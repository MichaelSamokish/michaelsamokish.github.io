var Qt=Object.defineProperty;var es=(i,e,t)=>e in i?Qt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>es(i,typeof e!="symbol"?e+"":e,t);import{d as U,g as St,c as ae,r as Q,a as b,b as X,o as m,e as V,f as p,u as te,R as ts,_ as z,v as xt,h as at,i as Ct,j as L,k as Ze,l as Ne,w as he,m as q,n as B,t as $,p as oe,q as de,F as J,s as _e,x as M,T as ss,y as os,z as be,A as pe,B as Et,C as me,D as ns,E as Lt,G as qe,H as Pt,I as rt,J as is,K as as,L as kt,M as rs,N as ls,O as us,P as ds,Q as cs,S as hs,U as fs,V as ps,W as ms}from"./vendor-Bk_n0JeD.js";import{w as Xt,F as R,i as fe,f as l,v as P,L as Nt,a as He,b as Se,d as $e,m as H,n as Yt,c as Ue,s as we,u as k,e as j,g as se,h as Be,j as vs,k as Ve,l as re,o as gs,p as wt,q as yt,r as Ht,t as ws,x as Fe,y as ys,z as lt,A as Vs,M as Ut,D as Mt,P as zt,B as It,C as _s,E as bs,G as Qe,H as Oe,I as Ss,J as pt,S as xs,K as Cs,N as Ps,O as Ge,Q as et,R as Rt,T as ks,U as Ns,W as Ms,V as Is,X as $s,Y as Os,Z as Ls,_ as Rs,$ as Dt,a0 as Ds,a1 as ke,a2 as ot,a3 as Ts,a4 as ut,a5 as Wt,a6 as dt,a7 as Ee,a8 as tt,a9 as Xe,aa as Tt,ab as mt,ac as As,ad as Ft}from"./three-CgwMEhLJ.js";import{i as Bs}from"./icons-CNPGi31y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const Gs={key:0,class:"gpu-error-box disable-user-select"},Es={class:"gpu-error-message-box"},Xs={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},Ys={key:2,class:"gpu-error-box disable-user-select"},Hs={class:"gpu-error-message-box"},Us={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},zs=U({__name:"App",setup(i){document.onkeydown=n=>{n.key=="F12"&&n.preventDefault()};const e=St(),t=localStorage.getItem("userLang");t&&e!=null&&(e.appContext.config.globalProperties.$i18n.locale=t);const s=ae(()=>navigator.gpu),o=ae(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));return(n,a)=>{const u=Q("font-awesome-icon");return o.value?(m(),b("div",Gs,[V("div",Es,[V("div",Xs,[p(u,{icon:["fas","circle-xmark"]})]),a[0]||(a[0]=V("h1",null,"Mobile devices not supported yet",-1))])])):s.value?(m(),X(te(ts),{key:1})):(m(),b("div",Ys,[V("div",Hs,[V("div",Us,[p(u,{icon:["fas","circle-xmark"]})]),a[1]||(a[1]=V("h1",null,"WebGPU is not supported on this browser.",-1))])]))}}}),Ws=z(zs,[["__scopeId","data-v-b1dd4320"]]);class qt{constructor(){r(this,"Id",xt());r(this,"In",null);r(this,"Out",null);r(this,"IsSelected",!1)}SetSelected(e){var s,o,n;var t=this.In!=null?(s=this.In.ParentNode)==null?void 0:s.ParentGraph:(n=(o=this.Out)==null?void 0:o.ParentNode)==null?void 0:n.ParentGraph;t!=null&&e==!0&&t.DeselectAll(),this.IsSelected=e}DeleteLinkFromTerminals(){var s,o;var e=(s=this.In)==null?void 0:s.Links.indexOf(this);e!=null&&this.In!=null&&this.In.Links.splice(e,1);var t=(o=this.Out)==null?void 0:o.Links.indexOf(this);t!=null&&this.Out!=null&&this.Out.Links.splice(t,1)}}class T{constructor(e,t){r(this,"X",0);r(this,"Y",0);this.X=e,this.Y=t}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get Normalized(){return T.Div(this,this.Length)}Reset(){this.X=0,this.Y=0}static Add(e,t){return t instanceof T?new T(e.X+t.X,e.Y+t.Y):typeof t=="number"?new T(e.X+t,e.Y+t):e}static Sub(e,t){return t instanceof T?new T(e.X-t.X,e.Y-t.Y):typeof t=="number"?new T(e.X-t,e.Y-t):e}static Mul(e,t){return t instanceof T?new T(e.X*t.X,e.Y*t.Y):typeof t=="number"?new T(e.X*t,e.Y*t):e}static Div(e,t){return t instanceof T?new T(e.X/t.X,e.Y/t.Y):typeof t=="number"?new T(e.X/t,e.Y/t):e}}var Zt=(i=>(i[i.none=0]="none",i[i.Buffer=1]="Buffer",i[i.Primitives=2]="Primitives",i[i.GeoPrimitives=3]="GeoPrimitives",i[i.Warps=4]="Warps",i[i.Adjastments=5]="Adjastments",i[i.Profile=6]="Profile",i[i.Filters=7]="Filters",i[i.Erosion=8]="Erosion",i[i.Snow=9]="Snow",i[i.Water=10]="Water",i[i.Data=11]="Data",i[i.Color=12]="Color",i[i.Render=13]="Render",i[i.Output=14]="Output",i))(Zt||{}),Re=(i=>(i[i.NotCalculated=0]="NotCalculated",i[i.Calculation=1]="Calculation",i[i.Calculated=2]="Calculated",i))(Re||{});class N{constructor(e,t,s,o=0,n=0,a="",u=""){r(this,"Name","");r(this,"Description","");r(this,"Value");r(this,"Min",-10);r(this,"Max",10);r(this,"Suffix");r(this,"Category");r(this,"Step");r(this,"valueList");r(this,"Default");this.Name=e,this.Value=t,this.Default=t,this.Min=typeof s=="number"?s:0,this.Max=o,this.Suffix=u,this.Category=a,this.Step=n,this.valueList=s instanceof Array?s:void 0}Reset(){this.Value=this.Default}}class ee{constructor(){r(this,"Id",xt());r(this,"Position",new T(0,0));r(this,"LastPosition",new T(0,0));r(this,"Name","");r(this,"Category",Zt.none);r(this,"Properties");r(this,"Inputs",[]);r(this,"Outputs",[]);r(this,"IsSelected",!1);r(this,"Height",0);r(this,"Width",0);r(this,"IsCalculated",!1);r(this,"ParentGraph",null);r(this,"CalculationState",Re.NotCalculated);r(this,"IsRealtimeUpdate",!1);r(this,"DefaultOutput",0)}Move(e,t){this.Position=new T(e,t)}SetSize(e,t){this.Height=e,this.Width=t}SetSelected(e,t=!0){this.IsSelected=e;const s=ve();e&&t?s.SelectedNode=this:s.SelectedNode==this&&(s.SelectedNode=null)}SetLastPosition(e,t){this.LastPosition.X=e,this.LastPosition.Y=t}BaseCalculate(){this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,o;(o=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||o.SetNotCalculated()})}),this.Inputs.forEach(e=>{var t,s,o,n;e.IsConnected&&((s=(t=e.Links[0].In)==null?void 0:t.ParentNode)==null||s.Calculate(),(n=(o=e.Links[0].In)==null?void 0:o.ParentNode)==null||n.SetCalculated())})}SetNotCalculated(){this.CalculationState=Re.NotCalculated,this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,o;(o=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||o.SetNotCalculated()})})}SetCalculated(){this.CalculationState=Re.Calculated}Calculate(){}}class E{constructor(e,t,s){r(this,"Guid",xt());r(this,"Links",new Array);r(this,"IsInput",!1);r(this,"ParentNode",null);r(this,"Position",new T(0,0));r(this,"OffsetPosition",new T(0,0));r(this,"Value",null);r(this,"Name","");this.ParentNode=t,this.IsInput=e,this.Name=s}get IsConnected(){return this.Links.length>0}SetOffset(e,t){this.OffsetPosition=new T(e,t)}SetPosition(e,t){this.Position=new T(e,t)}}class K{static register(e){var t=new e;this.classMap.set(t.constructor.name,e)}static registerStr(e,t,s){this.classMap.set(e,s),this.groupsMap.has(t)||this.groupsMap.set(t,new Map);var o=this.groupsMap.get(t);o==null||o.set(e,s)}static create(e,...t){const s=this.classMap.get(e);if(!s)throw new Error(`Class ${e} not registered`);return new s(...t)}static getGroups(){return this.groupsMap}}r(K,"classMap",new Map),r(K,"groupsMap",new Map);class Ye{static Serialize(e){var a,u,h,d,f,_,v,c;var t=new Fs;if(e.Nodes!=null&&e.Nodes.length>0)for(const w of e.Nodes){var s=new qs;if(s.NodeType=w.Name,s.NodeGuid=w.Id,s.NodePostition=w.Position,w.Properties!=null&&w.Properties.length>0)for(const y of w.Properties){var o=new Zs;o.Value=y.Value,s.Properties==null&&(s.Properties=new Array),s.Properties.push(o)}t.Nodes==null&&(t.Nodes=new Array),t.Nodes.push(s)}if(e.Links!=null&&e.Links.length>0)for(const w of e.Links){var n=new js;n.FromNodeGuid=(u=(a=w.In)==null?void 0:a.ParentNode)==null?void 0:u.Id,n.ToNodeGuid=(d=(h=w.Out)==null?void 0:h.ParentNode)==null?void 0:d.Id,n.FromTerminalIndex=(_=(f=w.In)==null?void 0:f.ParentNode)==null?void 0:_.Outputs.indexOf(w.In),n.ToTerminalIndex=(c=(v=w.Out)==null?void 0:v.ParentNode)==null?void 0:c.Inputs.indexOf(w.Out),t.Links==null&&(t.Links=new Array),t.Links.push(n)}return t}static Deserialize(e){var t=new Vt;if(e.Nodes!=null&&e.Nodes.length>0)for(var s of e.Nodes){var o=K.create(s.NodeType);if(o.Id=s.NodeGuid,o.Move(s.NodePostition.X,s.NodePostition.Y),s.Properties!=null&&s.Properties.length>0)for(var n=0;n<s.Properties.length;n++)o.Properties[n].Value=s.Properties[n].Value;t.AddNode(o,!1)}if(e.Links!=null&&e.Links.length>0)for(var a of e.Links){var u=at(t.Nodes).firstOrDefault(d=>d.Id==a.FromNodeGuid),h=at(t.Nodes).firstOrDefault(d=>d.Id==a.ToNodeGuid);u==null||h==null||t.AddLink(u.Outputs[a.FromTerminalIndex],h.Inputs[a.ToTerminalIndex],!1)}return t}}class Fs{constructor(){r(this,"Nodes");r(this,"Links")}static ToJson(e){return JSON.stringify(e)}}class qs{constructor(){r(this,"NodeGuid");r(this,"NodeType");r(this,"NodePostition");r(this,"Properties")}}class Zs{constructor(){r(this,"Value")}}class js{constructor(){r(this,"FromNodeGuid");r(this,"ToNodeGuid");r(this,"FromTerminalIndex");r(this,"ToTerminalIndex")}}class Ks{constructor(e){r(this,"buffer");r(this,"capacity");r(this,"head",0);r(this,"tail",0);r(this,"size",0);r(this,"poppedItems",[]);if(e<=0)throw new Error("Capacity must be greater than 0");this.capacity=e,this.buffer=new Array(e)}get hasValues(){return this.size>0}get hasPoppedItems(){return this.poppedItems.length>0}push(e){this.poppedItems=[],this.size===this.capacity?(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.head=(this.head+1)%this.capacity):(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++)}pop(){if(!this.hasValues)return;this.tail=(this.tail-1+this.capacity)%this.capacity;const e=this.buffer[this.tail];return this.size--,this.poppedItems.push(e),e}unpop(){if(!this.hasPoppedItems)return;const e=this.poppedItems.pop();return this.size===this.capacity&&(this.head=(this.head+1)%this.capacity),this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++,e}toArray(){const e=[];for(let t=0;t<this.size;t++){const s=(this.head+t)%this.capacity;e.push(this.buffer[s])}return e}peek(){if(this.hasValues)return this.buffer[(this.tail-1+this.capacity)%this.capacity]}get length(){return this.size}}class ye{static get HasValues(){return this.ActionHistoryBuffer.hasValues}static get HasPopped(){return this.ActionHistoryBuffer.hasPoppedItems}static PushState(e){this.ActionHistoryBuffer.push(Ye.Serialize(e))}static UnpopState(){if(this.ActionHistoryBuffer.hasPoppedItems){var e=this.ActionHistoryBuffer.unpop();return Ye.Deserialize(e)}return null}static PopState(){if(this.ActionHistoryBuffer.hasValues){var e=this.ActionHistoryBuffer.pop();return Ye.Deserialize(e)}return null}}r(ye,"ActionHistoryBuffer",new Ks(25));class Vt{constructor(){r(this,"IsSubGraph",!1);r(this,"Nodes",new Array);r(this,"Links",new Array)}get HasSelected(){return this.Nodes.some(e=>e.IsSelected)||this.Links.some(e=>e.IsSelected)}AddNode(e,t=!0){var s=this.Nodes.indexOf(e);s==-1&&(e.ParentGraph=this,this.Nodes.push(e),t&&ye.PushState(this))}DeleteLink(e,t=!0){var s=this.Links.indexOf(e);s!=-1&&(e.DeleteLinkFromTerminals(),this.Links.splice(s,1),t&&ye.PushState(this))}AddLink(e,t,s=!0){if(!(e.IsInput&&t.IsInput||!e.IsInput&&!t.IsInput)){var o=new qt;e.IsInput?(o.In=t,o.Out=e):(o.In=e,o.Out=t),t.Links.push(o),e.Links.push(o),this.Links.push(o),s&&ye.PushState(this)}}DeleteNode(e,t=!0){if(e!=null){var s=ve();s.SelectedNode==e&&(s.SelectedNode=null),s.LockedNode==e&&(s.LockedNode=null),e.Inputs.forEach(n=>{var a=n.Links.map(u=>u);a.forEach(u=>{this.DeleteLink(u)})}),e.Outputs.forEach(n=>{var a=n.Links.map(u=>u);a.forEach(u=>{this.DeleteLink(u)})});var o=this.Nodes.indexOf(e);o!=-1&&this.Nodes.splice(o,1),t&&ye.PushState(this)}}DeleteSelected(e=!0){this.Nodes.filter(s=>s.IsSelected).forEach(s=>this.DeleteNode(s,!1));var t=ve();t.SelectedNode=void 0,this.Links.filter(s=>s.IsSelected).forEach(s=>this.DeleteLink(s,!1)),e&&ye.PushState(this)}DeselectAll(){var e=ve();e.SelectedNode=void 0,this.Nodes.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1)),this.Links.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1))}SelectAll(){this.Nodes.forEach(e=>e.SetSelected(!0))}}const ct=Ct("drag",()=>{const i=L(!1),e=L(),t=L(),s=L();function o(a){s.value=a}function n(){return s.value}return{setNode:o,getNode:n,SourceTerminal:e,DestinationTerminal:t,IsDragging:i}}),ve=Ct("nodes",()=>{const i=L(),e=L(),t=L();return{SelectedNode:i,LockedNode:e,CurrentGraph:t}}),ge=Ct("renderer",()=>{const i=L(!1),e=L(),t=n=>{e.value=n},s=()=>e.value,o=L();return{ChangeEvent:i,Resolution:o,SetRenderer:t,GetRenderer:s}}),Js=U({__name:"HeapMonitor",setup(i){const e=L(0),t=L(0),s=()=>{setInterval(o,1e3)};Ze(()=>{s()});const o=()=>{performance&&performance.memory&&(e.value=performance.memory.usedJSHeapSize/1024/1024/1024,t.value=performance.memory.jsHeapSizeLimit/1024/1024/1024)};return(n,a)=>{const u=Q("font-awesome-icon"),h=Ne("tooltip");return m(),b("div",{onContextmenu:a[0]||(a[0]=he(()=>{},["prevent"])),class:"memory-usage"},[q((m(),b("span",null,[p(u,{icon:["fas","memory"]}),B(" "+$(e.value.toFixed(2))+" / "+$(t.value.toFixed(2))+" ",1),a[1]||(a[1]=V("span",null," GB",-1))])),[[h,"Heap memory usage",void 0,{up:!0}]])],32)}}}),Qs=z(Js,[["__scopeId","data-v-72365581"]]),eo={class:"status-bar-grid disable-user-select"},to={class:"working-status"},so=U({__name:"StatusBar",setup(i){ge();const e=L(0);return ae(()=>e.value),(t,s)=>{const o=Q("font-awesome-icon");return m(),b("div",eo,[V("div",to,[p(o,{icon:["fas","bars-progress"]}),s[0]||(s[0]=B(" Idle "))]),V("div",null,[p(Qs)])])}}}),oo=z(so,[["__scopeId","data-v-ddd0f7cf"]]),no={class:"collapse"},io={class:"carete"},ao={key:0,class:"collapse-body"},ro=U({__name:"Collapse",setup(i){var e=L(!1);const t=()=>{e.value=!e.value};return(s,o)=>{const n=Q("font-awesome-icon");return m(),b("div",no,[V("div",{onClick:t,class:"header"},[V("div",io,[te(e)?(m(),X(n,{key:0,icon:["fas","angle-right"]})):(m(),X(n,{key:1,icon:["fas","angle-down"]}))]),de(s.$slots,"header",{},void 0,!0)]),te(e)?oe("",!0):(m(),b("div",ao,[de(s.$slots,"default",{},void 0,!0)]))])}}}),jt=z(ro,[["__scopeId","data-v-ed8ad461"]]),st=R(([i])=>{const e=P(i).toVar();e.assign(e.modInt(l(289)));const t=l(l(34).mul(e.x).add(1).mul(e.x).modInt(289).add(e.y)).toVar();return t.assign(l(34).mul(t).add(l(1)).mul(t).modInt(289)),t.assign(Se(t.div(l(41))).mul(l(2)).sub(1)),Yt(P(t.sub(He(t.add(.5))),Ue(t).sub(.5)))}).setLayout({name:"gradientNoiseDir",type:"vec2",inputs:[{name:"p",type:"vec2"}]}),lo=R(([i])=>{const e=P(i).toVar(),t=P(He(e)).toVar(),s=P(Se(e)).toVar(),o=l($e(st(t),s)).toVar(),n=l($e(st(t.add(P(l(0),l(1)))),s.sub(P(l(0),l(1))))).toVar(),a=l($e(st(t.add(P(l(1),l(0)))),s.sub(P(l(1),l(0))))).toVar(),u=l($e(st(t.add(P(l(1),l(1)))),s.sub(P(l(1),l(1))))).toVar();return s.assign(s.mul(s).mul(s).mul(s.mul(s.mul(l(6)).sub(l(15))).add(l(10)))),H(H(o,n,s.y),H(a,u,s.y),s.x)}).setLayout({name:"gradientNoise",type:"float",inputs:[{name:"p",type:"vec2"}]}),Kt=R(([i])=>lo(i).add(.5)),ft=R(([i,e,t,s])=>{const o=fe(e).toVar(),n=l(s).toVar(),a=P(t.x,t.y).toVar(),u=P(i.x,i.y).sub(l(.5)).mul(n).toVar();u.addAssign(a);const h=l(0).toVar(),d=l(1).div(2).toVar();return Nt(o,({i:f})=>{const _=u.mul(l(2).pow(l(f))).toVar(),v=Kt(_).mul(d).toVar();d.divAssign(2),h.addAssign(v)}),h}).setLayout({name:"perlinNoise",type:"float",inputs:[{name:"UV",type:"vec2"},{name:"octaves",type:"int"},{name:"offset",type:"vec2"},{name:"scale",type:"float"}]}),uo=Xt(`
fn cracks(uv: vec2<f32>, angle: f32, scale: f32, thickness: f32) -> f32  {
	let st: vec2<f32> = (uv - 0.5) * scale;
	let i_st: vec2<f32> = floor(st);
	let f_st: vec2<f32> = fract(st);
	var m1: f32 = 1.;
	var m2: f32 = 1.;

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let neighbor: vec2<f32> = vec2<f32>(x, y);
			var point: vec2<f32> = random2(i_st + neighbor);
			point = 0.5 + 0.5 * sin(angle + 6.2831 * point);
			let diff: vec2<f32> = neighbor + point - f_st;
			let dist: f32 = length(diff);
			let cond: f32 = step(dist, m1);
			m2 = mix(min(max(m1, dist), m2), m1, cond);
			m1 = mix(m1, dist, cond);
		}

	}

	let edge: f32 = smoothstep(0.01, thickness, m2 - m1);
	return edge;
} 

fn random2(p: vec2<f32>) -> vec2<f32> {
	return fract(sin(vec2<f32>(dot(p, vec2<f32>(127.1, 311.7)), dot(p, vec2<f32>(269.5, 183.3)))) * 43758.547);
} 
`),vt=Xt(`
fn voronoi(UV: vec2<f32>, angleOffset: f32, cellDensity: f32) -> vec2<f32> {
	let g: vec2<f32> = floor((UV - 0.5) * cellDensity);
	let f: vec2<f32> = fract((UV - 0.5) * cellDensity);
	var res: vec3<f32> = vec3<f32>(8., 0., 0.);

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let lattice: vec2<f32> = vec2<f32>(x, y);
			let offset: vec2<f32> = voronoiNoiseRandomVector(lattice + g, angleOffset);
			let d: f32 = distance(lattice + offset, f);
			res = mix(res, vec3<f32>(d, offset.x, offset.y), step(d, res.x));
		}

	}

	return vec2<f32>(res.x, res.y);
} 

fn voronoiNoiseRandomVector(UV: vec2<f32>, offset: f32) -> vec2<f32> {
	var UV_var = UV;
	let m: mat2x2<f32> = mat2x2<f32>(15.27, 47.63, 99.41, 89.98);
	UV_var = fract(sin(UV_var * m) * 46839.32);
	return vec2<f32>(sin(UV_var.y * offset) * 0.5 + 0.5, cos(UV_var.x * offset) * 0.5 + 0.5);
}
`);class co extends ee{constructor(){super(...arguments);r(this,"Name","nodes.perlinNoise");r(this,"Outputs",[new E(!1,this,"Output")]);r(this,"Properties",[new N("Scale",10,0,100,0,"Transform","%"),new N("Octaves Count",10,1,50,1,"Noise",""),new N("Offset X",0,-100,100,0,"Transform",""),new N("Offset Y",0,-100,100,0,"Transform",""),new N("Warp Scale",0,0,1,.001,"Warp","%"),new N("Seed",0,0,99999,0,"Random",""),new N("Height",.4,0,1,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0);r(this,"Random",R(([t])=>{const s=P(t).toVar();return Se(we($e(s,P(12.9898,78.233))).mul(43758.5453))}))}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value);k(this.Properties[4].Value);const a=k(this.Properties[5].Value),u=k(this.Properties[6].Value);this.Outputs[0].Value=R(([h])=>{const d=P(h.x,h.y).toVar();return d.addAssign(this.Random(P(a).mul(a))),ft(d,s,P(o,n),t).mul(u)})}}const ho=U({__name:"DraggableNode",props:{GraphNode:{type:Function,required:!0}},setup(i){const e=ct(),t=i,s=L(),o=d=>{var _;if((_=d.dataTransfer)==null||_.setData("string","1"),t.GraphNode!=null&&t.GraphNode!=null){var f=t.GraphNode;e.setNode(new f)}};var n=void 0;const a=d=>{var v;n=(v=s.value)==null?void 0:v.cloneNode(!0);var f=n.getBoundingClientRect();if(n.style.position="fixed",n.style.left=`${d.touches[0].pageX-f.width/2}px`,n.style.top=`${d.touches[0].pageY-f.height/2}px`,n.style.zIndex="1000",document.body.appendChild(n),t.GraphNode!=null&&t.GraphNode!=null){var _=t.GraphNode;e.setNode(new _)}},u=d=>{if(n!=null){var f=n.getBoundingClientRect();n.style.left=`${d.touches[0].pageX-f.width/2}px`,n.style.top=`${d.touches[0].pageY-f.height/2}px`}},h=d=>{if(n!=null){document.body.removeChild(n),n=void 0,d.preventDefault(),d.stopPropagation();var f=d.changedTouches[0],_=document.elementFromPoint(f.clientX,f.clientY);console.log(_)}};return window.addEventListener("touchmove",u),window.addEventListener("touchend",h),(d,f)=>(m(),b("div",{onTouchstart:a,onDragstart:o,draggable:"true",class:"node",ref_key:"selfEl",ref:s},[de(d.$slots,"default",{},void 0,!0)],544))}}),fo=z(ho,[["__scopeId","data-v-ee47cd3c"]]),po={class:"node-list"},mo=U({__name:"NodeList",setup(i){var e=K.getGroups();return(t,s)=>{const o=Q("font-awesome-icon");return m(),b("div",po,[(m(!0),b(J,null,_e(te(e),([n,a])=>(m(),b(J,null,[n!=""?(m(),X(jt,{key:0},{header:M(()=>[B($(t.$t(n)),1)]),default:M(()=>[(m(!0),b(J,null,_e(a,([u,h])=>(m(),X(fo,{"-graph-node":h},{default:M(()=>[p(o,{icon:["fas","circle-nodes"]}),B(" "+$(t.$t(u)),1)]),_:2},1032,["-graph-node"]))),256))]),_:2},1024)):oe("",!0)],64))),256))])}}}),vo=z(mo,[["__scopeId","data-v-ff1a0b3e"]]),go={class:"padding"},wo={class:"header disable-user-select"},yo={class:"body disable-user-select"},Vo=U({__name:"FrameTab",props:{wheelFocus:{type:Boolean,default:!0}},setup(i){const e=i,t=L(),s=o=>{t.value&&e.wheelFocus&&t.value.focus()};return(o,n)=>(m(),b("div",go,[V("div",{class:"main",tabindex:"0",ref_key:"selfEl",ref:t,onWheel:s},[V("div",wo,[de(o.$slots,"header",{},void 0,!0)]),V("div",yo,[de(o.$slots,"default",{},void 0,!0)])],544)]))}}),ht=z(Vo,[["__scopeId","data-v-611ecd47"]]);class Le extends ee{constructor(){super(...arguments);r(this,"Name","nodes.buffer");r(this,"Inputs",[new E(!0,this,"")]);r(this,"Outputs",[new E(!1,this,"")])}Calculate(){this.BaseCalculate();var t=this.Inputs[0].Links[0].In,s=this.Outputs[0];s.Value=t==null?void 0:t.Value}}class _t{constructor(e,t,s,o){r(this,"X",0);r(this,"Y",0);r(this,"Height",0);r(this,"Width",0);this.X=e,this.Y=t,this.Height=s,this.Width=o}ContainsRect(e){return this.X<=e.X&&e.X+e.Width<=this.X+this.Width&&this.Y<=e.Y&&e.Y+e.Height<=this.Y+this.Height}ContainsPoint(e,t){return this.X<=e&&e<this.X+this.Width&&this.Y<=t&&t<this.Y+this.Height}IntersectsWith(e){return e.X<this.X+this.Width&&this.X<e.X+e.Width&&e.Y<this.Y+this.Height&&this.Y<e.Y+e.Height}static Intersects(e,t){return e.X<t.X+t.Width&&t.X<e.X+e.Width&&e.Y<t.Y+t.Height&&t.Y<e.Y+e.Height}}const _o=U({__name:"ContextMenu",props:{CloseOnAnyClick:{type:Boolean,default:!0},CloseOnMouseOut:{type:Boolean,default:!0}},emits:["lost-focus"],setup(i,{expose:e,emit:t}){const s=L(!1),o=L(),n=t,a=i,u=y=>{s.value=!0,be(()=>{o.value!=null&&o.value!=null&&(o.value.style.left=y.pageX+"px",o.value.style.top=y.pageY+"px",d(),window.addEventListener("mousedown",w))})},h=y=>{be(()=>{o.value!=null&&(o.value.style.width=y+"px")})},d=()=>{if(o.value!=null&&o.value!=null){const g=o.value.getBoundingClientRect();if(g.y+g.height>window.innerHeight){var y=g.y+g.height-window.innerHeight;o.value.style.top=g.y-y+"px"}if(g.y<0&&(o.value.style.top="0px"),g.x+g.width>window.innerWidth){var y=g.x+g.width-window.innerWidth;o.value.style.left=g.x-y+"px"}g.x<0&&(o.value.style.left="0px")}},f=y=>{s.value=!0,be(()=>{if(o.value!=null&&o.value!=null){var g=y.getBoundingClientRect();o.value.style.left=g.x+"px",o.value.style.top=g.y+g.height+"px",d(),window.addEventListener("mousedown",w)}})},_=y=>{s.value=!0,be(()=>{if(o.value!=null&&o.value!=null){var g=y.getBoundingClientRect(),x=o.value.getBoundingClientRect();o.value.style.left=g.x-x.width+"px",o.value.style.top=g.y+"px",d(),window.addEventListener("mousedown",w)}})},v=y=>{s.value=!0,be(()=>{if(o.value!=null&&o.value!=null){var g=y.getBoundingClientRect();o.value.style.left=g.x+g.width+"px",o.value.style.top=g.y+"px",d(),window.addEventListener("mousedown",w)}})},c=()=>{window.removeEventListener("mousedown",w),s.value=!1},w=y=>{if(a.CloseOnMouseOut&&o.value!=null){var g=o.value.getBoundingClientRect(),x=new _t(g.x,g.y,g.height,g.width);x.ContainsPoint(y.clientX,y.clientY)||(s.value=!1,window.removeEventListener("mousedown",w),n("lost-focus"))}};return e({Open:u,Close:c,OpenUnder:f,OpenLeft:_,OpenRight:v,SetWidth:h,isOpened:s}),(y,g)=>(m(),X(os,{name:"open"},{default:M(()=>[(m(),X(ss,{to:"body"},[s.value?(m(),b("div",{key:0,onContextmenu:g[0]||(g[0]=he(()=>{},["prevent"])),onMousedown:g[1]||(g[1]=he(()=>{},["stop"])),ref_key:"ContextMenu",ref:o,class:"context-menu disable-user-select"},[de(y.$slots,"default",{},void 0,!0)],544)):oe("",!0)]))]),_:3}))}}),je=z(_o,[["__scopeId","data-v-bc41e1a3"]]);class At{static pathExists(e,t){if(e===t)return!0;const s=new Set;return this.dfs(e,t,s)}static dfs(e,t,s){if(e===t)return!0;if(s.has(e))return!1;s.add(e);for(const o of e.Outputs)for(const n of o.Links)if(n.Out!=null&&n.Out!=null){const a=n.Out.ParentNode;if(this.dfs(a,t,s))return!0}return!1}}const bo=U({__name:"TerminalRenderer",props:{Term:{type:E,required:!0}},setup(i,{expose:e}){const t=L(!1),s=ct(),o=i,n=_=>{s.SourceTerminal=o.Term,s.IsDragging=!0,window.addEventListener("mouseup",a)},a=_=>{var y,g,x;window.removeEventListener("mouseup",a),s.IsDragging=!1;var v=s.DestinationTerminal,c=s.SourceTerminal;if(v!=null&&v!=c&&!(c!=null&&c.IsInput&&v.IsInput)&&(c==null?void 0:c.ParentNode)!=v.ParentNode){if(c!=null&&c.IsInput){if(At.pathExists(c==null?void 0:c.ParentNode,v.ParentNode))return;c.Links.forEach(C=>{var O,Y;(Y=(O=c==null?void 0:c.ParentNode)==null?void 0:O.ParentGraph)==null||Y.DeleteLink(C)})}if(v.IsInput){if(At.pathExists(v==null?void 0:v.ParentNode,c==null?void 0:c.ParentNode))return;v.Links.forEach(C=>{var O,Y;(Y=(O=v==null?void 0:v.ParentNode)==null?void 0:O.ParentGraph)==null||Y.DeleteLink(C)})}(g=(y=o.Term.ParentNode)==null?void 0:y.ParentGraph)==null||g.AddLink(v,c);var w=ge();(x=o.Term.ParentNode)!=null&&x.IsRealtimeUpdate&&(w.ChangeEvent=!w.ChangeEvent)}},u=_=>{s.IsDragging&&(s.DestinationTerminal=o.Term)},h=_=>{s.IsDragging&&(s.DestinationTerminal=null)},d=L();Ze(()=>{be(()=>{f()})});const f=()=>{var c,w,y,g;var _=((c=d.value)==null?void 0:c.offsetLeft)+((w=d.value)==null?void 0:w.offsetWidth)/2+2,v=((y=d.value)==null?void 0:y.offsetTop)+((g=d.value)==null?void 0:g.offsetHeight)/2+2;o.Term.SetOffset(_,v)};return e({SetOffset:f}),(_,v)=>{const c=Ne("tooltip");return q((m(),b("div",{class:pe(["node-terminal",{connected:o.Term.IsConnected},"disable-user-select",{"build-marker":t.value}]),onMousedown:[v[0]||(v[0]=he(()=>{},["right","stop"])),he(n,["left"])],onMouseover:u,onMouseleave:h,ref_key:"selfEl",ref:d},null,34)),[[c,{content:o.Term.Name,placement:o.Term.IsInput?"left":"right"}]])}}}),Bt=z(bo,[["__scopeId","data-v-ece7d6d8"]]),So=U({__name:"ContextMenuItem",props:{Active:{type:Boolean,default:!1}},setup(i){return(e,t)=>(m(),b("button",{class:pe([["btn",{active:i.Active}],"btn"]),style:{padding:"5px"}},[de(e.$slots,"default",{},void 0,!0)],2))}}),ue=z(So,[["__scopeId","data-v-3e13e567"]]),xo={},Co={class:"loader"};function Po(i,e){return m(),b("span",Co)}const Jt=z(xo,[["render",Po],["__scopeId","data-v-8c5c5c6f"]]);class nt extends ee{constructor(){super(...arguments);r(this,"Name","nodes.combine");r(this,"Inputs",[new E(!0,this,"Source 1"),new E(!0,this,"Source 2")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Mode","Burn",["Burn","Darken","Difference","Dodge","Divide","Exclusion","HardLight","HardMix","Lighten","LinearBurn","LinearDodge","LinearLight","LinearLightAddSub","Multiply","Negation","Overlay","PinLight","Screen","SoftLight","Subtract","VividLight","Overwrite"]),new N("Strength",0,0,100,0,"","%")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=this.Properties[0].Value,s=k(this.Properties[1].Value);this.Outputs[0].Value=R(([o])=>{var h,d;if(!this.Inputs[0].IsConnected||!this.Inputs[1].IsConnected)return l(0);const n=(h=this.Inputs[0].Links[0].In)==null?void 0:h.Value(o).toVar(),a=(d=this.Inputs[1].Links[0].In)==null?void 0:d.Value(o).toVar(),u=s.mul(.01);switch(t){case"Burn":{const f=l(1).sub(l(1).sub(a).div(n)).toVar();return H(n,f,u)}case"Darken":{const f=re(n,a).toVar();return H(n,f,u)}case"Difference":{const f=Ue(a.sub(n)).toVar();return H(n,f,u)}case"Dodge":{const f=n.div(a.add(l(1e-12))).toVar();return H(n,f,u)}case"Divide":{const f=n.div(l(1).sub(a)).toVar();return H(n,f,u)}case"Exclusion":{const f=a.add(n).sub(l(2).mul(a).mul(n)).toVar();return H(n,f,u)}case"HardLight":{const f=l(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=l(se(2,n).mul(a)).toVar(),v=l(Be(a,.5)).toVar(),c=l(_.mul(v).add(l(1).sub(v).mul(f))).toVar();return H(n,c,u)}case"HardMix":{const f=l(Be(l(1).sub(n),a)).toVar();return H(n,f,u)}case"Lighten":{const f=Ve(a,n).toVar();return H(n,f,u)}case"LinearBurn":{const f=l(n.add(a.sub(1))).toVar();return H(n,f,u)}case"LinearDodge":{const f=n.add(a).toVar();return H(n,f,u)}case"LinearLight":{const f=l(gs(a.lessThan(.5),Ve(n.add(l(2).mul(a).sub(l(1))),l(0)),re(n.add(l(2).mul(a.sub(.5))),l(1)))).toVar();return H(n,f,u)}case"LinearLightAddSub":{const f=l(a.add(se(2,n).sub(1))).toVar();return H(n,f,u)}case"Multiply":{const f=n.mul(a).toVar();return H(n,f,u)}case"Negation":{const f=l(j(1,Ue(j(1,a).sub(n)))).toVar();return H(n,f,u)}case"Overlay":{const f=l(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=l(se(2,n).mul(a)).toVar(),v=l(Be(n,.5)).toVar(),c=l(_.mul(v).add(l(1).sub(v).mul(f))).toVar();return H(n,c,u)}case"PinLight":{const f=l(Be(.5,a)).toVar(),_=l(f.mul(Ve(se(2,n.sub(.5)),a))).toVar(),v=l(_.add(j(1,f).mul(re(se(2,n),a)))).toVar();return H(n,v,u)}case"Screen":{const f=l(j(1,j(1,a).mul(j(1,n)))).toVar();return H(n,f,u)}case"SoftLight":{const f=l(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=l(vs(n).mul(se(2,a).sub(1)).add(se(2,n).mul(j(1,a)))).toVar(),v=l(Be(a,.5)).toVar(),c=l(_.mul(v).add(l(1).sub(v).mul(f))).toVar();return H(n,c,u)}case"Subtract":{const f=n.sub(a).toVar();return H(n,f,u)}case"VividLight":{const f=l(j(1,j(1,a).div(se(2,n)))).toVar(),_=l(a.div(se(2,j(1,n)))).toVar(),v=l(Be(.5,n)).toVar(),c=l(_.mul(v).add(l(1).sub(v).mul(f))).toVar();return H(n,c,u)}case"Overwrite":return H(n,a,u)}return l(0)})}}class it extends ee{constructor(){super(...arguments);r(this,"Name","nodes.export");r(this,"Inputs",[new E(!0,this,"Input")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate()}}const ko={class:"node-container"},No={class:"node-terminals left"},Mo={class:"node-center"},Io={class:"node-name"},$o={class:"node-terminals right"},Oo=U({__name:"NodeRenderer",props:{Offset:{type:T,required:!0},Zoom:{type:Number,required:!0},Node:{type:ee,required:!0},AllNodes:{type:Array,default:new Array}},setup(i){Et(S=>({cf56fb90:h.value,"85b4394c":d.value}));var e=i;const t=L(),s=me("contextMenu"),o=me("terminals");Ze(()=>{window.addEventListener("mousemove",Z),window.addEventListener("mouseup",C),be(()=>{var S=e.Node,I=t.value;if(S.SetSize(I.offsetHeight,I.offsetWidth),S.Move(S.Position.X-S.Width/2,S.Position.Y-S.Height/2),t!=null){var D=new ResizeObserver(c);D.observe(t.value)}})});const n=L(new T(0,0)),a=L(!1),u=ae(()=>{var S=ve();return S.LockedNode==e.Node});ae(()=>{var S=e.Node.Position.Y;return S+"px"}),ae(()=>{var S=e.Node.Position.X;return S+"px"});const h=ae(()=>a.value?"grabbing":"default"),d=ae(()=>e.Node.IsSelected?"1":"0"),f=ae(()=>{var S=ve(),I=S.LockedNode;return I!=null&&I==e.Node}),_=S=>{var I;(I=s.value)==null||I.Open(S)},v=()=>{var S;(S=s.value)==null||S.Close()},c=()=>{var S;o.value!=null&&((S=o.value)==null||S.forEach(I=>{I==null||I.SetOffset()}))},w=()=>{var S=ve(),I=ge();S.LockedNode==e.Node?S.LockedNode=null:(S.LockedNode=e.Node,e.Node.SetSelected(!0),I.ChangeEvent=!I.ChangeEvent)},y=(S,I,D)=>{var A,W,F,ce,ie;if(a.value=!0,n.value.X=S,n.value.Y=I,D)e.Node.SetSelected(!((A=e.Node)!=null&&A.IsSelected));else{var G=(W=e.Node.ParentGraph)==null?void 0:W.Nodes.filter(le=>le.IsSelected);G.length>1?e.Node.IsSelected==!1&&((F=e.Node.ParentGraph)==null||F.DeselectAll(),e.Node.SetSelected(!0)):((ce=e.Node.ParentGraph)==null||ce.DeselectAll(),e.Node.SetSelected(!0))}(ie=e.Node.ParentGraph)==null||ie.Nodes.filter(le=>le.IsSelected).forEach(le=>{le.SetLastPosition(le.Position.X,le.Position.Y)}),ye.PushState(e.Node.ParentGraph)},g=S=>{if(o.value!=null&&o.value.some(G=>G.$el==S.target||G==S.target))return;let I=S.touches[0].clientX,D=S.touches[0].clientY;y(I,D,!1)},x=S=>{o.value!=null&&o.value.some(I=>I.$el==S.target||I==S.target)||y(S.clientX,S.clientY,S.shiftKey)},C=S=>{a.value=!1},O=S=>{a.value=!1},Y=S=>{let I=S.touches[0].clientX,D=S.touches[0].clientY;ne(I,D)},ne=(S,I)=>{var A;if(a.value){var D=(S-n.value.X)/e.Zoom,G=(I-n.value.Y)/e.Zoom;(A=e.Node.ParentGraph)==null||A.Nodes.filter(W=>W.IsSelected).forEach(W=>{W.Move(W.LastPosition.X+D,W.LastPosition.Y+G)})}},Z=S=>{ne(S.clientX,S.clientY)};return(S,I)=>{const D=Q("font-awesome-icon"),G=Ne("tooltip");return m(),b("div",{class:pe([{node:!(i.Node instanceof te(Le))&&!(i.Node instanceof te(nt))&&!(i.Node instanceof te(it))},{"node-buffer":i.Node instanceof te(Le)||i.Node instanceof te(nt)||i.Node instanceof te(it)},"disable-user-select",{"not-calculated":i.Node.CalculationState==te(Re).NotCalculated&&!(i.Node instanceof te(Le))},{selected:i.Node.IsSelected},{lockedPreview:u.value},{"node-without-inputs":i.Node.Inputs.length==0}]),style:ns({top:te(e).Node.Position.Y+"px",left:te(e).Node.Position.X+"px"}),ref_key:"rootEl",ref:t,onMousedown:[he(x,["left"]),he(_,["right"])],onTouchmove:Y,onTouchstart:g,onTouchend:O},[V("div",ko,[V("div",No,[(m(!0),b(J,null,_e(i.Node.Inputs,A=>(m(),X(Bt,{ref_for:!0,ref_key:"terminals",ref:o,key:A.Guid,Term:A},null,8,["Term"]))),128))]),V("div",Mo,[i.Node instanceof te(Le)?(m(),X(D,{key:0,icon:"fa-solid fa-code-commit"})):i.Node instanceof te(nt)?(m(),b(J,{key:1},[q((m(),b("a",{class:"lock-icon",onClick:I[0]||(I[0]=A=>w())},[f.value?(m(),X(D,{key:0,icon:["fas","lock"]})):(m(),X(D,{key:1,icon:["fas","lock-open"]}))])),[[G,{content:S.$t("tt.lockPreview"),placement:"bottom"}]]),p(D,{icon:"fa-solid fa-code-fork",rotation:"270"})],64)):i.Node instanceof te(it)?(m(),X(D,{key:2,icon:"fa-solid fa-floppy-disk"})):(m(),b(J,{key:3},[q((m(),b("a",{class:"lock-icon",onClick:I[1]||(I[1]=A=>w())},[f.value?(m(),X(D,{key:0,icon:["fas","lock"]})):(m(),X(D,{key:1,icon:["fas","lock-open"]}))])),[[G,{content:S.$t("tt.lockPreview"),placement:"bottom"}]]),V("div",Io,$(S.$t(i.Node.Name)),1),i.Node.CalculationState==te(Re).Calculation?(m(),X(Jt,{key:0})):oe("",!0)],64))]),V("div",$o,[(m(!0),b(J,null,_e(i.Node.Outputs,A=>(m(),X(Bt,{ref_for:!0,ref_key:"terminals",ref:o,key:A.Guid,Term:A},null,8,["Term"]))),128))])]),p(je,{ref_key:"contextMenu",ref:s,CloseOnAnyClick:!0},{default:M(()=>[p(ue,null,{default:M(()=>[p(D,{icon:["far","copy"]}),B(" "+$(S.$t("tt.copy")),1)]),_:1}),p(ue,{onClick:I[2]||(I[2]=A=>{var W,F;(W=i.Node.ParentGraph)==null||W.DeleteNode(i.Node),(F=i.Node.ParentGraph)==null||F.DeleteSelected(),v()}),style:{color:"var(--vt-c-red)"}},{default:M(()=>[p(D,{icon:["far","trash-can"]}),B(" "+$(S.$t("tt.delete")),1)]),_:1}),I[4]||(I[4]=V("hr",null,null,-1)),p(ue,{onClick:I[3]||(I[3]=A=>{w(),v()})},{default:M(()=>[f.value?(m(),X(D,{key:0,icon:["fas","lock"]})):(m(),X(D,{key:1,icon:["fas","lock-open"]})),f.value?(m(),b(J,{key:2},[B("  "+$(S.$t("tt.unlockPreview")),1)],64)):(m(),b(J,{key:3},[B("  "+$(S.$t("tt.lockPreview")),1)],64))]),_:1})]),_:1,__:[4]},512)],38)}}}),Lo=z(Oo,[["__scopeId","data-v-176482e3"]]),Ro={},Do={class:"canvas",xmlns:"http://www.w3.org/2000/svg"};function To(i,e){return m(),b("svg",Do,[de(i.$slots,"default",{},void 0,!0)])}const Ao=z(Ro,[["render",To],["__scopeId","data-v-81940268"]]),Bo=["points"],Go=U({__name:"LinkRenderer",props:{Link:{type:qt,required:!0}},setup(i){const e=i,t=()=>{e.Link.SetSelected(!0)},s=n=>{var f;var a=e.Link.In,u=e.Link.Out;if(!(a==null||u==null)){var h=new Le;h.Move(n.offsetX,n.offsetY);var d=(f=a.ParentNode)==null?void 0:f.ParentGraph;d!=null&&(d.DeleteLink(e.Link),d.AddNode(h),d.AddLink(a,h.Inputs[0]),d.AddLink(h.Outputs[0],u))}},o=ae(()=>{var u,h,d,f,_,v;var n=T.Add((h=(u=e.Link.In)==null?void 0:u.ParentNode)==null?void 0:h.Position,(d=e.Link.In)==null?void 0:d.OffsetPosition),a=T.Add((_=(f=e.Link.Out)==null?void 0:f.ParentNode)==null?void 0:_.Position,(v=e.Link.Out)==null?void 0:v.OffsetPosition);return`${n.X},${n.Y} ${n.X+20},${n.Y} ${a.X-20},${a.Y} ${a.X},${a.Y}`});return(n,a)=>(m(),b("polyline",{onClick:t,onDblclick:s,points:o.value,class:pe(["line",{selected:e.Link.IsSelected}])},null,42,Bo))}}),Eo=z(Go,[["__scopeId","data-v-ca4f4d6b"]]),Xo={},Yo={class:"tool-bar-container"};function Ho(i,e){return m(),b("div",Yo,[de(i.$slots,"default",{},void 0,!0)])}const bt=z(Xo,[["render",Ho],["__scopeId","data-v-b20ca96b"]]),Uo={},zo={class:"tool-bar-body"};function Wo(i,e){return m(),b("div",zo,[de(i.$slots,"default")])}const Pe=z(Uo,[["render",Wo]]),Fo={key:0,class:"selection-box"},qo={class:"offset-container",ref:"offset_container"},Zo=["points"],jo={key:1,style:{"pointer-events":"none",height:"100%",width:"100%",padding:"30px",position:"absolute"}},Ko={style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%","border-radius":"50px",border:"4px dashed var(--vt-c-black-mute)",color:"var(--vt-c-black-mute)"}},Jo={style:{"font-size":"50px","font-weight":"bold","text-shadow":"0px 0px 20px black"}},Qo=U({props:{MinScale:{type:Number,default:.5},MaxScale:{type:Number,default:2}},data(){return{Offset:new T(0,0),SelectionBox:new _t(0,0,0,0),SelectionBoxVisibility:!1,LastMouse:new T(0,0),LastOffset:new T(0,0),Zoom:1,isDragging:!1,_Graph:new Vt,dragStore:ct(),points:"",GridSize:20,isDragOver:!1}},computed:{Nodes:function(){return this._Graph.Nodes},OffsetXStyle:function(){return this.Offset.X+"px"},OffsetYStyle:function(){return this.Offset.Y+"px"},EditorCursor:function(){return this.isDragging?"grabbing":"default"},SelectionBoxX:function(){return this.SelectionBox.X+"px"},SelectionBoxY:function(){return this.SelectionBox.Y+"px"},SelectionBoxHeight:function(){return this.SelectionBox.Height+"px"},SelectionBoxWidth:function(){return this.SelectionBox.Width+"px"},OffsetStyle:function(){var i=this.GridSize/2*this.Zoom;return this.Offset.X-i+"px "+(this.Offset.Y-i)+"px"},ScaleGridStyle:function(){var i=(this.GridSize*this.Zoom).toString();return`${i}px ${i}px`}},created(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted(){this.$nextTick(()=>{var t;this.$el;var i=((t=this.$parent)==null?void 0:t.$el).parentElement;i!=null&&(i.onkeydown=this.KeysHandler),this._Graph=new Vt;var e=ve();e.CurrentGraph=this._Graph})},methods:{SaveGraph(){var i=Ye.Serialize(this._Graph),e=JSON.stringify(i);console.log(e);var t=JSON.parse(e);console.log(t);var s=Ye.Deserialize(t);console.log(s)},Undo(){var i=ye.PopState();i!=null&&(this._Graph=i)},Redo(){var i=ye.UnpopState();i!=null&&(this._Graph=i)},isChild(i,e){for(var t=e.parentNode;t!=null;){if(t==i)return!0;t=t.parentNode}return!1},dragenter(){this.isDragOver=!0},dragleave(i){var e=this.$el,t=i.target;this.isChild(e,t)||(this.isDragOver=!1)},drop(i){this.isDragOver=!1;var e=ct(),t=e.getNode();if(t!=null){var s=this.$refs.editor,o=s.getBoundingClientRect();if(o!=null){ye.PushState(this._Graph);var n=T.Div(new T(i.clientX-o.x-this.Offset.X,i.clientY-o.y-this.Offset.Y),this.Zoom);t==null||t.Move(n.X,n.Y),this._Graph.AddNode(t)}}},KeysHandler(i){i.key=="Delete"&&(ye.PushState(this._Graph),this._Graph.DeleteSelected())},UpdateOffsetStyle(){var i=this.$refs.offset_container;i.style.left=this.OffsetXStyle,i.style.top=this.OffsetYStyle,i.style.scale=this.Zoom.toString()},OnMouseDownLeft:function(i){this.DrawGhostLine(i),i.target==this.$refs.editor&&(this.LastMouse=new T(i.clientX,i.clientY),this.SelectionBox.X=0,this.SelectionBox.Y=0,this.SelectionBox.Width=0,this.SelectionBox.Height=0,this.SelectionBoxVisibility=!0,this._Graph.DeselectAll())},OnMouseDownMiddle:function(i){this.isDragging=!0,this.LastMouse=new T(i.clientX,i.clientY),this.LastOffset={...this.Offset}},OnMouseMove:function(i){if(this.isDragging){i.preventDefault();var e=i.clientX-this.LastMouse.X,t=i.clientY-this.LastMouse.Y;this.Offset.X=this.LastOffset.X+e,this.Offset.Y=this.LastOffset.Y+t,this.UpdateOffsetStyle()}if(this.SelectionBoxVisibility){i.preventDefault();var s=new T(i.clientX,i.clientY),o=new T(Math.min(this.LastMouse.X,s.X),Math.min(this.LastMouse.Y,s.Y)),n=new T(Math.abs(this.LastMouse.X-s.X),Math.abs(this.LastMouse.Y-s.Y)),a=this.$refs.editor,u=a.getBoundingClientRect();this.SelectionBox.X=o.X-u.left,this.SelectionBox.Y=o.Y-u.top,this.SelectionBox.Width=n.X,this.SelectionBox.Height=n.Y,this._Graph.Nodes.forEach(h=>{var d=new _t(this.Offset.X+h.Position.X*this.Zoom,this.Offset.Y+h.Position.Y*this.Zoom,h.Height*this.Zoom,h.Width*this.Zoom);this.SelectionBox.IntersectsWith(d)?h.SetSelected(!0,!1):h.SetSelected(!1,!1)})}this.DrawGhostLine(i)},OnMouseUp:function(i){this.isDragging=!1,this.SelectionBoxVisibility=!1},OnWheel:function(i){let t=this.$refs.editor.getBoundingClientRect(),s=i.deltaY*.001,o=this.Zoom;this.Zoom=this.Clamp(this.Zoom-s,this.MinScale,this.MaxScale);let n=new T(i.clientX-t.left,i.clientY-t.top),a=(o-this.Zoom)/o;this.Offset=T.Add(this.Offset,T.Mul(T.Sub(n,this.Offset),a)),this.UpdateOffsetStyle()},DisableContextMenu(i){i.preventDefault()},Clamp:function(i,e,t){return Math.min(Math.max(i,e),t)},DrawGhostLine(i){var h;if(this.dragStore.IsDragging){var e=this.$refs.editor,t=e.getBoundingClientRect();if(i.preventDefault(),t!=null){var s=this.dragStore.SourceTerminal,o=T.Add((h=s.ParentNode)==null?void 0:h.Position,s.OffsetPosition),n=T.Div(new T(i.clientX-t.x-this.Offset.X,i.clientY-t.y-this.Offset.Y),this.Zoom),a=s.IsInput?n:o,u=s.IsInput?o:n;this.points=`${a.X},${a.Y} ${a.X+20},${a.Y} ${u.X-20},${u.Y} ${u.X},${u.Y}`}}}}}),en=U({...Qo,__name:"GraphRenderer",setup(i){return Et(e=>({"002c6548":e.EditorCursor,"2aba9081":e.SelectionBoxY,"2aba9080":e.SelectionBoxX,"0f8273c2":e.SelectionBoxHeight,"322179ce":e.SelectionBoxWidth,"3f222fda":e.ScaleGridStyle,"4a9860f6":e.OffsetStyle})),(e,t)=>{const s=Q("font-awesome-icon"),o=Ne("tooltip");return m(),b("div",{class:"graph-renderer dot",ref:"editor",onWheel:t[4]||(t[4]=(...n)=>e.OnWheel&&e.OnWheel(...n)),onMousedown:[t[5]||(t[5]=he((...n)=>e.OnMouseDownLeft&&e.OnMouseDownLeft(...n),["left"])),t[6]||(t[6]=he((...n)=>e.OnMouseDownMiddle&&e.OnMouseDownMiddle(...n),["middle"]))],onContextmenu:he(()=>!1,["prevent","right"]),onDragover:t[7]||(t[7]=he(()=>{},["prevent"])),onDragenter:t[8]||(t[8]=(...n)=>e.dragenter&&e.dragenter(...n)),onDragleave:t[9]||(t[9]=(...n)=>e.dragleave&&e.dragleave(...n)),onDrop:t[10]||(t[10]=(...n)=>e.drop&&e.drop(...n))},[p(bt,{class:"top-left"},{default:M(()=>[p(Pe,null,{default:M(()=>[q((m(),b("a",{onClick:t[0]||(t[0]=n=>e.Undo())},[p(s,{icon:["fas","rotate-left"]})])),[[o,e.$t("tt.undo"),void 0,{bottom:!0}]]),q((m(),b("a",{onClick:t[1]||(t[1]=n=>e.Redo())},[p(s,{icon:["fas","rotate-right"]})])),[[o,e.$t("tt.redo"),void 0,{bottom:!0}]])]),_:1}),p(Pe,null,{default:M(()=>[q((m(),b("a",null,[p(s,{icon:["far","copy"]})])),[[o,e.$t("tt.copy"),void 0,{bottom:!0}]]),q((m(),b("a",null,[p(s,{icon:["far","paste"]})])),[[o,e.$t("tt.paste"),void 0,{bottom:!0}]]),q((m(),b("a",{class:pe([{disabled:!e._Graph.HasSelected}]),style:{color:"var(--vt-c-red)"},onClick:t[2]||(t[2]=n=>e._Graph.DeleteSelected())},[p(s,{icon:["far","trash-can"]})],2)),[[o,e.$t("tt.delete"),void 0,{bottom:!0}]])]),_:1}),p(Pe,null,{default:M(()=>[q((m(),b("a",null,[p(s,{icon:["fas","expand"]})])),[[o,e.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),_:1})]),_:1}),p(bt,{class:"bottom-left"},{default:M(()=>[p(Pe,null,{default:M(()=>[V("span",null,[e.Zoom<1?(m(),X(s,{key:0,icon:["fas","magnifying-glass-minus"]})):(m(),X(s,{key:1,icon:["fas","magnifying-glass-plus"]})),B(" "+$((e.Zoom*100).toFixed(0))+"%",1)])]),_:1}),p(Pe,null,{default:M(()=>[V("span",null,[p(s,{icon:["fas","up-down-left-right"]}),B(" X: "+$(e.Offset.X.toFixed())+" Y: "+$(e.Offset.Y.toFixed()),1)])]),_:1}),p(Pe,null,{default:M(()=>[q((m(),b("a",{onClick:t[3]||(t[3]=n=>{e.Offset.Reset(),e.Zoom=1,e.UpdateOffsetStyle()})},[p(s,{icon:["fas","arrows-rotate"]})])),[[o,e.$t("tt.resetView")]])]),_:1}),p(Pe,null,{default:M(()=>[V("span",null,[p(s,{icon:["fas","circle-info"]}),B(" "+$(e.$t("hints.graphLmb")),1)])]),_:1}),p(Pe,null,{default:M(()=>[V("span",null,[p(s,{icon:["fas","circle-info"]}),B(" "+$(e.$t("hints.graphWheel")),1)])]),_:1})]),_:1}),e.SelectionBoxVisibility?(m(),b("div",Fo)):oe("",!0),V("div",qo,[p(Ao,{id:"links-container"},{default:M(()=>[p(Lt,{name:"link"},{default:M(()=>[(m(!0),b(J,null,_e(e._Graph.Links,n=>(m(),X(Eo,{key:n.Id,Link:n},null,8,["Link"]))),128))]),_:1}),e.dragStore.IsDragging?(m(),b("polyline",{key:0,class:"ghost-line",points:e.points},null,8,Zo)):oe("",!0)]),_:1}),p(Lt,{name:"delete",tag:"div"},{default:M(()=>[(m(!0),b(J,null,_e(e.Nodes,n=>(m(),X(Lo,{key:n.Id,Offset:e.Offset,Zoom:e.Zoom,Node:n},null,8,["Offset","Zoom","Node"]))),128))]),_:1})],512),e.isDragOver?(m(),b("div",jo,[V("div",Ko,[V("span",Jo,$(e.$t("hints.placeHere")),1)])])):oe("",!0)],544)}}}),tn=z(en,[["__scopeId","data-v-df584e7d"]]),sn={style:{height:"100%",display:"flex","flex-direction":"row"}},on={style:{"margin-left":"5px"}},nn={style:{"margin-left":"5px"}},an=U({__name:"EditorView",setup(i){return(e,t)=>{const s=Q("font-awesome-icon");return m(),b("div",sn,[p(ht,{style:{width:"20%","min-width":"300px"}},{header:M(()=>[p(s,{icon:["fas","list"]}),t[0]||(t[0]=B()),V("span",on,$(e.$t("windows.nodesList")),1)]),default:M(()=>[p(vo)]),_:1}),p(ht,{style:{width:"80%"}},{header:M(()=>[p(s,{icon:["fas","circle-nodes"]}),t[1]||(t[1]=B()),V("span",nn,$(e.$t("windows.graph")),1)]),default:M(()=>[p(tn)]),_:1})])}}}),rn={style:{display:"flex","flex-direction":"row"}},ln={style:{width:"100%","font-weight":"bold","text-align":"left","margin-left":"35px"}},un={style:{width:"100%","font-weight":"bold","text-align":"right","margin-right":"10px"}},dn={style:{width:"10px","margin-right":"10px"}},cn={key:0,class:"dropdown"},hn=["onClick"],fn=U({__name:"SelectDropdown",props:{options:{type:Array,required:!1,default:[]},title:{type:String,required:!1,default:""},default:{type:String,required:!1,default:null},modelValue:{type:String,default:""},RealtimeChange:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(i,{emit:e}){L(!1);const t=i,s=L(t.default?t.default:t.options.length>0?t.options[0]:null),o=L(!1);qe(()=>t.modelValue,a=>{s.value=a});const n=()=>{var a=ge();t.RealtimeChange&&(a.ChangeEvent=!a.ChangeEvent)};return(a,u)=>{const h=Q("font-awesome-icon");return m(),b("div",{class:"dropdown-head input-element value",tabindex:"0",onBlur:u[1]||(u[1]=d=>o.value=!1),style:{width:"100%",position:"relative"}},[V("div",{onClick:u[0]||(u[0]=d=>o.value=!o.value),style:{height:"100%"}},[V("div",rn,[V("div",ln,$(t.title)+$(t.title==""?"":":"),1),V("div",un,$(s.value),1),V("div",dn,[o.value?(m(),X(h,{key:1,icon:["fas","angle-up"]})):(m(),X(h,{key:0,icon:["fas","angle-down"]}))])])]),o.value?(m(),b("ul",cn,[(m(!0),b(J,null,_e(i.options,(d,f)=>(m(),b("li",{class:pe({selected:d==s.value}),key:f,onClick:_=>{s.value=d,o.value=!1,a.$emit("update:modelValue",s.value),n()}},$(d),11,hn))),128))])):oe("",!0)],32)}}}),pn=z(fn,[["__scopeId","data-v-eb9599f8"]]),mn=U({__name:"LangSwitch",setup(i){const e=St(),t=L("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);const s=h=>{e!=null&&(e.appContext.config.globalProperties.$i18n.locale=h,localStorage.setItem("userLang",h),t.value=h)},o=me("langContextMenu"),n=L(),a=h=>{var d;(n!=null||n!=null)&&((d=o.value)==null||d.OpenUnder(n.value))};var u=new Map;return u.set("en","English"),u.set("ru","Русский"),(h,d)=>{const f=Q("flag");return m(),b(J,null,[V("button",{ref_key:"langSwitchBtn",ref:n,class:"btn disable-user-select",onClick:a},[p(f,{iso:t.value=="en"?"gb":t.value},null,8,["iso"]),B(" "+$(te(u).get(t.value)),1)],512),p(je,{ref:"langContextMenu"},{default:M(()=>[V("button",{class:"btn btnContextMenuPadding",onClick:d[0]||(d[0]=_=>{var v;s("ru"),(v=o.value)==null||v.Close()})},[p(f,{iso:"ru"}),d[2]||(d[2]=B(" Русский"))]),V("button",{class:"btn btnContextMenuPadding",onClick:d[1]||(d[1]=_=>{var v;s("en"),(v=o.value)==null||v.Close()})},[p(f,{iso:"gb"}),d[3]||(d[3]=B(" English"))])]),_:1},512)],64)}}}),vn=U({__name:"ToggleButton",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const e=Pt(i,"modelValue");return(t,s)=>(m(),b("button",{class:pe(["btn",{toggled:e.value}]),onClick:s[0]||(s[0]=o=>e.value=!e.value)},[de(t.$slots,"default",{},void 0,!0)],2))}}),gn=z(vn,[["__scopeId","data-v-4a53f642"]]),wn=U({__name:"ResolutionSwitcher",setup(i){const e=St(),t=L("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);var s=ge();const o=me("contextMenu"),n=L(),a=_=>{var c,w,y;if(n!=null||n!=null){var v=(c=n.value)==null?void 0:c.getBoundingClientRect();(w=o.value)==null||w.OpenUnder(n.value),v!=null&&((y=o.value)==null||y.SetWidth(v.width))}},u=["0.5K","1K","2K","4K","8K"],h=[512,1024,2048,4096,8192],d=L(0),f=_=>{d.value=_;var v=s.GetRenderer();v!=null&&(v.ChangeResolution(h[_]),requestAnimationFrame(()=>v==null?void 0:v.Render()))};return(_,v)=>{const c=Q("font-awesome-icon"),w=Ne("tooltip");return m(),b(J,null,[q((m(),b("button",{ref_key:"switcher",ref:n,class:"btn disable-user-select",onClick:a},[p(c,{icon:["fas","vector-square"]}),B(" "+$(u[d.value])+" ",1),p(c,{icon:["fas","angle-down"]})])),[[w,_.$t("tt.mesh_resolution"),void 0,{bottom:!0}]]),p(je,{ref_key:"contextMenu",ref:o},{default:M(()=>[(m(),b(J,null,_e(u,(y,g)=>(m(),b(J,null,[g>2?q((m(),X(ue,{key:0,class:"waringText",Active:g==d.value,onClick:x=>{var C;f(g),(C=o.value)==null||C.Close()}},{default:M(()=>[p(c,{icon:["fas","vector-square"]}),B(" "+$(y),1)]),_:2},1032,["Active","onClick"])),[[w,{content:_.$t("tt.resolutionWarning"),html:!0,distance:15},void 0,{right:!0}]]):(m(),X(ue,{key:1,Active:g==d.value,onClick:x=>{var C;f(g),(C=o.value)==null||C.Close()}},{default:M(()=>[p(c,{icon:["fas","vector-square"]}),B(" "+$(y),1)]),_:2},1032,["Active","onClick"]))],64))),64))]),_:1},512)],64)}}}),Gt=z(wn,[["__scopeId","data-v-97dd3ce3"]]),yn={style:{height:"100%",width:"100%",position:"relative"}},Vn=["value"],_n=U({__name:"ProjectNameEditor",props:rt({modelValue:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:rt(["update:modelValue"],["update:modelValue"]),setup(i,{emit:e}){const t=Pt(i,"modelValue"),s=e,o=L(!1),n=L(),a=L(),u=()=>{o.value=!0,be(()=>{var _;a.value=t.value,(_=n.value)==null||_.focus()})},h=_=>{s("update:modelValue",a.value),o.value=!1},d=_=>{_.target!=null&&(a.value=_.target.value,s("update:modelValue",a.value))},f=_=>{_.key=="Enter"&&(_.target!=null&&(a.value=_.target.value,s("update:modelValue",a.value)),o.value=!1)};return(_,v)=>{const c=Q("font-awesome-icon"),w=Ne("tooltip");return m(),b("div",yn,[o.value?(m(),b("input",{key:0,ref_key:"input",ref:n,onFocusout:h,onInput:d,onKeypress:f,class:"editor",value:t.value},null,40,Vn)):q((m(),b("div",{key:1,class:"label",onClick:u},[B($(t.value),1)])),[[w,_.$t("tt.clickForEdit"),void 0,{bottom:!0}]]),p(c,{class:"icon",icon:["fas","pen"]})])}}}),bn=z(_n,[["__scopeId","data-v-7b27f16a"]]),Sn={class:"modal-container"},xn={class:"modal-header"},Cn={class:"title"},Pn={key:0,class:"closeButton"},kn={class:"modal-slot"},Nn={class:"modal-footer"},Mn=U({__name:"Modal",props:{closeButton:{type:Boolean,default:!0}},setup(i,{expose:e}){const t=i,s=L(!1);return e({Open:()=>{s.value=!0},Close:()=>{s.value=!1}}),(a,u)=>{const h=Q("font-awesome-icon");return s.value?(m(),b("div",{key:0,class:"modal-back",onClick:u[2]||(u[2]=d=>s.value=!1)},[V("div",{class:"modal-main",onClick:u[1]||(u[1]=he(()=>{},["stop"]))},[V("div",Sn,[V("div",xn,[V("div",Cn,[de(a.$slots,"title",{},void 0,!0)]),u[3]||(u[3]=V("div",{style:{width:"100%"}},null,-1)),t.closeButton?(m(),b("div",Pn,[V("button",{class:"btn",style:{margin:"0"},onClick:u[0]||(u[0]=d=>s.value=!1)},[p(h,{icon:"fa-solid fa-xmark"})])])):oe("",!0)]),V("div",kn,[de(a.$slots,"default",{},void 0,!0)]),V("div",Nn,[de(a.$slots,"footer",{},void 0,!0)])])])])):oe("",!0)}}}),$t=z(Mn,[["__scopeId","data-v-56059a2a"]]),In={style:{display:"flex"}},$n={style:{"margin-left":"0"},class:"btn btn-green footer-btn"},On=U({__name:"SettingsModal",setup(i,{expose:e}){const t=me("settingsModal");return e({Open:()=>{var o;(o=t.value)==null||o.Open()}}),(o,n)=>{const a=Q("font-awesome-icon");return m(),X($t,{ref_key:"settingsModal",ref:t},{title:M(()=>[p(a,{icon:["fas","gear"]}),B(" "+$(o.$t("tt.settings")),1)]),footer:M(()=>[V("div",In,[V("button",$n,[p(a,{icon:["fas","floppy-disk"]}),B(" "+$(o.$t("tt.saveSettings")),1)]),V("button",{class:"btn btn-red footer-btn",onClick:n[0]||(n[0]=u=>{var h;return(h=t.value)==null?void 0:h.Close()})},[p(a,{icon:"fa-solid fa-circle-xmark"}),B(" "+$(o.$t("tt.cancel")),1)])])]),_:1},512)}}}),Ln={},Rn={class:"container"},Dn={class:"format"};function Tn(i,e){const t=Q("font-awesome-icon");return m(),b("div",Rn,[e[1]||(e[1]=V("div",{class:"node-name"},"Erosion-evaporation:",-1)),e[2]||(e[2]=V("div",{class:"file-name"},[V("input",{type:"text",value:"Erosion-evaporation"})],-1)),V("button",Dn,[e[0]||(e[0]=B("PNG ")),p(t,{icon:["fas","angle-down"]})])])}const Ce=z(Ln,[["render",Tn],["__scopeId","data-v-c842a1c1"]]),An={class:"tabs-container"},Bn={class:"tabs"},Gn={key:0,class:"input-container"},En={style:{display:"flex"}},Xn={style:{"margin-left":"0"},class:"btn btn-green footer-btn"},Yn=U({__name:"BuildModal",setup(i,{expose:e}){const t=me("buildModal"),s=()=>{var n;(n=t.value)==null||n.Open()},o=L(0);return e({Open:s}),(n,a)=>{const u=Q("font-awesome-icon");return m(),X($t,{ref:"buildModal"},{title:M(()=>[p(u,{icon:"fa-solid fa-hammer"}),B(" "+$(n.$t("tt.buildSettings")),1)]),footer:M(()=>[V("div",En,[V("button",Xn,[p(u,{icon:"fa-solid fa-hammer"}),B(" "+$(n.$t("tt.build")),1)]),V("button",{class:"btn btn-red footer-btn",onClick:a[5]||(a[5]=h=>{var d;return(d=t.value)==null?void 0:d.Close()})},[p(u,{icon:"fa-solid fa-circle-xmark"}),B(" "+$(n.$t("tt.cancel")),1)])])]),default:M(()=>[V("div",An,[V("div",Bn,[V("button",{onClick:a[0]||(a[0]=h=>o.value=0),class:pe(["tab-item",{"tab-item-active":o.value==0}])},$(n.$t("buildModal.resolution")),3),V("button",{onClick:a[1]||(a[1]=h=>o.value=1),class:pe(["tab-item",{"tab-item-active":o.value==1}]),disabled:""},$(n.$t("buildModal.tiles")),3),V("button",{onClick:a[2]||(a[2]=h=>o.value=2),class:pe(["tab-item",{"tab-item-active":o.value==2}])},$(n.$t("buildModal.terrain")),3),V("button",{onClick:a[3]||(a[3]=h=>o.value=3),class:pe(["tab-item",{"tab-item-active":o.value==3}])},$(n.$t("buildModal.build")),3),V("button",{onClick:a[4]||(a[4]=h=>o.value=4),class:pe(["tab-item",{"tab-item-active":o.value==4}])},$(n.$t("buildModal.nodes")),3)]),o.value==4?(m(),b("div",Gn,[p(Ce),p(Ce),p(Ce),p(Ce),p(Ce),p(Ce),p(Ce),p(Ce),p(Ce)])):oe("",!0)])]),_:1},512)}}}),Hn=z(Yn,[["__scopeId","data-v-a8f672e9"]]),Un={style:{display:"flex"}},zn={style:{"margin-left":"0"},class:"btn btn-green footer-btn"},Wn=U({__name:"OpenModal",setup(i,{expose:e}){const t=me("openModal");return e({Open:()=>{var o;(o=t.value)==null||o.Open()}}),(o,n)=>{const a=Q("font-awesome-icon");return m(),X($t,{ref_key:"openModal",ref:t},{title:M(()=>[p(a,{icon:["fas","folder-open"]}),B(" "+$(o.$t("tt.load")),1)]),footer:M(()=>[V("div",Un,[V("button",zn,[p(a,{icon:["fas","folder-open"]}),B(" "+$(o.$t("tt.load")),1)]),V("button",{class:"btn btn-red footer-btn",onClick:n[0]||(n[0]=u=>{var h;return(h=t.value)==null?void 0:h.Close()})},[p(a,{icon:"fa-solid fa-circle-xmark"}),B(" "+$(o.$t("tt.cancel")),1)])])]),_:1},512)}}}),Fn={style:{"margin-left":"auto",right:"0px",height:"100%","white-space":"nowrap",overflow:"hidden"}},qn={class:"btn"},Zn={class:"btn"},jn={class:"btn"},Kn={class:"btn"},Jn={class:"btn"},Qn={class:"btn"},ei=550,ti=U({__name:"ActionButtonsBar",setup(i){const e=L(),t=me("contextMenu"),s=L(),o=L(),n=ve(),a=me("settingsModal"),u=me("buildModal"),h=me("openModal"),d=v=>{var c;(s!=null||s!=null)&&((c=t.value)==null||c.OpenUnder(s.value))},f=()=>{var w;var v=(w=e.value)==null?void 0:w.getBoundingClientRect();if(v!=null){var c=v==null?void 0:v.width;c!=null&&c<ei?o.value=!0:o.value=!1}};Ze(()=>{be(()=>{f(),window.addEventListener("resize",()=>{f()})})});const _=()=>{if(n.CurrentGraph!=null){var v=Ye.Serialize(n.CurrentGraph),c=JSON.stringify(v),w=document.createElement("a"),y=new Blob([c],{type:"text/plain"});w.href=URL.createObjectURL(y),w.download="untitled.json",w.click()}};return(v,c)=>{const w=Q("font-awesome-icon"),y=Q("font-awesome-layers"),g=Ne("tooltip");return m(),b(J,null,[V("div",{ref_key:"menuContainer",ref:e,style:{display:"flex",height:"100%",width:"100%","white-space":"nowrap",overflow:"hidden"}},[V("div",Fn,[o.value?(m(),b(J,{key:0},[p(Gt),c[12]||(c[12]=V("div",{class:"separator"},null,-1)),q((m(),b("button",{onClick:d,ref_key:"contextMenuButton",ref:s,class:"btn"},[p(w,{icon:["fas","fa-bars"]})])),[[g,v.$t("tt.menu"),void 0,{bottom:!0}]]),p(je,{ref_key:"contextMenu",ref:t},{default:M(()=>[p(ue,null,{default:M(()=>[p(w,{icon:["fas","file"]}),B(" "+$(v.$t("tt.new")),1)]),_:1}),p(ue,null,{default:M(()=>[p(w,{icon:["fas","floppy-disk"]}),B(" "+$(v.$t("tt.save")),1)]),_:1}),p(ue,{onClick:c[0]||(c[0]=x=>{var C,O;(C=h.value)==null||C.Open(),(O=t.value)==null||O.Close()})},{default:M(()=>[p(w,{icon:["fas","folder-open"]}),B(" "+$(v.$t("tt.load")),1)]),_:1}),c[8]||(c[8]=V("hr",null,null,-1)),p(ue,null,{default:M(()=>[p(w,{icon:["fas","rotate-left"]}),B(" "+$(v.$t("tt.undo")),1)]),_:1}),p(ue,null,{default:M(()=>[p(w,{icon:["fas","rotate-right"]}),B(" "+$(v.$t("tt.redo")),1)]),_:1}),c[9]||(c[9]=V("hr",null,null,-1)),p(ue,{onClick:c[1]||(c[1]=x=>{var C,O;(C=a.value)==null||C.Open(),(O=t.value)==null||O.Close()})},{default:M(()=>[p(w,{icon:["fas","gear"]}),B(" "+$(v.$t("tt.settings")),1)]),_:1}),c[10]||(c[10]=V("hr",null,null,-1)),p(ue,{onClick:c[2]||(c[2]=x=>{var C,O;(C=u.value)==null||C.Open(),(O=t.value)==null||O.Close()})},{default:M(()=>[p(y,{style:{width:"20px"}},{default:M(()=>[p(w,{icon:"fa-solid fa-hammer"}),p(w,{icon:["fas","gear"],transform:"shrink-8 left-8 up-6"})]),_:1}),B(" "+$(v.$t("tt.buildSettings")),1)]),_:1}),p(ue,{onClick:c[3]||(c[3]=x=>{var C;return(C=t.value)==null?void 0:C.Close()})},{default:M(()=>[p(w,{icon:"fa-solid fa-hammer"}),B(" "+$(v.$t("tt.build")),1)]),_:1}),c[11]||(c[11]=V("hr",null,null,-1)),p(ue,null,{default:M(()=>[p(w,{icon:["fas","expand"]}),B(" "+$(v.$t("tt.fullscreen")),1)]),_:1})]),_:1,__:[8,9,10,11]},512),c[13]||(c[13]=V("div",{class:"separator"},null,-1)),q((m(),b("button",qn,[p(w,{icon:["fas","rotate-left"]})])),[[g,v.$t("tt.undo"),void 0,{bottom:!0}]]),q((m(),b("button",Zn,[p(w,{icon:["fas","rotate-right"]})])),[[g,v.$t("tt.redo"),void 0,{bottom:!0}]])],64)):(m(),b(J,{key:1},[p(Gt),c[14]||(c[14]=V("div",{class:"separator"},null,-1)),q((m(),b("button",jn,[p(w,{icon:["fas","file"]})])),[[g,v.$t("tt.new"),void 0,{bottom:!0}]]),q((m(),b("button",{onClick:c[4]||(c[4]=x=>_()),class:"btn"},[p(w,{icon:["fas","floppy-disk"]})])),[[g,v.$t("tt.save"),void 0,{bottom:!0}]]),q((m(),b("button",{onClick:c[5]||(c[5]=x=>{var C;return(C=h.value)==null?void 0:C.Open()}),class:"btn"},[p(w,{icon:["fas","folder-open"]})])),[[g,v.$t("tt.load"),void 0,{bottom:!0}]]),c[15]||(c[15]=V("div",{class:"separator"},null,-1)),q((m(),b("button",Kn,[p(w,{icon:["fas","rotate-left"]})])),[[g,v.$t("tt.undo"),void 0,{bottom:!0}]]),q((m(),b("button",Jn,[p(w,{icon:["fas","rotate-right"]})])),[[g,v.$t("tt.redo"),void 0,{bottom:!0}]]),c[16]||(c[16]=V("div",{class:"separator"},null,-1)),q((m(),b("button",{onClick:c[6]||(c[6]=x=>{var C;return(C=a.value)==null?void 0:C.Open()}),class:"btn"},[p(w,{icon:["fas","gear"]})])),[[g,v.$t("tt.settings"),void 0,{bottom:!0}]]),c[17]||(c[17]=V("div",{class:"separator"},null,-1)),q((m(),b("button",{onClick:c[7]||(c[7]=x=>{var C;return(C=u.value)==null?void 0:C.Open()}),class:"btn"},[p(y,{style:{width:"20px"}},{default:M(()=>[p(w,{icon:"fa-solid fa-hammer"}),p(w,{icon:["fas","gear"],transform:"shrink-8 left-8 up-6"})]),_:1})])),[[g,v.$t("tt.buildSettings"),void 0,{bottom:!0}]]),q((m(),b("button",Qn,[p(w,{style:{color:"var(--vt-c-green)"},icon:"fa-solid fa-hammer"})])),[[g,v.$t("tt.build"),void 0,{bottom:!0}]]),c[18]||(c[18]=V("div",{class:"separator"},null,-1)),q((m(),X(gn,null,{default:M(()=>[p(w,{icon:["fas","expand"]})]),_:1})),[[g,v.$t("tt.fullscreen"),void 0,{bottom:!0}]])],64))])],512),p(On,{ref_key:"settingsModal",ref:a},null,512),p(Hn,{ref_key:"buildModal",ref:u},null,512),p(Wn,{ref_key:"openModal",ref:h},null,512)],64)}}}),si=z(ti,[["__scopeId","data-v-9c8ae11b"]]),oi={class:"disable-user-select left-section",style:{display:"flex","flex-direction":"row"}},ni={class:"logo disable-user-select",style:{"text-transform":"uppercase"}},ii={class:"padding"},ai={class:"middle-actions",style:{}},ri={style:{display:"flex","flex-direction":"row"}},li=U({__name:"MainMenuBar",setup(i){const e=L(!1);qe(e,(s,o)=>{s?document.documentElement.requestFullscreen():document.exitFullscreen()});const t=L("Untitled");return(s,o)=>(m(),b("div",{class:"main",onContextmenu:o[1]||(o[1]=he(()=>{},["prevent"]))},[V("div",oi,[V("div",ni,$(s.$t("logo")),1),p(si)]),V("div",ii,[V("div",ai,[p(bn,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=n=>t.value=n)},null,8,["modelValue"])])]),V("div",ri,[p(mn)])],32))}}),ui=z(li,[["__scopeId","data-v-58738f50"]]),di={style:{display:"flex"}},ci=["value","placeholder"],hi=U({__name:"ContextMenuInput",props:rt({Active:{type:Boolean,default:!1},Placeholder:{type:String,default:""},modelValue:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:rt(["update:modelValue"],["update:modelValue"]),setup(i,{emit:e}){var t=i;const s=Pt(i,"modelValue"),o=e,n=L(),a=d=>{o("update:modelValue",n.value)},u=d=>{d.target!=null&&(n.value=d.target.value,o("update:modelValue",n.value))},h=d=>{d.key=="Enter"&&d.target!=null&&(n.value=d.target.value,o("update:modelValue",n.value))};return(d,f)=>(m(),b("div",di,[V("input",{onFocusout:a,onInput:u,onKeypress:h,value:s.value,class:pe([{active:i.Active}]),placeholder:te(t).Placeholder,style:{padding:"5px"}},null,42,ci),de(d.$slots,"default",{},void 0,!0)]))}}),fi=z(hi,[["__scopeId","data-v-a59750ae"]]),pi={ref:"inputRange",class:"input-range"},mi=["value"],vi={class:"title"},gi={class:"valueText"},wi=U({props:{Min:Number,Max:Number,Suffix:String,Title:String,RealtimeChange:{type:Boolean,default:!0},Step:{type:Number,default:0},modelValue:{type:Number,default:0}},emits:["update:modelValue"],data(){return{IsDragging:!1,Value:0,lastPosition:new T(0,0),lastValue:0,IsInputVisible:!1,moveDistance:0}},created(){document.addEventListener("mousemove",this.OnMouseMove),document.addEventListener("mouseup",this.OnMouseUp),this.Value=this.modelValue},watch:{modelValue(i,e){this.Value=i}},methods:{ClickValue(i){this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+i,this.Min,this.Max):this.Value=this.Clamp(this.Value+(i>0?this.Step:-this.Step),this.Min,this.Max):this.Step==0?this.Value+=i:this.Value+=i>0?this.Step:-this.Step,this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnInput(i){this.Value=Number(i.target.value),this.Min!=null&&this.Max!=null&&(this.Value=this.Clamp(this.Value,this.Min,this.Max)),this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnMouseDown(i){this.IsInputVisible||(this.$el.requestPointerLock(),this.IsDragging=!0,this.lastPosition=new T(i.clientX,i.clientY),this.lastValue=this.Value,this.moveDistance=0)},OnMouseMove(i){this.IsDragging&&(this.moveDistance+=i.movementX,this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+i.movementX/(i.shiftKey?25:50),this.Min,this.Max):i.movementX!=0&&Math.abs(this.moveDistance)>=(i.shiftKey?25:50)&&(this.moveDistance=0,this.Value=this.Clamp(this.Value+(i.movementX>0?this.Step:-this.Step),this.Min,this.Max)):this.Step==0?this.Value+=i.movementX/(i.shiftKey?25:50):i.movementX!=0&&Math.abs(this.moveDistance)>=(i.shiftKey?25:50)&&(this.moveDistance=0,this.Value+=i.movementX>0?this.Step:-this.Step),this.$emit("update:modelValue",this.Value),this.UpdateEvent())},OnMouseUp(i){var e=new T(i.clientX,i.clientY);e.X==this.lastPosition.X&&e.Y==this.lastPosition.Y&&this.Value==this.lastValue&&(this.IsInputVisible=!0,this.$nextTick(()=>{var t=this.$refs.input;t.focus(),t.select()})),this.IsDragging=!1,document.exitPointerLock()},UpdateEvent(){var i=ge();this.RealtimeChange&&(i.ChangeEvent=!i.ChangeEvent)},validate(i){i.key=="Enter"&&i.target.blur();var e=/[0-9-]|\./;e.test(i.key)||i.preventDefault()},Clamp(i,e,t){return Math.min(Math.max(i,e),t)}}}),yi=U({...wi,__name:"InputRange",setup(i){return(e,t)=>{const s=Q("font-awesome-icon");return m(),b("div",pi,[V("div",{class:"button",onClick:t[0]||(t[0]=o=>e.ClickValue(-.1))},[p(s,{icon:["fas","caret-left"]})]),V("div",{class:"value",onMousedown:t[4]||(t[4]=he((...o)=>e.OnMouseDown&&e.OnMouseDown(...o),["left"]))},[e.IsInputVisible?(m(),b("input",{key:0,onKeypress:t[1]||(t[1]=(...o)=>e.validate&&e.validate(...o)),ref:"input",class:"input-element",value:e.modelValue,onInput:t[2]||(t[2]=(...o)=>e.OnInput&&e.OnInput(...o)),onBlur:t[3]||(t[3]=o=>e.IsInputVisible=!1)},null,40,mi)):(m(),b(J,{key:1},[V("div",vi,$(e.Title)+": ",1),V("div",gi,$(Number(e.Value.toFixed(4)))+" "+$(e.Suffix),1)],64))],32),V("div",{class:"button",onClick:t[5]||(t[5]=o=>e.ClickValue(.1))},[p(s,{icon:["fas","caret-right"]})])],512)}}}),Vi=z(yi,[["__scopeId","data-v-5ba96ddd"]]);class gt{constructor(){r(this,"Name");r(this,"Node");r(this,"Values")}static SavePreset(e){var t=localStorage.getItem("presets");if(t!=null){var s=JSON.parse(t),o=at(s).firstOrDefault(a=>a.Node==e.Node&&a.Name==e.Name);if(o!=null){var n=s.indexOf(o);s.splice(n,1)}s.push(e),localStorage.setItem("presets",JSON.stringify(s))}else{var s=new Array;s.push(e),localStorage.setItem("presets",JSON.stringify(s))}}static GetPresets(){var e=localStorage.getItem("presets");return e!=null?JSON.parse(e):new Array}}const _i={class:"properties"},bi={key:0,class:"not-selected"},Si={class:"header"},xi={style:{width:"100%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Ci={class:"buttons",style:{display:"flex","font-weight":"bold"}},Pi={key:0},ki={key:0,style:{margin:"0px 10px"}},Ni={class:"input-group",style:{width:"100%",padding:"0px"}},Mi={key:1,style:{padding:"10px"}},Ii={class:"notice"},$i=U({__name:"PropertiesView",setup(i){const e=ve(),t=ae(()=>e.SelectedNode),s=ae(()=>e.SelectedNode==null||e.SelectedNode instanceof Le),o=L(),n=ae(()=>{var y;return u((y=t.value)==null?void 0:y.Properties)}),a=()=>{if(e.SelectedNode!=null&&e.SelectedNode!=null&&e.SelectedNode){for(var y of e.SelectedNode.Properties)y.Reset();var g=ge();g.ChangeEvent=!g.ChangeEvent}};var u=y=>{var g=new Map;return y==null||y.length==0||y.forEach(x=>{var C;g.has(x.Category)||g.set(x.Category,new Array),(C=g.get(x.Category))==null||C.push(x)}),g};const h=me("presetsContextMenu"),d=L(),f=y=>{var O;if(d!=null||d!=null){if(t.value!=null){var g=t.value.Name,x=gt.GetPresets(),C=at(x).where(Y=>Y.Node==g).toArray();o.value=C}(O=h.value)==null||O.OpenUnder(d.value)}},_=L(""),v=()=>{var C,O;if(t.value!=null&&!(_.value==""||_.value==null)){var y=t.value.Properties,g=new gt,x=new Array;y.forEach(Y=>{x.push(Y.Value)}),g.Name=_.value,g.Node=t.value.Name,g.Values=x,(C=o.value)==null||C.push(g),gt.SavePreset(g),(O=h.value)==null||O.Close(),_.value=""}},c=y=>{var g;s.value||(t.value.Properties.forEach((x,C)=>{x.Value=y.Values[C]}),(g=h.value)==null||g.Close(),w())},w=()=>{var y=ge();t.value.IsRealtimeUpdate&&(y.ChangeEvent=!y.ChangeEvent)};return(y,g)=>{var O;const x=Q("font-awesome-icon"),C=Ne("tooltip");return m(),b("div",_i,[s.value?(m(),b("div",bi,[p(x,{icon:["fas","sliders"]})])):oe("",!0),s.value?oe("",!0):(m(),b(J,{key:1},[V("div",Si,[V("div",xi,$(y.$t((O=t.value)==null?void 0:O.Name)),1),V("div",Ci,[q((m(),b("button",{ref_key:"presetsButton",ref:d,onClick:f,class:"btn"},[p(x,{icon:["fas","sliders"]})])),[[C,y.$t("tt.presets"),void 0,{bottom:!0}]]),q((m(),b("button",{class:"btn",onClick:a},[p(x,{icon:["fas","arrows-rotate"]})])),[[C,y.$t("tt.resetParams"),void 0,{bottom:!0}]]),p(je,{ref_key:"presetsContextMenu",ref:h},{default:M(()=>{var Y;return[(m(!0),b(J,null,_e(o.value,ne=>(m(),X(ue,{onClick:Z=>c(ne)},{default:M(()=>[p(x,{icon:["fas","sliders"]}),B(" "+$(ne.Name),1)]),_:2},1032,["onClick"]))),256)),((Y=o.value)==null?void 0:Y.length)>0?(m(),b("hr",Pi)):oe("",!0),p(fi,{modelValue:_.value,"onUpdate:modelValue":g[0]||(g[0]=ne=>_.value=ne),Placeholder:"New preset name..."},{default:M(()=>[V("button",{onClick:v,class:"btn",style:{padding:"6px"}},[p(x,{icon:"fa-solid fa-circle-plus"})])]),_:1},8,["modelValue"])]}),_:1},512)])]),t.value.Name?(m(),b("hr",ki)):oe("",!0),(m(!0),b(J,null,_e(n.value,([Y,ne])=>(m(),X(jt,{style:{"background-color":"transparent",padding:"0px"}},{header:M(()=>[B($(Y),1)]),default:M(()=>[V("div",Ni,[(m(!0),b(J,null,_e(ne,Z=>(m(),b(J,null,[typeof Z.Value=="number"?(m(),X(Vi,{key:0,modelValue:Z.Value,"onUpdate:modelValue":S=>Z.Value=S,Min:Z.Min,Max:Z.Max,Step:Z.Step,Suffix:Z.Suffix,Title:Z.Name},null,8,["modelValue","onUpdate:modelValue","Min","Max","Step","Suffix","Title"])):oe("",!0),Z.valueList!=null?(m(),X(pn,{key:1,modelValue:Z.Value,"onUpdate:modelValue":S=>Z.Value=S,default:Z.Value,title:Z.Name,options:Z.valueList},null,8,["modelValue","onUpdate:modelValue","default","title","options"])):oe("",!0)],64))),256))])]),_:2},1024))),256)),t.value.IsRealtimeUpdate==!1?(m(),b("div",Mi,[g[2]||(g[2]=V("button",{class:"btn apply-btn"}," Apply changes ",-1)),V("div",Ii,[p(x,{icon:["fas","circle-exclamation"]}),g[1]||(g[1]=B(' This node performs a heavy operation, so the update occurs when you click the "Apply Changes" button and is cached. '))])])):oe("",!0)],64))])}}}),Oi=z($i,[["__scopeId","data-v-184b8032"]]);class Li{constructor(){r(this,"GridMaterial");r(this,"GridMesh");const e=l(.5).toVar(),t=l(5).toVar(),s=l(1*window.devicePixelRatio).toVar(),o=l(500).toVar(),n=l(200).toVar(),a=wt(.2,.2,.2,.2).toVar(),u=wt(.05,.05,.05,.2).toVar(),h=ws,d=ys,f=R(([D,G])=>{const A=yt(D,G),W=Ue(j(Se(j(A,.5)),.5)),F=yt(W,Ht(A));return re(F.x,F.y)}),_=f(h.xz,e),v=f(h.xz,t),c=j(1,Fe(0,s,_)),w=j(1,Fe(0,s,v)),y=j(h,d),g=lt(y),x=Fe(l(o),l(0),g),C=Fe(l(n),l(0),g),O=se(a,se(c,C)).toVar(),Y=se(u,se(w,x)).toVar(),ne=Vs(Y,O),Z=new Ut;Z.colorNode=ne,Z.transparent=!0,Z.side=Mt,Z.lights=!1;const S=new zt(1e3,1e3,1,1);S.rotateX(-Math.PI/2);const I=new It(S,Z);this.GridMesh=I,this.GridMaterial=Z}}class Ri{constructor(){r(this,"Mesh");const e=R(([n,a,u])=>{const h=P(n.x,n.y).toVar(),d=P(Ue(h.mul(2).sub(1)).sub(P(a,u))).toVar();return d.assign(l(1).sub(d.div(Ht(d)))),_s(re(d.x,d.y))});var t=new bs({color:"#fff",transparent:!0,side:Mt});t.colorNode=R(()=>{const n=e(Qe(),1,1).toVar(),a=e(Qe(),.9,1).toVar(),u=e(Qe(),1,.9).toVar(),h=e(Qe(),.98,.98).toVar(),d=Oe(0,1,n.sub(a).sub(u).sub(h)).toVar();return wt(.8,.8,.8,d)})();var s=new zt(1,1,1,1);s.rotateX(-Math.PI/2);var o=new It(s,t);o.castShadow=!1,o.receiveShadow=!1,o.scale.set(10,1,10),o.position.set(0,.005,0),this.Mesh=o}}class Di{static async Generate(e=1,t=1,s=1,o=1){var n=new Ss;const a=e/2,u=t/2,h=Math.floor(s),d=Math.floor(o),f=h+1,_=d+1,v=e/h,c=t/d,w=[],y=[],g=[],x=[];for(let C=0;C<_;C++){const O=C*c-u;for(let Y=0;Y<f;Y++){const ne=Y*v-a;y.push(ne,-O,0),g.push(0,0,1),x.push(Y/h),x.push(1-C/d)}await new Promise(Y=>setTimeout(Y,0))}for(let C=0;C<d;C++){for(let O=0;O<h;O++){const Y=O+f*C,ne=O+f*(C+1),Z=O+1+f*(C+1),S=O+1+f*C;w.push(Y,ne,S),w.push(ne,Z,S)}await new Promise(O=>setTimeout(O,0))}return n.setIndex(w),n.setAttribute("position",new pt(y,3)),n.setAttribute("normal",new pt(g,3)),n.setAttribute("uv",new pt(x,2)),n}}class Ti{constructor(){r(this,"Height",2);r(this,"GPURenderer");r(this,"HeightTexture");r(this,"TerrainMaterial");r(this,"IsMeshGenerated",L(!0));r(this,"Scene");r(this,"Camera");r(this,"Controls");r(this,"TerrainMesh");r(this,"GridMesh");r(this,"DirectionalLight");r(this,"DirectionalLight2");r(this,"_resolution",512);r(this,"_textureResolution",512);r(this,"_canvas");r(this,"_isColorized",!1);this.CreateRenderer(),this.Scene=new xs,this.Scene.environmentNode=Cs("#ffffff"),this.Scene.environmentIntensity=.05,this.Camera=new Ps(75,1,.01,1e3),this.Camera.position.z=10,this.Camera.position.y=10,this.CreateMaterial(),this.CreateTexture(this._resolution),this.CreateTerrainMesh(this.Resolution),this.CreateLight();const e=new Li;this.GridMesh=e.GridMesh,this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2),this.Scene.add(this.GridMesh);var t=new Ri;this.Scene.add(t.Mesh);const s=ge();s.SetRenderer(this),s.Resolution=this.Resolution}get Resolution(){return this._resolution}get TextureResolution(){return this._textureResolution}CreateMaterial(){this.TerrainMaterial=new Ut({color:"#a2a2a2"}),this.TerrainMaterial.side=Mt,this.TerrainMaterial.needsUpdate=!0,this.TerrainMaterial.metalness=0,this.TerrainMaterial.roughness=1,this.TerrainMaterial.positionNode=R(()=>{const e=l(1/this.Resolution),t=l(1).sub(e).toVar(),s=Ge.xyz.toVar(),o=et(this.HeightTexture,Ge.xz.add(.5).mul(t)).mul(this.Height);return s.y.addAssign(o),s})(),this.TerrainMaterial.normalNode=R(()=>{const e=l(1/this.TextureResolution).toVar(),t=l(1).sub(e).toVar(),s=Ge.xyz.add(Rt(e,0,0)).toVar(),o=Ge.xyz.add(Rt(0,0,e.negate())).toVar(),n=Ge.xyz.toVar(),a=et(this.HeightTexture,Ge.xz.add(.5).mul(t)).mul(this.Height);n.y.addAssign(a),s.y.addAssign(et(this.HeightTexture,s.xz.add(.5)).mul(t).mul(this.Height)),o.y.addAssign(et(this.HeightTexture,o.xz.add(.5)).mul(t).mul(this.Height));const u=s.sub(n).normalize(),h=o.sub(n).normalize();return ks(Ns(u,h))})()}CreateRenderer(){this.GPURenderer=new Ms({alpha:!0,antialias:!0}),this.GPURenderer.shadowMap.enabled=!0,this.GPURenderer.shadowMap.type=Is,this.GPURenderer.toneMapping=$s,this.GPURenderer.setClearColor(0,0),this.GPURenderer.setPixelRatio(window.devicePixelRatio)}CreateTexture(e){this.HeightTexture=new Os(Math.floor(this.TextureResolution),Math.floor(this.TextureResolution)),this.HeightTexture.format=Ls,this.HeightTexture.type=Rs}CreateLight(){const e=new Dt(16777215,2);e.position.set(-10,10,0),e.castShadow=!0,e.shadow.autoUpdate=!0,e.shadow.camera.near=.1,e.shadow.camera.far=30,e.shadow.camera.top=8,e.shadow.camera.right=8,e.shadow.camera.bottom=-8,e.shadow.camera.left=-8,e.shadow.mapSize.set(8192,8192),e.shadow.radius=5,e.shadow.blurSamples=25,e.shadow.normalBias=.05,this.DirectionalLight=e;const t=new Dt(16777215,.5);t.position.set(10,10,0),this.DirectionalLight2=t}SetIsMeshGenerated(e){this.IsMeshGenerated.value=e}CreateTerrainMesh(e){this.SetIsMeshGenerated(!1),Di.Generate(1,1,e,e).then(t=>{t.rotateX(-Math.PI/2),this.TerrainMesh=new It(t,this.TerrainMaterial),this.TerrainMesh.castShadow=!0,this.TerrainMesh.receiveShadow=!0,this.TerrainMesh.scale.set(10,1,10),this.TerrainMesh.position.set(0,.006,0),this.Scene.add(this.TerrainMesh),this.SetIsMeshGenerated(!0)})}ChangeResolution(e){this._textureResolution=e,this.TerrainMaterial.dispose(),this.HeightTexture.dispose(),this.CreateTexture(this.TextureResolution),this.CreateMaterial(),this.TerrainMesh.material=this.TerrainMaterial,this.Scene.remove(this.DirectionalLight),this.Scene.remove(this.DirectionalLight2),this.DirectionalLight.dispose(),this.DirectionalLight2.dispose(),this.CreateLight(),this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2);const t=ge();t.Resolution=this.TextureResolution;const s=ve();s.LockedNode!=null?this.Recalculate(s.LockedNode):s.SelectedNode!=null&&this.Recalculate(s.SelectedNode),requestAnimationFrame(()=>this.Render())}OnWindowResize(){if(this.GPURenderer==null||this.Camera==null||this._canvas==null)return;var e=this._canvas.offsetHeight,t=this._canvas.offsetWidth;this.GPURenderer.setSize(t,e);const s=t/e;this.Camera.aspect=s,this.Camera.updateProjectionMatrix(),requestAnimationFrame(()=>this.Render())}async Render(){await this.GPURenderer.renderAsync(this.Scene,this.Camera)}Mount(e){this._canvas=e;var t=this._canvas.offsetHeight,s=this._canvas.offsetWidth;this._canvas.appendChild(this.GPURenderer.domElement),this.GPURenderer.setSize(s,t),this.Camera.aspect=s/t,this.Controls=new Ds(this.Camera,this.GPURenderer.domElement),this.Controls.enablePan=!1,this.Controls.update(),window.addEventListener("resize",()=>this.OnWindowResize()),this.Render(),requestAnimationFrame(()=>this.Render)}RequestRender(){requestAnimationFrame(()=>this.Render)}async Recalculate(e,t=!1){if(this.IsMeshGenerated.value==!1||e.Outputs.length==0)return;t||e.Calculate();var s=e.Outputs[e.DefaultOutput].Value;const n=R(()=>{const a=ke.modInt(this.TextureResolution),u=ke.div(this.TextureResolution),h=ot(a,u),d=P(h.x,h.y).div(this.TextureResolution).toVar(),f=s(d).toVar();f.assign(Oe(f,0,1)),Ts(this.HeightTexture,h,f).toWriteOnly()})().compute(this.TextureResolution*this.TextureResolution);this.GPURenderer.computeAsync(n).then(()=>{e.CalculationState=Re.Calculated,requestAnimationFrame(()=>this.Render())})}SetGridVisible(e){this.GridMesh.visible=e,requestAnimationFrame(()=>this.Render())}}const Ai={class:"container"},Bi={key:0,style:{position:"relative",height:"100%",width:"100%"}},Gi={style:{position:"absolute !important",top:"calc(50% + 30px)",width:"100%","text-align":"center"}},Ei=U({__name:"Preview3D",setup(i){const e=L();e.value=new Ti;const t=L();var s=ge();const o=ae(()=>s.ChangeEvent);var n=ve();const a=ae(()=>n.SelectedNode),u=ae(()=>{var y;return(y=e.value)==null?void 0:y.IsMeshGenerated});qe(u,async(y,g)=>{requestAnimationFrame(()=>{var x;return(x=e.value)==null?void 0:x.Render()})}),qe(o,async(y,g)=>{var x,C;n.LockedNode!=null?(x=e.value)==null||x.Recalculate(n.LockedNode,!1):a.value!=null&&((C=e.value)==null||C.Recalculate(a.value,!1))}),qe(a,async y=>{var x,C;if(n.LockedNode!=null)(x=e.value)==null||x.Recalculate(n.LockedNode);else if(y!=null){var g=y;await((C=e.value)==null?void 0:C.Recalculate(g))}}),Ze(()=>{be(()=>{var y;(y=e.value)==null||y.Mount(t.value)})});let h=!1;const d=()=>{h=!0},f=()=>{h=!1};window.addEventListener("mouseup",f),window.addEventListener("pointerup",f);const _=()=>{h&&requestAnimationFrame(()=>{var y;return(y=e.value)==null?void 0:y.Render()})},v=()=>{requestAnimationFrame(()=>{var y;return(y=e.value)==null?void 0:y.Render()})},c=L(!0),w=()=>{var y;c.value=!c.value,(y=e.value)==null||y.SetGridVisible(c.value)};return(y,g)=>{var O;const x=Q("font-awesome-icon"),C=Ne("tooltip");return m(),b("div",Ai,[(O=e.value)!=null&&O.IsMeshGenerated?oe("",!0):(m(),b("div",Bi,[p(Jt,{style:{scale:"2"}}),V("span",Gi,$(y.$t("hints.initializingMesh")),1)])),V("div",{onMousedown:d,onMousemove:_,onWheel:v,onPointerdown:d,onPointermove:_,ref_key:"canvas",ref:t,style:{height:"100%",width:"100%"}},[p(bt,{class:"top-left"},{default:M(()=>[p(Pe,null,{default:M(()=>[q((m(),b("a",{onClick:w},[p(x,{icon:["fas","hashtag"]})])),[[C,"Switch Grid visibility",void 0,{bottom:!0}]])]),_:1})]),_:1})],544)])}}}),Xi=z(Ei,[["__scopeId","data-v-64b096ee"]]),Yi={style:{width:"100%",height:"100%"}},Hi={style:{height:"calc(100% - 80px)",display:"flex","flex-direction":"row"}},Ui={style:{width:"80%",height:"100%"}},zi={style:{height:"50%",width:"100%",display:"block"}},Wi={style:{"margin-left":"5px"}},Fi={style:{height:"50%"}},qi={style:{width:"20%",height:"100%"}},Zi={style:{"margin-left":"5px"}},ji=U({__name:"LayoutView",setup(i){return(e,t)=>{const s=Q("font-awesome-icon");return m(),b("div",Yi,[p(ui,{style:{height:"50px"}}),V("div",Hi,[V("div",Ui,[V("div",zi,[p(ht,{style:{display:"inline-block",width:"100%"}},{header:M(()=>[p(s,{icon:["fas","mountain-sun"]}),V("span",Wi,$(e.$t("windows.thirdPreview")),1)]),default:M(()=>[p(Xi)]),_:1})]),V("div",Fi,[p(an)])]),V("div",qi,[p(ht,{style:{width:"100%"},"wheel-focus":!1},{header:M(()=>[p(s,{icon:["fas","sliders"]}),V("span",Zi,$(e.$t("windows.properties")),1)]),default:M(()=>[p(Oi)]),_:1})])]),p(oo,{style:{height:"30px"}})])}}}),Ki=z(ji,[["__scopeId","data-v-96fdc7ac"]]),Ji=is({history:as("/"),routes:[{path:"/",name:"home",component:Ki}]});class Qi extends ee{constructor(){super(...arguments);r(this,"Name","nodes.clamp");r(this,"Inputs",[new E(!0,this,"Source")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Min",0,0,1),new N("Max",1,0,1)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value),s=k(this.Properties[1].Value);this.Outputs[0].Value=R(([o])=>{var a;if(!this.Inputs[0].IsConnected)return l(0);const n=(a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(o);return Oe(n,t,s)})}}class ea extends ee{constructor(){super(...arguments);r(this,"Name","nodes.constant");r(this,"Outputs",[new E(!1,this,"Output")]);r(this,"Properties",[new N("Height",0,0,1)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value);this.Outputs[0].Value=R(([s])=>l(t))}}class ta extends ee{constructor(){super(...arguments);r(this,"Name","nodes.cracks");r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Scale",10,0,100,0,"Transform","%"),new N("Angle",0,0,100,0,"Noise",""),new N("Thickness",.03,0,1,0,"Noise",""),new N("Distortion",0,0,100,0,"Distortion",""),new N("Octaves",10,0,100,1,"Distortion",""),new N("Scale",10,0,100,0,"Distortion",""),new N("Offset X",0,-100,100,0,"Distortion",""),new N("Offset Y",0,-100,100,0,"Distortion","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value),a=k(this.Properties[4].Value),u=k(this.Properties[5].Value),h=k(this.Properties[6].Value),d=k(this.Properties[7].Value);this.Outputs[0].Value=R(([f])=>{const _=P(f.x,f.y).toVar(),v=P(ft(_.mul(2).mul(.5),a,P(h,d),u)).mul(n).mul(.2);return uo({uv:_.add(v),angle:s,scale:t,thickness:o})})}}const sa=R(([i,e,t])=>{const s=l(t).toVar(),o=l(e).toVar(),n=l(i).toVar();s.assign(Ve(0,s));const a=l(Ve(0,re(1,o.sub(n).add(s).div(l(2).mul(s))))).toVar();return n.mul(a).add(o.mul(l(1).sub(a)).sub(s.mul(a).mul(l(1).sub(a))))}).setLayout({name:"smoothMin",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),oa=R(([i,e,t])=>{const s=l(t).toVar(),o=l(e).toVar(),n=l(i).toVar();s.assign(re(0,s.negate()));const a=l(Ve(0,re(1,o.sub(n).add(s).div(l(2).mul(s))))).toVar();return n.mul(a).add(o.mul(l(1).sub(a)).sub(s.mul(a).mul(l(1).sub(a))))}).setLayout({name:"smoothMax",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),na=R(([i])=>{const e=P(i).toVar();return Se(we($e(e.xy,P(12.9898,78.233))).mul(43758.5453123))}).setLayout({name:"random",type:"float",inputs:[{name:"st",type:"vec2"}]}),ia=R(([i,e,t])=>{const s=l(t).toVar(),o=l(e).toVar(),n=P(i).toVar(),a=P(n.mul(o)).toVar(),u=P(He(a)).toVar(),h=P(Se(a)).toVar(),d=l(na(u).mul(2).sub(1).mul(s)).toVar(),f=l(we(d)).toVar(),_=l(ut(d)).toVar(),v=P(h.sub(.5)).toVar(),c=P().toVar();return c.x.assign(v.x.mul(_).sub(v.y.mul(f))),c.y.assign(v.x.mul(f).add(v.y.mul(_))),c.add(.5).add(u).mod(1)}).setLayout({name:"tilingWithLimitedRotation",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"tileCount",type:"float"},{name:"maxAngle",type:"float"}]});class aa extends ee{constructor(){super(...arguments);r(this,"Name","nodes.crater");r(this,"Outputs",[new E(!1,this,"Output")]);r(this,"Properties",[new N("Smoothness",.5,0,1,0,"Crater params",""),new N("FloorHeight",-1,-5,5,0,"Crater params",""),new N("Radius",.16,0,1,0,"Crater params",""),new N("RimWidth",1.35,0,100,0,"Crater params",""),new N("RimSteepness",4,0,100,0,"Crater params",""),new N("X",.5,0,1,0,"Transform",""),new N("Y",.5,0,1,0,"Transform","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value),a=k(this.Properties[4].Value),u=k(this.Properties[5].Value),h=k(this.Properties[6].Value);this.Outputs[0].Value=R(([d])=>{const f=P(d.x,d.y).toVar(),_=P(u,h).toVar(),v=l(lt(f.sub(_)).div(Ve(o,1e-4))).toVar(),c=l(v.mul(v).sub(1)).toVar(),w=l(re(v.sub(1).sub(n),0)).toVar(),y=l(a.mul(w).mul(w)).toVar(),g=l(oa(c,s,t)).toVar();return g.assign(sa(g,y,t)),g.mul(o).add(.5).toVar()})}}class ra extends ee{constructor(){super(...arguments);r(this,"Name","nodes.fake");r(this,"Position",new T(1e3,1e3))}}class la extends ee{constructor(){super(...arguments);r(this,"Name","nodes.falloff");r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Strength",0,0,10)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value);this.Outputs[0].Value=R(([s])=>{const o=P(s.x,s.y).toVar(),n=l(Wt(P(.5),o.mod(1))).mul(t).toVar(),a=H(l(1),l(0),n).toVar();return dt(Oe(a,0,1),2)})}}class ua extends ee{constructor(){super(...arguments);r(this,"Name","nodes.fastErosion");r(this,"Inputs",[new E(!0,this,"Inpute Height")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Tiles",4,0,20,0,"Erosion",""),new N("Octaves",5,0,20,1,"Erosion",""),new N("Gain",.5,0,1,0,"Erosion",""),new N("Lacunarity",2,0,10,0,"Erosion",""),new N("Slope strength",3,0,10,0,"Erosion",""),new N("Branch strength",3,0,10,0,"Erosion",""),new N("Erosion Strength",.04,0,1,0,"Erosion","")]);r(this,"IsRealtimeUpdate",!1);r(this,"terrainHeight");r(this,"waterVolume");r(this,"sedimentAmount");r(this,"tempTerrainHeight");r(this,"tempWaterVolume");r(this,"tempSedimentAmount")}Calculate(){this.BaseCalculate();const t=ge(),s=t.GetRenderer(),o=t.Resolution,n=k(.1),a=k(.1),u=k(.1),h=k(1),d=k(.1),f=k(.1),_=k(9.8),v=k(.01),c=k(3),w=k(o),y=k(o);this.terrainHeight=Ee(o*o,"float"),this.waterVolume=Ee(o*o,"float"),this.sedimentAmount=Ee(o*o,"float"),this.tempTerrainHeight=Ee(o*o,"float"),this.tempWaterVolume=Ee(o*o,"float"),this.tempSedimentAmount=Ee(o*o,"float");const g=R(()=>{var A;const S=ke.modInt(o),I=ke.div(o),D=ot(S,I),G=P(D.x,D.y).div(o).toVar();if(this.Inputs[0].IsConnected){const F=((A=this.Inputs[0].Links[0].In)==null?void 0:A.Value)(G).toVar();this.terrainHeight.element(ke).assign(F)}}),x=R(([S,I])=>{const D=l(I).toVar(),G=l(S).toVar();return G.assign(Oe(G,fe(0),w.sub(fe(1)))),D.assign(Oe(D,fe(0),y.sub(fe(1)))),D.mul(w).add(G)}),C=R(([S,I])=>{const D=l(I).toVar(),G=P(S).toVar(),A=l(se(.01,Se(we(l(D).mul(12.9898)).mul(43758.5453)).mul(2).sub(1))).toVar();return Yt(G.add(P(A)))});R(([S,I,D])=>{const G=fe(D).toVar(),A=l(I).toVar(),W=l(S).toVar(),F=l(x(W,A)).toVar(),ce=l(this.tempWaterVolume.element(F).add(a.mul(n))).toVar(),ie=l(this.tempSedimentAmount.element(F)).toVar(),le=l(this.tempTerrainHeight.element(F)).toVar(),Ke=P(P(this.tempTerrainHeight.element(x(W.add(1),A)).sub(this.tempTerrainHeight.element(x(W.sub(1),A))),this.tempTerrainHeight.element(x(W,A.add(1))).sub(this.tempTerrainHeight.element(x(W,A.sub(1))))).mul(.5)).toVar(),ze=l(lt(Ke)).toVar();tt(ce.greaterThan(0).and(ze.greaterThan(0)),()=>{const De=P(C(Ke,G)).toVar(),Je=l(re(ce,ze.mul(_).mul(n))).toVar(),Ie=l(re(ce,Je)).toVar(),Te=Xe(Xe(W,A).add(Xe(Tt(De)))).toVar(),Ae=fe(x(Te.x,Te.y)).toVar();this.tempWaterVolume.element(Ae).addAssign(Ie),ce.subAssign(Ie);const xe=l(Ve(ze,v).mul(Ie).mul(h)).toVar();tt(ie.lessThan(xe),()=>{const We=l(re(xe.sub(ie).mul(d),le.sub(this.tempTerrainHeight.element(Ae)))).toVar();ie.addAssign(We),this.tempTerrainHeight.element(F).assign(le.sub(We))}).Else(()=>{const We=l(ie.sub(xe).mul(f)).toVar();ie.subAssign(We),this.tempTerrainHeight.element(F).assign(le.add(We))});const Ot=l(ie.mul(Ie).div(ce)).toVar();this.tempSedimentAmount.element(Ae).addAssign(Ot),ie.subAssign(Ot)}),ce.mulAssign(j(1,u.mul(n))),ie.assign(Ve(0,ie)),this.tempWaterVolume.element(F).assign(ce),this.tempSedimentAmount.element(F).assign(ie)});const O=R(([S,I])=>{const D=fe(I).toVar(),G=ot(S.x,S.y).toVar();return G.y.mul(D).add(G.x)});R(()=>{this.tempTerrainHeight.element(ke).addAssign(.5)});const Y=R(()=>{const S=fe(ke).toVar(),I=fe(S.modInt(w)).toVar(),D=fe(S.div(w)).toVar(),G=fe(x(I,D)).toVar();this.tempTerrainHeight.element(G).assign(this.terrainHeight.element(G)),this.tempWaterVolume.element(G).assign(this.waterVolume.element(G)),this.tempSedimentAmount.element(G).assign(this.sedimentAmount.element(G)),mt(),Nt(c,()=>{const A=l(x(I,D)).toVar(),W=l(this.tempWaterVolume.element(A).add(a.mul(n))).toVar(),F=l(this.tempSedimentAmount.element(A)).toVar(),ce=l(this.tempTerrainHeight.element(A)).toVar(),ie=P(P(this.tempTerrainHeight.element(x(I.add(1),D)).sub(this.tempTerrainHeight.element(x(I.sub(1),D))),this.tempTerrainHeight.element(x(I,D.add(1))).sub(this.tempTerrainHeight.element(x(I,D.sub(1))))).mul(.5)).toVar(),le=l(lt(ie)).toVar();tt(W.greaterThan(0).and(le.greaterThan(0)),()=>{const Ke=P(C(ie,S)).toVar(),ze=l(re(W,le.mul(_).mul(n))).toVar(),De=l(re(W,ze)).toVar(),Je=Xe(Xe(I,D).add(Xe(Tt(Ke)))).toVar(),Ie=fe(x(Je.x,Je.y)).toVar();this.tempWaterVolume.element(Ie).addAssign(De),W.subAssign(De);const Te=l(Ve(le,v).mul(De).mul(h)).toVar();tt(F.lessThan(Te),()=>{const xe=l(re(Te.sub(F).mul(d),ce.sub(this.tempTerrainHeight.element(Ie)))).toVar();F.addAssign(xe),this.tempTerrainHeight.element(A).assign(ce.sub(xe))}).Else(()=>{const xe=l(F.sub(Te).mul(f)).toVar();F.subAssign(xe),this.tempTerrainHeight.element(A).assign(ce.add(xe))});const Ae=l(F.mul(De).div(W)).toVar();this.tempSedimentAmount.element(Ie).addAssign(Ae),F.subAssign(Ae)}),W.mulAssign(j(1,u.mul(n))),F.assign(Ve(0,F)),this.tempWaterVolume.element(A).assign(W),this.tempSedimentAmount.element(A).assign(F),mt(),this.terrainHeight.element(A).assign(this.tempTerrainHeight.element(A)),this.waterVolume.element(A).assign(this.tempWaterVolume.element(A)),this.sedimentAmount.element(A).assign(this.tempSedimentAmount.element(A)),mt()}),this.terrainHeight.element(G).assign(this.tempTerrainHeight.element(G)),this.waterVolume.element(G).assign(this.tempWaterVolume.element(G)),this.sedimentAmount.element(G).assign(this.tempSedimentAmount.element(G))}),ne=g().compute(o*o),Z=Y().compute(o*o);s==null||s.GPURenderer.compute(ne),s==null||s.GPURenderer.computeAsync(Z),this.Outputs[0].Value=R(([S])=>{if(this.Inputs[0].IsConnected){P(S.x,S.y).toVar();const I=ke.modInt(o),D=ke.div(o),G=ot(I,D);return this.terrainHeight.element(O(G,o)).toVar()}else return 0})}}class da extends ee{constructor(){super(...arguments);r(this,"Name","nodes.gradientNoise");r(this,"Outputs",[new E(!1,this,"Output")]);r(this,"Properties",[new N("Scale",10,0,100),new N("Offset X",0,0,100),new N("Offset Y",0,0,100)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value);this.Outputs[0].Value=R(([n])=>{const a=P(n.x,n.y).mul(t).toVar(),u=P(s,o).toVar();return a.addAssign(u),Kt(a)})}}class ca extends ee{constructor(){super(...arguments);r(this,"Name","nodes.invert");r(this,"Inputs",[new E(!0,this,"Source")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate(),this.Outputs[0].Value=R(([t])=>{var o;if(!this.Inputs[0].IsConnected)return l(0);const s=(o=this.Inputs[0].Links[0].In)==null?void 0:o.Value(t);return l(1).sub(s)})}}class ha extends ee{constructor(){super(...arguments);r(this,"Name","nodes.mountain");r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Scale",3.55,0,100,0,"Noise Transform","%"),new N("Octaves Count",10,1,50,1,"Noise Params",""),new N("Offset X",-.08,-100,100,0,"Noise Transform",""),new N("Offset Y",-.54,-100,100,0,"Noise Transform",""),new N("Falloff",3,0,20,0,"Mountain",""),new N("Height",1,0,1,0,"Mountain",""),new N("Position X",.5,0,1,0,"Mountain Transform",""),new N("Position Y",.5,0,1,0,"Mountain Transform","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value),a=k(this.Properties[4].Value),u=k(this.Properties[5].Value),h=k(this.Properties[6].Value),d=k(this.Properties[7].Value);this.Outputs[0].Value=R(([f])=>{const _=P(f.x,f.y).toVar(),v=l(Wt(P(h,d),_)).mul(a).toVar(),c=H(l(1),l(0),v).toVar(),w=dt(Oe(c,0,1),2),y=_.sub(P(h,d).sub(.5)).toVar(),g=ft(y,s,P(o,n),t).toVar();return Oe(w.mul(g).mul(l(1.45).mul(u)),0,1)})}}class fa extends ee{constructor(){super(...arguments);r(this,"Name","nodes.redistribution");r(this,"Inputs",[new E(!0,this,"Source")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Exponent",1,1,10)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value);this.Outputs[0].Value=R(([s])=>{var n;return this.Inputs[0].IsConnected?((n=this.Inputs[0].Links[0].In)==null?void 0:n.Value(s)).pow(t):l(0)})}}class pa extends ee{constructor(){super(...arguments);r(this,"Name","nodes.terrace");r(this,"Inputs",[new E(!0,this,"Param 1")]);r(this,"Outputs",[new E(!1,this,"Output")]);r(this,"Properties",[new N("Smoothness",.1,0,1),new N("Count",3,0,100,1)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value);this.Outputs[0].Value=R(([o])=>{var n;if(this.Inputs[0].IsConnected){const u=((n=this.Inputs[0].Links[0].In)==null?void 0:n.Value)(o).toVar();if(this.Properties[1].Value==0)return u;const h=l(1).div(s).toVar(),d=He(u.div(h)).toVar(),f=u.sub(d.mul(h)).div(h).toVar(),_=re(l(2).mul(f),l(1)).toVar(),v=d.add(_).mul(h).toVar(),c=yt(1,l(s)),w=He(u.div(c)),y=Se(u.div(c)),g=w.mul(c).add(Fe(0,1,y).mul(c));return H(v,g,t)}else return 0})}}class ma extends ee{constructor(){super(...arguments);r(this,"Name","nodes.voronoi");r(this,"Outputs",[new E(!1,this,"Output"),new E(!1,this,"Cells"),new E(!1,this,"Bubbles")]);r(this,"Properties",[new N("Scale",10,1,100,0,"Transform","%"),new N("OffsetX",0,0,100,0,"Transform",""),new N("OffsetY",0,0,100,0,"Transform",""),new N("Angle",5,0,100,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value);this.Outputs[0].Value=R(([a])=>{const u=P(a.x,a.y).toVar(),h=P(s,o).toVar();u.addAssign(h);const d=vt({UV:u,angleOffset:n,cellDensity:t}).toVar();return dt(d.x,2)}),this.Outputs[1].Value=R(([a])=>{const u=P(a.x,a.y).toVar(),h=P(s,o).toVar();return u.addAssign(h),vt({UV:u,angleOffset:n,cellDensity:t}).toVar().y}),this.Outputs[2].Value=R(([a])=>{const u=P(a.x,a.y).toVar(),h=P(s,o).toVar();u.addAssign(h);const d=vt({UV:u,angleOffset:n,cellDensity:t}).toVar();return As(dt(d.x,2))})}}class va extends ee{constructor(){super(...arguments);r(this,"Name","nodes.transform");r(this,"Inputs",[new E(!0,this,"Input")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Properties",[new N("Scale X",1,0,100,0,"Scale",""),new N("Scale Y",1,0,100,0,"Scale",""),new N("Position X",0,-100,100,0,"Position",""),new N("Position Y",0,-100,100,0,"Position",""),new N("Midpoint X",.5,0,1,0,"Rotation",""),new N("Midpoint Y",.5,0,1,0,"Rotation",""),new N("Angle",0,-360,360,0,"Rotation","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value),a=k(this.Properties[4].Value),u=k(this.Properties[5].Value),h=k(this.Properties[6].Value);this.Outputs[0].Value=R(([d])=>{var x;const f=P(d.x,d.y).toVar(),_=P(t,s).toVar(),v=P(o,n).toVar(),c=P(a,u).toVar(),w=h.mul(Ft.div(180)).toVar(),y=P(ut(w).mul(f.x.sub(c.x)).add(we(w).mul(f.y.sub(c.y))).add(c.x),ut(w).mul(f.y.sub(c.y)).sub(we(w).mul(f.x.sub(c.x))).add(c.y));return f.assign(y),f.addAssign(v),f.mulAssign(_),(x=this.Inputs[0].Links[0].In)==null?void 0:x.Value(f).toVar()})}}class ga extends ee{constructor(){super(...arguments);r(this,"Inputs",[new E(!0,this,"Input")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Name","nodes.tile");r(this,"Properties",[new N("Tile Count",1,0,100,1),new N("Angle Threshold",0,0,360,0)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value),s=k(this.Properties[1].Value);this.Outputs[0].Value=R(([o])=>{var d;var n=P(o).toVar(),a=s.mul(Ft.div(180));const u=ia(n,t,a).toVar();return(d=this.Inputs[0].Links[0].In)==null?void 0:d.Value(u).toVar()})}}class wa extends ee{constructor(){super(...arguments);r(this,"Inputs",[new E(!0,this,"Input")]);r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Name","nodes.height");r(this,"IsRealtimeUpdate",!0);r(this,"Properties",[new N("Height",1,0,100,0,"","%")])}Calculate(){this.BaseCalculate();const t=k(this.Properties[0].Value);this.Outputs[0].Value=R(([s])=>{var a;if(!this.Inputs[0].IsConnected)return l(0);var o=P(s).toVar();return((a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(o).toVar()).mul(t.mul(.01))})}}class ya extends ee{constructor(){super(...arguments);r(this,"Name","nodes.distortion");r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Inputs",[new E(!0,this,"Input")]);r(this,"Properties",[new N("Distortion",0,0,100,0,"Distortion",""),new N("Octaves",10,0,100,1,"Distortion",""),new N("Scale",10,0,100,0,"Distortion",""),new N("Offset X",0,-100,100,0,"Distortion",""),new N("Offset Y",0,-100,100,0,"Distortion","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=k(this.Properties[0].Value),s=k(this.Properties[1].Value),o=k(this.Properties[2].Value),n=k(this.Properties[3].Value),a=k(this.Properties[4].Value);this.Outputs[0].Value=R(([u])=>{var h;if(this.Inputs[0].IsConnected){const d=(h=this.Inputs[0].Links[0].In)==null?void 0:h.Value,f=P(u.x,u.y).toVar(),_=P(ft(f.mul(2).mul(.5),s,P(n,a),o)).mul(t).mul(.2);return d(f.add(_)).toVar()}else return 0})}}class Va extends ee{constructor(){super(...arguments);r(this,"Name","nodes.dune");r(this,"Outputs",[new E(!1,this,"Result")]);r(this,"Inputs",[]);r(this,"Properties",[new N("Scale",0,0,0,0,"Tramsform","%"),new N("Height",0,0,0,0,"Tramsform","%"),new N("Wind Direction",0,0,0,0,"Tramsform","%"),new N("Octaves",0,0,0,0,"Noise","%"),new N("Sand Roughness",0,0,0,0,"Noise","%"),new N("Seed",0,0,0,0,"Random","%"),new N("Time",0,0,0,0,"Random","%")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=k(this.Properties[6].Value),s=k(this.Properties[5].Value),o=k(this.Properties[0].Value),n=k(this.Properties[1].Value),a=k(this.Properties[4].Value),u=k(this.Properties[2].Value);k(this.Properties[3].Value);const h=R(([c])=>{const w=c.toVar();return w.assign(P($e(w,P(127.1,311.7)),$e(w,P(269.5,183.3)))),l(-1).add(se(2,Se(we(w.x.add(w.y)).mul(l(43758.5453123)))))}),d=R(([c])=>{const w=He(c),y=Se(c),g=y.mul(y).mul(j(3,se(2,y))),x=h(w),C=h(w.add(P(1,0))),O=h(w.add(P(0,1))),Y=h(w.add(P(1,1)));return H(H(x,C,g.x),H(O,Y,g.x),g.y)}),f=R(([c,w,y])=>{const g=l(0),x=l(1),C=l(1),O=l(0);return Nt(w,({i:Y})=>{g.addAssign(x.mul(d(c.mul(C).add(s)))),O.addAssign(x),x.mulAssign(y),C.mulAssign(2)}),g.div(O)}),_=R(([c,w])=>j(1,Ue(we(c.mul(3.14159).mul(w))))),v=R(([c,w])=>{const y=P(ut(w),we(w)),g=f(c.mul(o).add(y.mul(.5)),4,.5);P(y.y.negate(),y.x);const x=we(c.x.mul(o).mul(.3).add(d(c.mul(2)).mul(2))).mul(we(c.y.mul(o).mul(.2))).mul(.3),C=g.mul(.7).add(x.mul(.3));C.assign(H(C,_(C,1.5),.4));const O=f(c.mul(o).mul(4),2,.3).mul(a);return C.add(O.mul(.1))});this.Outputs[0].Value=R(([c])=>{const w=c,y=P(t.mul(.01),0),g=v(w.mul(P(2,1)).add(y),u);return g.assign(g.mul(.5).add(.5).mul(n)),g})}}function _a(){K.registerStr("nodes.buffer","",Le),K.registerStr("nodes.fake","",ra),K.registerStr("nodes.constant","nodeCategories.testNodes",ea),K.registerStr("nodes.perlinNoise","nodeCategories.testNodes",co),K.registerStr("nodes.mountain","nodeCategories.testNodes",ha),K.registerStr("nodes.terrace","nodeCategories.testNodes",pa),K.registerStr("nodes.combine","nodeCategories.testNodes",nt),K.registerStr("nodes.clamp","nodeCategories.testNodes",Qi),K.registerStr("nodes.invert","nodeCategories.testNodes",ca),K.registerStr("nodes.redistribution","nodeCategories.testNodes",fa),K.registerStr("nodes.gradientNoise","nodeCategories.testNodes",da),K.registerStr("nodes.voronoi","nodeCategories.testNodes",ma),K.registerStr("nodes.crater","nodeCategories.testNodes",aa),K.registerStr("nodes.falloff","nodeCategories.testNodes",la),K.registerStr("nodes.fastErosion","nodeCategories.testNodes",ua),K.registerStr("nodes.cracks","nodeCategories.testNodes",ta),K.registerStr("nodes.transform","nodeCategories.testNodes",va),K.registerStr("nodes.tile","nodeCategories.testNodes",ga),K.registerStr("nodes.height","nodeCategories.testNodes",wa),K.registerStr("nodes.distortion","nodeCategories.testNodes",ya),K.registerStr("nodes.dune","nodeCategories.testNodes",Va),K.registerStr("nodes.export","nodeCategories.testNodes",it)}const ba={en:{"":"",logo:"Mashuk",windows:{thirdPreview:"3D Preview",secondPreview:"2D Preview",properties:"Node properties",graph:"Graph",nodesList:"Nodes list"},tt:{undo:"Undo",redo:"Redo",copy:"Copy",paste:"Paste",delete:"Delete node/selected",fullscreen:"Fullscreen",save:"Save project",cancel:"Cancel",load:"Load project",presets:"Presets",resetView:"Reset view",resetParams:"Reset node parameters to default",lockPreview:"Lock Preview",unlockPreview:"Unlock Preview",mesh_resolution:"Resolution",new:"New project",settings:"Project settings",menu:"Menu",resolutionWarning:"Warning! Selecting a high resolution will increase video memory consumption and processing speed.",build:"Build project",buildSettings:"Build settings",clickForEdit:"Click for edit",saveSettings:"Save settings"},hints:{graphLmb:"LMB: Select/Drag node",graphWheel:"Wheel: Zoom/Drag work space",placeHere:"PLACE HERE",initializingMesh:"Initializing Mesh..."},nodes:{constant:"Constant",perlinNoise:"Perlin Noise",mountain:"Mountain",terrace:"Terrace",combine:"Combine",clamp:"Clamp",invert:"Invert",redistribution:"Redistribution",gradientNoise:"Gradient Noise",voronoi:"Voronoi",crater:"Crater",falloff:"Falloff",fastErosion:"Fast Erosion",cracks:"Cracks",transform:"Transform",tile:"Tile",height:"Height",distortion:"Distortion",dune:"Dunes",export:"Export"},buildModal:{resolution:"Resolution",tiles:"Tiles",terrain:"Terrain",build:"Build",nodes:"Nodes"},nodeCategories:{testNodes:"Test nodes",colorNodes:"Color nodes"}},ru:{logo:"Машук",windows:{thirdPreview:"3D Просмотр",secondPreview:"2D Просмотр",properties:"Параметры узла",graph:"Граф",nodesList:"Список узлов"},tt:{undo:"Отменить",redo:"Повторить",copy:"Копировать",paste:"Вставить",delete:"Удалить узел/выделенные",fullscreen:"На весь экран",save:"Сохранить проект",cancel:"Отменить",load:"Загрузить проект",presets:"Предустановки",resetView:"Сбросить вид",resetParams:"Сбросить параметры узла до значений по умолчанию",lockPreview:"Закрепить отображение",unlockPreview:"Открепить отображение",mesh_resolution:"Разрешение",new:"Новый проект",settings:"Настройки проекта",menu:"Меню",resolutionWarning:"Внимание! Выбор высокого разрешения влечет за собой увеличение потребления видеопамяти и скорости обработки",build:"Собрать проект",buildSettings:"Настройка сборки",clickForEdit:"Нажмите что-бы отредактировать",saveSettings:"Сохранить настройки"},hints:{graphLmb:"ЛКМ: Выделить/Передвинуть узел",graphWheel:"Колесо мыши: Приближение/Перемещение рабочей области",placeHere:"РАЗМЕСТИТЕ ЗЕСЬ",initializingMesh:"Инициализация Меша..."},nodes:{constant:"Константа",perlinNoise:"Шум Перлина",mountain:"Гора",terrace:"Террасы",combine:"Комбинирование",clamp:"Ограничение",invert:"Инверсия",redistribution:"Перераспределение",gradientNoise:"Градиентный Шум",voronoi:"Шум Вороного",crater:"Кратер",falloff:"Спад",fastErosion:"Быстрая Эрозия",cracks:"Трещины",transform:"Преобразование",tile:"Плитка",height:"Высота",distortion:"Искажения",dune:"Дюны",export:"Экспорт"},buildModal:{resolution:"Разрешение",tiles:"Тайлы",terrain:"Ландшафт",build:"Сборка",nodes:"Узлы"},nodeCategories:{testNodes:"Тестовые узлы",colorNodes:"Красящие узлы"}}};kt.options.themes.tooltip.delay.show=0;kt.options.distance=10;rs.add(Bs,ls);const Sa=us({legacy:!1,locale:"en",fallbackLocale:"en",messages:ba}),Me=ds(Ws);Me.component("font-awesome-icon",cs);Me.component("font-awesome-layers",hs);Me.component("font-awesome-layers-text",fs);Me.use(ps());Me.use(Ji);Me.use(kt);Me.use(Sa);Me.use(ms);Me.mount("#app");_a();
