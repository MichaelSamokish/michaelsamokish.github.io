var Kt=Object.defineProperty;var jt=(n,e,t)=>e in n?Kt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>jt(n,typeof e!="symbol"?e+"":e,t);import{d as A,g as ht,c as ye,r as te,a as G,b as g,o as h,u as J,R as Jt,e as V,f as v,_ as B,v as ft,h as pt,i as k,j as R,t as M,k as Q,l as de,F as z,m as fe,w as I,n as mt,p as ge,q as Ne,s as H,x as ae,y as Ie,z as _t,T as Qt,A as es,B as $t,C as bt,D as Be,E as vt,G as Rt,H as Pt,I as ts,J as ss,K as gt,L as ns,M as os,N as is,O as as,P as rs,Q as ls,V as us}from"./vendor-CoEcxX_r.js";import{w as Dt,F as C,i as ne,f as d,v as y,L as Tt,a as st,b as Ce,d as Te,m as T,n as At,c as Ee,s as Ae,u as S,e as lt,g as Nt,h as X,j as Xt,k as ee,p as ds,l as We,o as cs,q as Je,r as j,t as hs,M as Gt,D as wt,P as Bt,x as Vt,y as fs,z as ps,A as ze,B as Se,S as ms,C as vs,E as gs,G as Le,H as Fe,I as It,J as ws,K as Vs,W as ys,N as Ss,O as _s,Q as bs,R as Ps,T as Ns,U as Ct,V as Is,X as Ze,Y as Cs,Z as ve,_ as je,$ as Ms,a0 as $e,a1 as xs,a2 as ue,a3 as ks,a4 as ut,a5 as Yt,a6 as Qe,a7 as Re,a8 as qe,a9 as De,aa as Mt,ab as at,ac as Os,ad as Et}from"./three-CJGEr-Sp.js";import{i as Ls}from"./icons-CNPGi31y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const $s={key:1,class:"gpu-error-box disable-user-select"},Rs={class:"gpu-error-message-box"},Ds={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},Ts=A({__name:"App",setup(n){const e=ht(),t=localStorage.getItem("userLang");t&&e!=null&&(e.appContext.config.globalProperties.$i18n.locale=t);const s=ye(()=>navigator.gpu);return(i,o)=>{const a=te("font-awesome-icon");return s.value?(h(),G(J(Jt),{key:0})):(h(),g("div",$s,[V("div",Rs,[V("div",Ds,[v(a,{icon:["fas","circle-xmark"]})]),o[0]||(o[0]=V("h1",null,"WebGPU is not supported on this browser.",-1))])]))}}}),As=B(Ts,[["__scopeId","data-v-286205d8"]]);class Ht{constructor(){l(this,"Id",ft());l(this,"In",null);l(this,"Out",null);l(this,"IsSelected",!1)}SetSelected(e){var s,i,o;var t=this.In!=null?(s=this.In.ParentNode)==null?void 0:s.ParentGraph:(o=(i=this.Out)==null?void 0:i.ParentNode)==null?void 0:o.ParentGraph;t!=null&&e==!0&&t.DeselectAll(),this.IsSelected=e}DeleteLinkFromTerminals(){var s,i;var e=(s=this.In)==null?void 0:s.Links.indexOf(this);e!=null&&this.In!=null&&this.In.Links.splice(e,1);var t=(i=this.Out)==null?void 0:i.Links.indexOf(this);t!=null&&this.Out!=null&&this.Out.Links.splice(t,1)}}class N{constructor(e,t){l(this,"X",0);l(this,"Y",0);this.X=e,this.Y=t}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get Normalized(){return N.Div(this,this.Length)}Reset(){this.X=0,this.Y=0}static Add(e,t){return t instanceof N?new N(e.X+t.X,e.Y+t.Y):typeof t=="number"?new N(e.X+t,e.Y+t):e}static Sub(e,t){return t instanceof N?new N(e.X-t.X,e.Y-t.Y):typeof t=="number"?new N(e.X-t,e.Y-t):e}static Mul(e,t){return t instanceof N?new N(e.X*t.X,e.Y*t.Y):typeof t=="number"?new N(e.X*t,e.Y*t):e}static Div(e,t){return t instanceof N?new N(e.X/t.X,e.Y/t.Y):typeof t=="number"?new N(e.X/t,e.Y/t):e}}var Ut=(n=>(n[n.none=0]="none",n[n.Buffer=1]="Buffer",n[n.Primitives=2]="Primitives",n[n.GeoPrimitives=3]="GeoPrimitives",n[n.Warps=4]="Warps",n[n.Adjastments=5]="Adjastments",n[n.Profile=6]="Profile",n[n.Filters=7]="Filters",n[n.Erosion=8]="Erosion",n[n.Snow=9]="Snow",n[n.Water=10]="Water",n[n.Data=11]="Data",n[n.Color=12]="Color",n[n.Render=13]="Render",n[n.Output=14]="Output",n))(Ut||{}),Pe=(n=>(n[n.NotCalculated=0]="NotCalculated",n[n.Calculation=1]="Calculation",n[n.Calculated=2]="Calculated",n))(Pe||{});class b{constructor(e,t,s,i=0,o=0,a="",u=""){l(this,"Name","");l(this,"Description","");l(this,"Value");l(this,"Min",-10);l(this,"Max",10);l(this,"Suffix");l(this,"Category");l(this,"Step");l(this,"valueList");l(this,"Default");this.Name=e,this.Value=t,this.Default=t,this.Min=typeof s=="number"?s:0,this.Max=i,this.Suffix=u,this.Category=a,this.Step=o,this.valueList=s instanceof Array?s:void 0}Reset(){this.Value=this.Default}}class q{constructor(){l(this,"Id",ft());l(this,"Position",new N(0,0));l(this,"LastPosition",new N(0,0));l(this,"Name","");l(this,"Category",Ut.none);l(this,"Properties");l(this,"Inputs",[]);l(this,"Outputs",[]);l(this,"IsSelected",!1);l(this,"Height",0);l(this,"Width",0);l(this,"IsCalculated",!1);l(this,"ParentGraph",null);l(this,"CalculationState",Pe.NotCalculated);l(this,"IsRealtimeUpdate",!1);l(this,"DefaultOutput",0)}Move(e,t){this.Position=new N(e,t)}SetSize(e,t){this.Height=e,this.Width=t}SetSelected(e){this.IsSelected=e;const t=he();e?t.SelectedNode=this:t.SelectedNode==this&&(t.SelectedNode=null)}SetLastPosition(e,t){this.LastPosition.X=e,this.LastPosition.Y=t}BaseCalculate(){this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})}),this.Inputs.forEach(e=>{var t,s,i,o;e.IsConnected&&((s=(t=e.Links[0].In)==null?void 0:t.ParentNode)==null||s.Calculate(),(o=(i=e.Links[0].In)==null?void 0:i.ParentNode)==null||o.SetCalculated())})}SetNotCalculated(){this.CalculationState=Pe.NotCalculated,this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})})}SetCalculated(){this.CalculationState=Pe.Calculated}Calculate(){}}class O{constructor(e,t,s){l(this,"Guid",ft());l(this,"Links",new Array);l(this,"IsInput",!1);l(this,"ParentNode",null);l(this,"Position",new N(0,0));l(this,"OffsetPosition",new N(0,0));l(this,"Value",null);l(this,"Name","");this.ParentNode=t,this.IsInput=e,this.Name=s}get IsConnected(){return this.Links.length>0}SetOffset(e,t){this.OffsetPosition=new N(e,t)}SetPosition(e,t){this.Position=new N(e,t)}}const et=pt("drag",()=>{const n=k(!1),e=k(),t=k(),s=k();function i(a){s.value=a}function o(){return s.value}return{setNode:i,getNode:o,SourceTerminal:e,DestinationTerminal:t,IsDragging:n}}),he=pt("nodes",()=>{const n=k(),e=k();return{SelectedNode:n,LockedNode:e}}),ce=pt("renderer",()=>{const n=k(!1),e=k(),t=o=>{e.value=o},s=()=>e.value,i=k();return{ChangeEvent:n,Resolution:i,SetRenderer:t,GetRenderer:s}}),Xs={class:"status-bar-grid disable-user-select"},Gs={class:"working-status"},Bs={class:"memory-usage"},Ys=A({__name:"StatusBar",setup(n){ce();const e=k(0),t=ye(()=>e.value);return(s,i)=>{const o=te("font-awesome-icon");return h(),g("div",Xs,[V("div",Gs,[v(o,{icon:["fas","bars-progress"]}),i[0]||(i[0]=R(" Idle "))]),V("div",Bs,[v(o,{icon:["fas","memory"]}),R(" "+M(t.value.toFixed(2))+" ",1),i[1]||(i[1]=V("span",null," GB",-1))])])}}}),Es=B(Ys,[["__scopeId","data-v-254f7b1e"]]),Hs={class:"collapse"},Us={class:"carete"},Ws={key:0,class:"collapse-body"},zs=A({__name:"Collapse",setup(n){var e=k(!1);const t=()=>{e.value=!e.value};return(s,i)=>{const o=te("font-awesome-icon");return h(),g("div",Hs,[V("div",{onClick:t,class:"header"},[V("div",Us,[J(e)?(h(),G(o,{key:0,icon:["fas","angle-right"]})):(h(),G(o,{key:1,icon:["fas","angle-down"]}))]),de(s.$slots,"header",{},void 0,!0)]),J(e)?Q("",!0):(h(),g("div",Ws,[de(s.$slots,"default",{},void 0,!0)]))])}}}),Wt=B(zs,[["__scopeId","data-v-ed8ad461"]]),Ke=C(([n])=>{const e=y(n).toVar();e.assign(e.modInt(d(289)));const t=d(d(34).mul(e.x).add(1).mul(e.x).modInt(289).add(e.y)).toVar();return t.assign(d(34).mul(t).add(d(1)).mul(t).modInt(289)),t.assign(Ce(t.div(d(41))).mul(d(2)).sub(1)),At(y(t.sub(st(t.add(.5))),Ee(t).sub(.5)))}).setLayout({name:"gradientNoiseDir",type:"vec2",inputs:[{name:"p",type:"vec2"}]}),Fs=C(([n])=>{const e=y(n).toVar(),t=y(st(e)).toVar(),s=y(Ce(e)).toVar(),i=d(Te(Ke(t),s)).toVar(),o=d(Te(Ke(t.add(y(d(0),d(1)))),s.sub(y(d(0),d(1))))).toVar(),a=d(Te(Ke(t.add(y(d(1),d(0)))),s.sub(y(d(1),d(0))))).toVar(),u=d(Te(Ke(t.add(y(d(1),d(1)))),s.sub(y(d(1),d(1))))).toVar();return s.assign(s.mul(s).mul(s).mul(s.mul(s.mul(d(6)).sub(d(15))).add(d(10)))),T(T(i,o,s.y),T(a,u,s.y),s.x)}).setLayout({name:"gradientNoise",type:"float",inputs:[{name:"p",type:"vec2"}]}),zt=C(([n])=>Fs(n).add(.5)),yt=C(([n,e,t,s])=>{const i=ne(e).toVar(),o=d(s).toVar(),a=y(t.x,t.y).toVar(),u=y(n.x,n.y).sub(d(.5)).mul(o).toVar();u.addAssign(a);const c=d(0).toVar(),r=d(1).div(2).toVar();return Tt(i,({i:p})=>{const m=u.mul(d(2).pow(d(p))).toVar(),f=zt(m).mul(r).toVar();r.divAssign(2),c.addAssign(f)}),c}).setLayout({name:"perlinNoise",type:"float",inputs:[{name:"UV",type:"vec2"},{name:"octaves",type:"int"},{name:"offset",type:"vec2"},{name:"scale",type:"float"}]}),Zs=Dt(`
fn cracks(uv: vec2<f32>, angle: f32, scale: f32, thickness: f32) -> f32  {
	let st: vec2<f32> = (uv - 0.5) * scale;
	let i_st: vec2<f32> = floor(st);
	let f_st: vec2<f32> = fract(st);
	var m1: f32 = 1.;
	var m2: f32 = 1.;

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let neighbor: vec2<f32> = vec2<f32>(x, y);
			var point: vec2<f32> = random2(i_st + neighbor);
			point = 0.5 + 0.5 * sin(angle + 6.2831 * point);
			let diff: vec2<f32> = neighbor + point - f_st;
			let dist: f32 = length(diff);
			let cond: f32 = step(dist, m1);
			m2 = mix(min(max(m1, dist), m2), m1, cond);
			m1 = mix(m1, dist, cond);
		}

	}

	let edge: f32 = smoothstep(0.01, thickness, m2 - m1);
	return edge;
} 

fn random2(p: vec2<f32>) -> vec2<f32> {
	return fract(sin(vec2<f32>(dot(p, vec2<f32>(127.1, 311.7)), dot(p, vec2<f32>(269.5, 183.3)))) * 43758.547);
} 
`),rt=Dt(`
fn voronoi(UV: vec2<f32>, angleOffset: f32, cellDensity: f32) -> vec2<f32> {
	let g: vec2<f32> = floor((UV - 0.5) * cellDensity);
	let f: vec2<f32> = fract((UV - 0.5) * cellDensity);
	var res: vec3<f32> = vec3<f32>(8., 0., 0.);

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let lattice: vec2<f32> = vec2<f32>(x, y);
			let offset: vec2<f32> = voronoiNoiseRandomVector(lattice + g, angleOffset);
			let d: f32 = distance(lattice + offset, f);
			res = mix(res, vec3<f32>(d, offset.x, offset.y), step(d, res.x));
		}

	}

	return vec2<f32>(res.x, res.y);
} 

fn voronoiNoiseRandomVector(UV: vec2<f32>, offset: f32) -> vec2<f32> {
	var UV_var = UV;
	let m: mat2x2<f32> = mat2x2<f32>(15.27, 47.63, 99.41, 89.98);
	UV_var = fract(sin(UV_var * m) * 46839.32);
	return vec2<f32>(sin(UV_var.y * offset) * 0.5 + 0.5, cos(UV_var.x * offset) * 0.5 + 0.5);
}
`);class qs extends q{constructor(){super(...arguments);l(this,"Name","nodes.perlinNoise");l(this,"Outputs",[new O(!1,this,"Output")]);l(this,"Properties",[new b("Scale",10,0,100,0,"Transform","%"),new b("Octaves Count",10,1,50,1,"Noise",""),new b("Offset X",0,-100,100,0,"Transform",""),new b("Offset Y",0,-100,100,0,"Transform",""),new b("Warp Scale",0,0,1,.001,"Warp","%"),new b("Seed",0,0,99999,0,"Random",""),new b("Height",.4,0,1,0,"Noise","")]);l(this,"IsRealtimeUpdate",!0);l(this,"DefaultOutput",0);l(this,"Random",C(([t])=>{const s=y(t).toVar();return Ce(Ae(Te(s,y(12.9898,78.233))).mul(43758.5453))}))}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value);S(this.Properties[4].Value);const a=S(this.Properties[5].Value),u=S(this.Properties[6].Value);this.Outputs[0].Value=C(([c])=>{const r=y(c.x,c.y).toVar();return r.addAssign(this.Random(y(a).mul(a))),yt(r,s,y(i,o),t).mul(u)})}}const Ks=A({__name:"DraggableNode",props:{GraphNode:{type:Function,required:!0}},setup(n){const e=et(),t=n,s=k(),i=r=>{var m;if((m=r.dataTransfer)==null||m.setData("string","1"),t.GraphNode!=null&&t.GraphNode!=null){var p=t.GraphNode;e.setNode(new p)}};var o=void 0;const a=r=>{var f;o=(f=s.value)==null?void 0:f.cloneNode(!0);var p=o.getBoundingClientRect();if(o.style.position="fixed",o.style.left=`${r.touches[0].pageX-p.width/2}px`,o.style.top=`${r.touches[0].pageY-p.height/2}px`,o.style.zIndex="1000",document.body.appendChild(o),t.GraphNode!=null&&t.GraphNode!=null){var m=t.GraphNode;e.setNode(new m)}},u=r=>{if(o!=null){var p=o.getBoundingClientRect();o.style.left=`${r.touches[0].pageX-p.width/2}px`,o.style.top=`${r.touches[0].pageY-p.height/2}px`}},c=r=>{if(o!=null){document.body.removeChild(o),o=void 0,r.preventDefault(),r.stopPropagation();var p=r.changedTouches[0],m=document.elementFromPoint(p.clientX,p.clientY);console.log(m)}};return window.addEventListener("touchmove",u),window.addEventListener("touchend",c),(r,p)=>(h(),g("div",{onTouchstart:a,onDragstart:i,draggable:"true",class:"node",ref_key:"selfEl",ref:s},[de(r.$slots,"default",{},void 0,!0)],544))}}),js=B(Ks,[["__scopeId","data-v-ee47cd3c"]]);class W{static register(e){var t=new e;this.classMap.set(t.constructor.name,e)}static registerStr(e,t,s){this.classMap.set(e,s),this.groupsMap.has(t)||this.groupsMap.set(t,new Map);var i=this.groupsMap.get(t);i==null||i.set(e,s)}static create(e,...t){const s=this.classMap.get(e);if(!s)throw new Error(`Class ${e} not registered`);return new s(...t)}static getGroups(){return this.groupsMap}}l(W,"classMap",new Map),l(W,"groupsMap",new Map);const Js={class:"node-list"},Qs=A({__name:"NodeList",setup(n){var e=W.getGroups();return(t,s)=>{const i=te("font-awesome-icon");return h(),g("div",Js,[(h(!0),g(z,null,fe(J(e),([o,a])=>(h(),g(z,null,[o!=""?(h(),G(Wt,{key:0},{header:I(()=>[R(M(t.$t(o)),1)]),default:I(()=>[(h(!0),g(z,null,fe(a,([u,c])=>(h(),G(js,{"-graph-node":c},{default:I(()=>[v(i,{icon:["fas","circle-nodes"]}),R(" "+M(t.$t(u)),1)]),_:2},1032,["-graph-node"]))),256))]),_:2},1024)):Q("",!0)],64))),256))])}}}),en=B(Qs,[["__scopeId","data-v-ff1a0b3e"]]),tn={class:"padding"},sn={class:"header disable-user-select"},nn={class:"body disable-user-select"},on=A({__name:"FrameTab",props:{wheelFocus:{type:Boolean,default:!0}},setup(n){const e=n,t=k(),s=i=>{t.value&&e.wheelFocus&&t.value.focus()};return(i,o)=>(h(),g("div",tn,[V("div",{class:"main",tabindex:"0",ref_key:"selfEl",ref:t,onWheel:s},[V("div",sn,[de(i.$slots,"header",{},void 0,!0)]),V("div",nn,[de(i.$slots,"default",{},void 0,!0)])],544)]))}}),tt=B(on,[["__scopeId","data-v-bce70494"]]);class xt{static pathExists(e,t){if(e===t)return!0;const s=new Set;return this.dfs(e,t,s)}static dfs(e,t,s){if(e===t)return!0;if(s.has(e))return!1;s.add(e);for(const i of e.Outputs)for(const o of i.Links)if(o.Out!=null&&o.Out!=null){const a=o.Out.ParentNode;if(this.dfs(a,t,s))return!0}return!1}}const an=A({__name:"TerminalRenderer",props:{Term:{type:O,required:!0}},setup(n,{expose:e}){const t=et(),s=n,i=p=>{t.SourceTerminal=s.Term,t.IsDragging=!0,window.addEventListener("mouseup",o)},o=p=>{var _,P,D;window.removeEventListener("mouseup",o),t.IsDragging=!1;var m=t.DestinationTerminal,f=t.SourceTerminal;if(m!=null&&m!=f&&!(f!=null&&f.IsInput&&m.IsInput)&&(f==null?void 0:f.ParentNode)!=m.ParentNode){if(f!=null&&f.IsInput){if(xt.pathExists(f==null?void 0:f.ParentNode,m.ParentNode))return;f.Links.forEach(x=>{var Y,oe;(oe=(Y=f==null?void 0:f.ParentNode)==null?void 0:Y.ParentGraph)==null||oe.DeleteLink(x)})}if(m.IsInput){if(xt.pathExists(m==null?void 0:m.ParentNode,f==null?void 0:f.ParentNode))return;m.Links.forEach(x=>{var Y,oe;(oe=(Y=m==null?void 0:m.ParentNode)==null?void 0:Y.ParentGraph)==null||oe.DeleteLink(x)})}(P=(_=s.Term.ParentNode)==null?void 0:_.ParentGraph)==null||P.AddLink(m,f);var w=ce();(D=s.Term.ParentNode)!=null&&D.IsRealtimeUpdate&&(w.ChangeEvent=!w.ChangeEvent)}},a=p=>{t.IsDragging&&(t.DestinationTerminal=s.Term)},u=p=>{t.IsDragging&&(t.DestinationTerminal=null)},c=k();mt(()=>{ge(()=>{r()})});const r=()=>{var f,w,_,P;var p=((f=c.value)==null?void 0:f.offsetLeft)+((w=c.value)==null?void 0:w.offsetWidth)/2+2,m=((_=c.value)==null?void 0:_.offsetTop)+((P=c.value)==null?void 0:P.offsetHeight)/2+2;s.Term.SetOffset(p,m)};return e({SetOffset:r}),(p,m)=>{const f=Ne("tooltip");return H((h(),g("div",{class:Ie(["node-terminal",{connected:s.Term.IsConnected},"disable-user-select"]),onMousedown:[m[0]||(m[0]=ae(()=>{},["right","stop"])),ae(i,["left"])],onMouseover:a,onMouseleave:u,ref_key:"selfEl",ref:c},null,34)),[[f,{content:s.Term.Name,placement:s.Term.IsInput?"left":"right"}]])}}}),kt=B(an,[["__scopeId","data-v-278bc81c"]]);class be extends q{constructor(){super(...arguments);l(this,"Name","nodes.buffer");l(this,"Inputs",[new O(!0,this,"")]);l(this,"Outputs",[new O(!1,this,"")])}Calculate(){this.BaseCalculate();var t=this.Inputs[0].Links[0].In,s=this.Outputs[0];s.Value=t==null?void 0:t.Value}}const rn={},ln={class:"loader"};function un(n,e){return h(),g("span",ln)}const Ft=B(rn,[["render",un],["__scopeId","data-v-8c5c5c6f"]]);class Zt{constructor(){l(this,"IsSubGraph",!1);l(this,"Nodes",new Array);l(this,"Links",new Array)}get HasSelected(){return this.Nodes.some(e=>e.IsSelected)||this.Links.some(e=>e.IsSelected)}AddNode(e,t=!0){var s=this.Nodes.indexOf(e);s==-1&&(e.ParentGraph=this,this.Nodes.push(e),t&&le.PushState(this))}DeleteLink(e,t=!0){var s=this.Links.indexOf(e);s!=-1&&(e.DeleteLinkFromTerminals(),this.Links.splice(s,1),t&&le.PushState(this))}AddLink(e,t,s=!0){if(!(e.IsInput&&t.IsInput||!e.IsInput&&!t.IsInput)){var i=new Ht;e.IsInput?(i.In=t,i.Out=e):(i.In=e,i.Out=t),t.Links.push(i),e.Links.push(i),this.Links.push(i),s&&le.PushState(this)}}DeleteNode(e,t=!0){if(e!=null){var s=he();s.SelectedNode==e&&(s.SelectedNode=null),s.LockedNode==e&&(s.LockedNode=null),e.Inputs.forEach(o=>{var a=o.Links.map(u=>u);a.forEach(u=>{this.DeleteLink(u)})}),e.Outputs.forEach(o=>{var a=o.Links.map(u=>u);a.forEach(u=>{this.DeleteLink(u)})});var i=this.Nodes.indexOf(e);i!=-1&&this.Nodes.splice(i,1),t&&le.PushState(this)}}DeleteSelected(e=!0){this.Nodes.filter(s=>s.IsSelected).forEach(s=>this.DeleteNode(s,!1));var t=he();t.SelectedNode=void 0,this.Links.filter(s=>s.IsSelected).forEach(s=>this.DeleteLink(s,!1)),e&&le.PushState(this)}DeselectAll(){var e=he();e.SelectedNode=void 0,this.Nodes.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1)),this.Links.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1))}SelectAll(){this.Nodes.forEach(e=>e.SetSelected(!0))}}class Ye{static Serialize(e){var a,u,c,r,p,m,f,w;var t=new dn;if(e.Nodes!=null&&e.Nodes.length>0)for(const _ of e.Nodes){var s=new cn;if(s.NodeType=_.Name,s.NodeGuid=_.Id,s.NodePostition=_.Position,_.Properties!=null&&_.Properties.length>0)for(const P of _.Properties){var i=new hn;i.Value=P.Value,s.Properties==null&&(s.Properties=new Array),s.Properties.push(i)}t.Nodes==null&&(t.Nodes=new Array),t.Nodes.push(s)}if(e.Links!=null&&e.Links.length>0)for(const _ of e.Links){var o=new fn;o.FromNodeGuid=(u=(a=_.In)==null?void 0:a.ParentNode)==null?void 0:u.Id,o.ToNodeGuid=(r=(c=_.Out)==null?void 0:c.ParentNode)==null?void 0:r.Id,o.FromTerminalIndex=(m=(p=_.In)==null?void 0:p.ParentNode)==null?void 0:m.Outputs.indexOf(_.In),o.ToTerminalIndex=(w=(f=_.Out)==null?void 0:f.ParentNode)==null?void 0:w.Inputs.indexOf(_.Out),t.Links==null&&(t.Links=new Array),t.Links.push(o)}return t}static Deserialize(e){var t=new Zt;if(e.Nodes!=null&&e.Nodes.length>0)for(var s of e.Nodes){var i=W.create(s.NodeType);if(i.Id=s.NodeGuid,i.Move(s.NodePostition.X,s.NodePostition.Y),s.Properties!=null&&s.Properties.length>0)for(var o=0;o<s.Properties.length;o++)i.Properties[o].Value=s.Properties[o].Value;t.AddNode(i,!1)}if(e.Links!=null&&e.Links.length>0)for(var a of e.Links){var u=_t(t.Nodes).firstOrDefault(r=>r.Id==a.FromNodeGuid),c=_t(t.Nodes).firstOrDefault(r=>r.Id==a.ToNodeGuid);u==null||c==null||t.AddLink(u.Outputs[a.FromTerminalIndex],c.Inputs[a.ToTerminalIndex],!1)}return t}}class dn{constructor(){l(this,"Nodes");l(this,"Links")}static ToJson(e){return JSON.stringify(e)}}class cn{constructor(){l(this,"NodeGuid");l(this,"NodeType");l(this,"NodePostition");l(this,"Properties")}}class hn{constructor(){l(this,"Value")}}class fn{constructor(){l(this,"FromNodeGuid");l(this,"ToNodeGuid");l(this,"FromTerminalIndex");l(this,"ToTerminalIndex")}}class pn{constructor(e){l(this,"buffer");l(this,"capacity");l(this,"head",0);l(this,"tail",0);l(this,"size",0);l(this,"poppedItems",[]);if(e<=0)throw new Error("Capacity must be greater than 0");this.capacity=e,this.buffer=new Array(e)}get hasValues(){return this.size>0}get hasPoppedItems(){return this.poppedItems.length>0}push(e){this.poppedItems=[],this.size===this.capacity?(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.head=(this.head+1)%this.capacity):(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++)}pop(){if(!this.hasValues)return;this.tail=(this.tail-1+this.capacity)%this.capacity;const e=this.buffer[this.tail];return this.size--,this.poppedItems.push(e),e}unpop(){if(!this.hasPoppedItems)return;const e=this.poppedItems.pop();return this.size===this.capacity&&(this.head=(this.head+1)%this.capacity),this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++,e}toArray(){const e=[];for(let t=0;t<this.size;t++){const s=(this.head+t)%this.capacity;e.push(this.buffer[s])}return e}peek(){if(this.hasValues)return this.buffer[(this.tail-1+this.capacity)%this.capacity]}get length(){return this.size}}class le{static get HasValues(){return this.ActionHistoryBuffer.hasValues}static get HasPopped(){return this.ActionHistoryBuffer.hasPoppedItems}static PushState(e){this.ActionHistoryBuffer.push(Ye.Serialize(e))}static UnpopState(){if(this.ActionHistoryBuffer.hasPoppedItems){var e=this.ActionHistoryBuffer.unpop();return Ye.Deserialize(e)}return null}static PopState(){if(this.ActionHistoryBuffer.hasValues){var e=this.ActionHistoryBuffer.pop();return Ye.Deserialize(e)}return null}}l(le,"ActionHistoryBuffer",new pn(25));class dt{constructor(e,t,s,i){l(this,"X",0);l(this,"Y",0);l(this,"Height",0);l(this,"Width",0);this.X=e,this.Y=t,this.Height=s,this.Width=i}ContainsRect(e){return this.X<=e.X&&e.X+e.Width<=this.X+this.Width&&this.Y<=e.Y&&e.Y+e.Height<=this.Y+this.Height}ContainsPoint(e,t){return this.X<=e&&e<this.X+this.Width&&this.Y<=t&&t<this.Y+this.Height}IntersectsWith(e){return e.X<this.X+this.Width&&this.X<e.X+e.Width&&e.Y<this.Y+this.Height&&this.Y<e.Y+e.Height}static Intersects(e,t){return e.X<t.X+t.Width&&t.X<e.X+e.Width&&e.Y<t.Y+t.Height&&t.Y<e.Y+e.Height}}const mn=A({__name:"ContextMenu",props:{CloseOnAnyClick:{type:Boolean,default:!0}},setup(n,{expose:e}){const t=k(!1),s=k(),i=f=>{t.value=!0,ge(()=>{s.value!=null&&s.value!=null&&(s.value.style.left=f.pageX+"px",s.value.style.top=f.pageY+"px",a(),window.addEventListener("mousedown",m))})},o=f=>{ge(()=>{s.value!=null&&(s.value.style.width=f+"px")})},a=()=>{if(s.value!=null&&s.value!=null){const w=s.value.getBoundingClientRect();if(w.y+w.height>window.innerHeight){var f=w.y+w.height-window.innerHeight;s.value.style.top=w.y-f+"px"}if(w.y<0&&(s.value.style.top="0px"),w.x+w.width>window.innerWidth){var f=w.x+w.width-window.innerWidth;s.value.style.left=w.x-f+"px"}w.x<0&&(s.value.style.left="0px")}},u=f=>{t.value=!0,ge(()=>{if(s.value!=null&&s.value!=null){var w=f.getBoundingClientRect();s.value.style.left=w.x+"px",s.value.style.top=w.y+w.height+"px",a(),window.addEventListener("mousedown",m)}})},c=f=>{t.value=!0,ge(()=>{if(s.value!=null&&s.value!=null){var w=f.getBoundingClientRect(),_=s.value.getBoundingClientRect();s.value.style.left=w.x-_.width+"px",s.value.style.top=w.y+"px",a(),window.addEventListener("mousedown",m)}})},r=f=>{t.value=!0,ge(()=>{if(s.value!=null&&s.value!=null){var w=f.getBoundingClientRect();s.value.style.left=w.x+w.width+"px",s.value.style.top=w.y+"px",a(),window.addEventListener("mousedown",m)}})},p=()=>{window.removeEventListener("mousedown",m),t.value=!1},m=f=>{if(s.value!=null){var w=s.value.getBoundingClientRect(),_=new dt(w.x,w.y,w.height,w.width);_.ContainsPoint(f.clientX,f.clientY)||(t.value=!1,window.removeEventListener("mousedown",m))}};return e({Open:i,Close:p,OpenUnder:u,OpenLeft:c,OpenRight:r,SetWidth:o}),(f,w)=>(h(),G(es,{name:"open"},{default:I(()=>[(h(),G(Qt,{to:"body"},[t.value?(h(),g("div",{key:0,onContextmenu:w[0]||(w[0]=ae(()=>{},["prevent"])),onMousedown:w[1]||(w[1]=ae(()=>{},["stop"])),ref_key:"ContextMenu",ref:s,class:"context-menu disable-user-select"},[de(f.$slots,"default",{onOnmousedown:p},void 0,!0)],544)):Q("",!0)]))]),_:3}))}}),nt=B(mn,[["__scopeId","data-v-85788d5b"]]),vn=A({__name:"ContextMenuItem",props:{Active:{type:Boolean,default:!1}},setup(n){return(e,t)=>(h(),g("button",{class:Ie([["btn",{active:n.Active}],"btn"]),style:{padding:"5px"}},[de(e.$slots,"default",{},void 0,!0)],2))}}),ie=B(vn,[["__scopeId","data-v-3e13e567"]]),gn={class:"node-container"},wn={class:"node-terminals left"},Vn={class:"node-center"},yn={class:"node-name"},Sn={class:"node-terminals right"},_n=A({props:{Offset:{type:N,required:!0},Zoom:{type:Number,required:!0},Node:{type:q,required:!0},AllNodes:{type:Array,default:new Array}},data(){return{LastMousePosition:new N(0,0),IsDragging:!1,ContextMenu:!1}},created:function(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted:function(){this.$nextTick(()=>{var n=this.$el;this.Node.SetSize(n.offsetHeight,n.offsetWidth),this.Node.Move(this.Node.Position.X-this.Node.Width/2,this.Node.Position.Y-this.Node.Height/2);var e=new ResizeObserver(this.OnNodeResize);e.observe(this.$refs.node)})},computed:{PriviewLocked:function(){var n=he();return n.LockedNode==this.Node},Top:function(){var n=this.Node.Position.Y;return n+"px"},Left:function(){var n=this.Node.Position.X;return n+"px"},Cursor:function(){return this.IsDragging?"grabbing":"default"},ZIndex:function(){return this.Node.IsSelected?"1":"0"},Blur:function(){return 4/this.Zoom+"px"},Border:function(){return this.Node.IsCalculated?"solid":"dashed"},IsNodeLocked:function(){var n=he(),e=n.LockedNode;return e!=null&&e==this.Node}},methods:{OpenContextMenu(n){this.$refs.contextMenu.Open(n)},CloseContextMenu(){this.$refs.contextMenu.Close()},OnNodeResize:function(){if(this.$refs.terminals!=null){var n=this.$refs.terminals;n.forEach(e=>{e.SetOffset()})}},LockNode:function(){var n=he(),e=ce();n.LockedNode==this.Node?n.LockedNode=null:(n.LockedNode=this.Node,this.Node.SetSelected(!0),e.ChangeEvent=!e.ChangeEvent)},Down:function(n,e,t){var i,o,a,u,c;if(this.IsDragging=!0,this.LastMousePosition.X=n,this.LastMousePosition.Y=e,t)this.Node.SetSelected(!((i=this.Node)!=null&&i.IsSelected));else{var s=(o=this.Node.ParentGraph)==null?void 0:o.Nodes.filter(r=>r.IsSelected);s.length>1?this.Node.IsSelected==!1&&((a=this.Node.ParentGraph)==null||a.DeselectAll(),this.Node.SetSelected(!0)):((u=this.Node.ParentGraph)==null||u.DeselectAll(),this.Node.SetSelected(!0))}(c=this.Node.ParentGraph)==null||c.Nodes.filter(r=>r.IsSelected).forEach(r=>{r.SetLastPosition(r.Position.X,r.Position.Y)}),le.PushState(this.Node.ParentGraph)},OnTouchDown:function(n){if(this.$refs.terminals!=null&&this.$refs.terminals.some(s=>s.$el==n.target||s==n.target))return;let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Down(e,t,!1)},OnMouseDown:function(n){this.$refs.terminals!=null&&this.$refs.terminals.some(e=>e.$el==n.target||e==n.target)||this.Down(n.clientX,n.clientY,n.shiftKey)},OnMouseUp:function(n){this.IsDragging=!1},OnTouchUp:function(n){this.IsDragging=!1},OnTouchMove:function(n){let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Move(e,t)},Move:function(n,e){var i;if(this.IsDragging){var t=(n-this.LastMousePosition.X)/this.Zoom,s=(e-this.LastMousePosition.Y)/this.Zoom;(i=this.Node.ParentGraph)==null||i.Nodes.filter(o=>o.IsSelected).forEach(o=>{o.Move(o.LastPosition.X+t,o.LastPosition.Y+s)})}},OnMouseMove:function(n){this.Move(n.clientX,n.clientY)}}}),bn=A({..._n,__name:"NodeRenderer",setup(n){return $t(e=>({"565ed938":e.Cursor,f3d0d29a:e.Top,"3cd77669":e.Left,"7b303a5a":e.ZIndex})),(e,t)=>{const s=te("font-awesome-icon"),i=Ne("tooltip");return h(),g("div",{class:Ie([{node:!(e.Node instanceof J(be))},{"node-buffer":e.Node instanceof J(be)},"disable-user-select",{"not-calculated":e.Node.CalculationState==J(Pe).NotCalculated&&!(e.Node instanceof J(be))},{selected:e.Node.IsSelected},{lockedPreview:e.PriviewLocked},{"node-without-inputs":e.Node.Inputs.length==0}]),ref:"node",onMousedown:[t[3]||(t[3]=ae((...o)=>e.OnMouseDown&&e.OnMouseDown(...o),["left"])),t[7]||(t[7]=ae((...o)=>e.OpenContextMenu&&e.OpenContextMenu(...o),["right"]))],onTouchmove:t[4]||(t[4]=(...o)=>e.OnTouchMove&&e.OnTouchMove(...o)),onTouchstart:t[5]||(t[5]=(...o)=>e.OnTouchDown&&e.OnTouchDown(...o)),onTouchend:t[6]||(t[6]=(...o)=>e.OnTouchUp&&e.OnTouchUp(...o))},[V("div",gn,[V("div",wn,[(h(!0),g(z,null,fe(e.Node.Inputs,o=>(h(),G(kt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))]),V("div",Vn,[e.Node instanceof J(be)?Q("",!0):(h(),g(z,{key:0},[H((h(),g("a",{class:"lock-icon",onClick:t[0]||(t[0]=o=>e.LockNode())},[e.IsNodeLocked?(h(),G(s,{key:0,icon:["fas","lock"]})):(h(),G(s,{key:1,icon:["fas","lock-open"]}))])),[[i,{content:e.$t("tt.lockPreview"),placement:"bottom"}]]),V("div",yn,M(e.$t(e.Node.Name)),1),e.Node.CalculationState==J(Pe).Calculation?(h(),G(Ft,{key:0})):Q("",!0)],64))]),V("div",Sn,[(h(!0),g(z,null,fe(e.Node.Outputs,o=>(h(),G(kt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))])]),v(nt,{ref:"contextMenu",CloseOnAnyClick:!0},{default:I(()=>[v(ie,null,{default:I(()=>[v(s,{icon:["far","copy"]}),R(" "+M(e.$t("tt.copy")),1)]),_:1}),v(ie,{onClick:t[1]||(t[1]=o=>{var a,u;(a=e.Node.ParentGraph)==null||a.DeleteNode(e.Node),(u=e.Node.ParentGraph)==null||u.DeleteSelected(),e.CloseContextMenu()}),style:{color:"var(--vt-c-red)"}},{default:I(()=>[v(s,{icon:["far","trash-can"]}),R(" "+M(e.$t("tt.delete")),1)]),_:1}),t[8]||(t[8]=V("hr",null,null,-1)),v(ie,{onClick:t[2]||(t[2]=o=>{e.LockNode(),e.CloseContextMenu()})},{default:I(()=>[e.IsNodeLocked?(h(),G(s,{key:0,icon:["fas","lock"]})):(h(),G(s,{key:1,icon:["fas","lock-open"]})),e.IsNodeLocked?(h(),g(z,{key:2},[R("  "+M(e.$t("tt.unlockPreview")),1)],64)):(h(),g(z,{key:3},[R("  "+M(e.$t("tt.lockPreview")),1)],64))]),_:1})]),_:1,__:[8]},512)],34)}}}),Ot=B(bn,[["__scopeId","data-v-1d778793"]]),Pn={},Nn={class:"canvas",xmlns:"http://www.w3.org/2000/svg"};function In(n,e){return h(),g("svg",Nn,[de(n.$slots,"default",{},void 0,!0)])}const Cn=B(Pn,[["render",In],["__scopeId","data-v-81940268"]]),Mn=["points"],xn=A({computed:{Points(){var t,s,i,o,a,u;var n=N.Add((s=(t=this.Link.In)==null?void 0:t.ParentNode)==null?void 0:s.Position,(i=this.Link.In)==null?void 0:i.OffsetPosition),e=N.Add((a=(o=this.Link.Out)==null?void 0:o.ParentNode)==null?void 0:a.Position,(u=this.Link.Out)==null?void 0:u.OffsetPosition);return`${n.X},${n.Y} ${n.X+20},${n.Y} ${e.X-20},${e.Y} ${e.X},${e.Y}`}}}),kn=A({...xn,__name:"LinkRenderer",props:{Link:{type:Ht,required:!0}},setup(n){const e=n,t=()=>{e.Link.SetSelected(!0)},s=i=>{var r;var o=e.Link.In,a=e.Link.Out;if(!(o==null||a==null)){var u=new be;u.Move(i.offsetX,i.offsetY);var c=(r=o.ParentNode)==null?void 0:r.ParentGraph;c!=null&&(c.DeleteLink(e.Link),c.AddNode(u),c.AddLink(o,u.Inputs[0]),c.AddLink(u.Outputs[0],a))}};return(i,o)=>(h(),g("polyline",{onClick:t,onDblclick:s,points:i.Points,class:Ie(["line",{selected:e.Link.IsSelected}])},null,42,Mn))}}),On=B(kn,[["__scopeId","data-v-a61d9acd"]]),Ln={},$n={class:"tool-bar-container"};function Rn(n,e){return h(),g("div",$n,[de(n.$slots,"default",{},void 0,!0)])}const ct=B(Ln,[["render",Rn],["__scopeId","data-v-b20ca96b"]]),Dn={},Tn={class:"tool-bar-body"};function An(n,e){return h(),g("div",Tn,[de(n.$slots,"default")])}const me=B(Dn,[["render",An]]);class qt extends q{constructor(){super(...arguments);l(this,"Name","nodes.fake");l(this,"Position",new N(1e3,1e3))}}const Xn={key:0,class:"selection-box"},Gn={class:"offset-container",ref:"offset_container"},Bn=["points"],Yn={key:1,style:{"pointer-events":"none",height:"100%",width:"100%",padding:"30px"}},En=A({props:{MinScale:{type:Number,default:.5},MaxScale:{type:Number,default:2}},data(){return{Offset:new N(0,0),SelectionBox:new dt(0,0,0,0),SelectionBoxVisibility:!1,LastMouse:new N(0,0),LastOffset:new N(0,0),Zoom:1,isDragging:!1,_Graph:new Zt,dragStore:et(),points:"",GridSize:20,isDragOver:!1,fakeNode:new qt}},computed:{Nodes:function(){return this._Graph.Nodes},OffsetXStyle:function(){return this.Offset.X+"px"},OffsetYStyle:function(){return this.Offset.Y+"px"},EditorCursor:function(){return this.isDragging?"grabbing":"default"},SelectionBoxX:function(){return this.SelectionBox.X+"px"},SelectionBoxY:function(){return this.SelectionBox.Y+"px"},SelectionBoxHeight:function(){return this.SelectionBox.Height+"px"},SelectionBoxWidth:function(){return this.SelectionBox.Width+"px"},OffsetStyle:function(){var n=this.GridSize/2*this.Zoom;return this.Offset.X-n+"px "+(this.Offset.Y-n)+"px"},ScaleGridStyle:function(){var n=(this.GridSize*this.Zoom).toString();return`${n}px ${n}px`}},created(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted(){this.$nextTick(()=>{var e;this.$el;var n=((e=this.$parent)==null?void 0:e.$el).parentElement;n!=null&&(n.onkeydown=this.KeysHandler)})},methods:{SaveGraph(){var n=Ye.Serialize(this._Graph),e=JSON.stringify(n);console.log(e);var t=JSON.parse(e);console.log(t);var s=Ye.Deserialize(t);console.log(s)},Undo(){var n=le.PopState();n!=null&&(this._Graph=n)},Redo(){var n=le.UnpopState();n!=null&&(this._Graph=n)},isChild(n,e){for(var t=e.parentNode;t!=null;){if(t==n)return!0;t=t.parentNode}return!1},dragenter(){this.isDragOver=!0},dragleave(n){var e=this.$el,t=n.target;this.isChild(e,t)||(this.isDragOver=!1)},drop(n){this.isDragOver=!1;var e=et(),t=e.getNode();if(t!=null){var s=this.$refs.editor,i=s.getBoundingClientRect();if(i!=null){le.PushState(this._Graph);var o=N.Div(new N(n.clientX-i.x-this.Offset.X,n.clientY-i.y-this.Offset.Y),this.Zoom);t==null||t.Move(o.X,o.Y),this._Graph.AddNode(t)}}},KeysHandler(n){n.key=="Delete"&&(le.PushState(this._Graph),this._Graph.DeleteSelected())},UpdateOffsetStyle(){var n=this.$refs.offset_container;n.style.left=this.OffsetXStyle,n.style.top=this.OffsetYStyle,n.style.scale=this.Zoom.toString()},OnMouseDownLeft:function(n){this.DrawGhostLine(n),n.target==this.$refs.editor&&(this.LastMouse=new N(n.clientX,n.clientY),this.SelectionBox.X=0,this.SelectionBox.Y=0,this.SelectionBox.Width=0,this.SelectionBox.Height=0,this.SelectionBoxVisibility=!0,this._Graph.DeselectAll())},OnMouseDownMiddle:function(n){this.isDragging=!0,this.LastMouse=new N(n.clientX,n.clientY),this.LastOffset={...this.Offset}},OnMouseMove:function(n){if(this.isDragging){n.preventDefault();var e=n.clientX-this.LastMouse.X,t=n.clientY-this.LastMouse.Y;this.Offset.X=this.LastOffset.X+e,this.Offset.Y=this.LastOffset.Y+t,this.UpdateOffsetStyle()}if(this.SelectionBoxVisibility){n.preventDefault();var s=new N(n.clientX,n.clientY),i=new N(Math.min(this.LastMouse.X,s.X),Math.min(this.LastMouse.Y,s.Y)),o=new N(Math.abs(this.LastMouse.X-s.X),Math.abs(this.LastMouse.Y-s.Y)),a=this.$refs.editor,u=a.getBoundingClientRect();this.SelectionBox.X=i.X-u.left,this.SelectionBox.Y=i.Y-u.top,this.SelectionBox.Width=o.X,this.SelectionBox.Height=o.Y,this._Graph.Nodes.forEach(c=>{var r=new dt(this.Offset.X+c.Position.X*this.Zoom,this.Offset.Y+c.Position.Y*this.Zoom,c.Height*this.Zoom,c.Width*this.Zoom);this.SelectionBox.IntersectsWith(r)?c.SetSelected(!0):c.SetSelected(!1)})}this.DrawGhostLine(n)},OnMouseUp:function(n){this.isDragging=!1,this.SelectionBoxVisibility=!1},OnWheel:function(n){let t=this.$refs.editor.getBoundingClientRect(),s=n.deltaY*.001,i=this.Zoom;this.Zoom=this.Clamp(this.Zoom-s,this.MinScale,this.MaxScale);let o=new N(n.clientX-t.left,n.clientY-t.top),a=(i-this.Zoom)/i;this.Offset=N.Add(this.Offset,N.Mul(N.Sub(o,this.Offset),a)),this.UpdateOffsetStyle()},DisableContextMenu(n){n.preventDefault()},Clamp:function(n,e,t){return Math.min(Math.max(n,e),t)},DrawGhostLine(n){var c;if(this.dragStore.IsDragging){var e=this.$refs.editor,t=e.getBoundingClientRect();if(n.preventDefault(),t!=null){var s=this.dragStore.SourceTerminal,i=N.Add((c=s.ParentNode)==null?void 0:c.Position,s.OffsetPosition),o=N.Div(new N(n.clientX-t.x-this.Offset.X,n.clientY-t.y-this.Offset.Y),this.Zoom),a=s.IsInput?o:i,u=s.IsInput?i:o;this.points=`${a.X},${a.Y} ${a.X+20},${a.Y} ${u.X-20},${u.Y} ${u.X},${u.Y}`}}}}}),Hn=A({...En,__name:"GraphRenderer",setup(n){return $t(e=>({"215df84a":e.EditorCursor,"37cbc353":e.SelectionBoxY,"37cbc352":e.SelectionBoxX,"2676868d":e.SelectionBoxHeight,"1ad8f3a0":e.SelectionBoxWidth,57915170:e.ScaleGridStyle,cc90e252:e.OffsetStyle})),(e,t)=>{const s=te("font-awesome-icon"),i=Ne("tooltip");return h(),g("div",{class:"graph-renderer dot",ref:"editor",onWheel:t[4]||(t[4]=(...o)=>e.OnWheel&&e.OnWheel(...o)),onMousedown:[t[5]||(t[5]=ae((...o)=>e.OnMouseDownLeft&&e.OnMouseDownLeft(...o),["left"])),t[6]||(t[6]=ae((...o)=>e.OnMouseDownMiddle&&e.OnMouseDownMiddle(...o),["middle"]))],onContextmenu:ae(()=>!1,["prevent","right"]),onDragover:t[7]||(t[7]=ae(()=>{},["prevent"])),onDragenter:t[8]||(t[8]=(...o)=>e.dragenter&&e.dragenter(...o)),onDragleave:t[9]||(t[9]=(...o)=>e.dragleave&&e.dragleave(...o)),onDrop:t[10]||(t[10]=(...o)=>e.drop&&e.drop(...o))},[v(ct,{class:"top-left"},{default:I(()=>[v(me,null,{default:I(()=>[H((h(),g("a",{onClick:t[0]||(t[0]=o=>e.Undo())},[v(s,{icon:["fas","rotate-left"]})])),[[i,e.$t("tt.undo"),void 0,{bottom:!0}]]),H((h(),g("a",{onClick:t[1]||(t[1]=o=>e.Redo())},[v(s,{icon:["fas","rotate-right"]})])),[[i,e.$t("tt.redo"),void 0,{bottom:!0}]])]),_:1}),v(me,null,{default:I(()=>[H((h(),g("a",null,[v(s,{icon:["far","copy"]})])),[[i,e.$t("tt.copy"),void 0,{bottom:!0}]]),H((h(),g("a",null,[v(s,{icon:["far","paste"]})])),[[i,e.$t("tt.paste"),void 0,{bottom:!0}]]),H((h(),g("a",{class:Ie([{disabled:!e._Graph.HasSelected}]),style:{color:"var(--vt-c-red)"},onClick:t[2]||(t[2]=o=>e._Graph.DeleteSelected())},[v(s,{icon:["far","trash-can"]})],2)),[[i,e.$t("tt.delete"),void 0,{bottom:!0}]])]),_:1}),v(me,null,{default:I(()=>[H((h(),g("a",null,[v(s,{icon:["fas","expand"]})])),[[i,e.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),_:1})]),_:1}),v(ct,{class:"bottom-left"},{default:I(()=>[v(me,null,{default:I(()=>[V("span",null,[e.Zoom<1?(h(),G(s,{key:0,icon:["fas","magnifying-glass-minus"]})):(h(),G(s,{key:1,icon:["fas","magnifying-glass-plus"]})),R(" "+M((e.Zoom*100).toFixed(0))+"%",1)])]),_:1}),v(me,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","up-down-left-right"]}),R(" X: "+M(e.Offset.X.toFixed())+" Y: "+M(e.Offset.Y.toFixed()),1)])]),_:1}),v(me,null,{default:I(()=>[H((h(),g("a",{onClick:t[3]||(t[3]=o=>{e.Offset.Reset(),e.Zoom=1,e.UpdateOffsetStyle()})},[v(s,{icon:["fas","arrows-rotate"]})])),[[i,e.$t("tt.resetView")]])]),_:1}),v(me,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","circle-info"]}),R(" "+M(e.$t("hints.graphLmb")),1)])]),_:1}),v(me,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","circle-info"]}),R(" "+M(e.$t("hints.graphWheel")),1)])]),_:1})]),_:1}),e.SelectionBoxVisibility?(h(),g("div",Xn)):Q("",!0),V("div",Gn,[v(Cn,{id:"links-container"},{default:I(()=>[v(bt,{name:"link"},{default:I(()=>[(h(!0),g(z,null,fe(e._Graph.Links,o=>(h(),G(On,{key:o.Id,Link:o},null,8,["Link"]))),128))]),_:1}),e.dragStore.IsDragging?(h(),g("polyline",{key:0,class:"ghost-line",points:e.points},null,8,Bn)):Q("",!0)]),_:1}),v(bt,{name:"delete",tag:"div"},{default:I(()=>[(h(!0),g(z,null,fe(e.Nodes,o=>(h(),G(Ot,{key:o.Id,Offset:e.Offset,Zoom:e.Zoom,Node:o},null,8,["Offset","Zoom","Node"]))),128))]),_:1}),v(Ot,{Offset:e.Offset,Zoom:e.Zoom,Node:e.fakeNode},null,8,["Offset","Zoom","Node"])],512),e.isDragOver?(h(),g("div",Yn,t[11]||(t[11]=[V("div",{style:{height:"100%",width:"100%","border-radius":"50px",border:"4px dashed var(--vt-c-black-mute)"}},null,-1)]))):Q("",!0)],544)}}}),Un=B(Hn,[["__scopeId","data-v-a00ad599"]]),Wn={style:{height:"100%",display:"flex","flex-direction":"row"}},zn={style:{"margin-left":"5px"}},Fn={style:{"margin-left":"5px"}},Zn=A({__name:"EditorView",setup(n){return(e,t)=>{const s=te("font-awesome-icon");return h(),g("div",Wn,[v(tt,{style:{width:"20%","min-width":"300px"}},{header:I(()=>[v(s,{icon:["fas","list"]}),t[0]||(t[0]=R()),V("span",zn,M(e.$t("windows.nodesList")),1)]),default:I(()=>[v(en)]),_:1}),v(tt,{style:{width:"80%"}},{header:I(()=>[v(s,{icon:["fas","circle-nodes"]}),t[1]||(t[1]=R()),V("span",Fn,M(e.$t("windows.graph")),1)]),default:I(()=>[v(Un)]),_:1})])}}}),qn={style:{display:"flex","flex-direction":"row"}},Kn={style:{width:"100%","font-weight":"bold","text-align":"left","margin-left":"10px"}},jn={style:{width:"100%","font-weight":"bold","text-align":"right","margin-right":"10px"}},Jn={style:{width:"10px","margin-right":"10px"}},Qn={key:0,class:"dropdown"},eo=["onClick"],to=A({__name:"SelectDropdown",props:{options:{type:Array,required:!1,default:[]},title:{type:String,required:!1,default:""},default:{type:String,required:!1,default:null},modelValue:{type:String,default:""},RealtimeChange:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(n,{emit:e}){k(!1);const t=n,s=k(t.default?t.default:t.options.length>0?t.options[0]:null),i=k(!1);Be(()=>t.modelValue,a=>{s.value=a});const o=()=>{var a=ce();t.RealtimeChange&&(a.ChangeEvent=!a.ChangeEvent)};return(a,u)=>{const c=te("font-awesome-icon");return h(),g("div",{class:"dropdown-head input-element value",tabindex:"0",onBlur:u[1]||(u[1]=r=>i.value=!1),style:{width:"100%",position:"relative"}},[V("div",{onClick:u[0]||(u[0]=r=>i.value=!i.value),style:{height:"100%"}},[V("div",qn,[V("div",Kn,M(t.title)+M(t.title==""?"":":"),1),V("div",jn,M(s.value),1),V("div",Jn,[i.value?(h(),G(c,{key:1,icon:["fas","angle-up"]})):(h(),G(c,{key:0,icon:["fas","angle-down"]}))])])]),i.value?(h(),g("ul",Qn,[(h(!0),g(z,null,fe(n.options,(r,p)=>(h(),g("li",{class:Ie({selected:r==s.value}),key:p,onClick:m=>{s.value=r,i.value=!1,a.$emit("update:modelValue",s.value),o()}},M(r),11,eo))),128))])):Q("",!0)],32)}}}),so=B(to,[["__scopeId","data-v-66e3177b"]]),no=A({__name:"LangSwitch",setup(n){const e=ht(),t=k("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);const s=c=>{e!=null&&(e.appContext.config.globalProperties.$i18n.locale=c,localStorage.setItem("userLang",c),t.value=c)},i=vt("langContextMenu"),o=k(),a=c=>{var r;(o!=null||o!=null)&&((r=i.value)==null||r.OpenUnder(o.value))};var u=new Map;return u.set("en","English"),u.set("ru","Русский"),(c,r)=>{const p=te("flag");return h(),g(z,null,[V("button",{ref_key:"langSwitchBtn",ref:o,class:"btn disable-user-select",onClick:a},[v(p,{iso:t.value=="en"?"gb":t.value},null,8,["iso"]),R(" "+M(J(u).get(t.value)),1)],512),v(nt,{ref:"langContextMenu"},{default:I(()=>[V("button",{class:"btn btnContextMenuPadding",onClick:r[0]||(r[0]=m=>{var f;s("ru"),(f=i.value)==null||f.Close()})},[v(p,{iso:"ru"}),r[2]||(r[2]=R(" Русский"))]),V("button",{class:"btn btnContextMenuPadding",onClick:r[1]||(r[1]=m=>{var f;s("en"),(f=i.value)==null||f.Close()})},[v(p,{iso:"gb"}),r[3]||(r[3]=R(" English"))])]),_:1},512)],64)}}}),oo=A({__name:"ToggleButton",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(n){const e=Rt(n,"modelValue");return(t,s)=>(h(),g("button",{class:Ie(["btn",{toggled:e.value}]),onClick:s[0]||(s[0]=i=>e.value=!e.value)},[de(t.$slots,"default",{},void 0,!0)],2))}}),io=B(oo,[["__scopeId","data-v-4a53f642"]]),ao=A({__name:"ResolutionSwitcher",setup(n){const e=ht(),t=k("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);var s=ce();const i=vt("contextMenu"),o=k(),a=m=>{var w,_,P;if(o!=null||o!=null){var f=(w=o.value)==null?void 0:w.getBoundingClientRect();(_=i.value)==null||_.OpenUnder(o.value),f!=null&&((P=i.value)==null||P.SetWidth(f.width))}},u=["0.5K","1K","2K","4K","8K"],c=[512,1024,2048,4096,8192],r=k(0),p=m=>{r.value=m;var f=s.GetRenderer();f!=null&&(f.ChangeResolution(c[m]),requestAnimationFrame(()=>f==null?void 0:f.Render()))};return(m,f)=>{const w=te("font-awesome-icon"),_=Ne("tooltip");return h(),g(z,null,[H((h(),g("button",{ref_key:"switcher",ref:o,class:"btn disable-user-select",onClick:a},[v(w,{icon:["fas","vector-square"]}),R(" "+M(u[r.value])+" ",1),v(w,{icon:["fas","angle-down"]})])),[[_,m.$t("tt.mesh_resolution"),void 0,{bottom:!0}]]),v(nt,{ref_key:"contextMenu",ref:i},{default:I(()=>[(h(),g(z,null,fe(u,(P,D)=>(h(),g(z,null,[D>2?H((h(),G(ie,{key:0,class:"waringText",Active:D==r.value,onClick:x=>{var Y;p(D),(Y=i.value)==null||Y.Close()}},{default:I(()=>[v(w,{icon:["fas","vector-square"]}),R(" "+M(P),1)]),_:2},1032,["Active","onClick"])),[[_,{content:m.$t("tt.resolutionWarning"),html:!0,distance:15},void 0,{right:!0}]]):(h(),G(ie,{key:1,Active:D==r.value,onClick:x=>{var Y;p(D),(Y=i.value)==null||Y.Close()}},{default:I(()=>[v(w,{icon:["fas","vector-square"]}),R(" "+M(P),1)]),_:2},1032,["Active","onClick"]))],64))),64))]),_:1},512)],64)}}}),Lt=B(ao,[["__scopeId","data-v-97dd3ce3"]]),ro={style:{height:"100%",width:"100%",position:"relative"}},lo=["value"],uo=A({__name:"ProjectNameEditor",props:Pt({modelValue:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:Pt(["update:modelValue"],["update:modelValue"]),setup(n,{emit:e}){const t=Rt(n,"modelValue"),s=e,i=k(!1),o=k(),a=k(),u=()=>{i.value=!0,ge(()=>{var m;a.value=t.value,(m=o.value)==null||m.focus()})},c=m=>{s("update:modelValue",a.value),i.value=!1},r=m=>{m.target!=null&&(a.value=m.target.value,s("update:modelValue",a.value))},p=m=>{m.key=="Enter"&&(m.target!=null&&(a.value=m.target.value,s("update:modelValue",a.value)),i.value=!1)};return(m,f)=>{const w=te("font-awesome-icon");return h(),g("div",ro,[i.value?(h(),g("input",{key:0,ref_key:"input",ref:o,onFocusout:c,onInput:r,onKeypress:p,class:"editor",value:t.value},null,40,lo)):(h(),g("div",{key:1,class:"label",onClick:u},M(t.value),1)),v(w,{class:"icon",icon:["fas","pen"]})])}}}),co=B(uo,[["__scopeId","data-v-1b5ff080"]]),ho={style:{"margin-left":"auto",right:"0px",height:"100%","white-space":"nowrap",overflow:"hidden"}},fo={class:"btn"},po={class:"btn"},mo={class:"btn"},vo={class:"btn"},go={class:"btn"},wo={class:"btn"},Vo={class:"btn"},yo={class:"btn"},So=450,_o=A({__name:"ActionButtonsBar",setup(n){const e=k(),t=vt("contextMenu"),s=k(),i=k(),o=u=>{var c;(s!=null||s!=null)&&((c=t.value)==null||c.OpenUnder(s.value))},a=()=>{var r;var u=(r=e.value)==null?void 0:r.getBoundingClientRect();if(u!=null){var c=u==null?void 0:u.width;c!=null&&c<So?i.value=!0:i.value=!1}};return mt(()=>{ge(()=>{a(),window.addEventListener("resize",()=>{a()})})}),(u,c)=>{const r=te("font-awesome-icon"),p=Ne("tooltip");return h(),g("div",{ref_key:"menuContainer",ref:e,style:{display:"flex",height:"100%",width:"100%","white-space":"nowrap",overflow:"hidden"}},[V("div",ho,[i.value?(h(),g(z,{key:0},[v(Lt),c[3]||(c[3]=V("div",{class:"separator"},null,-1)),H((h(),g("button",{onClick:o,ref_key:"contextMenuButton",ref:s,class:"btn"},[v(r,{icon:["fas","fa-bars"]})])),[[p,u.$t("tt.menu"),void 0,{bottom:!0}]]),v(nt,{ref_key:"contextMenu",ref:t},{default:I(()=>[v(ie,null,{default:I(()=>[v(r,{icon:["fas","file"]}),R(" "+M(u.$t("tt.new")),1)]),_:1}),v(ie,null,{default:I(()=>[v(r,{icon:["fas","floppy-disk"]}),R(" "+M(u.$t("tt.save")),1)]),_:1}),v(ie,null,{default:I(()=>[v(r,{icon:["fas","folder-open"]}),R(" "+M(u.$t("tt.load")),1)]),_:1}),c[0]||(c[0]=V("hr",null,null,-1)),v(ie,null,{default:I(()=>[v(r,{icon:["fas","rotate-left"]}),R(" "+M(u.$t("tt.undo")),1)]),_:1}),v(ie,null,{default:I(()=>[v(r,{icon:["fas","rotate-right"]}),R(" "+M(u.$t("tt.redo")),1)]),_:1}),c[1]||(c[1]=V("hr",null,null,-1)),v(ie,null,{default:I(()=>[v(r,{icon:["fas","gear"]}),R(" "+M(u.$t("tt.settings")),1)]),_:1}),c[2]||(c[2]=V("hr",null,null,-1)),v(ie,null,{default:I(()=>[v(r,{icon:["fas","expand"]}),R(" "+M(u.$t("tt.fullscreen")),1)]),_:1})]),_:1,__:[0,1,2]},512),c[4]||(c[4]=V("div",{class:"separator"},null,-1)),H((h(),g("button",fo,[v(r,{icon:["fas","rotate-left"]})])),[[p,u.$t("tt.undo"),void 0,{bottom:!0}]]),H((h(),g("button",po,[v(r,{icon:["fas","rotate-right"]})])),[[p,u.$t("tt.redo"),void 0,{bottom:!0}]])],64)):(h(),g(z,{key:1},[v(Lt),c[5]||(c[5]=V("div",{class:"separator"},null,-1)),H((h(),g("button",mo,[v(r,{icon:["fas","file"]})])),[[p,u.$t("tt.new"),void 0,{bottom:!0}]]),H((h(),g("button",vo,[v(r,{icon:["fas","floppy-disk"]})])),[[p,u.$t("tt.save"),void 0,{bottom:!0}]]),H((h(),g("button",go,[v(r,{icon:["fas","folder-open"]})])),[[p,u.$t("tt.load"),void 0,{bottom:!0}]]),c[6]||(c[6]=V("div",{class:"separator"},null,-1)),H((h(),g("button",wo,[v(r,{icon:["fas","rotate-left"]})])),[[p,u.$t("tt.undo"),void 0,{bottom:!0}]]),H((h(),g("button",Vo,[v(r,{icon:["fas","rotate-right"]})])),[[p,u.$t("tt.redo"),void 0,{bottom:!0}]]),c[7]||(c[7]=V("div",{class:"separator"},null,-1)),H((h(),g("button",yo,[v(r,{icon:["fas","gear"]})])),[[p,u.$t("tt.settings"),void 0,{bottom:!0}]]),c[8]||(c[8]=V("div",{class:"separator"},null,-1)),H((h(),G(io,null,{default:I(()=>[v(r,{icon:["fas","expand"]})]),_:1})),[[p,u.$t("tt.fullscreen"),void 0,{bottom:!0}]])],64))])],512)}}}),bo=B(_o,[["__scopeId","data-v-d512614f"]]),Po={class:"disable-user-select left-section",style:{display:"flex","flex-direction":"row"}},No={class:"logo disable-user-select",style:{"text-transform":"uppercase"}},Io={class:"padding"},Co={class:"middle-actions",style:{}},Mo={style:{display:"flex","flex-direction":"row"}},xo=A({__name:"MainMenuBar",setup(n){const e=k(!1);Be(e,(s,i)=>{s?document.documentElement.requestFullscreen():document.exitFullscreen()});const t=k("Untitled");return(s,i)=>(h(),g("div",{class:"main",onContextmenu:i[1]||(i[1]=ae(()=>{},["prevent"]))},[V("div",Po,[V("div",No,M(s.$t("logo")),1),v(bo)]),V("div",Io,[V("div",Co,[v(co,{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o)},null,8,["modelValue"])])]),V("div",Mo,[v(no)])],32))}}),ko=B(xo,[["__scopeId","data-v-58738f50"]]),Oo=A({props:{Min:Number,Max:Number,Suffix:String,Title:String,RealtimeChange:{type:Boolean,default:!0},Step:{type:Number,default:0},modelValue:{type:Number,default:0}},emits:["update:modelValue"],data(){return{IsDragging:!1,Value:0,lastPosition:new N(0,0),lastValue:0,IsInputVisible:!1,moveDistance:0}},created(){document.addEventListener("mousemove",this.OnMouseMove),document.addEventListener("mouseup",this.OnMouseUp),this.Value=this.modelValue},watch:{modelValue(n,e){this.Value=n}},methods:{ClickValue(n){this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n,this.Min,this.Max):this.Value=this.Clamp(this.Value+(n>0?this.Step:-this.Step),this.Min,this.Max):this.Step==0?this.Value+=n:this.Value+=n>0?this.Step:-this.Step,this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnInput(n){this.Value=Number(n.target.value),this.Min!=null&&this.Max!=null&&(this.Value=this.Clamp(this.Value,this.Min,this.Max)),this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnMouseDown(n){this.IsInputVisible||(this.$el.requestPointerLock(),this.IsDragging=!0,this.lastPosition=new N(n.clientX,n.clientY),this.lastValue=this.Value,this.moveDistance=0)},OnMouseMove(n){this.IsDragging&&(this.moveDistance+=n.movementX,this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n.movementX/(n.shiftKey?25:50),this.Min,this.Max):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value=this.Clamp(this.Value+(n.movementX>0?this.Step:-this.Step),this.Min,this.Max)):this.Step==0?this.Value+=n.movementX/(n.shiftKey?25:50):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value+=n.movementX>0?this.Step:-this.Step),this.$emit("update:modelValue",this.Value),this.UpdateEvent())},OnMouseUp(n){var e=new N(n.clientX,n.clientY);e.X==this.lastPosition.X&&e.Y==this.lastPosition.Y&&this.Value==this.lastValue&&(this.IsInputVisible=!0,this.$nextTick(()=>{var t=this.$refs.input;t.focus(),t.select()})),this.IsDragging=!1,document.exitPointerLock()},UpdateEvent(){var n=ce();this.RealtimeChange&&(n.ChangeEvent=!n.ChangeEvent)},validate(n){n.key=="Enter"&&n.target.blur();var e=/[0-9-]|\./;e.test(n.key)||n.preventDefault()},Clamp(n,e,t){return Math.min(Math.max(n,e),t)}}}),Lo={ref:"inputRange",class:"input-range"},$o=["value"],Ro={class:"title"},Do={class:"valueText"};function To(n,e,t,s,i,o){const a=te("font-awesome-icon");return h(),g("div",Lo,[V("div",{class:"button",onClick:e[0]||(e[0]=u=>n.ClickValue(-.1))},[v(a,{icon:["fas","caret-left"]})]),V("div",{class:"value",onMousedown:e[4]||(e[4]=ae((...u)=>n.OnMouseDown&&n.OnMouseDown(...u),["left"]))},[n.IsInputVisible?(h(),g("input",{key:0,onKeypress:e[1]||(e[1]=(...u)=>n.validate&&n.validate(...u)),ref:"input",class:"input-element",value:n.modelValue,onInput:e[2]||(e[2]=(...u)=>n.OnInput&&n.OnInput(...u)),onBlur:e[3]||(e[3]=u=>n.IsInputVisible=!1)},null,40,$o)):(h(),g(z,{key:1},[V("div",Ro,M(n.Title)+": ",1),V("div",Do,M(Number(n.Value.toFixed(4)))+" "+M(n.Suffix),1)],64))],32),V("div",{class:"button",onClick:e[5]||(e[5]=u=>n.ClickValue(.1))},[v(a,{icon:["fas","caret-right"]})])],512)}const Ao=B(Oo,[["render",To],["__scopeId","data-v-85813c7d"]]),Xo={class:"properties"},Go={key:0,class:"not-selected"},Bo={class:"header"},Yo={style:{width:"100%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Eo={class:"buttons",style:{display:"flex","font-weight":"bold"}},Ho={class:"btn"},Uo={key:0,style:{margin:"0px 10px"}},Wo={class:"input-group",style:{width:"100%",padding:"0px"}},zo={key:1,style:{padding:"10px"}},Fo={class:"notice"},Zo=A({__name:"PropertiesView",setup(n){const e=he();var t=ye(()=>e.SelectedNode),s=ye(()=>e.SelectedNode==null||e.SelectedNode instanceof be),i=ye(()=>{var u;return a((u=t.value)==null?void 0:u.Properties)});const o=()=>{if(e.SelectedNode!=null&&e.SelectedNode!=null&&e.SelectedNode){for(var u of e.SelectedNode.Properties)u.Reset();var c=ce();c.ChangeEvent=!c.ChangeEvent}};var a=u=>{var c=new Map;return u==null||u.length==0||u.forEach(r=>{var p;c.has(r.Category)||c.set(r.Category,new Array),(p=c.get(r.Category))==null||p.push(r)}),c};return(u,c)=>{var m;const r=te("font-awesome-icon"),p=Ne("tooltip");return h(),g("div",Xo,[J(s)?(h(),g("div",Go,[v(r,{icon:["fas","sliders"]})])):Q("",!0),J(s)?Q("",!0):(h(),g(z,{key:1},[V("div",Bo,[V("div",Yo,M(u.$t((m=J(t))==null?void 0:m.Name)),1),V("div",Eo,[H((h(),g("button",Ho,[v(r,{icon:["fas","sliders"]})])),[[p,u.$t("tt.presets"),void 0,{bottom:!0}]]),H((h(),g("button",{class:"btn",onClick:o},[v(r,{icon:["fas","arrows-rotate"]})])),[[p,u.$t("tt.resetParams"),void 0,{bottom:!0}]])])]),J(t).Name?(h(),g("hr",Uo)):Q("",!0),(h(!0),g(z,null,fe(J(i),([f,w])=>(h(),G(Wt,{style:{"background-color":"transparent",padding:"0px"}},{header:I(()=>[R(M(f),1)]),default:I(()=>[V("div",Wo,[(h(!0),g(z,null,fe(w,_=>(h(),g(z,null,[typeof _.Value=="number"?(h(),G(Ao,{key:0,modelValue:_.Value,"onUpdate:modelValue":P=>_.Value=P,Min:_.Min,Max:_.Max,Step:_.Step,Suffix:_.Suffix,Title:_.Name},null,8,["modelValue","onUpdate:modelValue","Min","Max","Step","Suffix","Title"])):Q("",!0),_.valueList!=null?(h(),G(so,{key:1,modelValue:_.Value,"onUpdate:modelValue":P=>_.Value=P,default:_.Value,title:_.Name,options:_.valueList},null,8,["modelValue","onUpdate:modelValue","default","title","options"])):Q("",!0)],64))),256))])]),_:2},1024))),256)),J(t).IsRealtimeUpdate==!1?(h(),g("div",zo,[c[1]||(c[1]=V("button",{class:"btn apply-btn"}," Apply changes ",-1)),V("div",Fo,[v(r,{icon:["fas","circle-exclamation"]}),c[0]||(c[0]=R(' This node performs a heavy operation, so the update occurs when you click the "Apply Changes" button and is cached. '))])])):Q("",!0)],64))])}}}),qo=B(Zo,[["__scopeId","data-v-f3a35aff"]]);function Ko(n){return new Worker("/assets/MeshGenerationWorker-DdK6sfo-.js",{name:n==null?void 0:n.name})}class jo{constructor(){l(this,"GridMaterial");l(this,"GridMesh");const e=d(.5).toVar(),t=d(5).toVar(),s=d(1*window.devicePixelRatio).toVar(),i=d(500).toVar(),o=d(200).toVar(),a=lt(.2,.2,.2,.2).toVar(),u=lt(.05,.05,.05,.2).toVar(),c=ds,r=cs,p=C(([E,L])=>{const $=Nt(E,L),K=Ee(X(Ce(X($,.5)),.5)),U=Nt(K,Xt($));return ee(U.x,U.y)}),m=p(c.xz,e),f=p(c.xz,t),w=X(1,We(0,s,m)),_=X(1,We(0,s,f)),P=X(c,r),D=Je(P),x=We(d(i),d(0),D),Y=We(d(o),d(0),D),oe=j(a,j(w,Y)).toVar(),ot=j(u,j(_,x)).toVar(),it=hs(ot,oe),we=new Gt;we.colorNode=it,we.transparent=!0,we.side=wt,we.lights=!1;const Z=new Bt(1e3,1e3,1,1);Z.rotateX(-Math.PI/2);const F=new Vt(Z,we);this.GridMesh=F,this.GridMaterial=we}}class Jo{constructor(){l(this,"Mesh");const e=C(([o,a,u])=>{const c=y(o.x,o.y).toVar(),r=y(Ee(c.mul(2).sub(1)).sub(y(a,u))).toVar();return r.assign(d(1).sub(r.div(Xt(r)))),fs(ee(r.x,r.y))});var t=new ps({color:"#fff",transparent:!0,side:wt});t.colorNode=C(()=>{const o=e(ze(),1,1).toVar(),a=e(ze(),.9,1).toVar(),u=e(ze(),1,.9).toVar(),c=e(ze(),.98,.98).toVar(),r=Se(0,1,o.sub(a).sub(u).sub(c)).toVar();return lt(.8,.8,.8,r)})();var s=new Bt(1,1,1,1);s.rotateX(-Math.PI/2);var i=new Vt(s,t);i.castShadow=!1,i.receiveShadow=!1,i.scale.set(10,1,10),i.position.set(0,.005,0),this.Mesh=i}}class Qo{constructor(){l(this,"Height",2);l(this,"GPURenderer");l(this,"HeightTexture");l(this,"TerrainMaterial");l(this,"HeightArray");l(this,"IsMeshGenerated",k(!1));l(this,"Scene");l(this,"Camera");l(this,"Controls");l(this,"TerrainMesh");l(this,"GridMesh");l(this,"DirectionalLight");l(this,"DirectionalLight2");l(this,"_resolution",512);l(this,"_textureResolution",512);l(this,"_canvas");this.CreateRenderer(),this.Scene=new ms,this.Scene.environmentNode=vs("#ffffff"),this.Scene.environmentIntensity=.05,this.Camera=new gs(75,1,.1,1e3),this.Camera.position.z=10,this.Camera.position.y=10,this.CreateMaterial(),this.CreateTexture(this._resolution),this.CreateTerrainMesh(this.Resolution),this.CreateLight();const e=new jo;this.GridMesh=e.GridMesh,this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2),this.Scene.add(this.GridMesh);var t=new Jo;this.Scene.add(t.Mesh);const s=ce();s.SetRenderer(this),s.Resolution=this.Resolution}get Resolution(){return this._resolution}get TextureResolution(){return this._textureResolution}CreateMaterial(){this.TerrainMaterial=new Gt({color:"#a2a2a2"}),this.TerrainMaterial.side=wt,this.TerrainMaterial.needsUpdate=!0,this.TerrainMaterial.roughness=1,this.TerrainMaterial.positionNode=C(()=>{const e=d(1/this.Resolution),t=d(1).sub(e).toVar(),s=Le.xyz.toVar(),i=Fe(this.HeightTexture,Le.xz.add(.5).mul(t)).mul(this.Height);return s.y.addAssign(i),s})(),this.TerrainMaterial.normalNode=C(()=>{const e=d(1/this.TextureResolution),t=d(1).sub(e).toVar(),s=Le.xyz.add(It(e,0,0)).toVar(),i=Le.xyz.add(It(0,0,e.negate())).toVar(),o=Le.xyz.toVar(),a=Fe(this.HeightTexture,Le.xz.add(.5)).mul(t).mul(this.Height);o.y.addAssign(a),s.y.addAssign(Fe(this.HeightTexture,s.xz.add(.5)).mul(t).mul(this.Height)),i.y.addAssign(Fe(this.HeightTexture,i.xz.add(.5)).mul(t).mul(this.Height));const u=s.sub(o).normalize(),c=i.sub(o).normalize();return ws(Vs(u,c))})()}CreateRenderer(){this.GPURenderer=new ys({alpha:!0,antialias:!0}),this.GPURenderer.shadowMap.enabled=!0,this.GPURenderer.shadowMap.type=Ss,this.GPURenderer.toneMapping=_s,this.GPURenderer.setClearColor(0,0),this.GPURenderer.setPixelRatio(window.devicePixelRatio)}CreateTexture(e){this.HeightTexture=new bs(Math.floor(this.TextureResolution),Math.floor(this.TextureResolution)),this.HeightTexture.format=Ps,this.HeightTexture.type=Ns}CreateLight(){const e=new Ct(16777215,2);e.position.set(-10,10,0),e.castShadow=!0,e.shadow.autoUpdate=!0,e.shadow.camera.near=.1,e.shadow.camera.far=30,e.shadow.camera.top=8,e.shadow.camera.right=8,e.shadow.camera.bottom=-8,e.shadow.camera.left=-8,e.shadow.mapSize.set(4096,4096),e.shadow.radius=5,e.shadow.blurSamples=25,e.shadow.normalBias=.05,this.DirectionalLight=e;const t=new Ct(16777215,.5);t.position.set(10,10,0),this.DirectionalLight2=t}SetIsMeshGenerated(e){this.IsMeshGenerated.value=e}CreateTerrainMesh(e){this.SetIsMeshGenerated(!1);let t=new Ko;t.onmessage=async s=>{var i=new Is;i.setIndex(new Ze(new Uint32Array(s.data.indices),1)),i.setAttribute("position",new Ze(new Float32Array(s.data.position),3)),i.setAttribute("normal",new Ze(new Float32Array(s.data.normal),3)),i.setAttribute("uv",new Ze(new Float32Array(s.data.uv),2)),this.TerrainMesh=new Vt(i,this.TerrainMaterial),this.TerrainMesh.castShadow=!0,this.TerrainMesh.receiveShadow=!0,this.TerrainMesh.scale.set(10,1,10),this.TerrainMesh.position.set(0,.006,0),this.Scene.add(this.TerrainMesh),this.SetIsMeshGenerated(!0)},t.postMessage(e)}ChangeResolution(e){this._textureResolution=e,this.CreateTexture(this.TextureResolution),this.CreateMaterial(),this.TerrainMesh.material=this.TerrainMaterial,this.Scene.remove(this.DirectionalLight),this.Scene.remove(this.DirectionalLight2),this.CreateLight(),this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2);const t=ce();t.SetRenderer(this),t.Resolution=this.TextureResolution;const s=he();s.LockedNode!=null?this.Recalculate(s.LockedNode):s.SelectedNode!=null&&this.Recalculate(s.SelectedNode),requestAnimationFrame(()=>this.Render())}OnWindowResize(){if(this.GPURenderer==null||this.Camera==null||this._canvas==null)return;var e=this._canvas.offsetHeight,t=this._canvas.offsetWidth;this.GPURenderer.setSize(t,e);const s=t/e;this.Camera.aspect=s,this.Camera.updateProjectionMatrix(),requestAnimationFrame(()=>this.Render())}async Render(){await this.GPURenderer.renderAsync(this.Scene,this.Camera)}Mount(e){this._canvas=e;var t=this._canvas.offsetHeight,s=this._canvas.offsetWidth;this._canvas.appendChild(this.GPURenderer.domElement),this.GPURenderer.setSize(s,t),this.Camera.aspect=s/t,this.Controls=new Cs(this.Camera,this.GPURenderer.domElement),this.Controls.enablePan=!1,this.Controls.update(),window.addEventListener("resize",()=>this.OnWindowResize()),this.Render(),requestAnimationFrame(()=>this.Render)}RequestRender(){requestAnimationFrame(()=>this.Render)}async Recalculate(e,t=!1){t||e.Calculate();var s=e.Outputs[e.DefaultOutput].Value;const o=C(()=>{const a=ve.modInt(this.TextureResolution),u=ve.div(this.TextureResolution),c=je(a,u),r=y(c.x,c.y).div(this.TextureResolution).toVar(),p=s(r).toVar();p.assign(Se(p,0,1)),Ms(this.HeightTexture,c,p).toWriteOnly()})().compute(this.TextureResolution*this.TextureResolution);this.GPURenderer.computeAsync(o).then(()=>{e.CalculationState=Pe.Calculated,requestAnimationFrame(()=>this.Render())})}SetGridVisible(e){this.GridMesh.visible=e,requestAnimationFrame(()=>this.Render())}}const ei={class:"container"},ti={key:0,style:{position:"relative",height:"100%",width:"100%"}},si=A({__name:"Preview3D",setup(n){const e=k();e.value=new Qo;const t=k();var s=ce();const i=ye(()=>s.ChangeEvent);var o=he();const a=ye(()=>o.SelectedNode),u=ye(()=>{var P;return(P=e.value)==null?void 0:P.IsMeshGenerated});Be(u,async(P,D)=>{requestAnimationFrame(()=>{var x;return(x=e.value)==null?void 0:x.Render()})}),Be(i,async(P,D)=>{var x,Y;o.LockedNode!=null?(x=e.value)==null||x.Recalculate(o.LockedNode,!1):a.value!=null&&((Y=e.value)==null||Y.Recalculate(a.value,!1))}),Be(a,async P=>{var x,Y;if(o.LockedNode!=null)(x=e.value)==null||x.Recalculate(o.LockedNode);else if(P!=null){var D=P;await((Y=e.value)==null?void 0:Y.Recalculate(D))}}),mt(()=>{ge(()=>{var P;(P=e.value)==null||P.Mount(t.value)})});let c=!1;const r=()=>{c=!0},p=()=>{c=!1};window.addEventListener("mouseup",p),window.addEventListener("pointerup",p);const m=()=>{c&&requestAnimationFrame(()=>{var P;return(P=e.value)==null?void 0:P.Render()})},f=()=>{requestAnimationFrame(()=>{var P;return(P=e.value)==null?void 0:P.Render()})},w=k(!0),_=()=>{var P;w.value=!w.value,(P=e.value)==null||P.SetGridVisible(w.value)};return(P,D)=>{var oe;const x=te("font-awesome-icon"),Y=Ne("tooltip");return h(),g("div",ei,[(oe=e.value)!=null&&oe.IsMeshGenerated?Q("",!0):(h(),g("div",ti,[v(Ft,{style:{scale:"2"}}),D[0]||(D[0]=V("span",{style:{position:"absolute !important",top:"calc(50% + 20px)",width:"100%","text-align":"center"}}," Initializing mesh...",-1))])),V("div",{onMousedown:r,onMousemove:m,onWheel:f,onPointerdown:r,onPointermove:m,ref_key:"canvas",ref:t,style:{height:"100%",width:"100%"}},[v(ct,{class:"top-left"},{default:I(()=>[v(me,null,{default:I(()=>[H((h(),g("a",{onClick:_},[v(x,{icon:["fas","hashtag"]})])),[[Y,"Switch Grid visibility",void 0,{bottom:!0}]])]),_:1})]),_:1})],544)])}}}),ni=B(si,[["__scopeId","data-v-f4b894cd"]]),oi={style:{width:"100%",height:"100%"}},ii={style:{height:"calc(100% - 80px)",display:"flex","flex-direction":"row"}},ai={style:{width:"80%",height:"100%"}},ri={style:{height:"50%",width:"100%",display:"block"}},li={style:{"margin-left":"5px"}},ui={style:{height:"50%"}},di={style:{width:"20%",height:"100%"}},ci={style:{"margin-left":"5px"}},hi=A({__name:"LayoutView",setup(n){return(e,t)=>{const s=te("font-awesome-icon");return h(),g("div",oi,[v(ko,{style:{height:"50px"}}),V("div",ii,[V("div",ai,[V("div",ri,[v(tt,{style:{display:"inline-block",width:"100%"}},{header:I(()=>[v(s,{icon:["fas","mountain-sun"]}),V("span",li,M(e.$t("windows.thirdPreview")),1)]),default:I(()=>[v(ni)]),_:1})]),V("div",ui,[v(Zn)])]),V("div",di,[v(tt,{style:{width:"100%"},"wheel-focus":!1},{header:I(()=>[v(s,{icon:["fas","sliders"]}),V("span",ci,M(e.$t("windows.properties")),1)]),default:I(()=>[v(qo)]),_:1})])]),v(Es,{style:{height:"30px"}})])}}}),fi=B(hi,[["__scopeId","data-v-415e308f"]]),pi=ts({history:ss("/"),routes:[{path:"/",name:"home",component:fi}]});class mi extends q{constructor(){super(...arguments);l(this,"Name","nodes.clamp");l(this,"Inputs",[new O(!0,this,"Source")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Min",0,0,1),new b("Max",1,0,1)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value),s=S(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var a;if(!this.Inputs[0].IsConnected)return d(0);const o=(a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(i);return Se(o,t,s)})}}class vi extends q{constructor(){super(...arguments);l(this,"Name","nodes.combine");l(this,"Inputs",[new O(!0,this,"Source 1"),new O(!0,this,"Source 2")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Mode","Burn",["Burn","Darken","Difference","Dodge","Divide","Exclusion","HardLight","HardMix","Lighten","LinearBurn","LinearDodge","LinearLight","LinearLightAddSub","Multiply","Negation","Overlay","PinLight","Screen","SoftLight","Subtract","VividLight","Overwrite"]),new b("Strength",0,0,1)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=this.Properties[0].Value,s=S(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var u,c;if(!this.Inputs[0].IsConnected||!this.Inputs[1].IsConnected)return d(0);const o=(u=this.Inputs[0].Links[0].In)==null?void 0:u.Value(i).toVar(),a=(c=this.Inputs[1].Links[0].In)==null?void 0:c.Value(i).toVar();switch(t){case"Burn":{const r=d(1).sub(d(1).sub(a).div(o)).toVar();return T(o,r,s)}case"Darken":{const r=ee(o,a).toVar();return T(o,r,s)}case"Difference":{const r=Ee(a.sub(o)).toVar();return T(o,r,s)}case"Dodge":{const r=o.div(a.add(d(1e-12))).toVar();return T(o,r,s)}case"Divide":{const r=o.div(d(1).sub(a)).toVar();return T(o,r,s)}case"Exclusion":{const r=a.add(o).sub(d(2).mul(a).mul(o)).toVar();return T(o,r,s)}case"HardLight":{const r=d(X(1,j(2,X(1,o)).mul(X(1,a)))).toVar(),p=d(j(2,o).mul(a)).toVar(),m=d($e(a,.5)).toVar(),f=d(p.mul(m).add(d(1).sub(m).mul(r))).toVar();return T(o,f,s)}case"HardMix":{const r=d($e(d(1).sub(o),a)).toVar();return T(o,r,s)}case"Lighten":{const r=ue(a,o).toVar();return T(o,r,s)}case"LinearBurn":{const r=d(o.add(a.sub(1))).toVar();return T(o,r,s)}case"LinearDodge":{const r=o.add(a).toVar();return T(o,r,s)}case"LinearLight":{const r=d(ks(a.lessThan(.5),ue(o.add(d(2).mul(a).sub(d(1))),d(0)),ee(o.add(d(2).mul(a.sub(.5))),d(1)))).toVar();return T(o,r,s)}case"LinearLightAddSub":{const r=d(a.add(j(2,o).sub(1))).toVar();return T(o,r,s)}case"Multiply":{const r=o.mul(a).toVar();return T(o,r,s)}case"Negation":{const r=d(X(1,Ee(X(1,a).sub(o)))).toVar();return T(o,r,s)}case"Overlay":{const r=d(X(1,j(2,X(1,o)).mul(X(1,a)))).toVar(),p=d(j(2,o).mul(a)).toVar(),m=d($e(o,.5)).toVar(),f=d(p.mul(m).add(d(1).sub(m).mul(r))).toVar();return T(o,f,s)}case"PinLight":{const r=d($e(.5,a)).toVar(),p=d(r.mul(ue(j(2,o.sub(.5)),a))).toVar(),m=d(p.add(X(1,r).mul(ee(j(2,o),a)))).toVar();return T(o,m,s)}case"Screen":{const r=d(X(1,X(1,a).mul(X(1,o)))).toVar();return T(o,r,s)}case"SoftLight":{const r=d(X(1,j(2,X(1,o)).mul(X(1,a)))).toVar(),p=d(xs(o).mul(j(2,a).sub(1)).add(j(2,o).mul(X(1,a)))).toVar(),m=d($e(a,.5)).toVar(),f=d(p.mul(m).add(d(1).sub(m).mul(r))).toVar();return T(o,f,s)}case"Subtract":{const r=o.sub(a).toVar();return T(o,r,s)}case"VividLight":{const r=d(X(1,X(1,a).div(j(2,o)))).toVar(),p=d(a.div(j(2,X(1,o)))).toVar(),m=d($e(.5,o)).toVar(),f=d(p.mul(m).add(d(1).sub(m).mul(r))).toVar();return T(o,f,s)}case"Overwrite":return T(o,a,s)}return d(0)})}}class gi extends q{constructor(){super(...arguments);l(this,"Name","nodes.constant");l(this,"Outputs",[new O(!1,this,"Output")]);l(this,"Properties",[new b("Height",0,0,1)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>d(t))}}class wi extends q{constructor(){super(...arguments);l(this,"Name","nodes.cracks");l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Scale",10,0,100,0,"Transform","%"),new b("Angle",0,0,100,0,"Noise",""),new b("Thickness",.03,0,1,0,"Noise",""),new b("Distortion",0,0,100,0,"Distortion",""),new b("Octaves",10,0,100,1,"Distortion",""),new b("Scale",10,0,100,0,"Distortion",""),new b("Offset X",0,-100,100,0,"Distortion",""),new b("Offset Y",0,-100,100,0,"Distortion","")]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value),a=S(this.Properties[4].Value),u=S(this.Properties[5].Value),c=S(this.Properties[6].Value),r=S(this.Properties[7].Value);this.Outputs[0].Value=C(([p])=>{const m=y(p.x,p.y).toVar(),f=y(yt(m.mul(2).mul(.5),a,y(c,r),u)).mul(o).mul(.2);return Zs({uv:m.add(f),angle:s,scale:t,thickness:i})})}}const Vi=C(([n,e,t])=>{const s=d(t).toVar(),i=d(e).toVar(),o=d(n).toVar();s.assign(ue(0,s));const a=d(ue(0,ee(1,i.sub(o).add(s).div(d(2).mul(s))))).toVar();return o.mul(a).add(i.mul(d(1).sub(a)).sub(s.mul(a).mul(d(1).sub(a))))}).setLayout({name:"smoothMin",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),yi=C(([n,e,t])=>{const s=d(t).toVar(),i=d(e).toVar(),o=d(n).toVar();s.assign(ee(0,s.negate()));const a=d(ue(0,ee(1,i.sub(o).add(s).div(d(2).mul(s))))).toVar();return o.mul(a).add(i.mul(d(1).sub(a)).sub(s.mul(a).mul(d(1).sub(a))))}).setLayout({name:"smoothMax",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),Si=C(([n])=>{const e=y(n).toVar();return Ce(Ae(Te(e.xy,y(12.9898,78.233))).mul(43758.5453123))}).setLayout({name:"random",type:"float",inputs:[{name:"st",type:"vec2"}]}),_i=C(([n,e,t])=>{const s=d(t).toVar(),i=d(e).toVar(),o=y(n).toVar(),a=y(o.mul(i)).toVar(),u=y(st(a)).toVar(),c=y(Ce(a)).toVar(),r=d(Si(u).mul(2).sub(1).mul(s)).toVar(),p=d(Ae(r)).toVar(),m=d(ut(r)).toVar(),f=y(c.sub(.5)).toVar(),w=y().toVar();return w.x.assign(f.x.mul(m).sub(f.y.mul(p))),w.y.assign(f.x.mul(p).add(f.y.mul(m))),w.add(.5).add(u).mod(1)}).setLayout({name:"tilingWithLimitedRotation",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"tileCount",type:"float"},{name:"maxAngle",type:"float"}]});class bi extends q{constructor(){super(...arguments);l(this,"Name","nodes.crater");l(this,"Outputs",[new O(!1,this,"Output")]);l(this,"Properties",[new b("Smoothness",.5,0,1,0,"Crater params",""),new b("FloorHeight",-1,-5,5,0,"Crater params",""),new b("Radius",.16,0,1,0,"Crater params",""),new b("RimWidth",1.35,0,100,0,"Crater params",""),new b("RimSteepness",4,0,100,0,"Crater params",""),new b("X",.5,0,1,0,"Transform",""),new b("Y",.5,0,1,0,"Transform","")]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value),a=S(this.Properties[4].Value),u=S(this.Properties[5].Value),c=S(this.Properties[6].Value);this.Outputs[0].Value=C(([r])=>{const p=y(r.x,r.y).toVar(),m=y(u,c).toVar(),f=d(Je(p.sub(m)).div(ue(i,1e-4))).toVar(),w=d(f.mul(f).sub(1)).toVar(),_=d(ee(f.sub(1).sub(o),0)).toVar(),P=d(a.mul(_).mul(_)).toVar(),D=d(yi(w,s,t)).toVar();return D.assign(Vi(D,P,t)),D.mul(i).add(.5).toVar()})}}class Pi extends q{constructor(){super(...arguments);l(this,"Name","nodes.falloff");l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Strength",0,0,10)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{const i=y(s.x,s.y).toVar(),o=d(Yt(y(.5),i.mod(1))).mul(t).toVar(),a=T(d(1),d(0),o).toVar();return Qe(Se(a,0,1),2)})}}class Ni extends q{constructor(){super(...arguments);l(this,"Name","nodes.fastErosion");l(this,"Inputs",[new O(!0,this,"Inpute Height")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Tiles",4,0,20,0,"Erosion",""),new b("Octaves",5,0,20,1,"Erosion",""),new b("Gain",.5,0,1,0,"Erosion",""),new b("Lacunarity",2,0,10,0,"Erosion",""),new b("Slope strength",3,0,10,0,"Erosion",""),new b("Branch strength",3,0,10,0,"Erosion",""),new b("Erosion Strength",.04,0,1,0,"Erosion","")]);l(this,"IsRealtimeUpdate",!1);l(this,"terrainHeight");l(this,"waterVolume");l(this,"sedimentAmount");l(this,"tempTerrainHeight");l(this,"tempWaterVolume");l(this,"tempSedimentAmount")}Calculate(){this.BaseCalculate();const t=ce(),s=t.GetRenderer(),i=t.Resolution,o=S(.1),a=S(.1),u=S(.1),c=S(1),r=S(.1),p=S(.1),m=S(9.8),f=S(.01),w=S(3),_=S(i),P=S(i);this.terrainHeight=Re(i*i,"float"),this.waterVolume=Re(i*i,"float"),this.sedimentAmount=Re(i*i,"float"),this.tempTerrainHeight=Re(i*i,"float"),this.tempWaterVolume=Re(i*i,"float"),this.tempSedimentAmount=Re(i*i,"float");const D=C(()=>{var $;const Z=ve.modInt(i),F=ve.div(i),E=je(Z,F),L=y(E.x,E.y).div(i).toVar();if(this.Inputs[0].IsConnected){const U=(($=this.Inputs[0].Links[0].In)==null?void 0:$.Value)(L).toVar();this.terrainHeight.element(ve).assign(U)}}),x=C(([Z,F])=>{const E=d(F).toVar(),L=d(Z).toVar();return L.assign(Se(L,ne(0),_.sub(ne(1)))),E.assign(Se(E,ne(0),P.sub(ne(1)))),E.mul(_).add(L)}),Y=C(([Z,F])=>{const E=d(F).toVar(),L=y(Z).toVar(),$=d(j(.01,Ce(Ae(d(E).mul(12.9898)).mul(43758.5453)).mul(2).sub(1))).toVar();return At(L.add(y($)))});C(([Z,F,E])=>{const L=ne(E).toVar(),$=d(F).toVar(),K=d(Z).toVar(),U=d(x(K,$)).toVar(),re=d(this.tempWaterVolume.element(U).add(a.mul(o))).toVar(),se=d(this.tempSedimentAmount.element(U)).toVar(),_e=d(this.tempTerrainHeight.element(U)).toVar(),He=y(y(this.tempTerrainHeight.element(x(K.add(1),$)).sub(this.tempTerrainHeight.element(x(K.sub(1),$))),this.tempTerrainHeight.element(x(K,$.add(1))).sub(this.tempTerrainHeight.element(x(K,$.sub(1))))).mul(.5)).toVar(),Xe=d(Je(He)).toVar();qe(re.greaterThan(0).and(Xe.greaterThan(0)),()=>{const xe=y(Y(He,L)).toVar(),Ue=d(ee(re,Xe.mul(m).mul(o))).toVar(),Ve=d(ee(re,Ue)).toVar(),ke=De(De(K,$).add(De(Mt(xe)))).toVar(),Oe=ne(x(ke.x,ke.y)).toVar();this.tempWaterVolume.element(Oe).addAssign(Ve),re.subAssign(Ve);const pe=d(ue(Xe,f).mul(Ve).mul(c)).toVar();qe(se.lessThan(pe),()=>{const Ge=d(ee(pe.sub(se).mul(r),_e.sub(this.tempTerrainHeight.element(Oe)))).toVar();se.addAssign(Ge),this.tempTerrainHeight.element(U).assign(_e.sub(Ge))}).Else(()=>{const Ge=d(se.sub(pe).mul(p)).toVar();se.subAssign(Ge),this.tempTerrainHeight.element(U).assign(_e.add(Ge))});const St=d(se.mul(Ve).div(re)).toVar();this.tempSedimentAmount.element(Oe).addAssign(St),se.subAssign(St)}),re.mulAssign(X(1,u.mul(o))),se.assign(ue(0,se)),this.tempWaterVolume.element(U).assign(re),this.tempSedimentAmount.element(U).assign(se)});const oe=C(([Z,F])=>{const E=ne(F).toVar(),L=je(Z.x,Z.y).toVar();return L.y.mul(E).add(L.x)});C(()=>{this.tempTerrainHeight.element(ve).addAssign(.5)});const ot=C(()=>{const Z=ne(ve).toVar(),F=ne(Z.modInt(_)).toVar(),E=ne(Z.div(_)).toVar(),L=ne(x(F,E)).toVar();this.tempTerrainHeight.element(L).assign(this.terrainHeight.element(L)),this.tempWaterVolume.element(L).assign(this.waterVolume.element(L)),this.tempSedimentAmount.element(L).assign(this.sedimentAmount.element(L)),at(),Tt(w,()=>{const $=d(x(F,E)).toVar(),K=d(this.tempWaterVolume.element($).add(a.mul(o))).toVar(),U=d(this.tempSedimentAmount.element($)).toVar(),re=d(this.tempTerrainHeight.element($)).toVar(),se=y(y(this.tempTerrainHeight.element(x(F.add(1),E)).sub(this.tempTerrainHeight.element(x(F.sub(1),E))),this.tempTerrainHeight.element(x(F,E.add(1))).sub(this.tempTerrainHeight.element(x(F,E.sub(1))))).mul(.5)).toVar(),_e=d(Je(se)).toVar();qe(K.greaterThan(0).and(_e.greaterThan(0)),()=>{const He=y(Y(se,Z)).toVar(),Xe=d(ee(K,_e.mul(m).mul(o))).toVar(),xe=d(ee(K,Xe)).toVar(),Ue=De(De(F,E).add(De(Mt(He)))).toVar(),Ve=ne(x(Ue.x,Ue.y)).toVar();this.tempWaterVolume.element(Ve).addAssign(xe),K.subAssign(xe);const ke=d(ue(_e,f).mul(xe).mul(c)).toVar();qe(U.lessThan(ke),()=>{const pe=d(ee(ke.sub(U).mul(r),re.sub(this.tempTerrainHeight.element(Ve)))).toVar();U.addAssign(pe),this.tempTerrainHeight.element($).assign(re.sub(pe))}).Else(()=>{const pe=d(U.sub(ke).mul(p)).toVar();U.subAssign(pe),this.tempTerrainHeight.element($).assign(re.add(pe))});const Oe=d(U.mul(xe).div(K)).toVar();this.tempSedimentAmount.element(Ve).addAssign(Oe),U.subAssign(Oe)}),K.mulAssign(X(1,u.mul(o))),U.assign(ue(0,U)),this.tempWaterVolume.element($).assign(K),this.tempSedimentAmount.element($).assign(U),at(),this.terrainHeight.element($).assign(this.tempTerrainHeight.element($)),this.waterVolume.element($).assign(this.tempWaterVolume.element($)),this.sedimentAmount.element($).assign(this.tempSedimentAmount.element($)),at()}),this.terrainHeight.element(L).assign(this.tempTerrainHeight.element(L)),this.waterVolume.element(L).assign(this.tempWaterVolume.element(L)),this.sedimentAmount.element(L).assign(this.tempSedimentAmount.element(L))}),it=D().compute(i*i),we=ot().compute(i*i);s==null||s.GPURenderer.compute(it),s==null||s.GPURenderer.computeAsync(we),this.Outputs[0].Value=C(([Z])=>{if(this.Inputs[0].IsConnected){y(Z.x,Z.y).toVar();const F=ve.modInt(i),E=ve.div(i),L=je(F,E);return this.terrainHeight.element(oe(L,i)).toVar()}else return 0})}}class Ii extends q{constructor(){super(...arguments);l(this,"Name","nodes.gradientNoise");l(this,"Outputs",[new O(!1,this,"Output")]);l(this,"Properties",[new b("Scale",10,0,100),new b("Offset X",0,0,100),new b("Offset Y",0,0,100)]);l(this,"IsRealtimeUpdate",!0);l(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value);this.Outputs[0].Value=C(([o])=>{const a=y(o.x,o.y).mul(t).toVar(),u=y(s,i).toVar();return a.addAssign(u),zt(a)})}}class Ci extends q{constructor(){super(...arguments);l(this,"Name","nodes.invert");l(this,"Inputs",[new O(!0,this,"Source")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate(),this.Outputs[0].Value=C(([t])=>{var i;if(!this.Inputs[0].IsConnected)return d(0);const s=(i=this.Inputs[0].Links[0].In)==null?void 0:i.Value(t);return d(1).sub(s)})}}class Mi extends q{constructor(){super(...arguments);l(this,"Name","nodes.mountain");l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Scale",3.55,0,100,0,"Noise Transform","%"),new b("Octaves Count",10,1,50,1,"Noise Params",""),new b("Offset X",-.08,-100,100,0,"Noise Transform",""),new b("Offset Y",-.54,-100,100,0,"Noise Transform",""),new b("Falloff",3,0,20,0,"Mountain",""),new b("Height",1,0,1,0,"Mountain",""),new b("Position X",.5,0,1,0,"Mountain Transform",""),new b("Position Y",.5,0,1,0,"Mountain Transform","")]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value),a=S(this.Properties[4].Value),u=S(this.Properties[5].Value),c=S(this.Properties[6].Value),r=S(this.Properties[7].Value);this.Outputs[0].Value=C(([p])=>{const m=y(p.x,p.y).toVar(),f=d(Yt(y(c,r),m)).mul(a).toVar(),w=T(d(1),d(0),f).toVar(),_=Qe(Se(w,0,1),2),P=m.sub(y(c,r).sub(.5)).toVar(),D=yt(P,s,y(i,o),t).toVar();return Se(_.mul(D).mul(d(1.45).mul(u)),0,1)})}}class xi extends q{constructor(){super(...arguments);l(this,"Name","nodes.redistribution");l(this,"Inputs",[new O(!0,this,"Source")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Exponent",1,1,10)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var o;return this.Inputs[0].IsConnected?((o=this.Inputs[0].Links[0].In)==null?void 0:o.Value(s)).pow(t):d(0)})}}class ki extends q{constructor(){super(...arguments);l(this,"Name","nodes.terrace");l(this,"Inputs",[new O(!0,this,"Param 1")]);l(this,"Outputs",[new O(!1,this,"Output")]);l(this,"Properties",[new b("Count",3,0,10,1)]);l(this,"IsRealtimeUpdate",!0);l(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var i;if(this.Inputs[0].IsConnected){const a=((i=this.Inputs[0].Links[0].In)==null?void 0:i.Value)(s).toVar();if(this.Properties[0].Value==0)return a;const u=d(1).div(t).toVar(),c=st(a.div(u)).toVar(),r=a.sub(c.mul(u)).div(u).toVar(),p=ee(d(2).mul(r),d(1)).toVar();return c.add(p).mul(u).toVar()}else return 0})}}class Oi extends q{constructor(){super(...arguments);l(this,"Name","nodes.voronoi");l(this,"Outputs",[new O(!1,this,"Output"),new O(!1,this,"Cells"),new O(!1,this,"Bubbles")]);l(this,"Properties",[new b("Scale",10,1,100,0,"Transform","%"),new b("OffsetX",0,0,100,0,"Transform",""),new b("OffsetY",0,0,100,0,"Transform",""),new b("Angle",5,0,100,0,"Noise","")]);l(this,"IsRealtimeUpdate",!0);l(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value);this.Outputs[0].Value=C(([a])=>{const u=y(a.x,a.y).toVar(),c=y(s,i).toVar();u.addAssign(c);const r=rt({UV:u,angleOffset:o,cellDensity:t}).toVar();return Qe(r.x,2)}),this.Outputs[1].Value=C(([a])=>{const u=y(a.x,a.y).toVar(),c=y(s,i).toVar();return u.addAssign(c),rt({UV:u,angleOffset:o,cellDensity:t}).toVar().y}),this.Outputs[2].Value=C(([a])=>{const u=y(a.x,a.y).toVar(),c=y(s,i).toVar();u.addAssign(c);const r=rt({UV:u,angleOffset:o,cellDensity:t}).toVar();return Os(Qe(r.x,2))})}}class Li extends q{constructor(){super(...arguments);l(this,"Name","nodes.transform");l(this,"Inputs",[new O(!0,this,"Input")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Properties",[new b("Scale X",1,0,100,0,"Scale",""),new b("Scale Y",1,0,100,0,"Scale",""),new b("Position X",0,-100,100,0,"Position",""),new b("Position Y",0,-100,100,0,"Position",""),new b("Midpoint X",.5,0,1,0,"Rotation",""),new b("Midpoint Y",.5,0,1,0,"Rotation",""),new b("Angle",0,-360,360,0,"Rotation","")]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=S(this.Properties[0].Value),s=S(this.Properties[1].Value),i=S(this.Properties[2].Value),o=S(this.Properties[3].Value),a=S(this.Properties[4].Value),u=S(this.Properties[5].Value),c=S(this.Properties[6].Value);this.Outputs[0].Value=C(([r])=>{var x;const p=y(r.x,r.y).toVar(),m=y(t,s).toVar(),f=y(i,o).toVar(),w=y(a,u).toVar(),_=c.mul(Et.div(180)).toVar(),P=y(ut(_).mul(p.x.sub(w.x)).add(Ae(_).mul(p.y.sub(w.y))).add(w.x),ut(_).mul(p.y.sub(w.y)).sub(Ae(_).mul(p.x.sub(w.x))).add(w.y));return p.assign(P),p.addAssign(f),p.mulAssign(m),(x=this.Inputs[0].Links[0].In)==null?void 0:x.Value(p).toVar()})}}class $i extends q{constructor(){super(...arguments);l(this,"Inputs",[new O(!0,this,"Input")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Name","nodes.tile");l(this,"Properties",[new b("Tile Count",1,0,100,1),new b("Angle Threshold",0,0,360,0)]);l(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value),s=S(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var r;var o=y(i).toVar(),a=s.mul(Et.div(180));const u=_i(o,t,a).toVar();return(r=this.Inputs[0].Links[0].In)==null?void 0:r.Value(u).toVar()})}}class Ri extends q{constructor(){super(...arguments);l(this,"Inputs",[new O(!0,this,"Input")]);l(this,"Outputs",[new O(!1,this,"Result")]);l(this,"Name","nodes.height");l(this,"IsRealtimeUpdate",!0);l(this,"Properties",[new b("Height",1,0,1,0)])}Calculate(){this.BaseCalculate();const t=S(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var a;if(!this.Inputs[0].IsConnected)return d(0);var i=y(s).toVar();return((a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(i).toVar()).mul(t)})}}function Di(){W.registerStr("nodes.buffer","",be),W.registerStr("nodes.fake","",qt),W.registerStr("nodes.constant","nodeCategories.testNodes",gi),W.registerStr("nodes.perlinNoise","nodeCategories.testNodes",qs),W.registerStr("nodes.mountain","nodeCategories.testNodes",Mi),W.registerStr("nodes.terrace","nodeCategories.testNodes",ki),W.registerStr("nodes.combine","nodeCategories.testNodes",vi),W.registerStr("nodes.clamp","nodeCategories.testNodes",mi),W.registerStr("nodes.invert","nodeCategories.testNodes",Ci),W.registerStr("nodes.redistribution","nodeCategories.testNodes",xi),W.registerStr("nodes.gradientNoise","nodeCategories.testNodes",Ii),W.registerStr("nodes.voronoi","nodeCategories.testNodes",Oi),W.registerStr("nodes.crater","nodeCategories.testNodes",bi),W.registerStr("nodes.falloff","nodeCategories.testNodes",Pi),W.registerStr("nodes.fastErosion","nodeCategories.testNodes",Ni),W.registerStr("nodes.cracks","nodeCategories.testNodes",wi),W.registerStr("nodes.transform","nodeCategories.testNodes",Li),W.registerStr("nodes.tile","nodeCategories.testNodes",$i),W.registerStr("nodes.height","nodeCategories.testNodes",Ri)}const Ti={en:{"":"",logo:"Mashuk",windows:{thirdPreview:"3D Preview",secondPreview:"2D Preview",properties:"Node properties",graph:"Graph",nodesList:"Nodes list"},tt:{undo:"Undo",redo:"Redo",copy:"Copy",paste:"Paste",delete:"Delete node/selected",fullscreen:"Fullscreen",save:"Save",load:"Load",presets:"Presets",resetView:"Reset view",resetParams:"Reset node parameters to default",lockPreview:"Lock Preview",unlockPreview:"Unlock Preview",mesh_resolution:"Resolution",new:"New project",settings:"Settings",menu:"Menu",resolutionWarning:"Warning! Selecting a high resolution will increase video memory consumption and processing speed."},hints:{graphLmb:"LMB: Select/Drag node",graphWheel:"Wheel: Zoom/Drag work space"},nodes:{constant:"Constant",perlinNoise:"Perlin Noise",mountain:"Mountain",terrace:"Terrace",combine:"Combine",clamp:"Clamp",invert:"Invert",redistribution:"Redistribution",gradientNoise:"Gradient Noise",voronoi:"Voronoi",crater:"Crater",falloff:"Falloff",fastErosion:"Fast Erosion",cracks:"Cracks",transform:"Transform",tile:"Tile",height:"Height"},nodeCategories:{testNodes:"Test nodes"}},ru:{logo:"Машук",windows:{thirdPreview:"3D Просмотр",secondPreview:"2D Просмотр",properties:"Параметры узла",graph:"Граф",nodesList:"Список узлов"},tt:{undo:"Отменить",redo:"Повторить",copy:"Копировать",paste:"Вставить",delete:"Удалить узел/выделенные",fullscreen:"На весь экран",save:"Сохранить",load:"Загрузить",presets:"Предустановки",resetView:"Сбросить вид",resetParams:"Сбросить параметры узла до значений по умолчанию",lockPreview:"Закрепить отображение",unlockPreview:"Открепить отображение",mesh_resolution:"Разрешение",new:"Новый проект",settings:"Настройки",menu:"Меню",resolutionWarning:"Внимание! Выбор высокого разрешения влечет за собой увеличение потребления видеопамяти и скорости обработки"},hints:{graphLmb:"ЛКМ: Выделить/Передвинуть узел",graphWheel:"Колесо мыши: Приближение/Перемещение рабочей области"},nodes:{constant:"Константа",perlinNoise:"Шум Перлина",mountain:"Гора",terrace:"Террасы",combine:"Комбинирование",clamp:"Ограничение",invert:"Инверсия",redistribution:"Перераспределение",gradientNoise:"Градиентный Шум",voronoi:"Шум Вороного",crater:"Кратер",falloff:"Спад",fastErosion:"Быстрая Эрозия",cracks:"Трещины",transform:"Преобразование",tile:"Плитка",height:"Высота"},nodeCategories:{testNodes:"Тестовые узлы"}}};gt.options.themes.tooltip.delay.show=0;gt.options.distance=10;ns.add(Ls,os);const Ai=is({legacy:!1,locale:"en",fallbackLocale:"en",messages:Ti}),Me=as(As);Me.component("font-awesome-icon",rs);Me.use(ls());Me.use(pi);Me.use(gt);Me.use(Ai);Me.use(us);Me.mount("#app");Di();
