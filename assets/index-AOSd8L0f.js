var zt=Object.defineProperty;var qt=(i,e,t)=>e in i?zt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>qt(i,typeof e!="symbol"?e+"":e,t);import{d as E,r as K,o as g,c as b,a as V,b as v,e as A,u as z,R as Zt,g as ct,f as ue,_ as Y,v as ft,h as Ye,i as ht,j as $,k as Ue,l as Se,w as re,m as U,n as O,t as M,p as ae,q as ee,F as q,s as ce,x as I,T as jt,y as Kt,z as me,A as le,B as Ot,C as de,D as Jt,E as xt,G as Xe,H as pt,I as Ze,J as Qt,K as es,L as ts,M as ss,N as os,O as vt,P as ns,Q as is,S as as,U as rs,V as ls,W as us,X as ds,Y as cs,Z as fs}from"./vendor-BBqbdMMm.js";import{w as Lt,F as T,i as Rt,f as m,v as x,L as Dt,a as Ie,b as be,d as xe,m as X,n as hs,c as Te,s as ge,u as N,e as j,g as se,h as $e,j as ps,k as ke,l as _e,o as vs,R as Tt,p as mt,S as gt,O as Bt,M as Fe,P as tt,q as wt,t as ye,r as Le,D as He,x as yt,H as ms,y as je,z as Be,A as _t,B as Me,C as Vt,E as at,G as rt,I as At,J as gs,K as Ee,N as ws,Q as bt,T as ys,U as Gt,V as _s,W as Vs,X as We,Y as bs,Z as Ss,_ as Oe,$ as Pt,a0 as Cs,a1 as xs,a2 as Ps,a3 as Ns,a4 as ks,a5 as Nt,a6 as Is,a7 as Ke,a8 as Et,a9 as Je,aa as ot,ab as Ms,ac as Xt}from"./three-BesVOhe5.js";import{i as $s}from"./icons-CNPGi31y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const Os={key:0,class:"gpu-error-box disable-user-select"},Ls={class:"gpu-error-message-box"},Rs={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},Ds={key:2,class:"gpu-error-box disable-user-select"},Ts={class:"gpu-error-message-box"},Bs={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},As=E({__name:"App",setup(i){document.onkeydown=n=>{n.key=="F12"&&n.preventDefault()};const e=ct(),t=localStorage.getItem("userLang");t&&e!=null&&(e.appContext.config.globalProperties.$i18n.locale=t);const s=ue(()=>navigator.gpu),o=ue(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));return(n,a)=>{const l=K("font-awesome-icon");return o.value?(g(),b("div",Os,[V("div",Ls,[V("div",Rs,[v(l,{icon:["fas","circle-xmark"]})]),a[0]||(a[0]=V("h1",null,"Mobile devices not supported yet",-1))])])):s.value?(g(),A(z(Zt),{key:1})):(g(),b("div",Ds,[V("div",Ts,[V("div",Bs,[v(l,{icon:["fas","circle-xmark"]})]),a[1]||(a[1]=V("h1",null,"WebGPU is not supported on this browser.",-1))])]))}}}),Gs=Y(As,[["__scopeId","data-v-b1dd4320"]]);class Yt{constructor(){r(this,"Id",ft());r(this,"In",null);r(this,"Out",null);r(this,"IsSelected",!1)}SetSelected(e){var s,o,n;var t=this.In!=null?(s=this.In.ParentNode)==null?void 0:s.ParentGraph:(n=(o=this.Out)==null?void 0:o.ParentNode)==null?void 0:n.ParentGraph;t!=null&&e==!0&&t.DeselectAll(),this.IsSelected=e}DeleteLinkFromTerminals(){var s,o;var e=(s=this.In)==null?void 0:s.Links.indexOf(this);e!=null&&this.In!=null&&this.In.Links.splice(e,1);var t=(o=this.Out)==null?void 0:o.Links.indexOf(this);t!=null&&this.Out!=null&&this.Out.Links.splice(t,1)}}class R{constructor(e,t){r(this,"X",0);r(this,"Y",0);this.X=e,this.Y=t}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get Normalized(){return R.Div(this,this.Length)}Reset(){this.X=0,this.Y=0}static Add(e,t){return t instanceof R?new R(e.X+t.X,e.Y+t.Y):typeof t=="number"?new R(e.X+t,e.Y+t):e}static Sub(e,t){return t instanceof R?new R(e.X-t.X,e.Y-t.Y):typeof t=="number"?new R(e.X-t,e.Y-t):e}static Mul(e,t){return t instanceof R?new R(e.X*t.X,e.Y*t.Y):typeof t=="number"?new R(e.X*t,e.Y*t):e}static Div(e,t){return t instanceof R?new R(e.X/t.X,e.Y/t.Y):typeof t=="number"?new R(e.X/t,e.Y/t):e}}var Ut=(i=>(i[i.none=0]="none",i[i.Buffer=1]="Buffer",i[i.Primitives=2]="Primitives",i[i.GeoPrimitives=3]="GeoPrimitives",i[i.Warps=4]="Warps",i[i.Adjastments=5]="Adjastments",i[i.Profile=6]="Profile",i[i.Filters=7]="Filters",i[i.Erosion=8]="Erosion",i[i.Snow=9]="Snow",i[i.Water=10]="Water",i[i.Data=11]="Data",i[i.Color=12]="Color",i[i.Render=13]="Render",i[i.Output=14]="Output",i))(Ut||{}),we=(i=>(i[i.NotCalculated=0]="NotCalculated",i[i.Calculation=1]="Calculation",i[i.Calculated=2]="Calculated",i))(we||{});class P{constructor(e,t,s,o=0,n=0,a="",l=""){r(this,"Name","");r(this,"Description","");r(this,"Value");r(this,"Min",-10);r(this,"Max",10);r(this,"Suffix");r(this,"Category");r(this,"Step");r(this,"valueList");r(this,"Default");this.Name=e,this.Value=t,this.Default=t,this.Min=typeof s=="number"?s:0,this.Max=o,this.Suffix=l,this.Category=a,this.Step=n,this.valueList=s instanceof Array?s:void 0}Reset(){this.Value=this.Default}}class J{constructor(){r(this,"Id",ft());r(this,"Position",new R(0,0));r(this,"LastPosition",new R(0,0));r(this,"Name","");r(this,"Category",Ut.none);r(this,"Properties");r(this,"Inputs",[]);r(this,"Outputs",[]);r(this,"IsSelected",!1);r(this,"Height",0);r(this,"Width",0);r(this,"IsCalculated",!1);r(this,"ParentGraph",null);r(this,"CalculationState",we.NotCalculated);r(this,"IsRealtimeUpdate",!1);r(this,"DefaultOutput",0)}Move(e,t){this.Position=new R(e,t)}SetSize(e,t){this.Height=e,this.Width=t}SetSelected(e,t=!0){this.IsSelected=e;const s=fe();e&&t?s.SelectedNode=this:s.SelectedNode==this&&(s.SelectedNode=null)}SetLastPosition(e,t){this.LastPosition.X=e,this.LastPosition.Y=t}async BaseCalculate(){var e,t,s,o;this.CalculationState==we.Calculation,this.Outputs.forEach(n=>{n.Links.forEach(a=>{var l,f;(f=(l=a==null?void 0:a.Out)==null?void 0:l.ParentNode)==null||f.SetNotCalculated()})});for(const n of this.Inputs)n.IsConnected&&(await((t=(e=n.Links[0].In)==null?void 0:e.ParentNode)==null?void 0:t.Calculate()),(o=(s=n.Links[0].In)==null?void 0:s.ParentNode)==null||o.SetCalculated());this.CalculationState==we.Calculation}SetNotCalculated(){this.CalculationState=we.NotCalculated,this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,o;(o=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||o.SetNotCalculated()})})}SetCalculated(){this.CalculationState=we.Calculated}async Calculate(){}}class G{constructor(e,t,s){r(this,"Guid",ft());r(this,"Links",new Array);r(this,"IsInput",!1);r(this,"ParentNode",null);r(this,"Position",new R(0,0));r(this,"OffsetPosition",new R(0,0));r(this,"Value",null);r(this,"Name","");this.ParentNode=t,this.IsInput=e,this.Name=s}get IsConnected(){return this.Links.length>0}SetOffset(e,t){this.OffsetPosition=new R(e,t)}SetPosition(e,t){this.Position=new R(e,t)}}class Z{static register(e){var t=new e;this.classMap.set(t.constructor.name,e)}static registerStr(e,t,s){this.classMap.set(e,s),this.groupsMap.has(t)||this.groupsMap.set(t,new Map);var o=this.groupsMap.get(t);o==null||o.set(e,s)}static create(e,...t){const s=this.classMap.get(e);if(!s)throw new Error(`Class ${e} not registered`);return new s(...t)}static getGroups(){return this.groupsMap}}r(Z,"classMap",new Map),r(Z,"groupsMap",new Map);class Re{static Serialize(e){var a,l,f,d,c,_,h,u;var t=new Es;if(e.Nodes!=null&&e.Nodes.length>0)for(const p of e.Nodes){var s=new Xs;if(s.NodeType=p.Name,s.NodeGuid=p.Id,s.NodePostition=p.Position,p.Properties!=null&&p.Properties.length>0)for(const y of p.Properties){var o=new Ys;o.Value=y.Value,s.Properties==null&&(s.Properties=new Array),s.Properties.push(o)}t.Nodes==null&&(t.Nodes=new Array),t.Nodes.push(s)}if(e.Links!=null&&e.Links.length>0)for(const p of e.Links){var n=new Us;n.FromNodeGuid=(l=(a=p.In)==null?void 0:a.ParentNode)==null?void 0:l.Id,n.ToNodeGuid=(d=(f=p.Out)==null?void 0:f.ParentNode)==null?void 0:d.Id,n.FromTerminalIndex=(_=(c=p.In)==null?void 0:c.ParentNode)==null?void 0:_.Outputs.indexOf(p.In),n.ToTerminalIndex=(u=(h=p.Out)==null?void 0:h.ParentNode)==null?void 0:u.Inputs.indexOf(p.Out),t.Links==null&&(t.Links=new Array),t.Links.push(n)}return t}static Deserialize(e){var t=new lt;if(e.Nodes!=null&&e.Nodes.length>0)for(var s of e.Nodes){var o=Z.create(s.NodeType);if(o.Id=s.NodeGuid,o.Move(s.NodePostition.X,s.NodePostition.Y),s.Properties!=null&&s.Properties.length>0)for(var n=0;n<s.Properties.length;n++)o.Properties[n].Value=s.Properties[n].Value;t.AddNode(o,!1)}if(e.Links!=null&&e.Links.length>0)for(var a of e.Links){var l=Ye(t.Nodes).firstOrDefault(d=>d.Id==a.FromNodeGuid),f=Ye(t.Nodes).firstOrDefault(d=>d.Id==a.ToNodeGuid);l==null||f==null||t.AddLink(l.Outputs[a.FromTerminalIndex],f.Inputs[a.ToTerminalIndex],!1)}return t}}class Es{constructor(){r(this,"Nodes");r(this,"Links")}static ToJson(e){return JSON.stringify(e)}}class Xs{constructor(){r(this,"NodeGuid");r(this,"NodeType");r(this,"NodePostition");r(this,"Properties")}}class Ys{constructor(){r(this,"Value")}}class Us{constructor(){r(this,"FromNodeGuid");r(this,"ToNodeGuid");r(this,"FromTerminalIndex");r(this,"ToTerminalIndex")}}class Fs{constructor(e){r(this,"buffer");r(this,"capacity");r(this,"head",0);r(this,"tail",0);r(this,"size",0);r(this,"poppedItems",[]);if(e<=0)throw new Error("Capacity must be greater than 0");this.capacity=e,this.buffer=new Array(e)}get hasValues(){return this.size>0}get hasPoppedItems(){return this.poppedItems.length>0}push(e){this.poppedItems=[],this.size===this.capacity?(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.head=(this.head+1)%this.capacity):(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++)}pop(){if(!this.hasValues)return;this.tail=(this.tail-1+this.capacity)%this.capacity;const e=this.buffer[this.tail];return this.size--,this.poppedItems.push(e),e}unpop(){if(!this.hasPoppedItems)return;const e=this.poppedItems.pop();return this.size===this.capacity&&(this.head=(this.head+1)%this.capacity),this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++,e}toArray(){const e=[];for(let t=0;t<this.size;t++){const s=(this.head+t)%this.capacity;e.push(this.buffer[s])}return e}peek(){if(this.hasValues)return this.buffer[(this.tail-1+this.capacity)%this.capacity]}get length(){return this.size}}class pe{static get HasValues(){return this.ActionHistoryBuffer.hasValues}static get HasPopped(){return this.ActionHistoryBuffer.hasPoppedItems}static PushState(e){this.ActionHistoryBuffer.push(Re.Serialize(e))}static UnpopState(){if(this.ActionHistoryBuffer.hasPoppedItems){var e=this.ActionHistoryBuffer.unpop();return Re.Deserialize(e)}return null}static PopState(){if(this.ActionHistoryBuffer.hasValues){var e=this.ActionHistoryBuffer.pop();return Re.Deserialize(e)}return null}}r(pe,"ActionHistoryBuffer",new Fs(25));class lt{constructor(){r(this,"IsSubGraph",!1);r(this,"Nodes",new Array);r(this,"Links",new Array)}get HasSelected(){return this.Nodes.some(e=>e.IsSelected)||this.Links.some(e=>e.IsSelected)}AddNode(e,t=!0){var s=this.Nodes.indexOf(e);s==-1&&(e.ParentGraph=this,this.Nodes.push(e),t&&pe.PushState(this))}DeleteLink(e,t=!0){var s=this.Links.indexOf(e);s!=-1&&(e.DeleteLinkFromTerminals(),this.Links.splice(s,1),t&&pe.PushState(this))}AddLink(e,t,s=!0){if(!(e.IsInput&&t.IsInput||!e.IsInput&&!t.IsInput)){var o=new Yt;e.IsInput?(o.In=t,o.Out=e):(o.In=e,o.Out=t),t.Links.push(o),e.Links.push(o),this.Links.push(o),s&&pe.PushState(this)}}DeleteNode(e,t=!0){if(e!=null){var s=fe();s.SelectedNode==e&&(s.SelectedNode=null),s.LockedNode==e&&(s.LockedNode=null),e.Inputs.forEach(n=>{var a=n.Links.map(l=>l);a.forEach(l=>{this.DeleteLink(l)})}),e.Outputs.forEach(n=>{var a=n.Links.map(l=>l);a.forEach(l=>{this.DeleteLink(l)})});var o=this.Nodes.indexOf(e);o!=-1&&this.Nodes.splice(o,1),t&&pe.PushState(this)}}DeleteSelected(e=!0){this.Nodes.filter(s=>s.IsSelected).forEach(s=>this.DeleteNode(s,!1));var t=fe();t.SelectedNode=void 0,this.Links.filter(s=>s.IsSelected).forEach(s=>this.DeleteLink(s,!1)),e&&pe.PushState(this)}DeselectAll(){var e=fe();e.SelectedNode=void 0,this.Nodes.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1)),this.Links.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1))}SelectAll(){this.Nodes.forEach(e=>e.SetSelected(!0))}}const Qe=ht("drag",()=>{const i=$(!1),e=$(),t=$(),s=$();function o(a){s.value=a}function n(){return s.value}return{setNode:o,getNode:n,SourceTerminal:e,DestinationTerminal:t,IsDragging:i}}),fe=ht("nodes",()=>{const i=$(),e=$(),t=$();return{SelectedNode:i,LockedNode:e,CurrentGraph:t}}),he=ht("renderer",()=>{const i=$(!1),e=$(),t=n=>{e.value=n},s=()=>e.value,o=$();return{ChangeEvent:i,Resolution:o,SetRenderer:t,GetRenderer:s}}),Hs=E({__name:"HeapMonitor",setup(i){const e=$(0),t=$(0),s=()=>{setInterval(o,1e3)};Ue(()=>{s()});const o=()=>{performance&&performance.memory&&(e.value=performance.memory.usedJSHeapSize/1024/1024/1024,t.value=performance.memory.jsHeapSizeLimit/1024/1024/1024)};return(n,a)=>{const l=K("font-awesome-icon"),f=Se("tooltip");return g(),b("div",{onContextmenu:a[0]||(a[0]=re(()=>{},["prevent"])),class:"memory-usage"},[U((g(),b("span",null,[v(l,{icon:["fas","memory"]}),O(" "+M(e.value.toFixed(2))+" / "+M(t.value.toFixed(2))+" ",1),a[1]||(a[1]=V("span",null," GB",-1))])),[[f,"Heap memory usage",void 0,{up:!0}]])],32)}}}),Ws=Y(Hs,[["__scopeId","data-v-72365581"]]),zs={class:"status-bar-grid disable-user-select"},qs={class:"working-status"},Zs=E({__name:"StatusBar",setup(i){return he(),(e,t)=>{const s=K("font-awesome-icon");return g(),b("div",zs,[V("div",qs,[v(s,{icon:["fas","bars-progress"]}),t[0]||(t[0]=O(" Idle ",-1))]),V("div",null,[v(Ws)])])}}}),js=Y(Zs,[["__scopeId","data-v-ddd0f7cf"]]),Ks={class:"collapse"},Js={class:"carete"},Qs={key:0,class:"collapse-body"},eo=E({__name:"Collapse",setup(i){var e=$(!1);const t=()=>{e.value=!e.value};return(s,o)=>{const n=K("font-awesome-icon");return g(),b("div",Ks,[V("div",{onClick:t,class:"header"},[V("div",Js,[z(e)?(g(),A(n,{key:0,icon:["fas","angle-right"]})):(g(),A(n,{key:1,icon:["fas","angle-down"]}))]),ae(s.$slots,"header",{},void 0,!0)]),z(e)?ee("",!0):(g(),b("div",Qs,[ae(s.$slots,"default",{},void 0,!0)]))])}}}),Ft=Y(eo,[["__scopeId","data-v-ed8ad461"]]),ze=T(([i])=>{const e=x(i).toVar();e.assign(e.modInt(m(289)));const t=m(m(34).mul(e.x).add(1).mul(e.x).modInt(289).add(e.y)).toVar();return t.assign(m(34).mul(t).add(m(1)).mul(t).modInt(289)),t.assign(be(t.div(m(41))).mul(m(2)).sub(1)),hs(x(t.sub(Ie(t.add(.5))),Te(t).sub(.5)))}).setLayout({name:"gradientNoiseDir",type:"vec2",inputs:[{name:"p",type:"vec2"}]}),to=T(([i])=>{const e=x(i).toVar(),t=x(Ie(e)).toVar(),s=x(be(e)).toVar(),o=m(xe(ze(t),s)).toVar(),n=m(xe(ze(t.add(x(m(0),m(1)))),s.sub(x(m(0),m(1))))).toVar(),a=m(xe(ze(t.add(x(m(1),m(0)))),s.sub(x(m(1),m(0))))).toVar(),l=m(xe(ze(t.add(x(m(1),m(1)))),s.sub(x(m(1),m(1))))).toVar();return s.assign(s.mul(s).mul(s).mul(s.mul(s.mul(m(6)).sub(m(15))).add(m(10)))),X(X(o,n,s.y),X(a,l,s.y),s.x)}).setLayout({name:"gradientNoise",type:"float",inputs:[{name:"p",type:"vec2"}]}),Ht=T(([i])=>to(i).add(.5)),st=T(([i,e,t,s])=>{const o=Rt(e).toVar(),n=m(s).toVar(),a=x(t.x,t.y).toVar(),l=x(i.x,i.y).sub(m(.5)).mul(n).toVar();l.addAssign(a);const f=m(0).toVar(),d=m(1).div(2).toVar();return Dt(o,({i:c})=>{const _=l.mul(m(2).pow(m(c))).toVar(),h=Ht(_).mul(d).toVar();d.divAssign(2),f.addAssign(h)}),f}).setLayout({name:"perlinNoise",type:"float",inputs:[{name:"UV",type:"vec2"},{name:"octaves",type:"int"},{name:"offset",type:"vec2"},{name:"scale",type:"float"}]}),so=Lt(`
fn cracks(uv: vec2<f32>, angle: f32, scale: f32, thickness: f32) -> f32  {
	let st: vec2<f32> = (uv - 0.5) * scale;
	let i_st: vec2<f32> = floor(st);
	let f_st: vec2<f32> = fract(st);
	var m1: f32 = 1.;
	var m2: f32 = 1.;

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let neighbor: vec2<f32> = vec2<f32>(x, y);
			var point: vec2<f32> = random2(i_st + neighbor);
			point = 0.5 + 0.5 * sin(angle + 6.2831 * point);
			let diff: vec2<f32> = neighbor + point - f_st;
			let dist: f32 = length(diff);
			let cond: f32 = step(dist, m1);
			m2 = mix(min(max(m1, dist), m2), m1, cond);
			m1 = mix(m1, dist, cond);
		}

	}

	let edge: f32 = smoothstep(0.01, thickness, m2 - m1);
	return edge;
} 

fn random2(p: vec2<f32>) -> vec2<f32> {
	return fract(sin(vec2<f32>(dot(p, vec2<f32>(127.1, 311.7)), dot(p, vec2<f32>(269.5, 183.3)))) * 43758.547);
} 
`),nt=Lt(`
fn voronoi(UV: vec2<f32>, angleOffset: f32, cellDensity: f32) -> vec2<f32> {
	let g: vec2<f32> = floor((UV - 0.5) * cellDensity);
	let f: vec2<f32> = fract((UV - 0.5) * cellDensity);
	var res: vec3<f32> = vec3<f32>(8., 0., 0.);

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let lattice: vec2<f32> = vec2<f32>(x, y);
			let offset: vec2<f32> = voronoiNoiseRandomVector(lattice + g, angleOffset);
			let d: f32 = distance(lattice + offset, f);
			res = mix(res, vec3<f32>(d, offset.x, offset.y), step(d, res.x));
		}

	}

	return vec2<f32>(res.x, res.y);
} 

fn voronoiNoiseRandomVector(UV: vec2<f32>, offset: f32) -> vec2<f32> {
	var UV_var = UV;
	let m: mat2x2<f32> = mat2x2<f32>(15.27, 47.63, 99.41, 89.98);
	UV_var = fract(sin(UV_var * m) * 46839.32);
	return vec2<f32>(sin(UV_var.y * offset) * 0.5 + 0.5, cos(UV_var.x * offset) * 0.5 + 0.5);
}
`);class oo extends J{constructor(){super(...arguments);r(this,"Name","nodes.perlinNoise");r(this,"Outputs",[new G(!1,this,"Output")]);r(this,"Properties",[new P("Scale",10,0,100,0,"Transform","%"),new P("Octaves Count",10,1,50,1,"Noise",""),new P("Offset X",0,-100,100,0,"Transform",""),new P("Offset Y",0,-100,100,0,"Transform",""),new P("Warp Scale",0,0,1,.001,"Warp","%"),new P("Seed",0,0,99999,0,"Random",""),new P("Height",.4,0,1,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0);r(this,"Random",T(([t])=>{const s=x(t).toVar();return be(ge(xe(s,x(12.9898,78.233))).mul(43758.5453))}))}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value);N(this.Properties[4].Value);const a=N(this.Properties[5].Value),l=N(this.Properties[6].Value);this.Outputs[0].Value=T(([f])=>{const d=x(f.x,f.y).toVar();return d.addAssign(this.Random(x(a).mul(a))),st(d,s,x(o,n),t).mul(l)})}}const no=E({__name:"DraggableNode",props:{GraphNode:{type:Function,required:!0}},setup(i){const e=Qe(),t=i,s=$(),o=d=>{var _;if((_=d.dataTransfer)==null||_.setData("string","1"),t.GraphNode!=null&&t.GraphNode!=null){var c=t.GraphNode;e.setNode(new c)}};var n=void 0;const a=d=>{var h;n=(h=s.value)==null?void 0:h.cloneNode(!0);var c=n.getBoundingClientRect();if(n.style.position="fixed",n.style.left=`${d.touches[0].pageX-c.width/2}px`,n.style.top=`${d.touches[0].pageY-c.height/2}px`,n.style.zIndex="1000",document.body.appendChild(n),t.GraphNode!=null&&t.GraphNode!=null){var _=t.GraphNode;e.setNode(new _)}},l=d=>{if(n!=null){var c=n.getBoundingClientRect();n.style.left=`${d.touches[0].pageX-c.width/2}px`,n.style.top=`${d.touches[0].pageY-c.height/2}px`}},f=d=>{if(n!=null){document.body.removeChild(n),n=void 0,d.preventDefault(),d.stopPropagation();var c=d.changedTouches[0],_=document.elementFromPoint(c.clientX,c.clientY);console.log(_)}};return window.addEventListener("touchmove",l),window.addEventListener("touchend",f),(d,c)=>(g(),b("div",{onTouchstart:a,onDragstart:o,draggable:"true",class:"node",ref_key:"selfEl",ref:s},[ae(d.$slots,"default",{},void 0,!0)],544))}}),io=Y(no,[["__scopeId","data-v-ee47cd3c"]]),ao={class:"node-list"},ro=E({__name:"NodeList",setup(i){var e=Z.getGroups();return(t,s)=>{const o=K("font-awesome-icon");return g(),b("div",ao,[(g(!0),b(q,null,ce(z(e),([n,a])=>(g(),b(q,null,[n!=""?(g(),A(Ft,{key:0},{header:I(()=>[O(M(t.$t(n)),1)]),default:I(()=>[(g(!0),b(q,null,ce(a,([l,f])=>(g(),A(io,{"-graph-node":f},{default:I(()=>[v(o,{icon:["fas","circle-nodes"]}),O(" "+M(t.$t(l)),1)]),_:2},1032,["-graph-node"]))),256))]),_:2},1024)):ee("",!0)],64))),256))])}}}),lo=Y(ro,[["__scopeId","data-v-ff1a0b3e"]]),uo={class:"padding"},co={class:"header disable-user-select"},fo={class:"body disable-user-select"},ho=E({__name:"FrameTab",props:{wheelFocus:{type:Boolean,default:!0}},setup(i){const e=i,t=$(),s=o=>{t.value&&e.wheelFocus&&t.value.focus()};return(o,n)=>(g(),b("div",uo,[V("div",{class:"main",tabindex:"0",ref_key:"selfEl",ref:t,onWheel:s},[V("div",co,[ae(o.$slots,"header",{},void 0,!0)]),V("div",fo,[ae(o.$slots,"default",{},void 0,!0)])],544)]))}}),et=Y(ho,[["__scopeId","data-v-611ecd47"]]);class Ne extends J{constructor(){super(...arguments);r(this,"Name","nodes.buffer");r(this,"Inputs",[new G(!0,this,"")]);r(this,"Outputs",[new G(!1,this,"")])}async Calculate(){this.BaseCalculate();var t=this.Inputs[0].Links[0].In,s=this.Outputs[0];s.Value=t==null?void 0:t.Value}}class ut{constructor(e,t,s,o){r(this,"X",0);r(this,"Y",0);r(this,"Height",0);r(this,"Width",0);this.X=e,this.Y=t,this.Height=s,this.Width=o}ContainsRect(e){return this.X<=e.X&&e.X+e.Width<=this.X+this.Width&&this.Y<=e.Y&&e.Y+e.Height<=this.Y+this.Height}ContainsPoint(e,t){return this.X<=e&&e<this.X+this.Width&&this.Y<=t&&t<this.Y+this.Height}IntersectsWith(e){return e.X<this.X+this.Width&&this.X<e.X+e.Width&&e.Y<this.Y+this.Height&&this.Y<e.Y+e.Height}static Intersects(e,t){return e.X<t.X+t.Width&&t.X<e.X+e.Width&&e.Y<t.Y+t.Height&&t.Y<e.Y+e.Height}}const po=E({__name:"ContextMenu",props:{CloseOnAnyClick:{type:Boolean,default:!0},CloseOnMouseOut:{type:Boolean,default:!0}},emits:["lost-focus"],setup(i,{expose:e,emit:t}){const s=$(!1),o=$(),n=t,a=i,l=y=>{s.value=!0,me(()=>{o.value!=null&&o.value!=null&&(o.value.style.left=y.pageX+"px",o.value.style.top=y.pageY+"px",d(),window.addEventListener("mousedown",p))})},f=y=>{me(()=>{o.value!=null&&(o.value.style.width=y+"px")})},d=()=>{if(o.value!=null&&o.value!=null){const w=o.value.getBoundingClientRect();if(w.y+w.height>window.innerHeight){var y=w.y+w.height-window.innerHeight;o.value.style.top=w.y-y+"px"}if(w.y<0&&(o.value.style.top="0px"),w.x+w.width>window.innerWidth){var y=w.x+w.width-window.innerWidth;o.value.style.left=w.x-y+"px"}w.x<0&&(o.value.style.left="0px")}},c=y=>{s.value=!0,me(()=>{if(o.value!=null&&o.value!=null){var w=y.getBoundingClientRect();o.value.style.left=w.x+"px",o.value.style.top=w.y+w.height+"px",d(),window.addEventListener("mousedown",p)}})},_=y=>{s.value=!0,me(()=>{if(o.value!=null&&o.value!=null){var w=y.getBoundingClientRect(),S=o.value.getBoundingClientRect();o.value.style.left=w.x-S.width+"px",o.value.style.top=w.y+"px",d(),window.addEventListener("mousedown",p)}})},h=y=>{s.value=!0,me(()=>{if(o.value!=null&&o.value!=null){var w=y.getBoundingClientRect();o.value.style.left=w.x+w.width+"px",o.value.style.top=w.y+"px",d(),window.addEventListener("mousedown",p)}})},u=()=>{window.removeEventListener("mousedown",p),s.value=!1},p=y=>{if(a.CloseOnMouseOut&&o.value!=null){var w=o.value.getBoundingClientRect(),S=new ut(w.x,w.y,w.height,w.width);S.ContainsPoint(y.clientX,y.clientY)||(s.value=!1,window.removeEventListener("mousedown",p),n("lost-focus"))}};return e({Open:l,Close:u,OpenUnder:c,OpenLeft:_,OpenRight:h,SetWidth:f,isOpened:s}),(y,w)=>(g(),A(Kt,{name:"open"},{default:I(()=>[(g(),A(jt,{to:"body"},[s.value?(g(),b("div",{key:0,onContextmenu:w[0]||(w[0]=re(()=>{},["prevent"])),onMousedown:w[1]||(w[1]=re(()=>{},["stop"])),ref_key:"ContextMenu",ref:o,class:"context-menu disable-user-select"},[ae(y.$slots,"default",{},void 0,!0)],544)):ee("",!0)]))]),_:3}))}}),Ae=Y(po,[["__scopeId","data-v-bc41e1a3"]]);class kt{static pathExists(e,t){if(e===t)return!0;const s=new Set;return this.dfs(e,t,s)}static dfs(e,t,s){if(e===t)return!0;if(s.has(e))return!1;s.add(e);for(const o of e.Outputs)for(const n of o.Links)if(n.Out!=null&&n.Out!=null){const a=n.Out.ParentNode;if(this.dfs(a,t,s))return!0}return!1}}const vo=E({__name:"TerminalRenderer",props:{Term:{type:G,required:!0}},setup(i,{expose:e}){const t=$(!1),s=Qe(),o=i,n=_=>{s.SourceTerminal=o.Term,s.IsDragging=!0,window.addEventListener("mouseup",a)},a=_=>{var y,w,S;window.removeEventListener("mouseup",a),s.IsDragging=!1;var h=s.DestinationTerminal,u=s.SourceTerminal;if(h!=null&&h!=u&&!(u!=null&&u.IsInput&&h.IsInput)&&(u==null?void 0:u.ParentNode)!=h.ParentNode){if(u!=null&&u.IsInput){if(kt.pathExists(u==null?void 0:u.ParentNode,h.ParentNode))return;u.Links.forEach(C=>{var D,F;(F=(D=u==null?void 0:u.ParentNode)==null?void 0:D.ParentGraph)==null||F.DeleteLink(C)})}if(h.IsInput){if(kt.pathExists(h==null?void 0:h.ParentNode,u==null?void 0:u.ParentNode))return;h.Links.forEach(C=>{var D,F;(F=(D=h==null?void 0:h.ParentNode)==null?void 0:D.ParentGraph)==null||F.DeleteLink(C)})}(w=(y=o.Term.ParentNode)==null?void 0:y.ParentGraph)==null||w.AddLink(h,u);var p=he();(S=o.Term.ParentNode)!=null&&S.IsRealtimeUpdate&&(p.ChangeEvent=!p.ChangeEvent)}},l=_=>{s.IsDragging&&(s.DestinationTerminal=o.Term)},f=_=>{s.IsDragging&&(s.DestinationTerminal=null)},d=$();Ue(()=>{me(()=>{c()})});const c=()=>{var u,p,y,w;var _=((u=d.value)==null?void 0:u.offsetLeft)+((p=d.value)==null?void 0:p.offsetWidth)/2+2,h=((y=d.value)==null?void 0:y.offsetTop)+((w=d.value)==null?void 0:w.offsetHeight)/2+2;o.Term.SetOffset(_,h)};return e({SetOffset:c}),(_,h)=>{const u=Se("tooltip");return U((g(),b("div",{class:le(["node-terminal",{connected:o.Term.IsConnected},"disable-user-select",{"build-marker":t.value}]),onMousedown:[h[0]||(h[0]=re(()=>{},["right","stop"])),re(n,["left"])],onMouseover:l,onMouseleave:f,ref_key:"selfEl",ref:d},null,34)),[[u,{content:o.Term.Name,placement:o.Term.IsInput?"left":"right"}]])}}}),It=Y(vo,[["__scopeId","data-v-ece7d6d8"]]),mo=E({__name:"ContextMenuItem",props:{Active:{type:Boolean,default:!1}},setup(i){return(e,t)=>(g(),b("button",{class:le([["btn",{active:i.Active}],"btn"]),style:{padding:"5px"}},[ae(e.$slots,"default",{},void 0,!0)],2))}}),ne=Y(mo,[["__scopeId","data-v-3e13e567"]]),go={},wo={class:"loader"};function yo(i,e){return g(),b("span",wo)}const Wt=Y(go,[["render",yo],["__scopeId","data-v-8c5c5c6f"]]);class qe extends J{constructor(){super(...arguments);r(this,"Name","nodes.combine");r(this,"Inputs",[new G(!0,this,"Source 1"),new G(!0,this,"Source 2")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Mode","Burn",["Burn","Darken","Difference","Dodge","Divide","Exclusion","HardLight","HardMix","Lighten","LinearBurn","LinearDodge","LinearLight","LinearLightAddSub","Multiply","Negation","Overlay","PinLight","Screen","SoftLight","Subtract","VividLight","Overwrite"]),new P("Strength",0,0,100,0,"","%")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=this.Properties[0].Value,s=N(this.Properties[1].Value);this.Outputs[0].Value=T(([o])=>{var f,d;if(!this.Inputs[0].IsConnected||!this.Inputs[1].IsConnected)return m(0);const n=(f=this.Inputs[0].Links[0].In)==null?void 0:f.Value(o).toVar(),a=(d=this.Inputs[1].Links[0].In)==null?void 0:d.Value(o).toVar(),l=s.mul(.01);switch(t){case"Burn":{const c=m(1).sub(m(1).sub(a).div(n)).toVar();return X(n,c,l)}case"Darken":{const c=_e(n,a).toVar();return X(n,c,l)}case"Difference":{const c=Te(a.sub(n)).toVar();return X(n,c,l)}case"Dodge":{const c=n.div(a.add(m(1e-12))).toVar();return X(n,c,l)}case"Divide":{const c=n.div(m(1).sub(a)).toVar();return X(n,c,l)}case"Exclusion":{const c=a.add(n).sub(m(2).mul(a).mul(n)).toVar();return X(n,c,l)}case"HardLight":{const c=m(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=m(se(2,n).mul(a)).toVar(),h=m($e(a,.5)).toVar(),u=m(_.mul(h).add(m(1).sub(h).mul(c))).toVar();return X(n,u,l)}case"HardMix":{const c=m($e(m(1).sub(n),a)).toVar();return X(n,c,l)}case"Lighten":{const c=ke(a,n).toVar();return X(n,c,l)}case"LinearBurn":{const c=m(n.add(a.sub(1))).toVar();return X(n,c,l)}case"LinearDodge":{const c=n.add(a).toVar();return X(n,c,l)}case"LinearLight":{const c=m(vs(a.lessThan(.5),ke(n.add(m(2).mul(a).sub(m(1))),m(0)),_e(n.add(m(2).mul(a.sub(.5))),m(1)))).toVar();return X(n,c,l)}case"LinearLightAddSub":{const c=m(a.add(se(2,n).sub(1))).toVar();return X(n,c,l)}case"Multiply":{const c=n.mul(a).toVar();return X(n,c,l)}case"Negation":{const c=m(j(1,Te(j(1,a).sub(n)))).toVar();return X(n,c,l)}case"Overlay":{const c=m(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=m(se(2,n).mul(a)).toVar(),h=m($e(n,.5)).toVar(),u=m(_.mul(h).add(m(1).sub(h).mul(c))).toVar();return X(n,u,l)}case"PinLight":{const c=m($e(.5,a)).toVar(),_=m(c.mul(ke(se(2,n.sub(.5)),a))).toVar(),h=m(_.add(j(1,c).mul(_e(se(2,n),a)))).toVar();return X(n,h,l)}case"Screen":{const c=m(j(1,j(1,a).mul(j(1,n)))).toVar();return X(n,c,l)}case"SoftLight":{const c=m(j(1,se(2,j(1,n)).mul(j(1,a)))).toVar(),_=m(ps(n).mul(se(2,a).sub(1)).add(se(2,n).mul(j(1,a)))).toVar(),h=m($e(a,.5)).toVar(),u=m(_.mul(h).add(m(1).sub(h).mul(c))).toVar();return X(n,u,l)}case"Subtract":{const c=n.sub(a).toVar();return X(n,c,l)}case"VividLight":{const c=m(j(1,j(1,a).div(se(2,n)))).toVar(),_=m(a.div(se(2,j(1,n)))).toVar(),h=m($e(.5,n)).toVar(),u=m(_.mul(h).add(m(1).sub(h).mul(c))).toVar();return X(n,u,l)}case"Overwrite":return X(n,a,l)}return m(0)})}}class Mt{static async GetBuffer(e,t,s,o){const n=new Tt(t,t,{type:o,format:mt,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1}),a=e.getRenderTarget();var l=new gt,f=new Bt(-.5,.5,.5,-.5,1,100);f.position.set(0,0,10);var d=new Fe(new tt(1,1,1,1)),c=new wt;c.colorNode=ye(s,Le()),c.side=He,c.needsUpdate=!0,d.material=c,l.add(d),e.setRenderTarget(n),await e.renderAsync(l,f);var _=await e.readRenderTargetPixelsAsync(n,0,0,t,t);return n.dispose(),e.setRenderTarget(a),_}}var ie=(i=>(i[i.PNG8=0]="PNG8",i[i.PNG16=1]="PNG16",i[i.RAW16=2]="RAW16",i[i.RAW32=3]="RAW32",i[i.EXR=4]="EXR",i[i.TIFF16=5]="TIFF16",i[i.TIFF32=6]="TIFF32",i))(ie||{});class _o{constructor(e,t){r(this,"_renderer");r(this,"_textureForCompute");r(this,"_resolution");this._renderer=e,this._resolution=t,this._textureForCompute=new yt(t,t)}async Build(e){switch(await this.ComputeTexture(e),e.BuildType){case 2:return await this.BuildRAW16();case 3:return await this.BuildRAW32()}return new Blob}async BuildPNG8(){return new Blob}async BuildPNG16(){return new Blob}async BuildRAW16(){var e=await Mt.GetBuffer(this._renderer,this._resolution,this._textureForCompute,ms);return new Blob([e],{type:"application/octet-stream"})}async BuildRAW32(){var e=await Mt.GetBuffer(this._renderer,this._resolution,this._textureForCompute,je);return new Blob([e],{type:"application/octet-stream"})}async BuildEXR(){new Tt(this._resolution,this._resolution,{type:je,format:mt,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1});var e=new gt,t=new Bt(-.5,.5,.5,-.5,1,100);t.position.set(0,0,10);var s=new Fe(new tt(1,1,1,1)),o=new wt;return o.colorNode=ye(this._textureForCompute,Le()),o.side=He,o.needsUpdate=!0,s.material=o,e.add(s),new Blob}async BuildTIFF16(){return new Blob}async BuildTIFF32(){return new Blob}async ComputeTexture(e){if(e==null||e.InputTermianl==null)return;await e.Calculate();const s=T(()=>{var c;const o=Be.modInt(this._resolution),n=Be.div(this._resolution),a=_t(o,n),l=x(a.x,a.y).div(this._resolution).toVar();var f=(c=e.InputTermianl)==null?void 0:c.Value;const d=f(l).toVar();d.assign(Me(d,0,1)),Vt(this._textureForCompute,a,d).toWriteOnly()})().compute(this._resolution*this._resolution);await this._renderer.computeAsync(s)}}class De extends J{constructor(){super(...arguments);r(this,"Name","nodes.export");r(this,"Inputs",[new G(!0,this,"Input")]);r(this,"IsRealtimeUpdate",!0);r(this,"ExportFileName");r(this,"BuildType",ie.RAW16)}SetFileName(t){this.ExportFileName=t}SetBuildType(t){this.BuildType=t}get InputTermianl(){return this.Inputs[0].IsConnected?this.Inputs[0].Links[0].In:null}async Calculate(){this.BaseCalculate()}}const Vo={class:"node-container"},bo={class:"node-terminals left"},So={class:"node-center"},Co={class:"node-name"},xo={class:"node-terminals right"},Po=E({__name:"NodeRenderer",props:{Offset:{type:R,required:!0},Zoom:{type:Number,required:!0},Node:{type:J,required:!0},AllNodes:{type:Array,default:new Array}},setup(i){Ot(k=>({v3166abee:f.value,v56380d10:d.value}));var e=i;const t=$(),s=de("contextMenu"),o=de("terminals");Ue(()=>{window.addEventListener("mousemove",H),window.addEventListener("mouseup",C),me(()=>{var k=e.Node,L=t.value;if(k.SetSize(L.offsetHeight,L.offsetWidth),k.Move(k.Position.X-k.Width/2,k.Position.Y-k.Height/2),t!=null){var B=new ResizeObserver(u);B.observe(t.value)}})});const n=$(new R(0,0)),a=$(!1),l=ue(()=>{var k=fe();return k.LockedNode==e.Node}),f=ue(()=>a.value?"grabbing":"default"),d=ue(()=>e.Node.IsSelected?"1":"0"),c=ue(()=>{var k=fe(),L=k.LockedNode;return L!=null&&L==e.Node}),_=k=>{var L;(L=s.value)==null||L.Open(k)},h=()=>{var k;(k=s.value)==null||k.Close()},u=()=>{var k;o.value!=null&&((k=o.value)==null||k.forEach(L=>{L==null||L.SetOffset()}))},p=()=>{var k=fe(),L=he();k.LockedNode==e.Node?k.LockedNode=null:(k.LockedNode=e.Node,e.Node.SetSelected(!0),L.ChangeEvent=!L.ChangeEvent)},y=(k,L,B)=>{var W,te,ve,Ge,Ct;if(a.value=!0,n.value.X=k,n.value.Y=L,B)e.Node.SetSelected(!((W=e.Node)!=null&&W.IsSelected));else{var Q=(te=e.Node.ParentGraph)==null?void 0:te.Nodes.filter(Pe=>Pe.IsSelected);Q.length>1?e.Node.IsSelected==!1&&((ve=e.Node.ParentGraph)==null||ve.DeselectAll(),e.Node.SetSelected(!0)):((Ge=e.Node.ParentGraph)==null||Ge.DeselectAll(),e.Node.SetSelected(!0))}(Ct=e.Node.ParentGraph)==null||Ct.Nodes.filter(Pe=>Pe.IsSelected).forEach(Pe=>{Pe.SetLastPosition(Pe.Position.X,Pe.Position.Y)}),pe.PushState(e.Node.ParentGraph)},w=k=>{if(o.value!=null&&o.value.some(Q=>Q.$el==k.target||Q==k.target))return;let L=k.touches[0].clientX,B=k.touches[0].clientY;y(L,B,!1)},S=k=>{o.value!=null&&o.value.some(L=>L.$el==k.target||L==k.target)||y(k.clientX,k.clientY,k.shiftKey)},C=k=>{a.value=!1},D=k=>{a.value=!1},F=k=>{let L=k.touches[0].clientX,B=k.touches[0].clientY;oe(L,B)},oe=(k,L)=>{var W;if(a.value){var B=(k-n.value.X)/e.Zoom,Q=(L-n.value.Y)/e.Zoom;(W=e.Node.ParentGraph)==null||W.Nodes.filter(te=>te.IsSelected).forEach(te=>{te.Move(te.LastPosition.X+B,te.LastPosition.Y+Q)})}},H=k=>{oe(k.clientX,k.clientY)};return(k,L)=>{const B=K("font-awesome-icon"),Q=Se("tooltip");return g(),b("div",{class:le([{node:!(i.Node instanceof z(Ne))&&!(i.Node instanceof z(qe))&&!(i.Node instanceof z(De))},{"node-buffer":i.Node instanceof z(Ne)||i.Node instanceof z(qe)||i.Node instanceof z(De)},"disable-user-select",{"not-calculated":i.Node.CalculationState==z(we).NotCalculated&&!(i.Node instanceof z(Ne))},{selected:i.Node.IsSelected},{lockedPreview:l.value},{"node-without-inputs":i.Node.Inputs.length==0},{"node-animation":i.Node.CalculationState==z(we).Calculation}]),style:Jt({top:z(e).Node.Position.Y+"px",left:z(e).Node.Position.X+"px"}),ref_key:"rootEl",ref:t,onMousedown:[re(S,["left"]),re(_,["right"])],onTouchmove:F,onTouchstart:w,onTouchend:D},[V("div",Vo,[V("div",bo,[(g(!0),b(q,null,ce(i.Node.Inputs,W=>(g(),A(It,{ref_for:!0,ref_key:"terminals",ref:o,key:W.Guid,Term:W},null,8,["Term"]))),128))]),V("div",So,[i.Node instanceof z(Ne)?(g(),A(B,{key:0,icon:"fa-solid fa-code-commit"})):i.Node instanceof z(qe)?(g(),b(q,{key:1},[U((g(),b("a",{class:"lock-icon",onClick:L[0]||(L[0]=W=>p())},[c.value?(g(),A(B,{key:0,icon:["fas","lock"]})):(g(),A(B,{key:1,icon:["fas","lock-open"]}))])),[[Q,{content:k.$t("tt.lockPreview"),placement:"bottom"}]]),v(B,{icon:"fa-solid fa-code-fork",rotation:"270"})],64)):i.Node instanceof z(De)?(g(),A(B,{key:2,icon:"fa-solid fa-floppy-disk"})):(g(),b(q,{key:3},[U((g(),b("a",{class:"lock-icon",onClick:L[1]||(L[1]=W=>p())},[c.value?(g(),A(B,{key:0,icon:["fas","lock"]})):(g(),A(B,{key:1,icon:["fas","lock-open"]}))])),[[Q,{content:k.$t("tt.lockPreview"),placement:"bottom"}]]),V("div",Co,M(k.$t(i.Node.Name)),1)],64))]),V("div",xo,[(g(!0),b(q,null,ce(i.Node.Outputs,W=>(g(),A(It,{ref_for:!0,ref_key:"terminals",ref:o,key:W.Guid,Term:W},null,8,["Term"]))),128))])]),v(Ae,{ref_key:"contextMenu",ref:s,CloseOnAnyClick:!0},{default:I(()=>[v(ne,null,{default:I(()=>[v(B,{icon:["far","copy"]}),O(" "+M(k.$t("tt.copy")),1)]),_:1}),v(ne,{onClick:L[2]||(L[2]=W=>{var te,ve;(te=i.Node.ParentGraph)==null||te.DeleteNode(i.Node),(ve=i.Node.ParentGraph)==null||ve.DeleteSelected(),h()}),style:{color:"var(--vt-c-red)"}},{default:I(()=>[v(B,{icon:["far","trash-can"]}),O(" "+M(k.$t("tt.delete")),1)]),_:1}),L[4]||(L[4]=V("hr",null,null,-1)),v(ne,{onClick:L[3]||(L[3]=W=>{p(),h()})},{default:I(()=>[c.value?(g(),A(B,{key:0,icon:["fas","lock"]})):(g(),A(B,{key:1,icon:["fas","lock-open"]})),c.value?(g(),b(q,{key:2},[O("  "+M(k.$t("tt.unlockPreview")),1)],64)):(g(),b(q,{key:3},[O("  "+M(k.$t("tt.lockPreview")),1)],64))]),_:1})]),_:1},512)],38)}}}),No=Y(Po,[["__scopeId","data-v-27bc092e"]]),ko={},Io={class:"canvas",xmlns:"http://www.w3.org/2000/svg"};function Mo(i,e){return g(),b("svg",Io,[ae(i.$slots,"default",{},void 0,!0)])}const $o=Y(ko,[["render",Mo],["__scopeId","data-v-81940268"]]),Oo=["points"],Lo=E({__name:"LinkRenderer",props:{Link:{type:Yt,required:!0}},setup(i){const e=i,t=()=>{e.Link.SetSelected(!0)},s=n=>{var c;var a=e.Link.In,l=e.Link.Out;if(!(a==null||l==null)){var f=new Ne;f.Move(n.offsetX,n.offsetY);var d=(c=a.ParentNode)==null?void 0:c.ParentGraph;d!=null&&(d.DeleteLink(e.Link),d.AddNode(f),d.AddLink(a,f.Inputs[0]),d.AddLink(f.Outputs[0],l))}},o=ue(()=>{var l,f,d,c,_,h;var n=R.Add((f=(l=e.Link.In)==null?void 0:l.ParentNode)==null?void 0:f.Position,(d=e.Link.In)==null?void 0:d.OffsetPosition),a=R.Add((_=(c=e.Link.Out)==null?void 0:c.ParentNode)==null?void 0:_.Position,(h=e.Link.Out)==null?void 0:h.OffsetPosition);return`${n.X},${n.Y} ${n.X+20},${n.Y} ${a.X-20},${a.Y} ${a.X},${a.Y}`});return(n,a)=>(g(),b("polyline",{onClick:t,onDblclick:s,points:o.value,class:le(["line",{selected:e.Link.IsSelected}])},null,42,Oo))}}),Ro=Y(Lo,[["__scopeId","data-v-ca4f4d6b"]]),Do={},To={class:"tool-bar-container"};function Bo(i,e){return g(),b("div",To,[ae(i.$slots,"default",{},void 0,!0)])}const dt=Y(Do,[["render",Bo],["__scopeId","data-v-b20ca96b"]]),Ao={},Go={class:"tool-bar-body"};function Eo(i,e){return g(),b("div",Go,[ae(i.$slots,"default")])}const Ve=Y(Ao,[["render",Eo]]),Xo={key:0,class:"selection-box"},Yo={class:"offset-container",ref:"offset_container"},Uo=["points"],Fo={key:1,style:{"pointer-events":"none",height:"100%",width:"100%",padding:"30px",position:"absolute"}},Ho={style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%","border-radius":"50px",border:"4px dashed var(--vt-c-black-mute)",color:"var(--vt-c-black-mute)"}},Wo={style:{"font-size":"50px","font-weight":"bold","text-shadow":"0px 0px 20px black"}},zo=E({props:{MinScale:{type:Number,default:.5},MaxScale:{type:Number,default:2}},data(){return{Offset:new R(0,0),SelectionBox:new ut(0,0,0,0),SelectionBoxVisibility:!1,LastMouse:new R(0,0),LastOffset:new R(0,0),Zoom:1,isDragging:!1,_Graph:new lt,dragStore:Qe(),points:"",GridSize:20,isDragOver:!1}},computed:{Nodes:function(){return this._Graph.Nodes},OffsetXStyle:function(){return this.Offset.X+"px"},OffsetYStyle:function(){return this.Offset.Y+"px"},EditorCursor:function(){return this.isDragging?"grabbing":"default"},SelectionBoxX:function(){return this.SelectionBox.X+"px"},SelectionBoxY:function(){return this.SelectionBox.Y+"px"},SelectionBoxHeight:function(){return this.SelectionBox.Height+"px"},SelectionBoxWidth:function(){return this.SelectionBox.Width+"px"},OffsetStyle:function(){var i=this.GridSize/2*this.Zoom;return this.Offset.X-i+"px "+(this.Offset.Y-i)+"px"},ScaleGridStyle:function(){var i=(this.GridSize*this.Zoom).toString();return`${i}px ${i}px`}},created(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted(){this.$nextTick(()=>{var t;this.$el;var i=((t=this.$parent)==null?void 0:t.$el).parentElement;i!=null&&(i.onkeydown=this.KeysHandler),this._Graph=new lt;var e=fe();e.CurrentGraph=this._Graph})},methods:{SaveGraph(){var i=Re.Serialize(this._Graph),e=JSON.stringify(i);console.log(e);var t=JSON.parse(e);console.log(t);var s=Re.Deserialize(t);console.log(s)},Undo(){var i=pe.PopState();i!=null&&(this._Graph=i)},Redo(){var i=pe.UnpopState();i!=null&&(this._Graph=i)},isChild(i,e){for(var t=e.parentNode;t!=null;){if(t==i)return!0;t=t.parentNode}return!1},dragenter(){this.isDragOver=!0},dragleave(i){var e=this.$el,t=i.target;this.isChild(e,t)||(this.isDragOver=!1)},drop(i){this.isDragOver=!1;var e=Qe(),t=e.getNode();if(t!=null){var s=this.$refs.editor,o=s.getBoundingClientRect();if(o!=null){pe.PushState(this._Graph);var n=R.Div(new R(i.clientX-o.x-this.Offset.X,i.clientY-o.y-this.Offset.Y),this.Zoom);t==null||t.Move(n.X,n.Y),this._Graph.AddNode(t)}}},KeysHandler(i){i.key=="Delete"&&(pe.PushState(this._Graph),this._Graph.DeleteSelected())},UpdateOffsetStyle(){var i=this.$refs.offset_container;i.style.left=this.OffsetXStyle,i.style.top=this.OffsetYStyle,i.style.scale=this.Zoom.toString()},OnMouseDownLeft:function(i){this.DrawGhostLine(i),i.target==this.$refs.editor&&(this.LastMouse=new R(i.clientX,i.clientY),this.SelectionBox.X=0,this.SelectionBox.Y=0,this.SelectionBox.Width=0,this.SelectionBox.Height=0,this.SelectionBoxVisibility=!0,this._Graph.DeselectAll())},OnMouseDownMiddle:function(i){this.isDragging=!0,this.LastMouse=new R(i.clientX,i.clientY),this.LastOffset={...this.Offset}},OnMouseMove:function(i){if(this.isDragging){i.preventDefault();var e=i.clientX-this.LastMouse.X,t=i.clientY-this.LastMouse.Y;this.Offset.X=this.LastOffset.X+e,this.Offset.Y=this.LastOffset.Y+t,this.UpdateOffsetStyle()}if(this.SelectionBoxVisibility){i.preventDefault();var s=new R(i.clientX,i.clientY),o=new R(Math.min(this.LastMouse.X,s.X),Math.min(this.LastMouse.Y,s.Y)),n=new R(Math.abs(this.LastMouse.X-s.X),Math.abs(this.LastMouse.Y-s.Y)),a=this.$refs.editor,l=a.getBoundingClientRect();this.SelectionBox.X=o.X-l.left,this.SelectionBox.Y=o.Y-l.top,this.SelectionBox.Width=n.X,this.SelectionBox.Height=n.Y,this._Graph.Nodes.forEach(f=>{var d=new ut(this.Offset.X+f.Position.X*this.Zoom,this.Offset.Y+f.Position.Y*this.Zoom,f.Height*this.Zoom,f.Width*this.Zoom);this.SelectionBox.IntersectsWith(d)?f.SetSelected(!0,!1):f.SetSelected(!1,!1)})}this.DrawGhostLine(i)},OnMouseUp:function(i){this.isDragging=!1,this.SelectionBoxVisibility=!1},OnWheel:function(i){let t=this.$refs.editor.getBoundingClientRect(),s=i.deltaY*.001,o=this.Zoom;this.Zoom=this.Clamp(this.Zoom-s,this.MinScale,this.MaxScale);let n=new R(i.clientX-t.left,i.clientY-t.top),a=(o-this.Zoom)/o;this.Offset=R.Add(this.Offset,R.Mul(R.Sub(n,this.Offset),a)),this.UpdateOffsetStyle()},DisableContextMenu(i){i.preventDefault()},Clamp:function(i,e,t){return Math.min(Math.max(i,e),t)},DrawGhostLine(i){var f;if(this.dragStore.IsDragging){var e=this.$refs.editor,t=e.getBoundingClientRect();if(i.preventDefault(),t!=null){var s=this.dragStore.SourceTerminal,o=R.Add((f=s.ParentNode)==null?void 0:f.Position,s.OffsetPosition),n=R.Div(new R(i.clientX-t.x-this.Offset.X,i.clientY-t.y-this.Offset.Y),this.Zoom),a=s.IsInput?n:o,l=s.IsInput?o:n;this.points=`${a.X},${a.Y} ${a.X+20},${a.Y} ${l.X-20},${l.Y} ${l.X},${l.Y}`}}}}}),qo=E({...zo,__name:"GraphRenderer",setup(i){return Ot(e=>({v002c6548:e.EditorCursor,v2aba9081:e.SelectionBoxY,v2aba9080:e.SelectionBoxX,v0f8273c2:e.SelectionBoxHeight,v322179ce:e.SelectionBoxWidth,v3f222fda:e.ScaleGridStyle,v4a9860f6:e.OffsetStyle})),(e,t)=>{const s=K("font-awesome-icon"),o=Se("tooltip");return g(),b("div",{class:"graph-renderer dot",ref:"editor",onWheel:t[4]||(t[4]=(...n)=>e.OnWheel&&e.OnWheel(...n)),onMousedown:[t[5]||(t[5]=re((...n)=>e.OnMouseDownLeft&&e.OnMouseDownLeft(...n),["left"])),t[6]||(t[6]=re((...n)=>e.OnMouseDownMiddle&&e.OnMouseDownMiddle(...n),["middle"]))],onContextmenu:re(()=>!1,["prevent","right"]),onDragover:t[7]||(t[7]=re(()=>{},["prevent"])),onDragenter:t[8]||(t[8]=(...n)=>e.dragenter&&e.dragenter(...n)),onDragleave:t[9]||(t[9]=(...n)=>e.dragleave&&e.dragleave(...n)),onDrop:t[10]||(t[10]=(...n)=>e.drop&&e.drop(...n))},[v(dt,{class:"top-left"},{default:I(()=>[v(Ve,null,{default:I(()=>[U((g(),b("a",{onClick:t[0]||(t[0]=n=>e.Undo())},[v(s,{icon:["fas","rotate-left"]})])),[[o,e.$t("tt.undo"),void 0,{bottom:!0}]]),U((g(),b("a",{onClick:t[1]||(t[1]=n=>e.Redo())},[v(s,{icon:["fas","rotate-right"]})])),[[o,e.$t("tt.redo"),void 0,{bottom:!0}]])]),_:1}),v(Ve,null,{default:I(()=>[U((g(),b("a",null,[v(s,{icon:["far","copy"]})])),[[o,e.$t("tt.copy"),void 0,{bottom:!0}]]),U((g(),b("a",null,[v(s,{icon:["far","paste"]})])),[[o,e.$t("tt.paste"),void 0,{bottom:!0}]]),U((g(),b("a",{class:le([{disabled:!e._Graph.HasSelected}]),style:{color:"var(--vt-c-red)"},onClick:t[2]||(t[2]=n=>e._Graph.DeleteSelected())},[v(s,{icon:["far","trash-can"]})],2)),[[o,e.$t("tt.delete"),void 0,{bottom:!0}]])]),_:1}),v(Ve,null,{default:I(()=>[U((g(),b("a",null,[v(s,{icon:["fas","expand"]})])),[[o,e.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),_:1})]),_:1}),v(dt,{class:"bottom-left"},{default:I(()=>[v(Ve,null,{default:I(()=>[V("span",null,[e.Zoom<1?(g(),A(s,{key:0,icon:["fas","magnifying-glass-minus"]})):(g(),A(s,{key:1,icon:["fas","magnifying-glass-plus"]})),O(" "+M((e.Zoom*100).toFixed(0))+"%",1)])]),_:1}),v(Ve,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","up-down-left-right"]}),O(" X: "+M(e.Offset.X.toFixed())+" Y: "+M(e.Offset.Y.toFixed()),1)])]),_:1}),v(Ve,null,{default:I(()=>[U((g(),b("a",{onClick:t[3]||(t[3]=n=>{e.Offset.Reset(),e.Zoom=1,e.UpdateOffsetStyle()})},[v(s,{icon:["fas","arrows-rotate"]})])),[[o,e.$t("tt.resetView")]])]),_:1}),v(Ve,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","circle-info"]}),O(" "+M(e.$t("hints.graphLmb")),1)])]),_:1}),v(Ve,null,{default:I(()=>[V("span",null,[v(s,{icon:["fas","circle-info"]}),O(" "+M(e.$t("hints.graphWheel")),1)])]),_:1})]),_:1}),e.SelectionBoxVisibility?(g(),b("div",Xo)):ee("",!0),V("div",Yo,[v($o,{id:"links-container"},{default:I(()=>[v(xt,{name:"link"},{default:I(()=>[(g(!0),b(q,null,ce(e._Graph.Links,n=>(g(),A(Ro,{key:n.Id,Link:n},null,8,["Link"]))),128))]),_:1}),e.dragStore.IsDragging?(g(),b("polyline",{key:0,class:"ghost-line",points:e.points},null,8,Uo)):ee("",!0)]),_:1}),v(xt,{name:"delete",tag:"div"},{default:I(()=>[(g(!0),b(q,null,ce(e.Nodes,n=>(g(),A(No,{key:n.Id,Offset:e.Offset,Zoom:e.Zoom,Node:n},null,8,["Offset","Zoom","Node"]))),128))]),_:1})],512),e.isDragOver?(g(),b("div",Fo,[V("div",Ho,[V("span",Wo,M(e.$t("hints.placeHere")),1)])])):ee("",!0)],544)}}}),Zo=Y(qo,[["__scopeId","data-v-df584e7d"]]),jo={style:{height:"100%",display:"flex","flex-direction":"row"}},Ko={style:{"margin-left":"5px"}},Jo={style:{"margin-left":"5px"}},Qo=E({__name:"EditorView",setup(i){return(e,t)=>{const s=K("font-awesome-icon");return g(),b("div",jo,[v(et,{style:{width:"20%","min-width":"300px"}},{header:I(()=>[v(s,{icon:["fas","list"]}),t[0]||(t[0]=O()),V("span",Ko,M(e.$t("windows.nodesList")),1)]),default:I(()=>[v(lo)]),_:1}),v(et,{style:{width:"80%"}},{header:I(()=>[v(s,{icon:["fas","circle-nodes"]}),t[1]||(t[1]=O()),V("span",Jo,M(e.$t("windows.graph")),1)]),default:I(()=>[v(Zo)]),_:1})])}}}),en={style:{display:"flex","flex-direction":"row"}},tn={style:{width:"100%","font-weight":"bold","text-align":"left","margin-left":"35px"}},sn={style:{width:"100%","font-weight":"bold","text-align":"right","margin-right":"10px"}},on={style:{width:"10px","margin-right":"10px"}},nn={key:0,class:"dropdown"},an=["onClick"],rn=E({__name:"SelectDropdown",props:{options:{type:Array,required:!1,default:[]},title:{type:String,required:!1,default:""},default:{type:String,required:!1,default:null},modelValue:{type:String,default:""},RealtimeChange:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(i,{emit:e}){const t=i,s=$(t.default?t.default:t.options.length>0?t.options[0]:null),o=$(!1);Xe(()=>t.modelValue,a=>{s.value=a});const n=()=>{var a=he();t.RealtimeChange&&(a.ChangeEvent=!a.ChangeEvent)};return(a,l)=>{const f=K("font-awesome-icon");return g(),b("div",{class:"dropdown-head input-element value",tabindex:"0",onBlur:l[1]||(l[1]=d=>o.value=!1),style:{width:"100%",position:"relative"}},[V("div",{onClick:l[0]||(l[0]=d=>o.value=!o.value),style:{height:"100%"}},[V("div",en,[V("div",tn,M(t.title)+M(t.title==""?"":":"),1),V("div",sn,M(s.value),1),V("div",on,[o.value?(g(),A(f,{key:1,icon:["fas","angle-up"]})):(g(),A(f,{key:0,icon:["fas","angle-down"]}))])])]),o.value?(g(),b("ul",nn,[(g(!0),b(q,null,ce(i.options,(d,c)=>(g(),b("li",{class:le({selected:d==s.value}),key:c,onClick:_=>{s.value=d,o.value=!1,a.$emit("update:modelValue",s.value),n()}},M(d),11,an))),128))])):ee("",!0)],32)}}}),ln=Y(rn,[["__scopeId","data-v-eb9599f8"]]),un=E({__name:"LangSwitch",setup(i){const e=ct(),t=$("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);const s=f=>{e!=null&&(e.appContext.config.globalProperties.$i18n.locale=f,localStorage.setItem("userLang",f),t.value=f)},o=de("langContextMenu"),n=$(),a=f=>{var d;(n!=null||n!=null)&&((d=o.value)==null||d.OpenUnder(n.value))};var l=new Map;return l.set("en","English"),l.set("ru","Русский"),(f,d)=>{const c=K("flag");return g(),b(q,null,[V("button",{ref_key:"langSwitchBtn",ref:n,class:"btn disable-user-select",onClick:a},[v(c,{iso:t.value=="en"?"gb":t.value},null,8,["iso"]),O(" "+M(z(l).get(t.value)),1)],512),v(Ae,{ref:"langContextMenu"},{default:I(()=>[V("button",{class:"btn btnContextMenuPadding",onClick:d[0]||(d[0]=_=>{var h;s("ru"),(h=o.value)==null||h.Close()})},[v(c,{iso:"ru"}),d[2]||(d[2]=O(" Русский",-1))]),V("button",{class:"btn btnContextMenuPadding",onClick:d[1]||(d[1]=_=>{var h;s("en"),(h=o.value)==null||h.Close()})},[v(c,{iso:"gb"}),d[3]||(d[3]=O(" English",-1))])]),_:1},512)],64)}}}),dn=E({__name:"ToggleButton",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const e=pt(i,"modelValue");return(t,s)=>(g(),b("button",{class:le(["btn",{toggled:e.value}]),onClick:s[0]||(s[0]=o=>e.value=!e.value)},[ae(t.$slots,"default",{},void 0,!0)],2))}}),cn=Y(dn,[["__scopeId","data-v-4a53f642"]]),fn=E({__name:"ResolutionSwitcher",setup(i){const e=ct(),t=$("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);var s=he();const o=de("contextMenu"),n=$(),a=_=>{var u,p,y;if(n!=null||n!=null){var h=(u=n.value)==null?void 0:u.getBoundingClientRect();(p=o.value)==null||p.OpenUnder(n.value),h!=null&&((y=o.value)==null||y.SetWidth(h.width))}},l=["0.5K","1K","2K","4K","8K"],f=[512,1024,2048,4096,8192],d=$(0),c=_=>{d.value=_;var h=s.GetRenderer();h!=null&&(h.ChangeResolution(f[_]),requestAnimationFrame(()=>h==null?void 0:h.Render()))};return(_,h)=>{const u=K("font-awesome-icon"),p=Se("tooltip");return g(),b(q,null,[U((g(),b("button",{ref_key:"switcher",ref:n,class:"btn disable-user-select",onClick:a},[v(u,{icon:["fas","vector-square"]}),O(" "+M(l[d.value])+" ",1),v(u,{icon:["fas","angle-down"]})])),[[p,_.$t("tt.mesh_resolution"),void 0,{bottom:!0}]]),v(Ae,{ref_key:"contextMenu",ref:o},{default:I(()=>[(g(),b(q,null,ce(l,(y,w)=>(g(),b(q,null,[w>2?U((g(),A(ne,{key:0,class:"waringText",Active:w==d.value,onClick:S=>{var C;c(w),(C=o.value)==null||C.Close()}},{default:I(()=>[v(u,{icon:["fas","vector-square"]}),O(" "+M(y),1)]),_:2},1032,["Active","onClick"])),[[p,{content:_.$t("tt.resolutionWarning"),html:!0,distance:15},void 0,{right:!0}]]):(g(),A(ne,{key:1,Active:w==d.value,onClick:S=>{var C;c(w),(C=o.value)==null||C.Close()}},{default:I(()=>[v(u,{icon:["fas","vector-square"]}),O(" "+M(y),1)]),_:2},1032,["Active","onClick"]))],64))),64))]),_:1},512)],64)}}}),$t=Y(fn,[["__scopeId","data-v-97dd3ce3"]]),hn={style:{height:"100%",width:"100%",position:"relative"}},pn=["value"],vn=E({__name:"ProjectNameEditor",props:Ze({modelValue:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:Ze(["update:modelValue"],["update:modelValue"]),setup(i,{emit:e}){const t=pt(i,"modelValue"),s=e,o=$(!1),n=$(),a=$(),l=()=>{o.value=!0,me(()=>{var _;a.value=t.value,(_=n.value)==null||_.focus()})},f=_=>{s("update:modelValue",a.value),o.value=!1},d=_=>{_.target!=null&&(a.value=_.target.value,s("update:modelValue",a.value))},c=_=>{_.key=="Enter"&&(_.target!=null&&(a.value=_.target.value,s("update:modelValue",a.value)),o.value=!1)};return(_,h)=>{const u=K("font-awesome-icon"),p=Se("tooltip");return g(),b("div",hn,[o.value?(g(),b("input",{key:0,ref_key:"input",ref:n,onFocusout:f,onInput:d,onKeypress:c,class:"editor",value:t.value},null,40,pn)):U((g(),b("div",{key:1,class:"label",onClick:l},[O(M(t.value),1)])),[[p,_.$t("tt.clickForEdit"),void 0,{bottom:!0}]]),v(u,{class:"icon",icon:["fas","pen"]})])}}}),mn=Y(vn,[["__scopeId","data-v-7b27f16a"]]),gn={class:"modal-container"},wn={class:"modal-header"},yn={class:"title"},_n={key:0,class:"closeButton"},Vn={class:"modal-slot"},bn={class:"modal-footer"},Sn=E({__name:"Modal",props:{closeButton:{type:Boolean,default:!0}},setup(i,{expose:e}){const t=i,s=$(!1);return e({Open:()=>{s.value=!0},Close:()=>{s.value=!1}}),(a,l)=>{const f=K("font-awesome-icon");return s.value?(g(),b("div",{key:0,class:"modal-back",onClick:l[2]||(l[2]=d=>s.value=!1)},[V("div",{class:"modal-main",onClick:l[1]||(l[1]=re(()=>{},["stop"]))},[V("div",gn,[V("div",wn,[V("div",yn,[ae(a.$slots,"title",{},void 0,!0)]),l[3]||(l[3]=V("div",{style:{width:"100%"}},null,-1)),t.closeButton?(g(),b("div",_n,[V("button",{class:"btn",style:{margin:"0"},onClick:l[0]||(l[0]=d=>s.value=!1)},[v(f,{icon:"fa-solid fa-xmark"})])])):ee("",!0)]),V("div",Vn,[ae(a.$slots,"default",{},void 0,!0)]),V("div",bn,[ae(a.$slots,"footer",{},void 0,!0)])])])])):ee("",!0)}}}),St=Y(Sn,[["__scopeId","data-v-56059a2a"]]),Cn={style:{display:"flex"}},xn={style:{"margin-left":"0"},class:"btn btn-green footer-btn"},Pn=E({__name:"SettingsModal",setup(i,{expose:e}){const t=de("settingsModal");return e({Open:()=>{var o;(o=t.value)==null||o.Open()}}),(o,n)=>{const a=K("font-awesome-icon");return g(),A(St,{ref_key:"settingsModal",ref:t},{title:I(()=>[v(a,{icon:["fas","gear"]}),O(" "+M(o.$t("tt.settings")),1)]),footer:I(()=>[V("div",Cn,[V("button",xn,[v(a,{icon:["fas","floppy-disk"]}),O(" "+M(o.$t("tt.saveSettings")),1)]),V("button",{class:"btn btn-red footer-btn",onClick:n[0]||(n[0]=l=>{var f;return(f=t.value)==null?void 0:f.Close()})},[v(a,{icon:"fa-solid fa-circle-xmark"}),O(" "+M(o.$t("tt.cancel")),1)])])]),_:1},512)}}}),Nn={class:"container"},kn={class:"node-name"},In={class:"file-name"},Mn=E({__name:"ExportInput",props:{node:{type:De,required:!0}},setup(i){var d,c;const{t:e}=Qt({useScope:"global"});var t=i;const s=de("contextMenu"),o=$(),n=_=>{var h;console.log("Open"),(o!=null||o!=null)&&((h=s.value)==null||h.OpenUnder(o.value))},a=_=>{var h;t.node.SetBuildType(_),(h=s.value)==null||h.Close()},l=new Map([[ie.PNG8,"PNG8"],[ie.PNG16,"PNG16"],[ie.RAW16,"RAW16"],[ie.RAW32,"RAW32"],[ie.EXR,"EXR"],[ie.TIFF16,"TIFF16"],[ie.TIFF32,"TIFF32"]]),f=$(t.node.InputTermianl!=null?(c=(d=t.node.InputTermianl)==null?void 0:d.ParentNode)==null?void 0:c.Name:"");return(t.node.ExportFileName===""||t.node.ExportFileName==null)&&t.node.SetFileName(e(f.value).replace(" ","_")),(_,h)=>{const u=K("font-awesome-icon");return g(),b("div",Nn,[V("div",kn,M(_.$t(f.value))+":",1),V("div",In,[U(V("input",{type:"text","onUpdate:modelValue":h[0]||(h[0]=p=>z(t).node.ExportFileName=p)},null,512),[[es,z(t).node.ExportFileName]])]),V("button",{onClick:n,ref_key:"contextMenuButton",ref:o,class:"format"},[O(M(z(l).get(z(t).node.BuildType))+" ",1),v(u,{icon:["fas","angle-down"]})],512),v(Ae,{ref_key:"contextMenu",ref:s},{default:I(()=>[(g(!0),b(q,null,ce(z(l),p=>(g(),A(ne,{Active:p[0]==z(t).node.BuildType,onClick:y=>a(p[0])},{default:I(()=>[O(M(p[1]),1)]),_:2},1032,["Active","onClick"]))),256))]),_:1},512)])}}}),$n=Y(Mn,[["__scopeId","data-v-c22a8625"]]);class On{static DownloadArray(e,t){const s=new Blob([e],{type:"application/octet-stream"}),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=t,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(o)},100)}static DownloadBlob(e,t){const s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(s)},100)}}const Ln={class:"tabs-container"},Rn={class:"tabs"},Dn={key:0,class:"input-container"},Tn={style:{display:"flex"}},Bn=["disabled"],An=E({__name:"BuildModal",setup(i,{expose:e}){const t=de("buildModal"),s=()=>{var u;(u=t.value)==null||u.Open(),l()},o=$(0);var n=fe(),a=$();const l=()=>{n.CurrentGraph!=null&&(a.value=Ye(n.CurrentGraph.Nodes).where(u=>u instanceof De&&u.InputTermianl!=null).toArray())},f=new Map([[ie.PNG8,".png"],[ie.PNG16,".png"],[ie.RAW16,".raw"],[ie.RAW32,".raw"],[ie.EXR,".exr"],[ie.TIFF16,".tiff"],[ie.TIFF32,".tiff"]]);var d=new ts;const c=$(4096),_=$(!1),h=async()=>{_.value=!0;var u=he(),p=u.GetRenderer();if(p!=null){var y=new _o(p.GPURenderer,c.value);if(a.value!=null&&a.value.length!=0){for(var w of a.value){var S=w,C=await y.Build(S);d.file(S.ExportFileName+f.get(S.BuildType),C)}var D=await d.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});On.DownloadBlob(D,"build.zip")}}_.value=!1};return e({Open:s}),(u,p)=>{const y=K("font-awesome-icon");return g(),A(St,{ref:"buildModal"},{title:I(()=>[v(y,{icon:"fa-solid fa-hammer"}),O(" "+M(u.$t("tt.buildSettings")),1)]),footer:I(()=>[V("div",Tn,[V("button",{style:{"margin-left":"0"},class:"btn btn-green footer-btn",onClick:p[5]||(p[5]=w=>h()),disabled:_.value},[v(y,{icon:"fa-solid fa-hammer"}),O(" "+M(u.$t("tt.build")),1)],8,Bn),V("button",{class:"btn btn-red footer-btn",onClick:p[6]||(p[6]=w=>{var S;return(S=t.value)==null?void 0:S.Close()})},[v(y,{icon:"fa-solid fa-circle-xmark"}),O(" "+M(u.$t("tt.cancel")),1)])])]),default:I(()=>[V("div",Ln,[V("div",Rn,[V("button",{onClick:p[0]||(p[0]=w=>o.value=0),class:le(["tab-item",{"tab-item-active":o.value==0}])},[v(y,{icon:["fas","vector-square"]}),O(" "+M(u.$t("buildModal.resolution")),1)],2),V("button",{onClick:p[1]||(p[1]=w=>o.value=1),class:le(["tab-item",{"tab-item-active":o.value==1}]),disabled:""},[v(y,{icon:"fa-solid fa-border-all"}),O(" "+M(u.$t("buildModal.tiles"))+" ",1),v(y,{icon:"fa-solid fa-triangle-exclamation"})],2),V("button",{onClick:p[2]||(p[2]=w=>o.value=2),class:le(["tab-item",{"tab-item-active":o.value==2}])},[v(y,{icon:"fa-solid fa-mountain"}),O(" "+M(u.$t("buildModal.terrain")),1)],2),V("button",{onClick:p[3]||(p[3]=w=>o.value=3),class:le(["tab-item",{"tab-item-active":o.value==3}])},[v(y,{icon:"fa-solid fa-hammer"}),O(" "+M(u.$t("buildModal.build")),1)],2),V("button",{onClick:p[4]||(p[4]=w=>o.value=4),class:le(["tab-item",{"tab-item-active":o.value==4}])},[v(y,{icon:"fa-solid fa-circle-nodes"}),O(" "+M(u.$t("buildModal.nodes")),1)],2)]),o.value==4?(g(),b("div",Dn,[(g(!0),b(q,null,ce(z(a),w=>(g(),A($n,{node:w},null,8,["node"]))),256))])):ee("",!0)]),_.value?(g(),A(Wt,{key:0,style:{scale:"3"}})):ee("",!0)]),_:1},512)}}}),Gn=Y(An,[["__scopeId","data-v-d84eb0ee"]]),En={style:{display:"flex"}},Xn={style:{"margin-left":"0"},class:"btn btn-green footer-btn"},Yn=E({__name:"OpenModal",setup(i,{expose:e}){const t=de("openModal");return e({Open:()=>{var o;(o=t.value)==null||o.Open()}}),(o,n)=>{const a=K("font-awesome-icon");return g(),A(St,{ref_key:"openModal",ref:t},{title:I(()=>[v(a,{icon:["fas","folder-open"]}),O(" "+M(o.$t("tt.load")),1)]),footer:I(()=>[V("div",En,[V("button",Xn,[v(a,{icon:["fas","folder-open"]}),O(" "+M(o.$t("tt.load")),1)]),V("button",{class:"btn btn-red footer-btn",onClick:n[0]||(n[0]=l=>{var f;return(f=t.value)==null?void 0:f.Close()})},[v(a,{icon:"fa-solid fa-circle-xmark"}),O(" "+M(o.$t("tt.cancel")),1)])])]),_:1},512)}}}),Un={style:{"margin-left":"auto",right:"0px",height:"100%","white-space":"nowrap",overflow:"hidden"}},Fn={class:"btn"},Hn={class:"btn"},Wn={class:"btn"},zn={class:"btn"},qn={class:"btn"},Zn={class:"btn"},jn=550,Kn=E({__name:"ActionButtonsBar",setup(i){const e=$(),t=de("contextMenu"),s=$(),o=$(),n=fe(),a=de("settingsModal"),l=de("buildModal"),f=de("openModal"),d=h=>{var u;(s!=null||s!=null)&&((u=t.value)==null||u.OpenUnder(s.value))},c=()=>{var p;var h=(p=e.value)==null?void 0:p.getBoundingClientRect();if(h!=null){var u=h==null?void 0:h.width;u!=null&&u<jn?o.value=!0:o.value=!1}};Ue(()=>{me(()=>{c(),window.addEventListener("resize",()=>{c()})})});const _=()=>{if(n.CurrentGraph!=null){var h=Re.Serialize(n.CurrentGraph),u=JSON.stringify(h),p=document.createElement("a"),y=new Blob([u],{type:"text/plain"});p.href=URL.createObjectURL(y),p.download="untitled.json",p.click()}};return(h,u)=>{const p=K("font-awesome-icon"),y=K("font-awesome-layers"),w=Se("tooltip");return g(),b(q,null,[V("div",{ref_key:"menuContainer",ref:e,style:{display:"flex",height:"100%",width:"100%","white-space":"nowrap",overflow:"hidden"}},[V("div",Un,[o.value?(g(),b(q,{key:0},[v($t),u[12]||(u[12]=V("div",{class:"separator"},null,-1)),U((g(),b("button",{onClick:d,ref_key:"contextMenuButton",ref:s,class:"btn"},[v(p,{icon:["fas","fa-bars"]})])),[[w,h.$t("tt.menu"),void 0,{bottom:!0}]]),v(Ae,{ref_key:"contextMenu",ref:t},{default:I(()=>[v(ne,null,{default:I(()=>[v(p,{icon:["fas","file"]}),O(" "+M(h.$t("tt.new")),1)]),_:1}),v(ne,null,{default:I(()=>[v(p,{icon:["fas","floppy-disk"]}),O(" "+M(h.$t("tt.save")),1)]),_:1}),v(ne,{onClick:u[0]||(u[0]=S=>{var C,D;(C=f.value)==null||C.Open(),(D=t.value)==null||D.Close()})},{default:I(()=>[v(p,{icon:["fas","folder-open"]}),O(" "+M(h.$t("tt.load")),1)]),_:1}),u[8]||(u[8]=V("hr",null,null,-1)),v(ne,null,{default:I(()=>[v(p,{icon:["fas","rotate-left"]}),O(" "+M(h.$t("tt.undo")),1)]),_:1}),v(ne,null,{default:I(()=>[v(p,{icon:["fas","rotate-right"]}),O(" "+M(h.$t("tt.redo")),1)]),_:1}),u[9]||(u[9]=V("hr",null,null,-1)),v(ne,{onClick:u[1]||(u[1]=S=>{var C,D;(C=a.value)==null||C.Open(),(D=t.value)==null||D.Close()})},{default:I(()=>[v(p,{icon:["fas","gear"]}),O(" "+M(h.$t("tt.settings")),1)]),_:1}),u[10]||(u[10]=V("hr",null,null,-1)),v(ne,{onClick:u[2]||(u[2]=S=>{var C,D;(C=l.value)==null||C.Open(),(D=t.value)==null||D.Close()})},{default:I(()=>[v(y,{style:{width:"20px"}},{default:I(()=>[v(p,{icon:"fa-solid fa-hammer"}),v(p,{icon:["fas","gear"],transform:"shrink-8 left-8 up-6"})]),_:1}),O(" "+M(h.$t("tt.buildSettings")),1)]),_:1}),v(ne,{onClick:u[3]||(u[3]=S=>{var C;return(C=t.value)==null?void 0:C.Close()})},{default:I(()=>[v(p,{icon:"fa-solid fa-hammer"}),O(" "+M(h.$t("tt.build")),1)]),_:1}),u[11]||(u[11]=V("hr",null,null,-1)),v(ne,null,{default:I(()=>[v(p,{icon:["fas","expand"]}),O(" "+M(h.$t("tt.fullscreen")),1)]),_:1})]),_:1},512),u[13]||(u[13]=V("div",{class:"separator"},null,-1)),U((g(),b("button",Fn,[v(p,{icon:["fas","rotate-left"]})])),[[w,h.$t("tt.undo"),void 0,{bottom:!0}]]),U((g(),b("button",Hn,[v(p,{icon:["fas","rotate-right"]})])),[[w,h.$t("tt.redo"),void 0,{bottom:!0}]])],64)):(g(),b(q,{key:1},[v($t),u[14]||(u[14]=V("div",{class:"separator"},null,-1)),U((g(),b("button",Wn,[v(p,{icon:["fas","file"]})])),[[w,h.$t("tt.new"),void 0,{bottom:!0}]]),U((g(),b("button",{onClick:u[4]||(u[4]=S=>_()),class:"btn"},[v(p,{icon:["fas","floppy-disk"]})])),[[w,h.$t("tt.save"),void 0,{bottom:!0}]]),U((g(),b("button",{onClick:u[5]||(u[5]=S=>{var C;return(C=f.value)==null?void 0:C.Open()}),class:"btn"},[v(p,{icon:["fas","folder-open"]})])),[[w,h.$t("tt.load"),void 0,{bottom:!0}]]),u[15]||(u[15]=V("div",{class:"separator"},null,-1)),U((g(),b("button",zn,[v(p,{icon:["fas","rotate-left"]})])),[[w,h.$t("tt.undo"),void 0,{bottom:!0}]]),U((g(),b("button",qn,[v(p,{icon:["fas","rotate-right"]})])),[[w,h.$t("tt.redo"),void 0,{bottom:!0}]]),u[16]||(u[16]=V("div",{class:"separator"},null,-1)),U((g(),b("button",{onClick:u[6]||(u[6]=S=>{var C;return(C=a.value)==null?void 0:C.Open()}),class:"btn"},[v(p,{icon:["fas","gear"]})])),[[w,h.$t("tt.settings"),void 0,{bottom:!0}]]),u[17]||(u[17]=V("div",{class:"separator"},null,-1)),U((g(),b("button",{onClick:u[7]||(u[7]=S=>{var C;return(C=l.value)==null?void 0:C.Open()}),class:"btn"},[v(y,{style:{width:"20px"}},{default:I(()=>[v(p,{icon:"fa-solid fa-hammer"}),v(p,{icon:["fas","gear"],transform:"shrink-8 left-8 up-6"})]),_:1})])),[[w,h.$t("tt.buildSettings"),void 0,{bottom:!0}]]),U((g(),b("button",Zn,[v(p,{style:{color:"var(--vt-c-green)"},icon:"fa-solid fa-hammer"})])),[[w,h.$t("tt.build"),void 0,{bottom:!0}]]),u[18]||(u[18]=V("div",{class:"separator"},null,-1)),U((g(),A(cn,null,{default:I(()=>[v(p,{icon:["fas","expand"]})]),_:1})),[[w,h.$t("tt.fullscreen"),void 0,{bottom:!0}]])],64))])],512),v(Pn,{ref_key:"settingsModal",ref:a},null,512),v(Gn,{ref_key:"buildModal",ref:l},null,512),v(Yn,{ref_key:"openModal",ref:f},null,512)],64)}}}),Jn=Y(Kn,[["__scopeId","data-v-9c8ae11b"]]),Qn={class:"disable-user-select left-section",style:{display:"flex","flex-direction":"row"}},ei={class:"logo disable-user-select",style:{"text-transform":"uppercase"}},ti={class:"padding"},si={class:"middle-actions",style:{}},oi={style:{display:"flex","flex-direction":"row"}},ni=E({__name:"MainMenuBar",setup(i){const e=$(!1);Xe(e,(s,o)=>{s?document.documentElement.requestFullscreen():document.exitFullscreen()});const t=$("Untitled");return(s,o)=>(g(),b("div",{class:"main",onContextmenu:o[1]||(o[1]=re(()=>{},["prevent"]))},[V("div",Qn,[V("div",ei,M(s.$t("logo")),1),v(Jn)]),V("div",ti,[V("div",si,[v(mn,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=n=>t.value=n)},null,8,["modelValue"])])]),V("div",oi,[v(un)])],32))}}),ii=Y(ni,[["__scopeId","data-v-58738f50"]]),ai={style:{display:"flex"}},ri=["value","placeholder"],li=E({__name:"ContextMenuInput",props:Ze({Active:{type:Boolean,default:!1},Placeholder:{type:String,default:""},modelValue:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:Ze(["update:modelValue"],["update:modelValue"]),setup(i,{emit:e}){var t=i;const s=pt(i,"modelValue"),o=e,n=$(),a=d=>{o("update:modelValue",n.value)},l=d=>{d.target!=null&&(n.value=d.target.value,o("update:modelValue",n.value))},f=d=>{d.key=="Enter"&&d.target!=null&&(n.value=d.target.value,o("update:modelValue",n.value))};return(d,c)=>(g(),b("div",ai,[V("input",{onFocusout:a,onInput:l,onKeypress:f,value:s.value,class:le([{active:i.Active}]),placeholder:z(t).Placeholder,style:{padding:"5px"}},null,42,ri),ae(d.$slots,"default",{},void 0,!0)]))}}),ui=Y(li,[["__scopeId","data-v-a59750ae"]]),di={ref:"inputRange",class:"input-range"},ci=["value"],fi={class:"title"},hi={class:"valueText"},pi=E({props:{Min:Number,Max:Number,Suffix:String,Title:String,RealtimeChange:{type:Boolean,default:!0},Step:{type:Number,default:0},modelValue:{type:Number,default:0}},emits:["update:modelValue"],data(){return{IsDragging:!1,Value:0,lastPosition:new R(0,0),lastValue:0,IsInputVisible:!1,moveDistance:0}},created(){document.addEventListener("mousemove",this.OnMouseMove),document.addEventListener("mouseup",this.OnMouseUp),this.Value=this.modelValue},watch:{modelValue(i,e){this.Value=i}},methods:{ClickValue(i){this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+i,this.Min,this.Max):this.Value=this.Clamp(this.Value+(i>0?this.Step:-this.Step),this.Min,this.Max):this.Step==0?this.Value+=i:this.Value+=i>0?this.Step:-this.Step,this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnInput(i){this.Value=Number(i.target.value),this.Min!=null&&this.Max!=null&&(this.Value=this.Clamp(this.Value,this.Min,this.Max)),this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnMouseDown(i){this.IsInputVisible||(this.$el.requestPointerLock(),this.IsDragging=!0,this.lastPosition=new R(i.clientX,i.clientY),this.lastValue=this.Value,this.moveDistance=0)},OnMouseMove(i){this.IsDragging&&(this.moveDistance+=i.movementX,this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+i.movementX/(i.shiftKey?25:50),this.Min,this.Max):i.movementX!=0&&Math.abs(this.moveDistance)>=(i.shiftKey?25:50)&&(this.moveDistance=0,this.Value=this.Clamp(this.Value+(i.movementX>0?this.Step:-this.Step),this.Min,this.Max)):this.Step==0?this.Value+=i.movementX/(i.shiftKey?25:50):i.movementX!=0&&Math.abs(this.moveDistance)>=(i.shiftKey?25:50)&&(this.moveDistance=0,this.Value+=i.movementX>0?this.Step:-this.Step),this.$emit("update:modelValue",this.Value),this.UpdateEvent())},OnMouseUp(i){var e=new R(i.clientX,i.clientY);e.X==this.lastPosition.X&&e.Y==this.lastPosition.Y&&this.Value==this.lastValue&&(this.IsInputVisible=!0,this.$nextTick(()=>{var t=this.$refs.input;t.focus(),t.select()})),this.IsDragging=!1,document.exitPointerLock()},UpdateEvent(){var i=he();this.RealtimeChange&&(i.ChangeEvent=!i.ChangeEvent)},validate(i){i.key=="Enter"&&i.target.blur();var e=/[0-9-]|\./;e.test(i.key)||i.preventDefault()},Clamp(i,e,t){return Math.min(Math.max(i,e),t)}}}),vi=E({...pi,__name:"InputRange",setup(i){return(e,t)=>{const s=K("font-awesome-icon");return g(),b("div",di,[V("div",{class:"button",onClick:t[0]||(t[0]=o=>e.ClickValue(-.1))},[v(s,{icon:["fas","caret-left"]})]),V("div",{class:"value",onMousedown:t[4]||(t[4]=re((...o)=>e.OnMouseDown&&e.OnMouseDown(...o),["left"]))},[e.IsInputVisible?(g(),b("input",{key:0,onKeypress:t[1]||(t[1]=(...o)=>e.validate&&e.validate(...o)),ref:"input",class:"input-element",value:e.modelValue,onInput:t[2]||(t[2]=(...o)=>e.OnInput&&e.OnInput(...o)),onBlur:t[3]||(t[3]=o=>e.IsInputVisible=!1)},null,40,ci)):(g(),b(q,{key:1},[V("div",fi,M(e.Title)+": ",1),V("div",hi,M(Number(e.Value.toFixed(4)))+" "+M(e.Suffix),1)],64))],32),V("div",{class:"button",onClick:t[5]||(t[5]=o=>e.ClickValue(.1))},[v(s,{icon:["fas","caret-right"]})])],512)}}}),mi=Y(vi,[["__scopeId","data-v-5ba96ddd"]]);class it{constructor(){r(this,"Name");r(this,"Node");r(this,"Values")}static SavePreset(e){var t=localStorage.getItem("presets");if(t!=null){var s=JSON.parse(t),o=Ye(s).firstOrDefault(a=>a.Node==e.Node&&a.Name==e.Name);if(o!=null){var n=s.indexOf(o);s.splice(n,1)}s.push(e),localStorage.setItem("presets",JSON.stringify(s))}else{var s=new Array;s.push(e),localStorage.setItem("presets",JSON.stringify(s))}}static GetPresets(){var e=localStorage.getItem("presets");return e!=null?JSON.parse(e):new Array}}const gi={class:"properties"},wi={key:0,class:"not-selected"},yi={class:"header"},_i={style:{width:"100%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Vi={class:"buttons",style:{display:"flex","font-weight":"bold"}},bi={key:0},Si={key:0,style:{margin:"0px 10px"}},Ci={class:"input-group",style:{width:"100%",padding:"0px"}},xi={key:1,style:{padding:"10px"}},Pi={class:"notice"},Ni=E({__name:"PropertiesView",setup(i){const e=fe(),t=ue(()=>e.SelectedNode),s=ue(()=>e.SelectedNode==null||e.SelectedNode instanceof Ne),o=$(),n=ue(()=>{var y;return l((y=t.value)==null?void 0:y.Properties)}),a=()=>{if(e.SelectedNode!=null&&e.SelectedNode!=null&&e.SelectedNode){for(var y of e.SelectedNode.Properties)y.Reset();var w=he();w.ChangeEvent=!w.ChangeEvent}};var l=y=>{var w=new Map;return y==null||y.length==0||y.forEach(S=>{var C;w.has(S.Category)||w.set(S.Category,new Array),(C=w.get(S.Category))==null||C.push(S)}),w};const f=de("presetsContextMenu"),d=$(),c=y=>{var D;if(d!=null||d!=null){if(t.value!=null){var w=t.value.Name,S=it.GetPresets(),C=Ye(S).where(F=>F.Node==w).toArray();o.value=C}(D=f.value)==null||D.OpenUnder(d.value)}},_=$(""),h=()=>{var C,D;if(t.value!=null&&!(_.value==""||_.value==null)){var y=t.value.Properties,w=new it,S=new Array;y.forEach(F=>{S.push(F.Value)}),w.Name=_.value,w.Node=t.value.Name,w.Values=S,(C=o.value)==null||C.push(w),it.SavePreset(w),(D=f.value)==null||D.Close(),_.value=""}},u=y=>{var w;s.value||(t.value.Properties.forEach((S,C)=>{S.Value=y.Values[C]}),(w=f.value)==null||w.Close(),p())},p=()=>{var y=he();t.value.IsRealtimeUpdate&&(y.ChangeEvent=!y.ChangeEvent)};return(y,w)=>{var D;const S=K("font-awesome-icon"),C=Se("tooltip");return g(),b("div",gi,[s.value?(g(),b("div",wi,[v(S,{icon:["fas","sliders"]})])):ee("",!0),s.value?ee("",!0):(g(),b(q,{key:1},[V("div",yi,[V("div",_i,M(y.$t((D=t.value)==null?void 0:D.Name)),1),V("div",Vi,[U((g(),b("button",{ref_key:"presetsButton",ref:d,onClick:c,class:"btn"},[v(S,{icon:["fas","sliders"]})])),[[C,y.$t("tt.presets"),void 0,{bottom:!0}]]),U((g(),b("button",{class:"btn",onClick:a},[v(S,{icon:["fas","arrows-rotate"]})])),[[C,y.$t("tt.resetParams"),void 0,{bottom:!0}]]),v(Ae,{ref_key:"presetsContextMenu",ref:f},{default:I(()=>{var F;return[(g(!0),b(q,null,ce(o.value,oe=>(g(),A(ne,{onClick:H=>u(oe)},{default:I(()=>[v(S,{icon:["fas","sliders"]}),O(" "+M(oe.Name),1)]),_:2},1032,["onClick"]))),256)),((F=o.value)==null?void 0:F.length)>0?(g(),b("hr",bi)):ee("",!0),v(ui,{modelValue:_.value,"onUpdate:modelValue":w[0]||(w[0]=oe=>_.value=oe),Placeholder:"New preset name..."},{default:I(()=>[V("button",{onClick:h,class:"btn",style:{padding:"6px"}},[v(S,{icon:"fa-solid fa-circle-plus"})])]),_:1},8,["modelValue"])]}),_:1},512)])]),t.value.Name?(g(),b("hr",Si)):ee("",!0),(g(!0),b(q,null,ce(n.value,([F,oe])=>(g(),A(Ft,{style:{"background-color":"transparent",padding:"0px"}},{header:I(()=>[O(M(F),1)]),default:I(()=>[V("div",Ci,[(g(!0),b(q,null,ce(oe,H=>(g(),b(q,null,[typeof H.Value=="number"?(g(),A(mi,{key:0,modelValue:H.Value,"onUpdate:modelValue":k=>H.Value=k,Min:H.Min,Max:H.Max,Step:H.Step,Suffix:H.Suffix,Title:H.Name},null,8,["modelValue","onUpdate:modelValue","Min","Max","Step","Suffix","Title"])):ee("",!0),H.valueList!=null?(g(),A(ln,{key:1,modelValue:H.Value,"onUpdate:modelValue":k=>H.Value=k,default:H.Value,title:H.Name,options:H.valueList},null,8,["modelValue","onUpdate:modelValue","default","title","options"])):ee("",!0)],64))),256))])]),_:2},1024))),256)),t.value.IsRealtimeUpdate==!1?(g(),b("div",xi,[w[2]||(w[2]=V("button",{class:"btn apply-btn"}," Apply changes ",-1)),V("div",Pi,[v(S,{icon:["fas","circle-exclamation"]}),w[1]||(w[1]=O(' This node performs a heavy operation, so the update occurs when you click the "Apply Changes" button and is cached. ',-1))])])):ee("",!0)],64))])}}}),ki=Y(Ni,[["__scopeId","data-v-10cf94de"]]);class Ii{constructor(){r(this,"GridMaterial");r(this,"GridMesh");const e=m(.5).toVar(),t=m(5).toVar(),s=m(1*window.devicePixelRatio).toVar(),o=m(500).toVar(),n=m(200).toVar(),a=at(.2,.2,.2,.2).toVar(),l=at(.05,.05,.05,.2).toVar(),f=gs,d=ws,c=T(([B,Q])=>{const W=rt(B,Q),te=Te(j(be(j(W,.5)),.5)),ve=rt(te,At(W));return _e(ve.x,ve.y)}),_=c(f.xz,e),h=c(f.xz,t),u=j(1,Ee(0,s,_)),p=j(1,Ee(0,s,h)),y=j(f,d),w=bt(y),S=Ee(m(o),m(0),w),C=Ee(m(n),m(0),w),D=se(a,se(u,C)).toVar(),F=se(l,se(p,S)).toVar(),oe=ys(F,D),H=new Gt;H.colorNode=oe,H.transparent=!0,H.side=He,H.lights=!1;const k=new tt(1e3,1e3,1,1);k.rotateX(-Math.PI/2);const L=new Fe(k,H);this.GridMesh=L,this.GridMaterial=H}}class Mi{constructor(){r(this,"Mesh");const e=T(([n,a,l])=>{const f=x(n.x,n.y).toVar(),d=x(Te(f.mul(2).sub(1)).sub(x(a,l))).toVar();return d.assign(m(1).sub(d.div(At(d)))),_s(_e(d.x,d.y))});var t=new wt({color:"#fff",transparent:!0,side:He});t.colorNode=T(()=>{const n=e(Le(),1,1).toVar(),a=e(Le(),.9,1).toVar(),l=e(Le(),1,.9).toVar(),f=e(Le(),.98,.98).toVar(),d=Me(0,1,n.sub(a).sub(l).sub(f)).toVar();return at(.8,.8,.8,d)})();var s=new tt(1,1,1,1);s.rotateX(-Math.PI/2);var o=new Fe(s,t);o.castShadow=!1,o.receiveShadow=!1,o.scale.set(10,1,10),o.position.set(0,.005,0),this.Mesh=o}}class $i{static async Generate(e=1,t=1,s=1,o=1){var n=new Vs;const a=e/2,l=t/2,f=Math.floor(s),d=Math.floor(o),c=f+1,_=d+1,h=e/f,u=t/d,p=c*_,y=f*d*6,w=p*2,S=new Float32Array(p*3),C=new Float32Array(p*3),D=new Float32Array(w),F=new Uint32Array(y);let oe=0,H=0,k=0;for(let B=0;B<_;B++){const Q=B*u-l;for(let W=0;W<c;W++){const te=W*h-a;S[oe]=te,S[oe+1]=-Q,S[oe+2]=0,oe+=3,C[k]=0,C[k+1]=0,C[k+2]=1,k+=3,D[H]=W/f,D[H+1]=1-B/d,H+=2}B%1e4===0&&await new Promise(W=>setTimeout(W,0))}let L=0;for(let B=0;B<d;B++){for(let Q=0;Q<f;Q++){const W=Q+c*B,te=Q+c*(B+1),ve=Q+1+c*(B+1),Ge=Q+1+c*B;F[L++]=W,F[L++]=te,F[L++]=Ge,F[L++]=te,F[L++]=ve,F[L++]=Ge}B%1e4===0&&await new Promise(Q=>setTimeout(Q,0))}return n.setIndex(new We(F,1)),n.setAttribute("position",new We(S,3)),n.setAttribute("normal",new We(C,3)),n.setAttribute("uv",new We(D,2)),n}}class Oi{constructor(){r(this,"Height",2);r(this,"GPURenderer");r(this,"HeightTexture");r(this,"TerrainMaterial");r(this,"IsMeshGenerated",$(!0));r(this,"Scene");r(this,"Camera");r(this,"Controls");r(this,"TerrainMesh");r(this,"GridMesh");r(this,"DirectionalLight");r(this,"DirectionalLight2");r(this,"_resolution",512);r(this,"_textureResolution",512);r(this,"_canvas");r(this,"_isColorized",!1);this.CreateRenderer(),this.Scene=new gt,this.Scene.environmentNode=bs("#ffffff"),this.Scene.environmentIntensity=.05,this.Camera=new Ss(75,1,.01,1e3),this.Camera.position.z=10,this.Camera.position.y=10,this.CreateMaterial(),this.CreateTexture(this._resolution),this.CreateTerrainMesh(this.Resolution),this.CreateLight();const e=new Ii;this.GridMesh=e.GridMesh,this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2),this.Scene.add(this.GridMesh);var t=new Mi;this.Scene.add(t.Mesh);const s=he();s.SetRenderer(this),s.Resolution=this.Resolution}get Resolution(){return this._resolution}get TextureResolution(){return this._textureResolution}CreateMaterial(){this.TerrainMaterial=new Gt({color:"#a2a2a2"}),this.TerrainMaterial.side=He,this.TerrainMaterial.needsUpdate=!0,this.TerrainMaterial.metalness=0,this.TerrainMaterial.roughness=1,this.TerrainMaterial.positionNode=T(()=>{const e=m(1/this.Resolution),t=m(1).sub(e).toVar(),s=Oe.xyz.toVar(),o=ye(this.HeightTexture,Oe.xz.add(.5).mul(t)).mul(this.Height);return s.y.addAssign(o),s})(),this.TerrainMaterial.normalNode=T(()=>{const e=m(1/this.TextureResolution).toVar(),t=m(1).sub(e).toVar(),s=Oe.xyz.add(Pt(e,0,0)).toVar(),o=Oe.xyz.add(Pt(0,0,e.negate())).toVar(),n=Oe.xyz.toVar(),a=ye(this.HeightTexture,Oe.xz.add(.5).mul(t)).mul(this.Height);n.y.addAssign(a),s.y.addAssign(ye(this.HeightTexture,s.xz.add(.5)).mul(t).mul(this.Height)),o.y.addAssign(ye(this.HeightTexture,o.xz.add(.5)).mul(t).mul(this.Height));const l=s.sub(n).normalize(),f=o.sub(n).normalize();return Cs(xs(l,f))})()}CreateRenderer(){this.GPURenderer=new Ps({alpha:!0,antialias:!0}),this.GPURenderer.shadowMap.enabled=!0,this.GPURenderer.shadowMap.type=Ns,this.GPURenderer.toneMapping=ks,this.GPURenderer.setClearColor(0,0),this.GPURenderer.setPixelRatio(window.devicePixelRatio)}CreateTexture(e){this.HeightTexture=new yt(Math.floor(this.TextureResolution),Math.floor(this.TextureResolution)),this.HeightTexture.format=mt,this.HeightTexture.type=je}CreateLight(){const e=new Nt(16777215,2);e.position.set(-10,10,0),e.castShadow=!0,e.shadow.autoUpdate=!0,e.shadow.camera.near=.1,e.shadow.camera.far=30,e.shadow.camera.top=8,e.shadow.camera.right=8,e.shadow.camera.bottom=-8,e.shadow.camera.left=-8,e.shadow.mapSize.set(8192,8192),e.shadow.radius=5,e.shadow.blurSamples=25,e.shadow.normalBias=.05,this.DirectionalLight=e;const t=new Nt(16777215,.5);t.position.set(10,10,0),this.DirectionalLight2=t}SetIsMeshGenerated(e){this.IsMeshGenerated.value=e}CreateTerrainMesh(e){this.SetIsMeshGenerated(!1),$i.Generate(1,1,e,e).then(t=>{t.rotateX(-Math.PI/2),this.TerrainMesh=new Fe(t,this.TerrainMaterial),this.TerrainMesh.castShadow=!0,this.TerrainMesh.receiveShadow=!0,this.TerrainMesh.scale.set(10,1,10),this.TerrainMesh.position.set(0,.006,0),this.GPURenderer.compile(this.TerrainMesh,this.Camera).finally(()=>{this.Scene.add(this.TerrainMesh),this.SetIsMeshGenerated(!0)})})}ChangeResolution(e){this._textureResolution=e,this.TerrainMaterial.dispose(),this.HeightTexture.dispose(),this.CreateTexture(this.TextureResolution),this.CreateMaterial(),this.TerrainMesh.material=this.TerrainMaterial,this.Scene.remove(this.DirectionalLight),this.Scene.remove(this.DirectionalLight2),this.DirectionalLight.dispose(),this.DirectionalLight2.dispose(),this.CreateLight(),this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2);const t=he();t.Resolution=this.TextureResolution;const s=fe();s.LockedNode!=null?this.Recalculate(s.LockedNode):s.SelectedNode!=null&&this.Recalculate(s.SelectedNode),requestAnimationFrame(()=>this.Render())}OnWindowResize(){if(this.GPURenderer==null||this.Camera==null||this._canvas==null)return;var e=this._canvas.offsetHeight,t=this._canvas.offsetWidth;this.GPURenderer.setSize(t,e);const s=t/e;this.Camera.aspect=s,this.Camera.updateProjectionMatrix(),requestAnimationFrame(()=>this.Render())}async Render(){await this.GPURenderer.renderAsync(this.Scene,this.Camera)}Mount(e){this._canvas=e;var t=this._canvas.offsetHeight,s=this._canvas.offsetWidth;this._canvas.appendChild(this.GPURenderer.domElement),this.GPURenderer.setSize(s,t),this.Camera.aspect=s/t,this.Controls=new Is(this.Camera,this.GPURenderer.domElement),this.Controls.enablePan=!1,this.Controls.update(),window.addEventListener("resize",()=>this.OnWindowResize()),this.Render(),requestAnimationFrame(()=>this.Render)}RequestRender(){requestAnimationFrame(()=>this.Render)}async Recalculate(e,t=!1){if(this.IsMeshGenerated.value==!1||e.Outputs.length==0)return;t||await e.Calculate();var s=e.Outputs[e.DefaultOutput].Value;const n=T(()=>{const a=Be.modInt(this.TextureResolution),l=Be.div(this.TextureResolution),f=_t(a,l),d=x(f.x,f.y).div(this.TextureResolution).toVar(),c=s(d).toVar();c.assign(Me(c,0,1)),Vt(this.HeightTexture,f,c).toWriteOnly()})().compute(this.TextureResolution*this.TextureResolution);this.GPURenderer.computeAsync(n).then(()=>{e.CalculationState=we.Calculated,requestAnimationFrame(()=>this.Render())})}SetGridVisible(e){this.GridMesh.visible=e,requestAnimationFrame(()=>this.Render())}}const Li={class:"container"},Ri={key:0,style:{position:"relative",height:"100%",width:"100%"}},Di={style:{position:"absolute !important",top:"calc(50% + 30px)",width:"100%","text-align":"center"}},Ti=E({__name:"Preview3D",setup(i){const e=$();e.value=new Oi;const t=$();var s=he();const o=ue(()=>s.ChangeEvent);var n=fe();const a=ue(()=>n.SelectedNode),l=ue(()=>{var y;return(y=e.value)==null?void 0:y.IsMeshGenerated});Xe(l,async(y,w)=>{requestAnimationFrame(()=>{var S;return(S=e.value)==null?void 0:S.Render()})}),Xe(o,async(y,w)=>{var S,C;n.LockedNode!=null?(S=e.value)==null||S.Recalculate(n.LockedNode,!1):a.value!=null&&((C=e.value)==null||C.Recalculate(a.value,!1))}),Xe(a,async y=>{var S,C;if(n.LockedNode!=null)(S=e.value)==null||S.Recalculate(n.LockedNode);else if(y!=null){var w=y;await((C=e.value)==null?void 0:C.Recalculate(w))}}),Ue(()=>{me(()=>{var y;(y=e.value)==null||y.Mount(t.value)})});let f=!1;const d=()=>{f=!0},c=()=>{f=!1};window.addEventListener("mouseup",c),window.addEventListener("pointerup",c);const _=()=>{f&&requestAnimationFrame(()=>{var y;return(y=e.value)==null?void 0:y.Render()})},h=()=>{requestAnimationFrame(()=>{var y;return(y=e.value)==null?void 0:y.Render()})},u=$(!0),p=()=>{var y;u.value=!u.value,(y=e.value)==null||y.SetGridVisible(u.value)};return(y,w)=>{var D;const S=K("font-awesome-icon"),C=Se("tooltip");return g(),b("div",Li,[(D=e.value)!=null&&D.IsMeshGenerated?ee("",!0):(g(),b("div",Ri,[v(Wt,{style:{scale:"2"}}),V("span",Di,M(y.$t("hints.initializingMesh")),1)])),V("div",{onMousedown:d,onMousemove:_,onWheel:h,onPointerdown:d,onPointermove:_,ref_key:"canvas",ref:t,style:{height:"100%",width:"100%"}},[v(dt,{class:"top-left"},{default:I(()=>[v(Ve,null,{default:I(()=>[U((g(),b("a",{onClick:p},[v(S,{icon:["fas","hashtag"]})])),[[C,"Switch Grid visibility",void 0,{bottom:!0}]])]),_:1})]),_:1})],544)])}}}),Bi=Y(Ti,[["__scopeId","data-v-64b096ee"]]),Ai={style:{width:"100%",height:"100%"}},Gi={style:{height:"calc(100% - 80px)",display:"flex","flex-direction":"row"}},Ei={style:{width:"80%",height:"100%"}},Xi={style:{height:"50%",width:"100%",display:"block"}},Yi={style:{"margin-left":"5px"}},Ui={style:{height:"50%"}},Fi={style:{width:"20%",height:"100%"}},Hi={style:{"margin-left":"5px"}},Wi=E({__name:"LayoutView",setup(i){return(e,t)=>{const s=K("font-awesome-icon");return g(),b("div",Ai,[v(ii,{style:{height:"50px"}}),V("div",Gi,[V("div",Ei,[V("div",Xi,[v(et,{style:{display:"inline-block",width:"100%"}},{header:I(()=>[v(s,{icon:["fas","mountain-sun"]}),V("span",Yi,M(e.$t("windows.thirdPreview")),1)]),default:I(()=>[v(Bi)]),_:1})]),V("div",Ui,[v(Qo)])]),V("div",Fi,[v(et,{style:{width:"100%"},"wheel-focus":!1},{header:I(()=>[v(s,{icon:["fas","sliders"]}),V("span",Hi,M(e.$t("windows.properties")),1)]),default:I(()=>[v(ki)]),_:1})])]),v(js,{style:{height:"30px"}})])}}}),zi=Y(Wi,[["__scopeId","data-v-96fdc7ac"]]),qi=ss({history:os("/"),routes:[{path:"/",name:"home",component:zi}]});class Zi extends J{constructor(){super(...arguments);r(this,"Name","nodes.clamp");r(this,"Inputs",[new G(!0,this,"Source")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Min",0,0,1),new P("Max",1,0,1)]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value),s=N(this.Properties[1].Value);this.Outputs[0].Value=T(([o])=>{var a;if(!this.Inputs[0].IsConnected)return m(0);const n=(a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(o);return Me(n,t,s)})}}class ji extends J{constructor(){super(...arguments);r(this,"Name","nodes.constant");r(this,"Outputs",[new G(!1,this,"Output")]);r(this,"Properties",[new P("Height",0,0,1)]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value);this.Outputs[0].Value=T(([s])=>m(t))}}class Ki extends J{constructor(){super(...arguments);r(this,"Name","nodes.cracks");r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Scale",10,0,100,0,"Transform","%"),new P("Angle",0,0,100,0,"Noise",""),new P("Thickness",.03,0,1,0,"Noise",""),new P("Distortion",0,0,100,0,"Distortion",""),new P("Octaves",10,0,100,1,"Distortion",""),new P("Scale",10,0,100,0,"Distortion",""),new P("Offset X",0,-100,100,0,"Distortion",""),new P("Offset Y",0,-100,100,0,"Distortion","")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value),a=N(this.Properties[4].Value),l=N(this.Properties[5].Value),f=N(this.Properties[6].Value),d=N(this.Properties[7].Value);this.Outputs[0].Value=T(([c])=>{const _=x(c.x,c.y).toVar(),h=x(st(_.mul(2).mul(.5),a,x(f,d),l)).mul(n).mul(.2);return so({uv:_.add(h),angle:s,scale:t,thickness:o})})}}const Ji=T(([i,e,t])=>{const s=m(t).toVar(),o=m(e).toVar(),n=m(i).toVar();s.assign(ke(0,s));const a=m(ke(0,_e(1,o.sub(n).add(s).div(m(2).mul(s))))).toVar();return n.mul(a).add(o.mul(m(1).sub(a)).sub(s.mul(a).mul(m(1).sub(a))))}).setLayout({name:"smoothMin",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),Qi=T(([i,e,t])=>{const s=m(t).toVar(),o=m(e).toVar(),n=m(i).toVar();s.assign(_e(0,s.negate()));const a=m(ke(0,_e(1,o.sub(n).add(s).div(m(2).mul(s))))).toVar();return n.mul(a).add(o.mul(m(1).sub(a)).sub(s.mul(a).mul(m(1).sub(a))))}).setLayout({name:"smoothMax",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),ea=T(([i])=>{const e=x(i).toVar();return be(ge(xe(e.xy,x(12.9898,78.233))).mul(43758.5453123))}).setLayout({name:"random",type:"float",inputs:[{name:"st",type:"vec2"}]}),ta=T(([i,e,t])=>{const s=m(t).toVar(),o=m(e).toVar(),n=x(i).toVar(),a=x(n.mul(o)).toVar(),l=x(Ie(a)).toVar(),f=x(be(a)).toVar(),d=m(ea(l).mul(2).sub(1).mul(s)).toVar(),c=m(ge(d)).toVar(),_=m(Ke(d)).toVar(),h=x(f.sub(.5)).toVar(),u=x().toVar();return u.x.assign(h.x.mul(_).sub(h.y.mul(c))),u.y.assign(h.x.mul(c).add(h.y.mul(_))),u.add(.5).add(l).mod(1)}).setLayout({name:"tilingWithLimitedRotation",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"tileCount",type:"float"},{name:"maxAngle",type:"float"}]});class sa extends J{constructor(){super(...arguments);r(this,"Name","nodes.crater");r(this,"Outputs",[new G(!1,this,"Output")]);r(this,"Properties",[new P("Smoothness",.5,0,1,0,"Crater params",""),new P("FloorHeight",-1,-5,5,0,"Crater params",""),new P("Radius",.16,0,1,0,"Crater params",""),new P("RimWidth",1.35,0,100,0,"Crater params",""),new P("RimSteepness",4,0,100,0,"Crater params",""),new P("X",.5,0,1,0,"Transform",""),new P("Y",.5,0,1,0,"Transform","")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value),a=N(this.Properties[4].Value),l=N(this.Properties[5].Value),f=N(this.Properties[6].Value);this.Outputs[0].Value=T(([d])=>{const c=x(d.x,d.y).toVar(),_=x(l,f).toVar(),h=m(bt(c.sub(_)).div(ke(o,1e-4))).toVar(),u=m(h.mul(h).sub(1)).toVar(),p=m(_e(h.sub(1).sub(n),0)).toVar(),y=m(a.mul(p).mul(p)).toVar(),w=m(Qi(u,s,t)).toVar();return w.assign(Ji(w,y,t)),w.mul(o).add(.5).toVar()})}}class oa extends J{constructor(){super(...arguments);r(this,"Name","nodes.fake");r(this,"Position",new R(1e3,1e3))}}class na extends J{constructor(){super(...arguments);r(this,"Name","nodes.falloff");r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Strength",0,0,10)]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value);this.Outputs[0].Value=T(([s])=>{const o=x(s.x,s.y).toVar(),n=m(Et(x(.5),o.mod(1))).mul(t).toVar(),a=X(m(1),m(0),n).toVar();return Je(Me(a,0,1),2)})}}const ia=T(([i,e])=>{const t=i.mul(e).toVar();return Ie(t).add(.5).toVar().div(e)});class aa extends J{constructor(){super(...arguments);r(this,"Name","nodes.fastErosion");r(this,"Inputs",[new G(!0,this,"Inpute Height")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Power",.1,0,1,0,"Erosion","")]);r(this,"IsRealtimeUpdate",!1);r(this,"terrainHeight")}async Calculate(){await this.BaseCalculate();const t=he(),s=t.GetRenderer(),o=t.Resolution;if(this.terrainHeight=new yt(Math.floor(o),Math.floor(o)),this.terrainHeight.type=je,!this.IsCalculated){const l=T(()=>{var h;const f=Be.modInt(o),d=Be.div(o),c=_t(f,d);x(1/o).toVar();const _=x(c.x,c.y).div(o).toVar();if(this.Inputs[0].IsConnected){const p=((h=this.Inputs[0].Links[0].In)==null?void 0:h.Value)(_).toVar();Vt(this.terrainHeight,c,p).toWriteOnly()}})().compute(o*o);s==null||s.GPURenderer.computeAsync(l)}this.CalculationState=we.Calculation;for(let a=0;a<1e8;a++)this.CalculationState,a%1e5==0&&await new Promise(l=>setTimeout(l,0));const n=N(this.Properties[0].Value);this.Outputs[0].Value=T(([a])=>{if(this.Inputs[0].IsConnected){const l=x(a.x,a.y).toVar(),f=ia(l,o).toVar(),d=ye(this.terrainHeight,f),c=d.r,_=d.g,h=d.b,u=ye(this.terrainHeight,f.add(ot(Rt(-1),0))).r,p=ye(this.terrainHeight,f.add(ot(1,0))).r,y=ye(this.terrainHeight,f.add(ot(0,1))).r,w=x(p.sub(u),y.sub(c));_.addAssign(5e-4);const C=bt(w).mul(_).mul(10).mul(n);return c.subAssign(C),h.addAssign(C),_.mulAssign(.95),h.mulAssign(.99),c}else return 0})}}class ra extends J{constructor(){super(...arguments);r(this,"Name","nodes.gradientNoise");r(this,"Outputs",[new G(!1,this,"Output")]);r(this,"Properties",[new P("Scale",10,0,100),new P("Offset X",0,0,100),new P("Offset Y",0,0,100)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value);this.Outputs[0].Value=T(([n])=>{const a=x(n.x,n.y).mul(t).toVar(),l=x(s,o).toVar();return a.addAssign(l),Ht(a)})}}class la extends J{constructor(){super(...arguments);r(this,"Name","nodes.invert");r(this,"Inputs",[new G(!0,this,"Source")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate(),this.Outputs[0].Value=T(([t])=>{var o;if(!this.Inputs[0].IsConnected)return m(0);const s=(o=this.Inputs[0].Links[0].In)==null?void 0:o.Value(t);return m(1).sub(s)})}}class ua extends J{constructor(){super(...arguments);r(this,"Name","nodes.mountain");r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Scale",3.55,0,100,0,"Noise Transform","%"),new P("Octaves Count",10,1,50,1,"Noise Params",""),new P("Offset X",-.08,-100,100,0,"Noise Transform",""),new P("Offset Y",-.54,-100,100,0,"Noise Transform",""),new P("Falloff",3,0,20,0,"Mountain",""),new P("Height",1,0,1,0,"Mountain",""),new P("Position X",.5,0,1,0,"Mountain Transform",""),new P("Position Y",.5,0,1,0,"Mountain Transform","")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value),a=N(this.Properties[4].Value),l=N(this.Properties[5].Value),f=N(this.Properties[6].Value),d=N(this.Properties[7].Value);this.Outputs[0].Value=T(([c])=>{const _=x(c.x,c.y).toVar(),h=m(Et(x(f,d),_)).mul(a).toVar(),u=X(m(1),m(0),h).toVar(),p=Je(Me(u,0,1),2),y=_.sub(x(f,d).sub(.5)).toVar(),w=st(y,s,x(o,n),t).toVar();return Me(p.mul(w).mul(m(1.45).mul(l)),0,1)})}}class da extends J{constructor(){super(...arguments);r(this,"Name","nodes.redistribution");r(this,"Inputs",[new G(!0,this,"Source")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Exponent",1,1,10)]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value);this.Outputs[0].Value=T(([s])=>{var n;return this.Inputs[0].IsConnected?((n=this.Inputs[0].Links[0].In)==null?void 0:n.Value(s)).pow(t):m(0)})}}class ca extends J{constructor(){super(...arguments);r(this,"Name","nodes.terrace");r(this,"Inputs",[new G(!0,this,"Param 1")]);r(this,"Outputs",[new G(!1,this,"Output")]);r(this,"Properties",[new P("Smoothness",.1,0,1),new P("Count",3,0,100,1)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value);this.Outputs[0].Value=T(([o])=>{var n;if(this.Inputs[0].IsConnected){const l=((n=this.Inputs[0].Links[0].In)==null?void 0:n.Value)(o).toVar();if(this.Properties[1].Value==0)return l;const f=m(1).div(s).toVar(),d=Ie(l.div(f)).toVar(),c=l.sub(d.mul(f)).div(f).toVar(),_=_e(m(2).mul(c),m(1)).toVar(),h=d.add(_).mul(f).toVar(),u=rt(1,m(s)),p=Ie(l.div(u)),y=be(l.div(u)),w=p.mul(u).add(Ee(0,1,y).mul(u));return X(h,w,t)}else return 0})}}class fa extends J{constructor(){super(...arguments);r(this,"Name","nodes.voronoi");r(this,"Outputs",[new G(!1,this,"Output"),new G(!1,this,"Cells"),new G(!1,this,"Bubbles")]);r(this,"Properties",[new P("Scale",10,1,100,0,"Transform","%"),new P("OffsetX",0,0,100,0,"Transform",""),new P("OffsetY",0,0,100,0,"Transform",""),new P("Angle",5,0,100,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value);this.Outputs[0].Value=T(([a])=>{const l=x(a.x,a.y).toVar(),f=x(s,o).toVar();l.addAssign(f);const d=nt({UV:l,angleOffset:n,cellDensity:t}).toVar();return Je(d.x,2)}),this.Outputs[1].Value=T(([a])=>{const l=x(a.x,a.y).toVar(),f=x(s,o).toVar();return l.addAssign(f),nt({UV:l,angleOffset:n,cellDensity:t}).toVar().y}),this.Outputs[2].Value=T(([a])=>{const l=x(a.x,a.y).toVar(),f=x(s,o).toVar();l.addAssign(f);const d=nt({UV:l,angleOffset:n,cellDensity:t}).toVar();return Ms(Je(d.x,2))})}}class ha extends J{constructor(){super(...arguments);r(this,"Name","nodes.transform");r(this,"Inputs",[new G(!0,this,"Input")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Properties",[new P("Scale X",1,0,100,0,"Scale",""),new P("Scale Y",1,0,100,0,"Scale",""),new P("Position X",0,-100,100,0,"Position",""),new P("Position Y",0,-100,100,0,"Position",""),new P("Midpoint X",.5,0,1,0,"Rotation",""),new P("Midpoint Y",.5,0,1,0,"Rotation",""),new P("Angle",0,-360,360,0,"Rotation","")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value),a=N(this.Properties[4].Value),l=N(this.Properties[5].Value),f=N(this.Properties[6].Value);this.Outputs[0].Value=T(([d])=>{var S;const c=x(d.x,d.y).toVar(),_=x(t,s).toVar(),h=x(o,n).toVar(),u=x(a,l).toVar(),p=f.mul(Xt.div(180)).toVar(),y=x(Ke(p).mul(c.x.sub(u.x)).add(ge(p).mul(c.y.sub(u.y))).add(u.x),Ke(p).mul(c.y.sub(u.y)).sub(ge(p).mul(c.x.sub(u.x))).add(u.y));return c.assign(y),c.addAssign(h),c.mulAssign(_),(S=this.Inputs[0].Links[0].In)==null?void 0:S.Value(c).toVar()})}}class pa extends J{constructor(){super(...arguments);r(this,"Inputs",[new G(!0,this,"Input")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Name","nodes.tile");r(this,"Properties",[new P("Tile Count",1,0,100,1),new P("Angle Threshold",0,0,360,0)]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value),s=N(this.Properties[1].Value);this.Outputs[0].Value=T(([o])=>{var d;var n=x(o).toVar(),a=s.mul(Xt.div(180));const l=ta(n,t,a).toVar();return(d=this.Inputs[0].Links[0].In)==null?void 0:d.Value(l).toVar()})}}class va extends J{constructor(){super(...arguments);r(this,"Inputs",[new G(!0,this,"Input")]);r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Name","nodes.height");r(this,"IsRealtimeUpdate",!0);r(this,"Properties",[new P("Height",1,0,100,0,"","%")])}async Calculate(){this.BaseCalculate();const t=N(this.Properties[0].Value);this.Outputs[0].Value=T(([s])=>{var a;if(!this.Inputs[0].IsConnected)return m(0);var o=x(s).toVar();return((a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(o).toVar()).mul(t.mul(.01))})}}class ma extends J{constructor(){super(...arguments);r(this,"Name","nodes.distortion");r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Inputs",[new G(!0,this,"Input")]);r(this,"Properties",[new P("Distortion",0,0,100,0,"Distortion",""),new P("Octaves",10,0,100,1,"Distortion",""),new P("Scale",10,0,100,0,"Distortion",""),new P("Offset X",0,-100,100,0,"Distortion",""),new P("Offset Y",0,-100,100,0,"Distortion","")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();var t=N(this.Properties[0].Value),s=N(this.Properties[1].Value),o=N(this.Properties[2].Value),n=N(this.Properties[3].Value),a=N(this.Properties[4].Value);this.Outputs[0].Value=T(([l])=>{var f;if(this.Inputs[0].IsConnected){const d=(f=this.Inputs[0].Links[0].In)==null?void 0:f.Value,c=x(l.x,l.y).toVar(),_=x(st(c.mul(2).mul(.5),s,x(n,a),o)).mul(t).mul(.2);return d(c.add(_)).toVar()}else return 0})}}class ga extends J{constructor(){super(...arguments);r(this,"Name","nodes.dune");r(this,"Outputs",[new G(!1,this,"Result")]);r(this,"Inputs",[]);r(this,"Properties",[new P("Scale",0,0,0,0,"Tramsform","%"),new P("Height",0,0,0,0,"Tramsform","%"),new P("Wind Direction",0,0,0,0,"Tramsform","%"),new P("Octaves",0,0,0,0,"Noise","%"),new P("Sand Roughness",0,0,0,0,"Noise","%"),new P("Seed",0,0,0,0,"Random","%"),new P("Time",0,0,0,0,"Random","%")]);r(this,"IsRealtimeUpdate",!0)}async Calculate(){this.BaseCalculate();const t=N(this.Properties[6].Value),s=N(this.Properties[5].Value),o=N(this.Properties[0].Value),n=N(this.Properties[1].Value),a=N(this.Properties[4].Value),l=N(this.Properties[2].Value);N(this.Properties[3].Value);const f=T(([u])=>{const p=u.toVar();return p.assign(x(xe(p,x(127.1,311.7)),xe(p,x(269.5,183.3)))),m(-1).add(se(2,be(ge(p.x.add(p.y)).mul(m(43758.5453123)))))}),d=T(([u])=>{const p=Ie(u),y=be(u),w=y.mul(y).mul(j(3,se(2,y))),S=f(p),C=f(p.add(x(1,0))),D=f(p.add(x(0,1))),F=f(p.add(x(1,1)));return X(X(S,C,w.x),X(D,F,w.x),w.y)}),c=T(([u,p,y])=>{const w=m(0),S=m(1),C=m(1),D=m(0);return Dt(p,({i:F})=>{w.addAssign(S.mul(d(u.mul(C).add(s)))),D.addAssign(S),S.mulAssign(y),C.mulAssign(2)}),w.div(D)}),_=T(([u,p])=>j(1,Te(ge(u.mul(3.14159).mul(p))))),h=T(([u,p])=>{const y=x(Ke(p),ge(p)),w=c(u.mul(o).add(y.mul(.5)),4,.5);x(y.y.negate(),y.x);const S=ge(u.x.mul(o).mul(.3).add(d(u.mul(2)).mul(2))).mul(ge(u.y.mul(o).mul(.2))).mul(.3),C=w.mul(.7).add(S.mul(.3));C.assign(X(C,_(C,1.5),.4));const D=c(u.mul(o).mul(4),2,.3).mul(a);return C.add(D.mul(.1))});this.Outputs[0].Value=T(([u])=>{const p=u,y=x(t.mul(.01),0),w=h(p.mul(x(2,1)).add(y),l);return w.assign(w.mul(.5).add(.5).mul(n)),w})}}function wa(){Z.registerStr("nodes.buffer","",Ne),Z.registerStr("nodes.fake","",oa),Z.registerStr("nodes.constant","nodeCategories.testNodes",ji),Z.registerStr("nodes.perlinNoise","nodeCategories.testNodes",oo),Z.registerStr("nodes.mountain","nodeCategories.testNodes",ua),Z.registerStr("nodes.terrace","nodeCategories.testNodes",ca),Z.registerStr("nodes.combine","nodeCategories.testNodes",qe),Z.registerStr("nodes.clamp","nodeCategories.testNodes",Zi),Z.registerStr("nodes.invert","nodeCategories.testNodes",la),Z.registerStr("nodes.redistribution","nodeCategories.testNodes",da),Z.registerStr("nodes.gradientNoise","nodeCategories.testNodes",ra),Z.registerStr("nodes.voronoi","nodeCategories.testNodes",fa),Z.registerStr("nodes.crater","nodeCategories.testNodes",sa),Z.registerStr("nodes.falloff","nodeCategories.testNodes",na),Z.registerStr("nodes.fastErosion","nodeCategories.testNodes",aa),Z.registerStr("nodes.cracks","nodeCategories.testNodes",Ki),Z.registerStr("nodes.transform","nodeCategories.testNodes",ha),Z.registerStr("nodes.tile","nodeCategories.testNodes",pa),Z.registerStr("nodes.height","nodeCategories.testNodes",va),Z.registerStr("nodes.distortion","nodeCategories.testNodes",ma),Z.registerStr("nodes.dune","nodeCategories.testNodes",ga),Z.registerStr("nodes.export","nodeCategories.testNodes",De)}const ya={en:{"":"",logo:"Mashuk",windows:{thirdPreview:"3D Preview",secondPreview:"2D Preview",properties:"Node properties",graph:"Graph",nodesList:"Nodes list"},tt:{undo:"Undo",redo:"Redo",copy:"Copy",paste:"Paste",delete:"Delete node/selected",fullscreen:"Fullscreen",save:"Save project",cancel:"Cancel",load:"Load project",presets:"Presets",resetView:"Reset view",resetParams:"Reset node parameters to default",lockPreview:"Lock Preview",unlockPreview:"Unlock Preview",mesh_resolution:"Resolution",new:"New project",settings:"Project settings",menu:"Menu",resolutionWarning:"Warning! Selecting a high resolution will increase video memory consumption and processing speed.",build:"Build project",buildSettings:"Build settings",clickForEdit:"Click for edit",saveSettings:"Save settings"},hints:{graphLmb:"LMB: Select/Drag node",graphWheel:"Wheel: Zoom/Drag work space",placeHere:"PLACE HERE",initializingMesh:"Initializing Mesh..."},nodes:{constant:"Constant",perlinNoise:"Perlin Noise",mountain:"Mountain",terrace:"Terrace",combine:"Combine",clamp:"Clamp",invert:"Invert",redistribution:"Redistribution",gradientNoise:"Gradient Noise",voronoi:"Voronoi",crater:"Crater",falloff:"Falloff",fastErosion:"Fast Erosion",cracks:"Cracks",transform:"Transform",tile:"Tile",height:"Height",distortion:"Distortion",dune:"Dunes",export:"Export"},buildModal:{resolution:"Resolution",tiles:"Tiles",terrain:"Terrain",build:"Build",nodes:"Nodes"},nodeCategories:{testNodes:"Test nodes",colorNodes:"Color nodes"}},ru:{logo:"Машук",windows:{thirdPreview:"3D Просмотр",secondPreview:"2D Просмотр",properties:"Параметры узла",graph:"Граф",nodesList:"Список узлов"},tt:{undo:"Отменить",redo:"Повторить",copy:"Копировать",paste:"Вставить",delete:"Удалить узел/выделенные",fullscreen:"На весь экран",save:"Сохранить проект",cancel:"Отменить",load:"Загрузить проект",presets:"Предустановки",resetView:"Сбросить вид",resetParams:"Сбросить параметры узла до значений по умолчанию",lockPreview:"Закрепить отображение",unlockPreview:"Открепить отображение",mesh_resolution:"Разрешение",new:"Новый проект",settings:"Настройки проекта",menu:"Меню",resolutionWarning:"Внимание! Выбор высокого разрешения влечет за собой увеличение потребления видеопамяти и скорости обработки",build:"Собрать проект",buildSettings:"Настройка сборки",clickForEdit:"Нажмите что-бы отредактировать",saveSettings:"Сохранить настройки"},hints:{graphLmb:"ЛКМ: Выделить/Передвинуть узел",graphWheel:"Колесо мыши: Приближение/Перемещение рабочей области",placeHere:"РАЗМЕСТИТЕ ЗЕСЬ",initializingMesh:"Инициализация Меша..."},nodes:{constant:"Константа",perlinNoise:"Шум Перлина",mountain:"Гора",terrace:"Террасы",combine:"Комбинирование",clamp:"Ограничение",invert:"Инверсия",redistribution:"Перераспределение",gradientNoise:"Градиентный Шум",voronoi:"Шум Вороного",crater:"Кратер",falloff:"Спад",fastErosion:"Быстрая Эрозия",cracks:"Трещины",transform:"Преобразование",tile:"Плитка",height:"Высота",distortion:"Искажения",dune:"Дюны",export:"Экспорт"},buildModal:{resolution:"Разрешение",tiles:"Тайлы",terrain:"Ландшафт",build:"Сборка",nodes:"Узлы"},nodeCategories:{testNodes:"Тестовые узлы",colorNodes:"Красящие узлы"}}};vt.options.themes.tooltip.delay.show=0;vt.options.distance=10;ns.add($s,is);const _a=as({legacy:!1,locale:"en",fallbackLocale:"en",messages:ya}),Ce=rs(Gs);Ce.component("font-awesome-icon",ls);Ce.component("font-awesome-layers",us);Ce.component("font-awesome-layers-text",ds);Ce.use(cs());Ce.use(qi);Ce.use(vt);Ce.use(_a);Ce.use(fs);Ce.mount("#app");wa();
