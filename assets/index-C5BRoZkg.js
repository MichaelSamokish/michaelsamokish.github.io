var cs=Object.defineProperty;var hs=(n,e,t)=>e in n?cs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>hs(n,typeof e!="symbol"?e+"":e,t);import{d as X,g as mt,c as we,r as te,a as H,b as g,u as x,o as v,R as fs,e as S,f as c,_ as E,v as vt,h as gt,i as $,j as O,t as P,k as se,l as de,w as _,m as Lt,n as De,p as Pe,q as Z,s as ae,x as Ie,y as Pt,z as ps,T as ms,A as vs,F as ee,B as Ve,C as $t,D as It,E as Ge,G as Dt,H as gs,I as ws,J as Vs,K as wt,L as ys,M as Ss,N as bs,O as _s,P as Ps,Q as Is,V as Ns}from"./vendor-n_C4yHzJ.js";import{u as V,F as C,f as u,w as Rt,i as oe,v as w,L as Tt,a as st,b as Ne,d as Re,m as T,n as At,c as Be,s as Te,e as A,g as J,h as xe,j as Ms,k as ue,l as Q,o as Cs,p as ye,q as Je,r as Os,t as dt,x as Qe,y as Xt,z as Le,A as fe,B as Ke,I as Ue,C as $e,D as Nt,E as at,P as Gt,G as ct,H as Mt,J as Yt,K as ks,M as We,N as xs,O as Ls,Q as Bt,R as Vt,S as Et,T as yt,U as $s,V as Ds,W as ze,X as Rs,Y as Ts,Z as As,_ as Xs,$ as rt,a0 as Fe,a1 as lt,a2 as Gs,a3 as Ys,a4 as Bs,a5 as Es,a6 as Hs,a7 as Us,a8 as Ws,a9 as zs,aa as Ct,ab as Fs,ac as Ze,ad as Zs,ae as qs}from"./three-UTeHTzsP.js";import{i as Ks}from"./icons-CNPGi31y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const js={key:1,class:"gpu-error-box disable-user-select"},Js={class:"gpu-error-message-box"},Qs={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},en=X({__name:"App",setup(n){const e=mt(),t=localStorage.getItem("userLang");t&&e!=null&&(e.appContext.config.globalProperties.$i18n.locale=t);var s=we(()=>navigator.gpu);return(i,o)=>{const a=te("font-awesome-icon");return x(s)?(v(),H(x(fs),{key:0})):(v(),g("div",js,[S("div",Js,[S("div",Qs,[c(a,{icon:["fas","circle-xmark"]})]),o[0]||(o[0]=S("h1",null,"WebGPU is not supported on this browser.",-1))])]))}}}),tn=E(en,[["__scopeId","data-v-f1213186"]]);class Ht{constructor(){r(this,"Id",vt());r(this,"In",null);r(this,"Out",null);r(this,"IsSelected",!1)}SetSelected(e){var s,i,o;var t=this.In!=null?(s=this.In.ParentNode)==null?void 0:s.ParentGraph:(o=(i=this.Out)==null?void 0:i.ParentNode)==null?void 0:o.ParentGraph;t!=null&&e==!0&&t.DeselectAll(),this.IsSelected=e}DeleteLinkFromTerminals(){var s,i;var e=(s=this.In)==null?void 0:s.Links.indexOf(this);e!=null&&this.In!=null&&this.In.Links.splice(e,1);var t=(i=this.Out)==null?void 0:i.Links.indexOf(this);t!=null&&this.Out!=null&&this.Out.Links.splice(t,1)}}class I{constructor(e,t){r(this,"X",0);r(this,"Y",0);this.X=e,this.Y=t}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get Normalized(){return I.Div(this,this.Length)}Reset(){this.X=0,this.Y=0}static Add(e,t){return t instanceof I?new I(e.X+t.X,e.Y+t.Y):typeof t=="number"?new I(e.X+t,e.Y+t):e}static Sub(e,t){return t instanceof I?new I(e.X-t.X,e.Y-t.Y):typeof t=="number"?new I(e.X-t,e.Y-t):e}static Mul(e,t){return t instanceof I?new I(e.X*t.X,e.Y*t.Y):typeof t=="number"?new I(e.X*t,e.Y*t):e}static Div(e,t){return t instanceof I?new I(e.X/t.X,e.Y/t.Y):typeof t=="number"?new I(e.X/t,e.Y/t):e}}var nt=(n=>(n[n.none=0]="none",n[n.Buffer=1]="Buffer",n[n.Primitives=2]="Primitives",n[n.GeoPrimitives=3]="GeoPrimitives",n[n.Warps=4]="Warps",n[n.Adjastments=5]="Adjastments",n[n.Profile=6]="Profile",n[n.Filters=7]="Filters",n[n.Erosion=8]="Erosion",n[n.Snow=9]="Snow",n[n.Water=10]="Water",n[n.Data=11]="Data",n[n.Color=12]="Color",n[n.Render=13]="Render",n[n.Output=14]="Output",n))(nt||{}),_e=(n=>(n[n.NotCalculated=0]="NotCalculated",n[n.Calculation=1]="Calculation",n[n.Calculated=2]="Calculated",n))(_e||{});class y{constructor(e,t,s,i=0,o=0,a="",d=""){r(this,"Name","");r(this,"Description","");r(this,"Value");r(this,"Min",-10);r(this,"Max",10);r(this,"Suffix");r(this,"Category");r(this,"Step");r(this,"valueList");r(this,"Default");this.Name=e,this.Value=t,this.Default=t,this.Min=typeof s=="number"?s:0,this.Max=i,this.Suffix=d,this.Category=a,this.Step=o,this.valueList=s instanceof Array?s:void 0}Reset(){this.Value=this.Default}}class F{constructor(){r(this,"Id",vt());r(this,"Position",new I(0,0));r(this,"LastPosition",new I(0,0));r(this,"Name","");r(this,"Category",nt.none);r(this,"Properties");r(this,"Inputs",[]);r(this,"Outputs",[]);r(this,"IsSelected",!1);r(this,"Height",0);r(this,"Width",0);r(this,"IsCalculated",!1);r(this,"ParentGraph",null);r(this,"CalculationState",_e.NotCalculated);r(this,"IsRealtimeUpdate",!1);r(this,"DefaultOutput",0)}Move(e,t){this.Position=new I(e,t)}SetSize(e,t){this.Height=e,this.Width=t}SetSelected(e){this.IsSelected=e;const t=pe();e?t.SelectedNode=this:t.SelectedNode==this&&(t.SelectedNode=null)}SetLastPosition(e,t){this.LastPosition.X=e,this.LastPosition.Y=t}BaseCalculate(){this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})}),this.Inputs.forEach(e=>{var t,s,i,o;e.IsConnected&&((s=(t=e.Links[0].In)==null?void 0:t.ParentNode)==null||s.Calculate(),(o=(i=e.Links[0].In)==null?void 0:i.ParentNode)==null||o.SetCalculated())})}SetNotCalculated(){this.CalculationState=_e.NotCalculated,this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})})}SetCalculated(){this.CalculationState=_e.Calculated}Calculate(){}}class L{constructor(e,t,s){r(this,"Guid",vt());r(this,"Links",new Array);r(this,"IsInput",!1);r(this,"ParentNode",null);r(this,"Position",new I(0,0));r(this,"OffsetPosition",new I(0,0));r(this,"Value",null);r(this,"Name","");this.ParentNode=t,this.IsInput=e,this.Name=s}get IsConnected(){return this.Links.length>0}SetOffset(e,t){this.OffsetPosition=new I(e,t)}SetPosition(e,t){this.Position=new I(e,t)}}const et=gt("drag",()=>{const n=$(!1),e=$(),t=$(),s=$();function i(a){s.value=a}function o(){return s.value}return{setNode:i,getNode:o,SourceTerminal:e,DestinationTerminal:t,IsDragging:n}}),pe=gt("nodes",()=>{const n=$(),e=$();return{SelectedNode:n,LockedNode:e}}),me=gt("renderer",()=>{const n=$(!1),e=$(),t=o=>{e.value=o},s=()=>e.value,i=$();return{ChangeEvent:n,Resolution:i,SetRenderer:t,GetRenderer:s}}),sn={class:"status-bar-grid disable-user-select"},nn={class:"working-status"},on={class:"memory-usage"},an=X({__name:"StatusBar",setup(n){me();const e=$(0),t=we(()=>e.value);return(s,i)=>{const o=te("font-awesome-icon");return v(),g("div",sn,[S("div",nn,[c(o,{icon:["fas","bars-progress"]}),i[0]||(i[0]=O(" Idle "))]),S("div",on,[c(o,{icon:["fas","memory"]}),O(" "+P(t.value.toFixed(2))+" ",1),i[1]||(i[1]=S("span",null," GB",-1))])])}}}),rn=E(an,[["__scopeId","data-v-254f7b1e"]]);class Ut extends F{constructor(){super(...arguments);r(this,"Name","nodes.constant");r(this,"Outputs",[new L(!1,this,"Output")]);r(this,"Properties",[new y("Height",0,0,1)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>u(t))}}const ln={class:"collapse"},un={class:"carete"},dn={key:0,class:"collapse-body"},cn=X({__name:"Collapse",setup(n){var e=$(!1);const t=()=>{e.value=!e.value};return(s,i)=>{const o=te("font-awesome-icon");return v(),g("div",ln,[S("div",{onClick:t,class:"header"},[S("div",un,[x(e)?(v(),H(o,{key:0,icon:["fas","angle-right"]})):(v(),H(o,{key:1,icon:["fas","angle-down"]}))]),de(s.$slots,"header",{},void 0,!0)]),x(e)?se("",!0):(v(),g("div",dn,[de(s.$slots,"default",{},void 0,!0)]))])}}}),ht=E(cn,[["__scopeId","data-v-ed8ad461"]]),qe=C(([n])=>{const e=w(n).toVar();e.assign(e.modInt(u(289)));const t=u(u(34).mul(e.x).add(1).mul(e.x).modInt(289).add(e.y)).toVar();return t.assign(u(34).mul(t).add(u(1)).mul(t).modInt(289)),t.assign(Ne(t.div(u(41))).mul(u(2)).sub(1)),At(w(t.sub(st(t.add(.5))),Be(t).sub(.5)))}).setLayout({name:"gradientNoiseDir",type:"vec2",inputs:[{name:"p",type:"vec2"}]}),hn=C(([n])=>{const e=w(n).toVar(),t=w(st(e)).toVar(),s=w(Ne(e)).toVar(),i=u(Re(qe(t),s)).toVar(),o=u(Re(qe(t.add(w(u(0),u(1)))),s.sub(w(u(0),u(1))))).toVar(),a=u(Re(qe(t.add(w(u(1),u(0)))),s.sub(w(u(1),u(0))))).toVar(),d=u(Re(qe(t.add(w(u(1),u(1)))),s.sub(w(u(1),u(1))))).toVar();return s.assign(s.mul(s).mul(s).mul(s.mul(s.mul(u(6)).sub(u(15))).add(u(10)))),T(T(i,o,s.y),T(a,d,s.y),s.x)}).setLayout({name:"gradientNoise",type:"float",inputs:[{name:"p",type:"vec2"}]}),Wt=C(([n])=>hn(n).add(.5)),St=C(([n,e,t,s])=>{const i=oe(e).toVar(),o=u(s).toVar(),a=w(t.x,t.y).toVar(),d=w(n.x,n.y).sub(u(.5)).mul(o).toVar();d.addAssign(a);const f=u(0).toVar(),l=u(1).div(2).toVar();return Tt(i,({i:m})=>{const p=d.mul(u(2).pow(u(m))).toVar(),h=Wt(p).mul(l).toVar();l.divAssign(2),f.addAssign(h)}),f}).setLayout({name:"perlinNoise",type:"float",inputs:[{name:"UV",type:"vec2"},{name:"octaves",type:"int"},{name:"offset",type:"vec2"},{name:"scale",type:"float"}]}),fn=Rt(`
fn cracks(uv: vec2<f32>, angle: f32, scale: f32, thickness: f32) -> f32  {
	let st: vec2<f32> = (uv - 0.5) * scale;
	let i_st: vec2<f32> = floor(st);
	let f_st: vec2<f32> = fract(st);
	var m1: f32 = 1.;
	var m2: f32 = 1.;

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let neighbor: vec2<f32> = vec2<f32>(x, y);
			var point: vec2<f32> = random2(i_st + neighbor);
			point = 0.5 + 0.5 * sin(angle + 6.2831 * point);
			let diff: vec2<f32> = neighbor + point - f_st;
			let dist: f32 = length(diff);
			let cond: f32 = step(dist, m1);
			m2 = mix(min(max(m1, dist), m2), m1, cond);
			m1 = mix(m1, dist, cond);
		}

	}

	let edge: f32 = smoothstep(0.01, thickness, m2 - m1);
	return edge;
} 

fn random2(p: vec2<f32>) -> vec2<f32> {
	return fract(sin(vec2<f32>(dot(p, vec2<f32>(127.1, 311.7)), dot(p, vec2<f32>(269.5, 183.3)))) * 43758.547);
} 
`),ut=Rt(`
fn voronoi(UV: vec2<f32>, angleOffset: f32, cellDensity: f32) -> vec2<f32> {
	let g: vec2<f32> = floor((UV - 0.5) * cellDensity);
	let f: vec2<f32> = fract((UV - 0.5) * cellDensity);
	var res: vec3<f32> = vec3<f32>(8., 0., 0.);

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let lattice: vec2<f32> = vec2<f32>(x, y);
			let offset: vec2<f32> = voronoiNoiseRandomVector(lattice + g, angleOffset);
			let d: f32 = distance(lattice + offset, f);
			res = mix(res, vec3<f32>(d, offset.x, offset.y), step(d, res.x));
		}

	}

	return vec2<f32>(res.x, res.y);
} 

fn voronoiNoiseRandomVector(UV: vec2<f32>, offset: f32) -> vec2<f32> {
	var UV_var = UV;
	let m: mat2x2<f32> = mat2x2<f32>(15.27, 47.63, 99.41, 89.98);
	UV_var = fract(sin(UV_var * m) * 46839.32);
	return vec2<f32>(sin(UV_var.y * offset) * 0.5 + 0.5, cos(UV_var.x * offset) * 0.5 + 0.5);
}
`);class zt extends F{constructor(){super(...arguments);r(this,"Name","nodes.perlinNoise");r(this,"Outputs",[new L(!1,this,"Output")]);r(this,"Properties",[new y("Scale",10,0,100,0,"Transform","%"),new y("Octaves Count",10,1,50,1,"Noise",""),new y("Offset X",0,-100,100,0,"Transform",""),new y("Offset Y",0,-100,100,0,"Transform",""),new y("Warp Scale",0,0,1,.001,"Warp","%"),new y("Seed",0,0,99999,0,"Random",""),new y("Height",.4,0,1,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0);r(this,"Random",C(([t])=>{const s=w(t).toVar();return Ne(Te(Re(s,w(12.9898,78.233))).mul(43758.5453))}))}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value);V(this.Properties[4].Value);const a=V(this.Properties[5].Value),d=V(this.Properties[6].Value);this.Outputs[0].Value=C(([f])=>{const l=w(f.x,f.y).toVar();return l.addAssign(this.Random(w(a).mul(a))),St(l,s,w(i,o),t).mul(d)})}}const pn=X({__name:"DraggableNode",props:{GraphNode:{type:Function,required:!0}},setup(n){const e=et(),t=n,s=$(),i=l=>{var p;if((p=l.dataTransfer)==null||p.setData("string","1"),t.GraphNode!=null&&t.GraphNode!=null){var m=t.GraphNode;e.setNode(new m)}};var o=void 0;const a=l=>{var h;o=(h=s.value)==null?void 0:h.cloneNode(!0);var m=o.getBoundingClientRect();if(o.style.position="fixed",o.style.left=`${l.touches[0].pageX-m.width/2}px`,o.style.top=`${l.touches[0].pageY-m.height/2}px`,o.style.zIndex="1000",document.body.appendChild(o),t.GraphNode!=null&&t.GraphNode!=null){var p=t.GraphNode;e.setNode(new p)}},d=l=>{if(o!=null){var m=o.getBoundingClientRect();o.style.left=`${l.touches[0].pageX-m.width/2}px`,o.style.top=`${l.touches[0].pageY-m.height/2}px`}},f=l=>{if(o!=null){document.body.removeChild(o),o=void 0,l.preventDefault(),l.stopPropagation();var m=l.changedTouches[0],p=document.elementFromPoint(m.clientX,m.clientY);console.log(p)}};return window.addEventListener("touchmove",d),window.addEventListener("touchend",f),(l,m)=>(v(),g("div",{onTouchstart:a,onDragstart:i,draggable:"true",class:"node",ref_key:"selfEl",ref:s},[de(l.$slots,"default",{},void 0,!0)],544))}}),j=E(pn,[["__scopeId","data-v-ee47cd3c"]]);class Ft extends F{constructor(){super(...arguments);r(this,"Name","nodes.combine");r(this,"Inputs",[new L(!0,this,"Source 1"),new L(!0,this,"Source 2")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Mode","Burn",["Burn","Darken","Difference","Dodge","Divide","Exclusion","HardLight","HardMix","Lighten","LinearBurn","LinearDodge","LinearLight","LinearLightAddSub","Multiply","Negation","Overlay","PinLight","Screen","SoftLight","Subtract","VividLight","Overwrite"]),new y("Strength",0,0,1)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=this.Properties[0].Value,s=V(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var d,f;if(!this.Inputs[0].IsConnected||!this.Inputs[1].IsConnected)return u(0);const o=(d=this.Inputs[0].Links[0].In)==null?void 0:d.Value(i).toVar(),a=(f=this.Inputs[1].Links[0].In)==null?void 0:f.Value(i).toVar();switch(t){case"Burn":{const l=u(1).sub(u(1).sub(a).div(o)).toVar();return T(o,l,s)}case"Darken":{const l=Q(o,a).toVar();return T(o,l,s)}case"Difference":{const l=Be(a.sub(o)).toVar();return T(o,l,s)}case"Dodge":{const l=o.div(a.add(u(1e-12))).toVar();return T(o,l,s)}case"Divide":{const l=o.div(u(1).sub(a)).toVar();return T(o,l,s)}case"Exclusion":{const l=a.add(o).sub(u(2).mul(a).mul(o)).toVar();return T(o,l,s)}case"HardLight":{const l=u(A(1,J(2,A(1,o)).mul(A(1,a)))).toVar(),m=u(J(2,o).mul(a)).toVar(),p=u(xe(a,.5)).toVar(),h=u(m.mul(p).add(u(1).sub(p).mul(l))).toVar();return T(o,h,s)}case"HardMix":{const l=u(xe(u(1).sub(o),a)).toVar();return T(o,l,s)}case"Lighten":{const l=ue(a,o).toVar();return T(o,l,s)}case"LinearBurn":{const l=u(o.add(a.sub(1))).toVar();return T(o,l,s)}case"LinearDodge":{const l=o.add(a).toVar();return T(o,l,s)}case"LinearLight":{const l=u(Cs(a.lessThan(.5),ue(o.add(u(2).mul(a).sub(u(1))),u(0)),Q(o.add(u(2).mul(a.sub(.5))),u(1)))).toVar();return T(o,l,s)}case"LinearLightAddSub":{const l=u(a.add(J(2,o).sub(1))).toVar();return T(o,l,s)}case"Multiply":{const l=o.mul(a).toVar();return T(o,l,s)}case"Negation":{const l=u(A(1,Be(A(1,a).sub(o)))).toVar();return T(o,l,s)}case"Overlay":{const l=u(A(1,J(2,A(1,o)).mul(A(1,a)))).toVar(),m=u(J(2,o).mul(a)).toVar(),p=u(xe(o,.5)).toVar(),h=u(m.mul(p).add(u(1).sub(p).mul(l))).toVar();return T(o,h,s)}case"PinLight":{const l=u(xe(.5,a)).toVar(),m=u(l.mul(ue(J(2,o.sub(.5)),a))).toVar(),p=u(m.add(A(1,l).mul(Q(J(2,o),a)))).toVar();return T(o,p,s)}case"Screen":{const l=u(A(1,A(1,a).mul(A(1,o)))).toVar();return T(o,l,s)}case"SoftLight":{const l=u(A(1,J(2,A(1,o)).mul(A(1,a)))).toVar(),m=u(Ms(o).mul(J(2,a).sub(1)).add(J(2,o).mul(A(1,a)))).toVar(),p=u(xe(a,.5)).toVar(),h=u(m.mul(p).add(u(1).sub(p).mul(l))).toVar();return T(o,h,s)}case"Subtract":{const l=o.sub(a).toVar();return T(o,l,s)}case"VividLight":{const l=u(A(1,A(1,a).div(J(2,o)))).toVar(),m=u(a.div(J(2,A(1,o)))).toVar(),p=u(xe(.5,o)).toVar(),h=u(m.mul(p).add(u(1).sub(p).mul(l))).toVar();return T(o,h,s)}case"Overwrite":return T(o,a,s)}return u(0)})}}class Zt extends F{constructor(){super(...arguments);r(this,"Name","nodes.terrace");r(this,"Inputs",[new L(!0,this,"Param 1")]);r(this,"Outputs",[new L(!1,this,"Output")]);r(this,"Properties",[new y("Count",3,0,10,1)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var i;if(this.Inputs[0].IsConnected){const a=((i=this.Inputs[0].Links[0].In)==null?void 0:i.Value)(s).toVar();if(this.Properties[0].Value==0)return a;const d=u(1).div(t).toVar(),f=st(a.div(d)).toVar(),l=a.sub(f.mul(d)).div(d).toVar(),m=Q(u(2).mul(l),u(1)).toVar();return f.add(m).mul(d).toVar()}else return 0})}}class qt extends F{constructor(){super(...arguments);r(this,"Name","nodes.clamp");r(this,"Inputs",[new L(!0,this,"Source")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Min",0,0,1),new y("Max",1,0,1)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var a;if(!this.Inputs[0].IsConnected)return u(0);const o=(a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(i);return ye(o,t,s)})}}class Kt extends F{constructor(){super(...arguments);r(this,"Name","nodes.invert");r(this,"Inputs",[new L(!0,this,"Source")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate(),this.Outputs[0].Value=C(([t])=>{var i;if(!this.Inputs[0].IsConnected)return u(0);const s=(i=this.Inputs[0].Links[0].In)==null?void 0:i.Value(t);return u(1).sub(s)})}}class jt extends F{constructor(){super(...arguments);r(this,"Name","nodes.redistribution");r(this,"Inputs",[new L(!0,this,"Source")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Exponent",1,1,10)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var o;return this.Inputs[0].IsConnected?((o=this.Inputs[0].Links[0].In)==null?void 0:o.Value(s)).pow(t):u(0)})}}class Jt extends F{constructor(){super(...arguments);r(this,"Name","nodes.gradientNoise");r(this,"Outputs",[new L(!1,this,"Output")]);r(this,"Properties",[new y("Scale",10,0,100),new y("Offset X",0,0,100),new y("Offset Y",0,0,100)]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value);this.Outputs[0].Value=C(([o])=>{const a=w(o.x,o.y).mul(t).toVar(),d=w(s,i).toVar();return a.addAssign(d),Wt(a)})}}class Qt extends F{constructor(){super(...arguments);r(this,"Name","nodes.voronoi");r(this,"Outputs",[new L(!1,this,"Output"),new L(!1,this,"Cells"),new L(!1,this,"Bubbles")]);r(this,"Properties",[new y("Scale",10,1,100,0,"Transform","%"),new y("OffsetX",0,0,100,0,"Transform",""),new y("OffsetY",0,0,100,0,"Transform",""),new y("Angle",5,0,100,0,"Noise","")]);r(this,"IsRealtimeUpdate",!0);r(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value);this.Outputs[0].Value=C(([a])=>{const d=w(a.x,a.y).toVar(),f=w(s,i).toVar();d.addAssign(f);const l=ut({UV:d,angleOffset:o,cellDensity:t}).toVar();return Je(l.x,2)}),this.Outputs[1].Value=C(([a])=>{const d=w(a.x,a.y).toVar(),f=w(s,i).toVar();return d.addAssign(f),ut({UV:d,angleOffset:o,cellDensity:t}).toVar().y}),this.Outputs[2].Value=C(([a])=>{const d=w(a.x,a.y).toVar(),f=w(s,i).toVar();d.addAssign(f);const l=ut({UV:d,angleOffset:o,cellDensity:t}).toVar();return Os(Je(l.x,2))})}}const mn=C(([n,e,t])=>{const s=u(t).toVar(),i=u(e).toVar(),o=u(n).toVar();s.assign(ue(0,s));const a=u(ue(0,Q(1,i.sub(o).add(s).div(u(2).mul(s))))).toVar();return o.mul(a).add(i.mul(u(1).sub(a)).sub(s.mul(a).mul(u(1).sub(a))))}).setLayout({name:"smoothMin",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),vn=C(([n,e,t])=>{const s=u(t).toVar(),i=u(e).toVar(),o=u(n).toVar();s.assign(Q(0,s.negate()));const a=u(ue(0,Q(1,i.sub(o).add(s).div(u(2).mul(s))))).toVar();return o.mul(a).add(i.mul(u(1).sub(a)).sub(s.mul(a).mul(u(1).sub(a))))}).setLayout({name:"smoothMax",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),gn=C(([n])=>{const e=w(n).toVar();return Ne(Te(Re(e.xy,w(12.9898,78.233))).mul(43758.5453123))}).setLayout({name:"random",type:"float",inputs:[{name:"st",type:"vec2"}]}),wn=C(([n,e,t])=>{const s=u(t).toVar(),i=u(e).toVar(),o=w(n).toVar(),a=w(o.mul(i)).toVar(),d=w(st(a)).toVar(),f=w(Ne(a)).toVar(),l=u(gn(d).mul(2).sub(1).mul(s)).toVar(),m=u(Te(l)).toVar(),p=u(dt(l)).toVar(),h=w(f.sub(.5)).toVar(),M=w().toVar();return M.x.assign(h.x.mul(p).sub(h.y.mul(m))),M.y.assign(h.x.mul(m).add(h.y.mul(p))),M.add(.5).add(d).mod(1)}).setLayout({name:"tilingWithLimitedRotation",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"tileCount",type:"float"},{name:"maxAngle",type:"float"}]});class es extends F{constructor(){super(...arguments);r(this,"Name","nodes.crater");r(this,"Outputs",[new L(!1,this,"Output")]);r(this,"Properties",[new y("Smoothness",.5,0,1,0,"Crater params",""),new y("FloorHeight",-1,-5,5,0,"Crater params",""),new y("Radius",.16,0,1,0,"Crater params",""),new y("RimWidth",1.35,0,100,0,"Crater params",""),new y("RimSteepness",4,0,100,0,"Crater params",""),new y("X",.5,0,1,0,"Transform",""),new y("Y",.5,0,1,0,"Transform","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),a=V(this.Properties[4].Value),d=V(this.Properties[5].Value),f=V(this.Properties[6].Value);this.Outputs[0].Value=C(([l])=>{const m=w(l.x,l.y).toVar(),p=w(d,f).toVar(),h=u(Qe(m.sub(p)).div(ue(i,1e-4))).toVar(),M=u(h.mul(h).sub(1)).toVar(),b=u(Q(h.sub(1).sub(o),0)).toVar(),N=u(a.mul(b).mul(b)).toVar(),G=u(vn(M,s,t)).toVar();return G.assign(mn(G,N,t)),G.mul(i).add(.5).toVar()})}}class ts extends F{constructor(){super(...arguments);r(this,"Name","nodes.falloff");r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Strength",0,0,10)]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{const i=w(s.x,s.y).toVar(),o=u(Xt(w(.5),i.mod(1))).mul(t).toVar(),a=T(u(1),u(0),o).toVar();return Je(ye(a,0,1),2)})}}class ss extends F{constructor(){super(...arguments);r(this,"Name","nodes.mountain");r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Scale",3.55,0,100,0,"Noise Transform","%"),new y("Octaves Count",10,1,50,1,"Noise Params",""),new y("Offset X",-.08,-100,100,0,"Noise Transform",""),new y("Offset Y",-.54,-100,100,0,"Noise Transform",""),new y("Falloff",3,0,20,0,"Mountain",""),new y("Height",1,0,1,0,"Mountain",""),new y("Position X",.5,0,1,0,"Mountain Transform",""),new y("Position Y",.5,0,1,0,"Mountain Transform","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),a=V(this.Properties[4].Value),d=V(this.Properties[5].Value),f=V(this.Properties[6].Value),l=V(this.Properties[7].Value);this.Outputs[0].Value=C(([m])=>{const p=w(m.x,m.y).toVar(),h=u(Xt(w(f,l),p)).mul(a).toVar(),M=T(u(1),u(0),h).toVar(),b=Je(ye(M,0,1),2),N=p.sub(w(f,l).sub(.5)).toVar(),G=St(N,s,w(i,o),t).toVar();return ye(b.mul(G).mul(u(1.45).mul(d)),0,1)})}}class ns extends F{constructor(){super(...arguments);r(this,"Name","nodes.fastErosion");r(this,"Inputs",[new L(!0,this,"Inpute Height")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Tiles",4,0,20,0,"Erosion",""),new y("Octaves",5,0,20,1,"Erosion",""),new y("Gain",.5,0,1,0,"Erosion",""),new y("Lacunarity",2,0,10,0,"Erosion",""),new y("Slope strength",3,0,10,0,"Erosion",""),new y("Branch strength",3,0,10,0,"Erosion",""),new y("Erosion Strength",.04,0,1,0,"Erosion","")]);r(this,"IsRealtimeUpdate",!1);r(this,"terrainHeight");r(this,"waterVolume");r(this,"sedimentAmount");r(this,"tempTerrainHeight");r(this,"tempWaterVolume");r(this,"tempSedimentAmount")}Calculate(){this.BaseCalculate();const t=me(),s=t.GetRenderer(),i=t.Resolution,o=V(.1),a=V(.1),d=V(.1),f=V(1),l=V(.1),m=V(.1),p=V(9.8),h=V(.01),M=V(3),b=V(i),N=V(i);this.terrainHeight=Le(i*i,"float"),this.waterVolume=Le(i*i,"float"),this.sedimentAmount=Le(i*i,"float"),this.tempTerrainHeight=Le(i*i,"float"),this.tempWaterVolume=Le(i*i,"float"),this.tempSedimentAmount=Le(i*i,"float");const G=C(()=>{var R;const z=fe.modInt(i),U=fe.div(i),Y=Ke(z,U),D=w(Y.x,Y.y).div(i).toVar();if(this.Inputs[0].IsConnected){const B=((R=this.Inputs[0].Links[0].In)==null?void 0:R.Value)(D).toVar();this.terrainHeight.element(fe).assign(B)}}),k=C(([z,U])=>{const Y=u(U).toVar(),D=u(z).toVar();return D.assign(ye(D,oe(0),b.sub(oe(1)))),Y.assign(ye(Y,oe(0),N.sub(oe(1)))),Y.mul(b).add(D)}),q=C(([z,U])=>{const Y=u(U).toVar(),D=w(z).toVar(),R=u(J(.01,Ne(Te(u(Y).mul(12.9898)).mul(43758.5453)).mul(2).sub(1))).toVar();return At(D.add(w(R)))});C(([z,U,Y])=>{const D=oe(Y).toVar(),R=u(U).toVar(),K=u(z).toVar(),B=u(k(K,R)).toVar(),re=u(this.tempWaterVolume.element(B).add(a.mul(o))).toVar(),ne=u(this.tempSedimentAmount.element(B)).toVar(),Se=u(this.tempTerrainHeight.element(B)).toVar(),Ee=w(w(this.tempTerrainHeight.element(k(K.add(1),R)).sub(this.tempTerrainHeight.element(k(K.sub(1),R))),this.tempTerrainHeight.element(k(K,R.add(1))).sub(this.tempTerrainHeight.element(k(K,R.sub(1))))).mul(.5)).toVar(),Ae=u(Qe(Ee)).toVar();Ue(re.greaterThan(0).and(Ae.greaterThan(0)),()=>{const Ce=w(q(Ee,D)).toVar(),He=u(Q(re,Ae.mul(p).mul(o))).toVar(),ge=u(Q(re,He)).toVar(),Oe=$e($e(K,R).add($e(Nt(Ce)))).toVar(),ke=oe(k(Oe.x,Oe.y)).toVar();this.tempWaterVolume.element(ke).addAssign(ge),re.subAssign(ge);const ce=u(ue(Ae,h).mul(ge).mul(f)).toVar();Ue(ne.lessThan(ce),()=>{const Xe=u(Q(ce.sub(ne).mul(l),Se.sub(this.tempTerrainHeight.element(ke)))).toVar();ne.addAssign(Xe),this.tempTerrainHeight.element(B).assign(Se.sub(Xe))}).Else(()=>{const Xe=u(ne.sub(ce).mul(m)).toVar();ne.subAssign(Xe),this.tempTerrainHeight.element(B).assign(Se.add(Xe))});const _t=u(ne.mul(ge).div(re)).toVar();this.tempSedimentAmount.element(ke).addAssign(_t),ne.subAssign(_t)}),re.mulAssign(A(1,d.mul(o))),ne.assign(ue(0,ne)),this.tempWaterVolume.element(B).assign(re),this.tempSedimentAmount.element(B).assign(ne)});const ie=C(([z,U])=>{const Y=oe(U).toVar(),D=Ke(z.x,z.y).toVar();return D.y.mul(Y).add(D.x)});C(()=>{this.tempTerrainHeight.element(fe).addAssign(.5)});const ot=C(()=>{const z=oe(fe).toVar(),U=oe(z.modInt(b)).toVar(),Y=oe(z.div(b)).toVar(),D=oe(k(U,Y)).toVar();this.tempTerrainHeight.element(D).assign(this.terrainHeight.element(D)),this.tempWaterVolume.element(D).assign(this.waterVolume.element(D)),this.tempSedimentAmount.element(D).assign(this.sedimentAmount.element(D)),at(),Tt(M,()=>{const R=u(k(U,Y)).toVar(),K=u(this.tempWaterVolume.element(R).add(a.mul(o))).toVar(),B=u(this.tempSedimentAmount.element(R)).toVar(),re=u(this.tempTerrainHeight.element(R)).toVar(),ne=w(w(this.tempTerrainHeight.element(k(U.add(1),Y)).sub(this.tempTerrainHeight.element(k(U.sub(1),Y))),this.tempTerrainHeight.element(k(U,Y.add(1))).sub(this.tempTerrainHeight.element(k(U,Y.sub(1))))).mul(.5)).toVar(),Se=u(Qe(ne)).toVar();Ue(K.greaterThan(0).and(Se.greaterThan(0)),()=>{const Ee=w(q(ne,z)).toVar(),Ae=u(Q(K,Se.mul(p).mul(o))).toVar(),Ce=u(Q(K,Ae)).toVar(),He=$e($e(U,Y).add($e(Nt(Ee)))).toVar(),ge=oe(k(He.x,He.y)).toVar();this.tempWaterVolume.element(ge).addAssign(Ce),K.subAssign(Ce);const Oe=u(ue(Se,h).mul(Ce).mul(f)).toVar();Ue(B.lessThan(Oe),()=>{const ce=u(Q(Oe.sub(B).mul(l),re.sub(this.tempTerrainHeight.element(ge)))).toVar();B.addAssign(ce),this.tempTerrainHeight.element(R).assign(re.sub(ce))}).Else(()=>{const ce=u(B.sub(Oe).mul(m)).toVar();B.subAssign(ce),this.tempTerrainHeight.element(R).assign(re.add(ce))});const ke=u(B.mul(Ce).div(K)).toVar();this.tempSedimentAmount.element(ge).addAssign(ke),B.subAssign(ke)}),K.mulAssign(A(1,d.mul(o))),B.assign(ue(0,B)),this.tempWaterVolume.element(R).assign(K),this.tempSedimentAmount.element(R).assign(B),at(),this.terrainHeight.element(R).assign(this.tempTerrainHeight.element(R)),this.waterVolume.element(R).assign(this.tempWaterVolume.element(R)),this.sedimentAmount.element(R).assign(this.tempSedimentAmount.element(R)),at()}),this.terrainHeight.element(D).assign(this.tempTerrainHeight.element(D)),this.waterVolume.element(D).assign(this.tempWaterVolume.element(D)),this.sedimentAmount.element(D).assign(this.tempSedimentAmount.element(D))}),it=G().compute(i*i),ve=ot().compute(i*i);s==null||s.GPURenderer.compute(it),s==null||s.GPURenderer.computeAsync(ve),this.Outputs[0].Value=C(([z])=>{if(this.Inputs[0].IsConnected){w(z.x,z.y).toVar();const U=fe.modInt(i),Y=fe.div(i),D=Ke(U,Y);return this.terrainHeight.element(ie(D,i)).toVar()}else return 0})}}class os extends F{constructor(){super(...arguments);r(this,"Name","nodes.cracks");r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Scale",10,0,100,0,"Transform","%"),new y("Angle",0,0,100,0,"Noise",""),new y("Thickness",.03,0,1,0,"Noise",""),new y("Distortion",0,0,100,0,"Distortion",""),new y("Octaves",10,0,100,1,"Distortion",""),new y("Scale",10,0,100,0,"Distortion",""),new y("Offset X",0,-100,100,0,"Distortion",""),new y("Offset Y",0,-100,100,0,"Distortion","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),a=V(this.Properties[4].Value),d=V(this.Properties[5].Value),f=V(this.Properties[6].Value),l=V(this.Properties[7].Value);this.Outputs[0].Value=C(([m])=>{const p=w(m.x,m.y).toVar(),h=w(St(p.mul(2).mul(.5),a,w(f,l),d)).mul(o).mul(.2);return fn({uv:p.add(h),angle:s,scale:t,thickness:i})})}}class is extends F{constructor(){super(...arguments);r(this,"Name","nodes.transform");r(this,"Inputs",[new L(!0,this,"Input")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Properties",[new y("Scale X",1,0,100,0,"Scale",""),new y("Scale Y",1,0,100,0,"Scale",""),new y("Position X",0,-100,100,0,"Position",""),new y("Position Y",0,-100,100,0,"Position",""),new y("Midpoint X",.5,0,1,0,"Rotation",""),new y("Midpoint Y",.5,0,1,0,"Rotation",""),new y("Angle",0,-360,360,0,"Rotation","")]);r(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),a=V(this.Properties[4].Value),d=V(this.Properties[5].Value),f=V(this.Properties[6].Value);this.Outputs[0].Value=C(([l])=>{var k;const m=w(l.x,l.y).toVar(),p=w(t,s).toVar(),h=w(i,o).toVar(),M=w(a,d).toVar(),b=f.mul(Gt.div(180)).toVar(),N=w(dt(b).mul(m.x.sub(M.x)).add(Te(b).mul(m.y.sub(M.y))).add(M.x),dt(b).mul(m.y.sub(M.y)).sub(Te(b).mul(m.x.sub(M.x))).add(M.y));return m.assign(N),m.addAssign(h),m.mulAssign(p),(k=this.Inputs[0].Links[0].In)==null?void 0:k.Value(m).toVar()})}}class as extends F{constructor(){super(...arguments);r(this,"Inputs",[new L(!0,this,"Input")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Name","nodes.tile");r(this,"Properties",[new y("Tile Count",1,0,100,1),new y("Angle Threshold",0,0,360,0)])}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value);this.Outputs[0].Value=C(([i])=>{var l;var o=w(i).toVar(),a=s.mul(Gt.div(180));const d=wn(o,t,a).toVar();return(l=this.Inputs[0].Links[0].In)==null?void 0:l.Value(d).toVar()})}}class rs extends F{constructor(){super(...arguments);r(this,"Inputs",[new L(!0,this,"Input")]);r(this,"Outputs",[new L(!1,this,"Result")]);r(this,"Name","nodes.height");r(this,"Properties",[new y("Height",1,0,1,0)])}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value);this.Outputs[0].Value=C(([s])=>{var a;var i=w(s).toVar();return((a=this.Inputs[0].Links[0].In)==null?void 0:a.Value(i).toVar()).mul(t)})}}const Vn={class:"node-list"},yn=X({__name:"NodeList",setup(n){return(e,t)=>{const s=te("font-awesome-icon");return v(),g("div",Vn,[c(ht,null,{header:_(()=>[O(P(e.$t("nodeCategories.testNodes")),1)]),default:_(()=>[c(j,{"-graph-node":x(Ut)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.constant")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(zt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.perlinNoise")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(ss)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.mountain")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(Zt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.terrace")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(Ft)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.combine")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(qt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.clamp")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(Kt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.invert")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(jt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.redistribution")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(Jt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.gradientNoise")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(Qt)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.voronoi")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(es)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.crater")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(ts)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.falloff")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(ns)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.fastErosion")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(os)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.cracks")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(is)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.transform")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(as)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.tile")),1)]),_:1},8,["-graph-node"]),c(j,{"-graph-node":x(rs)},{default:_(()=>[c(s,{icon:["fas","circle-nodes"]}),O(" "+P(e.$t("nodes.height")),1)]),_:1},8,["-graph-node"])]),_:1}),c(ht,null,{header:_(()=>t[0]||(t[0]=[O("Basic nodes")])),_:1})])}}}),Sn=E(yn,[["__scopeId","data-v-2ba13cd7"]]),bn={class:"padding"},_n={class:"header disable-user-select"},Pn={class:"body disable-user-select"},In=X({__name:"FrameTab",props:{wheelFocus:{type:Boolean,default:!0}},setup(n){const e=n,t=$(),s=i=>{t.value&&e.wheelFocus&&t.value.focus()};return(i,o)=>(v(),g("div",bn,[S("div",{class:"main",tabindex:"0",ref_key:"selfEl",ref:t,onWheel:s},[S("div",_n,[de(i.$slots,"header",{},void 0,!0)]),S("div",Pn,[de(i.$slots,"default",{},void 0,!0)])],544)]))}}),tt=E(In,[["__scopeId","data-v-bce70494"]]);class Ot{static pathExists(e,t){if(e===t)return!0;const s=new Set;return this.dfs(e,t,s)}static dfs(e,t,s){if(e===t)return!0;if(s.has(e))return!1;s.add(e);for(const i of e.Outputs)for(const o of i.Links)if(o.Out!=null&&o.Out!=null){const a=o.Out.ParentNode;if(this.dfs(a,t,s))return!0}return!1}}const Nn=X({__name:"TerminalRenderer",props:{Term:{type:L,required:!0}},setup(n,{expose:e}){const t=et(),s=n,i=m=>{t.SourceTerminal=s.Term,t.IsDragging=!0,window.addEventListener("mouseup",o)},o=m=>{var b,N,G;window.removeEventListener("mouseup",o),t.IsDragging=!1;var p=t.DestinationTerminal,h=t.SourceTerminal;if(p!=null&&p!=h&&!(h!=null&&h.IsInput&&p.IsInput)&&(h==null?void 0:h.ParentNode)!=p.ParentNode){if(h!=null&&h.IsInput){if(Ot.pathExists(h==null?void 0:h.ParentNode,p.ParentNode))return;h.Links.forEach(k=>{var q,ie;(ie=(q=h==null?void 0:h.ParentNode)==null?void 0:q.ParentGraph)==null||ie.DeleteLink(k)})}if(p.IsInput){if(Ot.pathExists(p==null?void 0:p.ParentNode,h==null?void 0:h.ParentNode))return;p.Links.forEach(k=>{var q,ie;(ie=(q=p==null?void 0:p.ParentNode)==null?void 0:q.ParentGraph)==null||ie.DeleteLink(k)})}(N=(b=s.Term.ParentNode)==null?void 0:b.ParentGraph)==null||N.AddLink(p,h);var M=me();(G=s.Term.ParentNode)!=null&&G.IsRealtimeUpdate&&(M.ChangeEvent=!M.ChangeEvent)}},a=m=>{t.IsDragging&&(t.DestinationTerminal=s.Term)},d=m=>{t.IsDragging&&(t.DestinationTerminal=null)},f=$();Lt(()=>{De(()=>{l()})});const l=()=>{var h,M,b,N;var m=((h=f.value)==null?void 0:h.offsetLeft)+((M=f.value)==null?void 0:M.offsetWidth)/2+2,p=((b=f.value)==null?void 0:b.offsetTop)+((N=f.value)==null?void 0:N.offsetHeight)/2+2;s.Term.SetOffset(m,p)};return e({SetOffset:l}),(m,p)=>{const h=Pe("tooltip");return Z((v(),g("div",{class:Ie(["node-terminal",{connected:s.Term.IsConnected},"disable-user-select"]),onMousedown:[p[0]||(p[0]=ae(()=>{},["right","stop"])),ae(i,["left"])],onMouseover:a,onMouseleave:d,ref_key:"selfEl",ref:f},null,34)),[[h,{content:s.Term.Name,placement:s.Term.IsInput?"left":"right"}]])}}}),kt=E(Nn,[["__scopeId","data-v-278bc81c"]]);class be extends F{constructor(){super(...arguments);r(this,"Inputs",[new L(!0,this,"")]);r(this,"Outputs",[new L(!1,this,"")]);r(this,"Category",nt.Buffer)}Calculate(){this.BaseCalculate();var t=this.Inputs[0].Links[0].In,s=this.Outputs[0];s.Value=t==null?void 0:t.Value}}const Mn={},Cn={class:"loader"};function On(n,e){return v(),g("span",Cn)}const ls=E(Mn,[["render",On],["__scopeId","data-v-8c5c5c6f"]]);class us{constructor(){r(this,"IsSubGraph",!1);r(this,"Nodes",new Array);r(this,"Links",new Array)}get HasSelected(){return this.Nodes.some(e=>e.IsSelected)||this.Links.some(e=>e.IsSelected)}AddNode(e,t=!0){var s=this.Nodes.indexOf(e);s==-1&&(e.ParentGraph=this,this.Nodes.push(e),t&&le.PushState(this))}DeleteLink(e,t=!0){var s=this.Links.indexOf(e);s!=-1&&(e.DeleteLinkFromTerminals(),this.Links.splice(s,1),t&&le.PushState(this))}AddLink(e,t,s=!0){if(!(e.IsInput&&t.IsInput||!e.IsInput&&!t.IsInput)){var i=new Ht;e.IsInput?(i.In=t,i.Out=e):(i.In=e,i.Out=t),t.Links.push(i),e.Links.push(i),this.Links.push(i),s&&le.PushState(this)}}DeleteNode(e,t=!0){if(e!=null){var s=pe();s.SelectedNode==e&&(s.SelectedNode=null),s.LockedNode==e&&(s.LockedNode=null),e.Inputs.forEach(o=>{var a=o.Links.map(d=>d);a.forEach(d=>{this.DeleteLink(d)})}),e.Outputs.forEach(o=>{var a=o.Links.map(d=>d);a.forEach(d=>{this.DeleteLink(d)})});var i=this.Nodes.indexOf(e);i!=-1&&this.Nodes.splice(i,1),t&&le.PushState(this)}}DeleteSelected(e=!0){this.Nodes.filter(s=>s.IsSelected).forEach(s=>this.DeleteNode(s,!1));var t=pe();t.SelectedNode=void 0,this.Links.filter(s=>s.IsSelected).forEach(s=>this.DeleteLink(s,!1)),e&&le.PushState(this)}DeselectAll(){var e=pe();e.SelectedNode=void 0,this.Nodes.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1)),this.Links.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1))}SelectAll(){this.Nodes.forEach(e=>e.SetSelected(!0))}}class W{static register(e){var t=new e;this.classMap.set(t.constructor.name,e)}static create(e,...t){const s=this.classMap.get(e);if(!s)throw new Error(`Class ${e} not registered`);return new s(...t)}}r(W,"classMap",new Map);class Ye{static Serialize(e){var a,d,f,l,m,p,h,M;var t=new kn;if(e.Nodes!=null&&e.Nodes.length>0)for(const b of e.Nodes){var s=new xn;if(s.NodeType=b.constructor.name,s.NodeGuid=b.Id,s.NodePostition=b.Position,b.Properties!=null&&b.Properties.length>0)for(const N of b.Properties){var i=new Ln;i.Value=N.Value,s.Properties==null&&(s.Properties=new Array),s.Properties.push(i)}t.Nodes==null&&(t.Nodes=new Array),t.Nodes.push(s)}if(e.Links!=null&&e.Links.length>0)for(const b of e.Links){var o=new $n;o.FromNodeGuid=(d=(a=b.In)==null?void 0:a.ParentNode)==null?void 0:d.Id,o.ToNodeGuid=(l=(f=b.Out)==null?void 0:f.ParentNode)==null?void 0:l.Id,o.FromTerminalIndex=(p=(m=b.In)==null?void 0:m.ParentNode)==null?void 0:p.Outputs.indexOf(b.In),o.ToTerminalIndex=(M=(h=b.Out)==null?void 0:h.ParentNode)==null?void 0:M.Inputs.indexOf(b.Out),t.Links==null&&(t.Links=new Array),t.Links.push(o)}return t}static Deserialize(e){var t=new us;if(e.Nodes!=null&&e.Nodes.length>0)for(var s of e.Nodes){var i=W.create(s.NodeType);if(i.Id=s.NodeGuid,i.Move(s.NodePostition.X,s.NodePostition.Y),s.Properties!=null&&s.Properties.length>0)for(var o=0;o<s.Properties.length;o++)i.Properties[o].Value=s.Properties[o].Value;t.AddNode(i,!1)}if(e.Links!=null&&e.Links.length>0)for(var a of e.Links){var d=Pt(t.Nodes).firstOrDefault(l=>l.Id==a.FromNodeGuid),f=Pt(t.Nodes).firstOrDefault(l=>l.Id==a.ToNodeGuid);d==null||f==null||t.AddLink(d.Outputs[a.FromTerminalIndex],f.Inputs[a.ToTerminalIndex],!1)}return t}}class kn{constructor(){r(this,"Nodes");r(this,"Links")}static ToJson(e){return JSON.stringify(e)}}class xn{constructor(){r(this,"NodeGuid");r(this,"NodeType");r(this,"NodePostition");r(this,"Properties")}}class Ln{constructor(){r(this,"Value")}}class $n{constructor(){r(this,"FromNodeGuid");r(this,"ToNodeGuid");r(this,"FromTerminalIndex");r(this,"ToTerminalIndex")}}class Dn{constructor(e){r(this,"buffer");r(this,"capacity");r(this,"head",0);r(this,"tail",0);r(this,"size",0);r(this,"poppedItems",[]);if(e<=0)throw new Error("Capacity must be greater than 0");this.capacity=e,this.buffer=new Array(e)}get hasValues(){return this.size>0}get hasPoppedItems(){return this.poppedItems.length>0}push(e){this.poppedItems=[],this.size===this.capacity?(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.head=(this.head+1)%this.capacity):(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++)}pop(){if(!this.hasValues)return;this.tail=(this.tail-1+this.capacity)%this.capacity;const e=this.buffer[this.tail];return this.size--,this.poppedItems.push(e),e}unpop(){if(!this.hasPoppedItems)return;const e=this.poppedItems.pop();return this.size===this.capacity&&(this.head=(this.head+1)%this.capacity),this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++,e}toArray(){const e=[];for(let t=0;t<this.size;t++){const s=(this.head+t)%this.capacity;e.push(this.buffer[s])}return e}peek(){if(this.hasValues)return this.buffer[(this.tail-1+this.capacity)%this.capacity]}get length(){return this.size}}class le{static get HasValues(){return this.ActionHistoryBuffer.hasValues}static get HasPopped(){return this.ActionHistoryBuffer.hasPoppedItems}static PushState(e){this.ActionHistoryBuffer.push(Ye.Serialize(e))}static UnpopState(){if(this.ActionHistoryBuffer.hasPoppedItems){var e=this.ActionHistoryBuffer.unpop();return Ye.Deserialize(e)}return null}static PopState(){if(this.ActionHistoryBuffer.hasValues){var e=this.ActionHistoryBuffer.pop();return Ye.Deserialize(e)}return null}}r(le,"ActionHistoryBuffer",new Dn(25));class ft{constructor(e,t,s,i){r(this,"X",0);r(this,"Y",0);r(this,"Height",0);r(this,"Width",0);this.X=e,this.Y=t,this.Height=s,this.Width=i}ContainsRect(e){return this.X<=e.X&&e.X+e.Width<=this.X+this.Width&&this.Y<=e.Y&&e.Y+e.Height<=this.Y+this.Height}ContainsPoint(e,t){return this.X<=e&&e<this.X+this.Width&&this.Y<=t&&t<this.Y+this.Height}IntersectsWith(e){return e.X<this.X+this.Width&&this.X<e.X+e.Width&&e.Y<this.Y+this.Height&&this.Y<e.Y+e.Height}static Intersects(e,t){return e.X<t.X+t.Width&&t.X<e.X+e.Width&&e.Y<t.Y+t.Height&&t.Y<e.Y+e.Height}}const Rn=X({__name:"ContextMenu",props:{CloseOnAnyClick:{type:Boolean,default:!0}},setup(n,{expose:e}){const t=$(!1),s=$();ps();const i=p=>{t.value=!0,De(()=>{s.value!=null&&s.value!=null&&(s.value.style.left=p.pageX+"px",s.value.style.top=p.pageY+"px",o(),window.addEventListener("mousedown",m))})},o=()=>{if(s.value!=null&&s.value!=null){const h=s.value.getBoundingClientRect();if(h.y+h.height>window.innerHeight){var p=h.y+h.height-window.innerHeight;s.value.style.top=h.y-p+"px"}if(h.y<0&&(s.value.style.top="0px"),h.x+h.width>window.innerWidth){var p=h.x+h.width-window.innerWidth;s.value.style.left=h.x-p+"px"}h.x<0&&(s.value.style.left="0px")}},a=p=>{t.value=!0,De(()=>{if(s.value!=null&&s.value!=null){var h=p.getBoundingClientRect();s.value.style.left=h.x+"px",s.value.style.top=h.y+h.height+"px",o(),window.addEventListener("mousedown",m)}})},d=p=>{t.value=!0,De(()=>{if(s.value!=null&&s.value!=null){var h=p.getBoundingClientRect(),M=s.value.getBoundingClientRect();s.value.style.left=h.x-M.width+"px",s.value.style.top=h.y+"px",o(),window.addEventListener("mousedown",m)}})},f=p=>{t.value=!0,De(()=>{if(s.value!=null&&s.value!=null){var h=p.getBoundingClientRect();s.value.getBoundingClientRect(),s.value.style.left=h.x+h.width+"px",s.value.style.top=h.y+"px",o(),window.addEventListener("mousedown",m)}})},l=()=>{window.removeEventListener("mousedown",m),t.value=!1},m=p=>{if(s.value!=null){var h=s.value.getBoundingClientRect(),M=new ft(h.x,h.y,h.height,h.width);M.ContainsPoint(p.clientX,p.clientY)||(t.value=!1,window.removeEventListener("mousedown",m))}};return e({Open:i,Close:l,OpenUnder:a,OpenLeft:d,OpenRight:f}),(p,h)=>(v(),H(vs,{name:"open"},{default:_(()=>[(v(),H(ms,{to:"body"},[t.value?(v(),g("div",{key:0,onContextmenu:h[0]||(h[0]=ae(()=>{},["prevent"])),onMousedown:h[1]||(h[1]=ae(()=>{},["stop"])),ref_key:"ContextMenu",ref:s,class:"context-menu disable-user-select"},[de(p.$slots,"default",{onOnmousedown:l},void 0,!0)],544)):se("",!0)]))]),_:3}))}}),bt=E(Rn,[["__scopeId","data-v-a3ad6a7c"]]),Tn=X({__name:"ContextMenuItem",props:{Active:{type:Boolean,default:!1}},setup(n){return(e,t)=>(v(),g("button",{class:Ie([["btn",{active:n.Active}],"btn"]),style:{padding:"5px"}},[de(e.$slots,"default",{},void 0,!0)],2))}}),je=E(Tn,[["__scopeId","data-v-3fbc2fef"]]),An={class:"node-container"},Xn={class:"node-terminals left"},Gn={class:"node-center"},Yn={class:"node-name"},Bn={class:"node-terminals right"},En=X({props:{Offset:{type:I,required:!0},Zoom:{type:Number,required:!0},Node:{type:F,required:!0},AllNodes:{type:Array,default:new Array}},data(){return{LastMousePosition:new I(0,0),IsDragging:!1,ContextMenu:!1}},created:function(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted:function(){this.$nextTick(()=>{var n=this.$el;this.Node.SetSize(n.offsetHeight,n.offsetWidth),this.Node.Move(this.Node.Position.X-this.Node.Width/2,this.Node.Position.Y-this.Node.Height/2);var e=new ResizeObserver(this.OnNodeResize);e.observe(this.$refs.node)})},computed:{PriviewLocked:function(){var n=pe();return n.LockedNode==this.Node},Top:function(){var n=this.Node.Position.Y;return n+"px"},Left:function(){var n=this.Node.Position.X;return n+"px"},Cursor:function(){return this.IsDragging?"grabbing":"default"},ZIndex:function(){return this.Node.IsSelected?"1":"0"},Blur:function(){return 4/this.Zoom+"px"},Border:function(){return this.Node.IsCalculated?"solid":"dashed"},IsNodeLocked:function(){var n=pe(),e=n.LockedNode;return e!=null&&e==this.Node}},methods:{OpenContextMenu(n){this.$refs.contextMenu.Open(n)},CloseContextMenu(){this.$refs.contextMenu.Close()},OnNodeResize:function(){if(this.$refs.terminals!=null){var n=this.$refs.terminals;n.forEach(e=>{e.SetOffset()})}},LockNode:function(){var n=pe(),e=me();n.LockedNode==this.Node?n.LockedNode=null:(n.LockedNode=this.Node,this.Node.SetSelected(!0),e.ChangeEvent=!e.ChangeEvent)},Down:function(n,e,t){var i,o,a,d,f;if(this.IsDragging=!0,this.LastMousePosition.X=n,this.LastMousePosition.Y=e,t)this.Node.SetSelected(!((i=this.Node)!=null&&i.IsSelected));else{var s=(o=this.Node.ParentGraph)==null?void 0:o.Nodes.filter(l=>l.IsSelected);s.length>1?this.Node.IsSelected==!1&&((a=this.Node.ParentGraph)==null||a.DeselectAll(),this.Node.SetSelected(!0)):((d=this.Node.ParentGraph)==null||d.DeselectAll(),this.Node.SetSelected(!0))}(f=this.Node.ParentGraph)==null||f.Nodes.filter(l=>l.IsSelected).forEach(l=>{l.SetLastPosition(l.Position.X,l.Position.Y)}),le.PushState(this.Node.ParentGraph)},OnTouchDown:function(n){if(this.$refs.terminals!=null&&this.$refs.terminals.some(s=>s.$el==n.target||s==n.target))return;let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Down(e,t,!1)},OnMouseDown:function(n){this.$refs.terminals!=null&&this.$refs.terminals.some(e=>e.$el==n.target||e==n.target)||this.Down(n.clientX,n.clientY,n.shiftKey)},OnMouseUp:function(n){this.IsDragging=!1},OnTouchUp:function(n){this.IsDragging=!1},OnTouchMove:function(n){let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Move(e,t)},Move:function(n,e){var i;if(this.IsDragging){var t=(n-this.LastMousePosition.X)/this.Zoom,s=(e-this.LastMousePosition.Y)/this.Zoom;(i=this.Node.ParentGraph)==null||i.Nodes.filter(o=>o.IsSelected).forEach(o=>{o.Move(o.LastPosition.X+t,o.LastPosition.Y+s)})}},OnMouseMove:function(n){this.Move(n.clientX,n.clientY)}}}),Hn=X({...En,__name:"NodeRenderer",setup(n){return $t(e=>({"565ed938":e.Cursor,f3d0d29a:e.Top,"3cd77669":e.Left,"7b303a5a":e.ZIndex})),(e,t)=>{const s=te("font-awesome-icon"),i=Pe("tooltip");return v(),g("div",{class:Ie([{node:!(e.Node instanceof x(be))},{"node-buffer":e.Node instanceof x(be)},"disable-user-select",{"not-calculated":e.Node.CalculationState==x(_e).NotCalculated&&!(e.Node instanceof x(be))},{selected:e.Node.IsSelected},{lockedPreview:e.PriviewLocked},{"node-without-inputs":e.Node.Inputs.length==0}]),ref:"node",onMousedown:[t[3]||(t[3]=ae((...o)=>e.OnMouseDown&&e.OnMouseDown(...o),["left"])),t[7]||(t[7]=ae((...o)=>e.OpenContextMenu&&e.OpenContextMenu(...o),["right"]))],onTouchmove:t[4]||(t[4]=(...o)=>e.OnTouchMove&&e.OnTouchMove(...o)),onTouchstart:t[5]||(t[5]=(...o)=>e.OnTouchDown&&e.OnTouchDown(...o)),onTouchend:t[6]||(t[6]=(...o)=>e.OnTouchUp&&e.OnTouchUp(...o))},[S("div",An,[S("div",Xn,[(v(!0),g(ee,null,Ve(e.Node.Inputs,o=>(v(),H(kt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))]),S("div",Gn,[e.Node instanceof x(be)?se("",!0):(v(),g(ee,{key:0},[Z((v(),g("a",{class:"lock-icon",onClick:t[0]||(t[0]=o=>e.LockNode())},[e.IsNodeLocked?(v(),H(s,{key:0,icon:["fas","lock"]})):(v(),H(s,{key:1,icon:["fas","lock-open"]}))])),[[i,{content:e.$t("tt.lockPreview"),placement:"bottom"}]]),S("div",Yn,P(e.$t(e.Node.Name)),1),e.Node.CalculationState==x(_e).Calculation?(v(),H(ls,{key:0})):se("",!0)],64))]),S("div",Bn,[(v(!0),g(ee,null,Ve(e.Node.Outputs,o=>(v(),H(kt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))])]),c(bt,{ref:"contextMenu",CloseOnAnyClick:!0},{default:_(()=>[c(je,null,{default:_(()=>[c(s,{icon:["far","copy"]}),O(""+P(e.$t("tt.copy")),1)]),_:1}),c(je,{onClick:t[1]||(t[1]=o=>{var a,d;(a=e.Node.ParentGraph)==null||a.DeleteNode(e.Node),(d=e.Node.ParentGraph)==null||d.DeleteSelected(),e.CloseContextMenu()}),style:{color:"var(--vt-c-red)"}},{default:_(()=>[c(s,{icon:["far","trash-can"]}),O(""+P(e.$t("tt.delete")),1)]),_:1}),t[8]||(t[8]=S("hr",null,null,-1)),c(je,{onClick:t[2]||(t[2]=o=>{e.LockNode(),e.CloseContextMenu()})},{default:_(()=>[e.IsNodeLocked?(v(),H(s,{key:0,icon:["fas","lock"]})):(v(),H(s,{key:1,icon:["fas","lock-open"]})),e.IsNodeLocked?(v(),g(ee,{key:2},[O(" "+P(e.$t("tt.unlockPreview")),1)],64)):(v(),g(ee,{key:3},[O(" "+P(e.$t("tt.lockPreview")),1)],64))]),_:1})]),_:1,__:[8]},512)],34)}}}),xt=E(Hn,[["__scopeId","data-v-1d778793"]]),Un={},Wn={class:"canvas",xmlns:"http://www.w3.org/2000/svg"};function zn(n,e){return v(),g("svg",Wn,[de(n.$slots,"default",{},void 0,!0)])}const Fn=E(Un,[["render",zn],["__scopeId","data-v-81940268"]]),Zn=["points"],qn=X({computed:{Points(){var t,s,i,o,a,d;var n=I.Add((s=(t=this.Link.In)==null?void 0:t.ParentNode)==null?void 0:s.Position,(i=this.Link.In)==null?void 0:i.OffsetPosition),e=I.Add((a=(o=this.Link.Out)==null?void 0:o.ParentNode)==null?void 0:a.Position,(d=this.Link.Out)==null?void 0:d.OffsetPosition);return`${n.X},${n.Y} ${n.X+20},${n.Y} ${e.X-20},${e.Y} ${e.X},${e.Y}`}}}),Kn=X({...qn,__name:"LinkRenderer",props:{Link:{type:Ht,required:!0}},setup(n){const e=n,t=()=>{e.Link.SetSelected(!0)},s=i=>{var l;var o=e.Link.In,a=e.Link.Out;if(!(o==null||a==null)){var d=new be;d.Move(i.offsetX,i.offsetY);var f=(l=o.ParentNode)==null?void 0:l.ParentGraph;f!=null&&(f.DeleteLink(e.Link),f.AddNode(d),f.AddLink(o,d.Inputs[0]),f.AddLink(d.Outputs[0],a))}};return(i,o)=>(v(),g("polyline",{onClick:t,onDblclick:s,points:i.Points,class:Ie(["line",{selected:e.Link.IsSelected}])},null,42,Zn))}}),jn=E(Kn,[["__scopeId","data-v-a61d9acd"]]),Jn={},Qn={class:"tool-bar-container"};function eo(n,e){return v(),g("div",Qn,[de(n.$slots,"default",{},void 0,!0)])}const pt=E(Jn,[["render",eo],["__scopeId","data-v-b20ca96b"]]),to={},so={class:"tool-bar-body"};function no(n,e){return v(),g("div",so,[de(n.$slots,"default")])}const he=E(to,[["render",no]]);class ds extends F{constructor(){super(...arguments);r(this,"Category",nt.Buffer);r(this,"Position",new I(1e3,1e3))}}const oo={key:0,class:"selection-box"},io={class:"offset-container",ref:"offset_container"},ao=["points"],ro={key:1,style:{"pointer-events":"none",height:"100%",width:"100%",padding:"30px"}},lo=X({props:{MinScale:{type:Number,default:.5},MaxScale:{type:Number,default:2}},data(){return{Offset:new I(0,0),SelectionBox:new ft(0,0,0,0),SelectionBoxVisibility:!1,LastMouse:new I(0,0),LastOffset:new I(0,0),Zoom:1,isDragging:!1,_Graph:new us,dragStore:et(),points:"",GridSize:20,isDragOver:!1,fakeNode:new ds}},computed:{Nodes:function(){return this._Graph.Nodes},OffsetXStyle:function(){return this.Offset.X+"px"},OffsetYStyle:function(){return this.Offset.Y+"px"},EditorCursor:function(){return this.isDragging?"grabbing":"default"},SelectionBoxX:function(){return this.SelectionBox.X+"px"},SelectionBoxY:function(){return this.SelectionBox.Y+"px"},SelectionBoxHeight:function(){return this.SelectionBox.Height+"px"},SelectionBoxWidth:function(){return this.SelectionBox.Width+"px"},OffsetStyle:function(){var n=this.GridSize/2*this.Zoom;return this.Offset.X-n+"px "+(this.Offset.Y-n)+"px"},ScaleGridStyle:function(){var n=(this.GridSize*this.Zoom).toString();return`${n}px ${n}px`}},created(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted(){this.$nextTick(()=>{var e;this.$el;var n=((e=this.$parent)==null?void 0:e.$el).parentElement;n!=null&&(n.onkeydown=this.KeysHandler)})},methods:{SaveGraph(){var n=Ye.Serialize(this._Graph),e=JSON.stringify(n);console.log(e);var t=JSON.parse(e);console.log(t);var s=Ye.Deserialize(t);console.log(s)},Undo(){var n=le.PopState();n!=null&&(this._Graph=n)},Redo(){var n=le.UnpopState();n!=null&&(this._Graph=n)},isChild(n,e){for(var t=e.parentNode;t!=null;){if(t==n)return!0;t=t.parentNode}return!1},dragenter(){this.isDragOver=!0},dragleave(n){var e=this.$el,t=n.target;this.isChild(e,t)||(this.isDragOver=!1)},drop(n){this.isDragOver=!1;var e=et(),t=e.getNode();if(t!=null){var s=this.$refs.editor,i=s.getBoundingClientRect();if(i!=null){le.PushState(this._Graph);var o=I.Div(new I(n.clientX-i.x-this.Offset.X,n.clientY-i.y-this.Offset.Y),this.Zoom);t==null||t.Move(o.X,o.Y),this._Graph.AddNode(t)}}},KeysHandler(n){n.key=="Delete"&&(le.PushState(this._Graph),this._Graph.DeleteSelected())},UpdateOffsetStyle(){var n=this.$refs.offset_container;n.style.left=this.OffsetXStyle,n.style.top=this.OffsetYStyle,n.style.scale=this.Zoom.toString()},OnMouseDownLeft:function(n){this.DrawGhostLine(n),n.target==this.$refs.editor&&(this.LastMouse=new I(n.clientX,n.clientY),this.SelectionBox.X=0,this.SelectionBox.Y=0,this.SelectionBox.Width=0,this.SelectionBox.Height=0,this.SelectionBoxVisibility=!0,this._Graph.DeselectAll())},OnMouseDownMiddle:function(n){this.isDragging=!0,this.LastMouse=new I(n.clientX,n.clientY),this.LastOffset={...this.Offset}},OnMouseMove:function(n){if(this.isDragging){n.preventDefault();var e=n.clientX-this.LastMouse.X,t=n.clientY-this.LastMouse.Y;this.Offset.X=this.LastOffset.X+e,this.Offset.Y=this.LastOffset.Y+t,this.UpdateOffsetStyle()}if(this.SelectionBoxVisibility){n.preventDefault();var s=new I(n.clientX,n.clientY),i=new I(Math.min(this.LastMouse.X,s.X),Math.min(this.LastMouse.Y,s.Y)),o=new I(Math.abs(this.LastMouse.X-s.X),Math.abs(this.LastMouse.Y-s.Y)),a=this.$refs.editor,d=a.getBoundingClientRect();this.SelectionBox.X=i.X-d.left,this.SelectionBox.Y=i.Y-d.top,this.SelectionBox.Width=o.X,this.SelectionBox.Height=o.Y,this._Graph.Nodes.forEach(f=>{var l=new ft(this.Offset.X+f.Position.X*this.Zoom,this.Offset.Y+f.Position.Y*this.Zoom,f.Height*this.Zoom,f.Width*this.Zoom);this.SelectionBox.IntersectsWith(l)?f.SetSelected(!0):f.SetSelected(!1)})}this.DrawGhostLine(n)},OnMouseUp:function(n){this.isDragging=!1,this.SelectionBoxVisibility=!1},OnWheel:function(n){let t=this.$refs.editor.getBoundingClientRect(),s=n.deltaY*.001,i=this.Zoom;this.Zoom=this.Clamp(this.Zoom-s,this.MinScale,this.MaxScale);let o=new I(n.clientX-t.left,n.clientY-t.top),a=(i-this.Zoom)/i;this.Offset=I.Add(this.Offset,I.Mul(I.Sub(o,this.Offset),a)),this.UpdateOffsetStyle()},DisableContextMenu(n){n.preventDefault()},Clamp:function(n,e,t){return Math.min(Math.max(n,e),t)},DrawGhostLine(n){var f;if(this.dragStore.IsDragging){var e=this.$refs.editor,t=e.getBoundingClientRect();if(n.preventDefault(),t!=null){var s=this.dragStore.SourceTerminal,i=I.Add((f=s.ParentNode)==null?void 0:f.Position,s.OffsetPosition),o=I.Div(new I(n.clientX-t.x-this.Offset.X,n.clientY-t.y-this.Offset.Y),this.Zoom),a=s.IsInput?o:i,d=s.IsInput?i:o;this.points=`${a.X},${a.Y} ${a.X+20},${a.Y} ${d.X-20},${d.Y} ${d.X},${d.Y}`}}}}}),uo=X({...lo,__name:"GraphRenderer",setup(n){return $t(e=>({"215df84a":e.EditorCursor,"37cbc353":e.SelectionBoxY,"37cbc352":e.SelectionBoxX,"2676868d":e.SelectionBoxHeight,"1ad8f3a0":e.SelectionBoxWidth,57915170:e.ScaleGridStyle,cc90e252:e.OffsetStyle})),(e,t)=>{const s=te("font-awesome-icon"),i=Pe("tooltip");return v(),g("div",{class:"graph-renderer dot",ref:"editor",onWheel:t[4]||(t[4]=(...o)=>e.OnWheel&&e.OnWheel(...o)),onMousedown:[t[5]||(t[5]=ae((...o)=>e.OnMouseDownLeft&&e.OnMouseDownLeft(...o),["left"])),t[6]||(t[6]=ae((...o)=>e.OnMouseDownMiddle&&e.OnMouseDownMiddle(...o),["middle"]))],onContextmenu:ae(()=>!1,["prevent","right"]),onDragover:t[7]||(t[7]=ae(()=>{},["prevent"])),onDragenter:t[8]||(t[8]=(...o)=>e.dragenter&&e.dragenter(...o)),onDragleave:t[9]||(t[9]=(...o)=>e.dragleave&&e.dragleave(...o)),onDrop:t[10]||(t[10]=(...o)=>e.drop&&e.drop(...o))},[c(pt,{class:"top-left"},{default:_(()=>[c(he,null,{default:_(()=>[Z((v(),g("a",{onClick:t[0]||(t[0]=o=>e.Undo())},[c(s,{icon:["fas","rotate-left"]})])),[[i,e.$t("tt.undo"),void 0,{bottom:!0}]]),Z((v(),g("a",{onClick:t[1]||(t[1]=o=>e.Redo())},[c(s,{icon:["fas","rotate-right"]})])),[[i,e.$t("tt.redo"),void 0,{bottom:!0}]])]),_:1}),c(he,null,{default:_(()=>[Z((v(),g("a",null,[c(s,{icon:["far","copy"]})])),[[i,e.$t("tt.copy"),void 0,{bottom:!0}]]),Z((v(),g("a",null,[c(s,{icon:["far","paste"]})])),[[i,e.$t("tt.paste"),void 0,{bottom:!0}]]),Z((v(),g("a",{class:Ie([{disabled:!e._Graph.HasSelected}]),style:{color:"var(--vt-c-red)"},onClick:t[2]||(t[2]=o=>e._Graph.DeleteSelected())},[c(s,{icon:["far","trash-can"]})],2)),[[i,e.$t("tt.delete"),void 0,{bottom:!0}]])]),_:1}),c(he,null,{default:_(()=>[Z((v(),g("a",null,[c(s,{icon:["fas","expand"]})])),[[i,e.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),_:1})]),_:1}),c(pt,{class:"bottom-left"},{default:_(()=>[c(he,null,{default:_(()=>[S("span",null,[e.Zoom<1?(v(),H(s,{key:0,icon:["fas","magnifying-glass-minus"]})):(v(),H(s,{key:1,icon:["fas","magnifying-glass-plus"]})),O(" "+P((e.Zoom*100).toFixed(0))+"%",1)])]),_:1}),c(he,null,{default:_(()=>[S("span",null,[c(s,{icon:["fas","up-down-left-right"]}),O(" X: "+P(e.Offset.X.toFixed())+" Y: "+P(e.Offset.Y.toFixed()),1)])]),_:1}),c(he,null,{default:_(()=>[Z((v(),g("a",{onClick:t[3]||(t[3]=o=>{e.Offset.Reset(),e.Zoom=1,e.UpdateOffsetStyle()})},[c(s,{icon:["fas","arrows-rotate"]})])),[[i,e.$t("tt.resetView")]])]),_:1}),c(he,null,{default:_(()=>[S("span",null,[c(s,{icon:["fas","circle-info"]}),O(" "+P(e.$t("hints.graphLmb")),1)])]),_:1}),c(he,null,{default:_(()=>[S("span",null,[c(s,{icon:["fas","circle-info"]}),O(" "+P(e.$t("hints.graphWheel")),1)])]),_:1})]),_:1}),e.SelectionBoxVisibility?(v(),g("div",oo)):se("",!0),S("div",io,[c(Fn,{id:"links-container"},{default:_(()=>[c(It,{name:"link"},{default:_(()=>[(v(!0),g(ee,null,Ve(e._Graph.Links,o=>(v(),H(jn,{key:o.Id,Link:o},null,8,["Link"]))),128))]),_:1}),e.dragStore.IsDragging?(v(),g("polyline",{key:0,class:"ghost-line",points:e.points},null,8,ao)):se("",!0)]),_:1}),c(It,{name:"delete",tag:"div"},{default:_(()=>[(v(!0),g(ee,null,Ve(e.Nodes,o=>(v(),H(xt,{key:o.Id,Offset:e.Offset,Zoom:e.Zoom,Node:o},null,8,["Offset","Zoom","Node"]))),128))]),_:1}),c(xt,{Offset:e.Offset,Zoom:e.Zoom,Node:e.fakeNode},null,8,["Offset","Zoom","Node"])],512),e.isDragOver?(v(),g("div",ro,t[11]||(t[11]=[S("div",{style:{height:"100%",width:"100%","border-radius":"50px",border:"4px dashed var(--vt-c-black-mute)"}},null,-1)]))):se("",!0)],544)}}}),co=E(uo,[["__scopeId","data-v-a00ad599"]]),ho={style:{height:"100%"}},fo={style:{"margin-left":"5px"}},po={style:{"margin-left":"5px"}},mo=X({__name:"EditorView",setup(n){return(e,t)=>{const s=te("font-awesome-icon");return v(),g("div",ho,[c(tt,{style:{width:"20%",display:"inline-block"}},{header:_(()=>[c(s,{icon:["fas","list"]}),t[0]||(t[0]=O()),S("span",fo,P(e.$t("windows.nodesList")),1)]),default:_(()=>[c(Sn)]),_:1}),c(tt,{style:{width:"80%",display:"inline-block"}},{header:_(()=>[c(s,{icon:["fas","circle-nodes"]}),t[1]||(t[1]=O()),S("span",po,P(e.$t("windows.graph")),1)]),default:_(()=>[c(co)]),_:1})])}}}),vo={style:{display:"flex","flex-direction":"row"}},go={style:{width:"100%","font-weight":"bold","text-align":"left","margin-left":"10px"}},wo={style:{width:"100%","font-weight":"bold","text-align":"right","margin-right":"10px"}},Vo={style:{width:"10px","margin-right":"10px"}},yo={key:0,class:"dropdown"},So=["onClick"],bo=X({__name:"SelectDropdown",props:{options:{type:Array,required:!1,default:[]},title:{type:String,required:!1,default:""},default:{type:String,required:!1,default:null},modelValue:{type:String,default:""},RealtimeChange:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(n,{emit:e}){$(!1);const t=n,s=$(t.default?t.default:t.options.length>0?t.options[0]:null),i=$(!1);Ge(()=>t.modelValue,a=>{s.value=a});const o=()=>{var a=me();t.RealtimeChange&&(a.ChangeEvent=!a.ChangeEvent)};return(a,d)=>{const f=te("font-awesome-icon");return v(),g("div",{class:"dropdown-head input-element value",tabindex:"0",onBlur:d[1]||(d[1]=l=>i.value=!1),style:{width:"100%",position:"relative"}},[S("div",{onClick:d[0]||(d[0]=l=>i.value=!i.value),style:{height:"100%"}},[S("div",vo,[S("div",go,P(t.title)+P(t.title==""?"":":"),1),S("div",wo,P(s.value),1),S("div",Vo,[i.value?(v(),H(f,{key:1,icon:["fas","angle-up"]})):(v(),H(f,{key:0,icon:["fas","angle-down"]}))])])]),i.value?(v(),g("ul",yo,[(v(!0),g(ee,null,Ve(n.options,(l,m)=>(v(),g("li",{class:Ie({selected:l==s.value}),key:m,onClick:p=>{s.value=l,i.value=!1,a.$emit("update:modelValue",s.value),o()}},P(l),11,So))),128))])):se("",!0)],32)}}}),_o=E(bo,[["__scopeId","data-v-66e3177b"]]),Po=X({__name:"LangSwitch",setup(n){const e=mt(),t=$("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);const s=f=>{e!=null&&(e.appContext.config.globalProperties.$i18n.locale=f,localStorage.setItem("userLang",f),t.value=f)},i=Dt("langContextMenu"),o=$(),a=f=>{var l;(o!=null||o!=null)&&((l=i.value)==null||l.OpenUnder(o.value))};var d=new Map;return d.set("en","English"),d.set("ru",""),(f,l)=>{const m=te("flag");return v(),g(ee,null,[S("button",{ref_key:"langSwitchBtn",ref:o,class:"btn disable-user-select",onClick:a},[c(m,{iso:t.value=="en"?"gb":t.value},null,8,["iso"]),O(" "+P(x(d).get(t.value)),1)],512),c(bt,{ref:"langContextMenu"},{default:_(()=>[S("button",{class:"btn btnContextMenuPadding",onClick:l[0]||(l[0]=p=>{var h;s("ru"),(h=i.value)==null||h.Close()})},[c(m,{iso:"ru"}),l[2]||(l[2]=O(" "))]),S("button",{class:"btn btnContextMenuPadding",onClick:l[1]||(l[1]=p=>{var h;s("en"),(h=i.value)==null||h.Close()})},[c(m,{iso:"gb"}),l[3]||(l[3]=O(" English"))])]),_:1},512)],64)}}}),Io=X({__name:"ToggleButton",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(n){const e=gs(n,"modelValue");return(t,s)=>(v(),g("button",{class:Ie(["btn",{toggled:e.value}]),onClick:s[0]||(s[0]=i=>e.value=!e.value)},[de(t.$slots,"default",{},void 0,!0)],2))}}),No=E(Io,[["__scopeId","data-v-4a53f642"]]),Mo=X({__name:"ResolutionSwitcher",setup(n){const e=mt(),t=$("English");e!=null&&(t.value=e.appContext.config.globalProperties.$i18n.locale);const s=Dt("contextMenu"),i=$(),o=l=>{var m;(i!=null||i!=null)&&((m=s.value)==null||m.OpenUnder(i.value))},a=["0.5K","1K","2K","4K"],d=$(0),f=l=>{d.value=l};return(l,m)=>{const p=te("font-awesome-icon"),h=Pe("tooltip");return v(),g(ee,null,[Z((v(),g("button",{ref_key:"switcher",ref:i,class:"btn disable-user-select",onClick:o},[c(p,{icon:["fas","border-all"]}),O(" "+P(a[d.value]),1),c(p,{icon:["fas","angle-down"]})])),[[h,l.$t("tt.mesh_resolution"),void 0,{bottom:!0}]]),c(bt,{ref_key:"contextMenu",ref:s},{default:_(()=>[(v(),g(ee,null,Ve(a,(M,b)=>c(je,{Active:b==d.value,onClick:N=>{var G;f(b),(G=s.value)==null||G.Close()}},{default:_(()=>[O(P(M),1)]),_:2},1032,["Active","onClick"])),64))]),_:1},512)],64)}}}),Co={class:"disable-user-select left-section",style:{display:"flex","flex-direction":"row"}},Oo={class:"logo disable-user-select",style:{"text-transform":"uppercase"}},ko={style:{"margin-left":"auto",right:"0px",height:"100%"}},xo={class:"btn"},Lo={class:"btn"},$o={class:"btn"},Do={class:"btn"},Ro={class:"btn"},To={style:{display:"flex","flex-direction":"row"}},Ao=X({__name:"MainMenuBar",setup(n){const e=$(!1);return Ge(e,(t,s)=>{t?document.documentElement.requestFullscreen():document.exitFullscreen()}),(t,s)=>{const i=te("font-awesome-icon"),o=Pe("tooltip");return v(),g("div",{class:"main",onContextmenu:s[1]||(s[1]=ae(()=>{},["prevent"]))},[S("div",Co,[S("div",Oo,P(t.$t("logo")),1),S("div",ko,[c(Mo),s[2]||(s[2]=S("div",{class:"separator"},null,-1)),Z((v(),g("button",xo,[c(i,{icon:["fas","file"]})])),[[o,t.$t("tt.new"),void 0,{bottom:!0}]]),Z((v(),g("button",Lo,[c(i,{icon:["fas","floppy-disk"]})])),[[o,t.$t("tt.save"),void 0,{bottom:!0}]]),Z((v(),g("button",$o,[c(i,{icon:["fas","folder-open"]})])),[[o,t.$t("tt.load"),void 0,{bottom:!0}]]),s[3]||(s[3]=S("div",{class:"separator"},null,-1)),Z((v(),g("button",Do,[c(i,{icon:["fas","rotate-left"]})])),[[o,t.$t("tt.undo"),void 0,{bottom:!0}]]),Z((v(),g("button",Ro,[c(i,{icon:["fas","rotate-right"]})])),[[o,t.$t("tt.redo"),void 0,{bottom:!0}]]),s[4]||(s[4]=S("div",{class:"separator"},null,-1)),Z((v(),H(No,{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=a=>e.value=a)},{default:_(()=>[c(i,{icon:["fas","expand"]})]),_:1},8,["modelValue"])),[[o,t.$t("tt.fullscreen"),void 0,{bottom:!0}]])])]),s[5]||(s[5]=S("div",{class:"padding"},[S("div",{class:"middle-actions",style:{}}," Untitled project ")],-1)),S("div",To,[c(Po)])],32)}}}),Xo=E(Ao,[["__scopeId","data-v-ae82b680"]]),Go=X({props:{Min:Number,Max:Number,Suffix:String,Title:String,RealtimeChange:{type:Boolean,default:!0},Step:{type:Number,default:0},modelValue:{type:Number,default:0}},emits:["update:modelValue"],data(){return{IsDragging:!1,Value:0,lastPosition:new I(0,0),lastValue:0,IsInputVisible:!1,moveDistance:0}},created(){document.addEventListener("mousemove",this.OnMouseMove),document.addEventListener("mouseup",this.OnMouseUp),this.Value=this.modelValue},watch:{modelValue(n,e){this.Value=n}},methods:{ClickValue(n){this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n,this.Min,this.Max):this.Value=this.Clamp(this.Value+(n>0?this.Step:-this.Step),this.Min,this.Max):this.Step==0?this.Value+=n:this.Value+=n>0?this.Step:-this.Step,this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnInput(n){this.Value=Number(n.target.value),this.Min!=null&&this.Max!=null&&(this.Value=this.Clamp(this.Value,this.Min,this.Max)),this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnMouseDown(n){this.IsInputVisible||(this.$el.requestPointerLock(),this.IsDragging=!0,this.lastPosition=new I(n.clientX,n.clientY),this.lastValue=this.Value,this.moveDistance=0)},OnMouseMove(n){this.IsDragging&&(this.moveDistance+=n.movementX,this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n.movementX/(n.shiftKey?25:50),this.Min,this.Max):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value=this.Clamp(this.Value+(n.movementX>0?this.Step:-this.Step),this.Min,this.Max)):this.Step==0?this.Value+=n.movementX/(n.shiftKey?25:50):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value+=n.movementX>0?this.Step:-this.Step),this.$emit("update:modelValue",this.Value),this.UpdateEvent())},OnMouseUp(n){var e=new I(n.clientX,n.clientY);e.X==this.lastPosition.X&&e.Y==this.lastPosition.Y&&this.Value==this.lastValue&&(this.IsInputVisible=!0,this.$nextTick(()=>{var t=this.$refs.input;t.focus(),t.select()})),this.IsDragging=!1,document.exitPointerLock()},UpdateEvent(){var n=me();this.RealtimeChange&&(n.ChangeEvent=!n.ChangeEvent)},validate(n){n.key=="Enter"&&n.target.blur();var e=/[0-9-]|\./;e.test(n.key)||n.preventDefault()},Clamp(n,e,t){return Math.min(Math.max(n,e),t)}}}),Yo={ref:"inputRange",class:"input-range"},Bo=["value"],Eo={class:"title"},Ho={class:"valueText"};function Uo(n,e,t,s,i,o){const a=te("font-awesome-icon");return v(),g("div",Yo,[S("div",{class:"button",onClick:e[0]||(e[0]=d=>n.ClickValue(-.1))},[c(a,{icon:["fas","caret-left"]})]),S("div",{class:"value",onMousedown:e[4]||(e[4]=ae((...d)=>n.OnMouseDown&&n.OnMouseDown(...d),["left"]))},[n.IsInputVisible?(v(),g("input",{key:0,onKeypress:e[1]||(e[1]=(...d)=>n.validate&&n.validate(...d)),ref:"input",class:"input-element",value:n.modelValue,onInput:e[2]||(e[2]=(...d)=>n.OnInput&&n.OnInput(...d)),onBlur:e[3]||(e[3]=d=>n.IsInputVisible=!1)},null,40,Bo)):(v(),g(ee,{key:1},[S("div",Eo,P(n.Title)+": ",1),S("div",Ho,P(Number(n.Value.toFixed(4)))+" "+P(n.Suffix),1)],64))],32),S("div",{class:"button",onClick:e[5]||(e[5]=d=>n.ClickValue(.1))},[c(a,{icon:["fas","caret-right"]})])],512)}const Wo=E(Go,[["render",Uo],["__scopeId","data-v-85813c7d"]]),zo={class:"properties"},Fo={key:0,class:"not-selected"},Zo={class:"header"},qo={style:{width:"100%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Ko={class:"buttons",style:{display:"flex","font-weight":"bold"}},jo={class:"btn"},Jo={key:0,style:{margin:"0px 10px"}},Qo={class:"input-group",style:{width:"100%",padding:"0px"}},ei=X({__name:"PropertiesView",setup(n){const e=pe();var t=we(()=>e.SelectedNode),s=we(()=>e.SelectedNode==null||e.SelectedNode instanceof be),i=we(()=>{var d;return a((d=t.value)==null?void 0:d.Properties)});const o=()=>{if(e.SelectedNode!=null&&e.SelectedNode!=null&&e.SelectedNode){for(var d of e.SelectedNode.Properties)d.Reset();var f=me();f.ChangeEvent=!f.ChangeEvent}};var a=d=>{var f=new Map;return d==null||d.length==0||d.forEach(l=>{var m;f.has(l.Category)||f.set(l.Category,new Array),(m=f.get(l.Category))==null||m.push(l)}),f};return(d,f)=>{var p;const l=te("font-awesome-icon"),m=Pe("tooltip");return v(),g("div",zo,[x(s)?(v(),g("div",Fo,[c(l,{icon:["fas","sliders"]})])):se("",!0),x(s)?se("",!0):(v(),g(ee,{key:1},[S("div",Zo,[S("div",qo,P(d.$t((p=x(t))==null?void 0:p.Name)),1),S("div",Ko,[Z((v(),g("button",jo,[c(l,{icon:["fas","sliders"]})])),[[m,d.$t("tt.presets"),void 0,{bottom:!0}]]),Z((v(),g("button",{class:"btn",onClick:o},[c(l,{icon:["fas","arrows-rotate"]})])),[[m,d.$t("tt.resetParams"),void 0,{bottom:!0}]])])]),x(t).Name?(v(),g("hr",Jo)):se("",!0),(v(!0),g(ee,null,Ve(x(i),([h,M])=>(v(),H(ht,{style:{"background-color":"transparent",padding:"0px"}},{header:_(()=>[O(P(h),1)]),default:_(()=>[S("div",Qo,[(v(!0),g(ee,null,Ve(M,b=>(v(),g(ee,null,[typeof b.Value=="number"?(v(),H(Wo,{key:0,modelValue:b.Value,"onUpdate:modelValue":N=>b.Value=N,Min:b.Min,Max:b.Max,Step:b.Step,Suffix:b.Suffix,Title:b.Name},null,8,["modelValue","onUpdate:modelValue","Min","Max","Step","Suffix","Title"])):se("",!0),b.valueList!=null?(v(),H(_o,{key:1,modelValue:b.Value,"onUpdate:modelValue":N=>b.Value=N,default:b.Value,title:b.Name,options:b.valueList},null,8,["modelValue","onUpdate:modelValue","default","title","options"])):se("",!0)],64))),256))])]),_:2},1024))),256))],64))])}}}),ti=E(ei,[["__scopeId","data-v-00af43f3"]]);function si(n){return new Worker("/assets/MeshGenerationWorker-DdK6sfo-.js",{name:n==null?void 0:n.name})}class ni{constructor(){r(this,"GridMaterial");r(this,"GridMesh");const e=u(.5).toVar(),t=u(5).toVar(),s=u(1*window.devicePixelRatio).toVar(),i=u(500).toVar(),o=u(200).toVar(),a=ct(.2,.2,.2,.2).toVar(),d=ct(.05,.05,.05,.2).toVar(),f=ks,l=xs,m=C(([Y,D])=>{const R=Mt(Y,D),K=Be(A(Ne(A(R,.5)),.5)),B=Mt(K,Yt(R));return Q(B.x,B.y)}),p=m(f.xz,e),h=m(f.xz,t),M=A(1,We(0,s,p)),b=A(1,We(0,s,h)),N=A(f,l),G=Qe(N),k=We(u(i),u(0),G),q=We(u(o),u(0),G),ie=J(a,J(M,q)).toVar(),ot=J(d,J(b,k)).toVar(),it=Ls(ot,ie),ve=new Bt;ve.colorNode=it,ve.transparent=!0,ve.side=Vt,ve.lights=!1;const z=new Et(1e3,1e3,1,1);z.rotateX(-Math.PI/2);const U=new yt(z,ve);this.GridMesh=U,this.GridMaterial=ve}}class oi{constructor(){r(this,"Mesh");const e=C(([o,a,d])=>{const f=w(o.x,o.y).toVar(),l=w(Be(f.mul(2).sub(1)).sub(w(a,d))).toVar();return l.assign(u(1).sub(l.div(Yt(l)))),$s(Q(l.x,l.y))});var t=new Ds({color:"#fff",transparent:!0,side:Vt});t.colorNode=C(()=>{const o=e(ze(),1,1).toVar(),a=e(ze(),.9,1).toVar(),d=e(ze(),1,.9).toVar(),f=e(ze(),.98,.98).toVar(),l=ye(0,1,o.sub(a).sub(d).sub(f)).toVar();return ct(.8,.8,.8,l)})();var s=new Et(1,1,1,1);s.rotateX(-Math.PI/2);var i=new yt(s,t);i.castShadow=!1,i.receiveShadow=!1,i.scale.set(10,1,10),i.position.set(0,.005,0),this.Mesh=i}}class ii{constructor(){r(this,"Height",2);r(this,"GPURenderer");r(this,"HeightTexture");r(this,"TerrainMaterial");r(this,"HeightArray");r(this,"IsMeshGenerated");r(this,"Scene");r(this,"Camera");r(this,"Controls");r(this,"TerrainMesh");r(this,"GridMesh");r(this,"GridMaterial");r(this,"DirectionalLight");r(this,"DirectionalLight2");r(this,"_resolution",512);r(this,"_canvas");this.IsMeshGenerated=$(!1),this.CreateRenderer(),this.Scene=new Rs,this.Scene.environmentNode=Ts("#ffffff"),this.Scene.environmentIntensity=.05,this.Camera=new As(75,1,.1,1e3),this.Camera.position.z=10,this.Camera.position.y=10,this.CreateMaterial(),this.CreateTexture(this._resolution),this.CreateTerrainMesh(this.Resolution),this.CreateLight();const e=new ni;this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2),this.GridMesh=e.GridMesh,this.Scene.add(this.GridMesh);const t=me();t.SetRenderer(this),t.Resolution=this.Resolution}get Resolution(){return this._resolution}CreateMaterial(){this.TerrainMaterial=new Bt({color:"#a2a2a2"}),this.TerrainMaterial.side=Vt,this.TerrainMaterial.needsUpdate=!0,this.TerrainMaterial.roughness=1;const e=Xs(rt());this.TerrainMaterial.positionNode=C(()=>{const t=u(1/this.Resolution),s=Fe.xyz.add(rt(t,0,0)).toVar(),i=Fe.xyz.add(rt(0,0,t.negate())).toVar(),o=u(1).sub(t).toVar(),a=Fe.xyz.toVar(),d=lt(this.HeightTexture,Fe.xz.add(.5).mul(o)).mul(this.Height);a.y.addAssign(d),s.y.addAssign(lt(this.HeightTexture,s.xz.add(.5).mul(o)).mul(this.Height)),i.y.addAssign(lt(this.HeightTexture,i.xz.add(.5).mul(o)).mul(this.Height));const f=s.sub(a).normalize(),l=i.sub(a).normalize();return e.assign(Gs(f,l)),a})(),this.TerrainMaterial.normalNode=Ys(e)}CreateRenderer(){this.GPURenderer=new Bs({alpha:!0,antialias:!0}),this.GPURenderer.shadowMap.enabled=!0,this.GPURenderer.shadowMap.type=Es,this.GPURenderer.toneMapping=Hs,this.GPURenderer.setClearColor(0,0),this.GPURenderer.setPixelRatio(window.devicePixelRatio)}CreateTexture(e){this.HeightTexture=new Us(Math.floor(this.Resolution),Math.floor(this.Resolution)),this.HeightTexture.format=Ws,this.HeightTexture.type=zs}CreateLight(){const e=new Ct(16777215,2);e.position.set(-10,10,0),e.castShadow=!0,e.shadow.camera.near=.1,e.shadow.camera.far=30,e.shadow.camera.top=8,e.shadow.camera.right=8,e.shadow.camera.bottom=-8,e.shadow.camera.left=-8,e.shadow.mapSize.set(2048,2048),e.shadow.radius=5,e.shadow.blurSamples=25,e.shadow.normalBias=.05,this.DirectionalLight=e;const t=new Ct(16777215,.5);t.position.set(10,10,0),this.DirectionalLight2=t}CreateTerrainMesh(e){let t=new si;t.onmessage=async i=>{var o=new Fs;o.setIndex(new Ze(new Uint32Array(i.data.indices),1)),o.setAttribute("position",new Ze(new Float32Array(i.data.position),3)),o.setAttribute("normal",new Ze(new Float32Array(i.data.normal),3)),o.setAttribute("uv",new Ze(new Float32Array(i.data.uv),2)),this.TerrainMesh=new yt(o,this.TerrainMaterial),this.TerrainMesh.castShadow=!0,this.TerrainMesh.receiveShadow=!0,this.TerrainMesh.scale.set(10,1,10),this.TerrainMesh.position.set(0,.006,0),this.Scene.add(this.TerrainMesh),this.IsMeshGenerated.value=!0},t.postMessage(e);var s=new oi;this.Scene.add(s.Mesh)}ChangeResolution(e){this.Scene.remove(this.TerrainMesh),this._resolution=e,this.CreateTerrainMesh(this._resolution),this.CreateTexture(this._resolution),this.Scene.add(this.TerrainMesh)}OnWindowResize(){if(this.GPURenderer==null||this.Camera==null||this._canvas==null)return;var e=this._canvas.offsetHeight,t=this._canvas.offsetWidth;this.GPURenderer.setSize(t,e);const s=t/e;this.Camera.aspect=s,this.Camera.updateProjectionMatrix(),requestAnimationFrame(()=>this.Render())}async Render(){await this.GPURenderer.renderAsync(this.Scene,this.Camera)}Mount(e){this._canvas=e;var t=this._canvas.offsetHeight,s=this._canvas.offsetWidth;this._canvas.appendChild(this.GPURenderer.domElement),this.GPURenderer.setSize(s,t),this.Camera.aspect=s/t,this.Controls=new Zs(this.Camera,this.GPURenderer.domElement),this.Controls.enablePan=!1,this.Controls.update(),window.addEventListener("resize",()=>this.OnWindowResize()),this.Render(),requestAnimationFrame(()=>this.Render)}RequestRender(){requestAnimationFrame(()=>this.Render)}async Recalculate(e,t=!1){t||e.Calculate();var s=e.Outputs[e.DefaultOutput].Value;const o=C(()=>{const a=fe.modInt(this.Resolution),d=fe.div(this.Resolution),f=Ke(a,d),l=w(f.x,f.y).div(this.Resolution).toVar(),m=s(l).toVar();m.assign(ye(m,0,1)),qs(this.HeightTexture,f,m).toWriteOnly()})().compute(this.Resolution*this.Resolution);this.GPURenderer.computeAsync(o).then(()=>{e.CalculationState=_e.Calculated,requestAnimationFrame(()=>this.Render())})}SetGridVisible(e){this.GridMesh.visible=e,requestAnimationFrame(()=>this.Render())}}const ai={class:"container"},ri={key:0,style:{position:"relative",height:"100%",width:"100%"}},li=X({__name:"Preview3D",setup(n){const e=$();e.value=new ii,$(e.value.IsMeshGenerated.value);const t=$();var s=me();const i=we(()=>s.ChangeEvent);var o=pe();const a=we(()=>o.SelectedNode),d=we(()=>{var N;return(N=e.value)==null?void 0:N.IsMeshGenerated});Ge(d,async(N,G)=>{requestAnimationFrame(()=>{var k;return(k=e.value)==null?void 0:k.Render()})}),Ge(i,async(N,G)=>{var k,q;o.LockedNode!=null?(k=e.value)==null||k.Recalculate(o.LockedNode,!1):a.value!=null&&((q=e.value)==null||q.Recalculate(a.value,!1))}),Ge(a,async N=>{var k,q;if(o.LockedNode!=null)(k=e.value)==null||k.Recalculate(o.LockedNode);else if(N!=null){var G=N;await((q=e.value)==null?void 0:q.Recalculate(G))}}),Lt(()=>{De(()=>{var N;(N=e.value)==null||N.Mount(t.value)})});let f=!1;const l=()=>{f=!0},m=()=>{f=!1};window.addEventListener("mouseup",m),window.addEventListener("pointerup",m);const p=()=>{f&&requestAnimationFrame(()=>{var N;return(N=e.value)==null?void 0:N.Render()})},h=()=>{requestAnimationFrame(()=>{var N;return(N=e.value)==null?void 0:N.Render()})},M=$(!0),b=()=>{var N;M.value=!M.value,(N=e.value)==null||N.SetGridVisible(M.value)};return(N,G)=>{var ie;const k=te("font-awesome-icon"),q=Pe("tooltip");return v(),g("div",ai,[(ie=e.value)!=null&&ie.IsMeshGenerated?se("",!0):(v(),g("div",ri,[c(ls,{style:{scale:"2"}}),G[0]||(G[0]=S("span",{style:{position:"absolute !important",top:"calc(50% + 20px)",width:"100%","text-align":"center"}}," Initializing mesh...",-1))])),S("div",{onMousedown:l,onMousemove:p,onWheel:h,onPointerdown:l,onPointermove:p,ref_key:"canvas",ref:t,style:{height:"100%",width:"100%"}},[c(pt,{class:"top-left"},{default:_(()=>[c(he,null,{default:_(()=>[Z((v(),g("a",{onClick:b},[c(k,{icon:["fas","hashtag"]})])),[[q,"Switch Grid visibility",void 0,{bottom:!0}]])]),_:1})]),_:1})],544)])}}}),ui=E(li,[["__scopeId","data-v-41874a11"]]),di={style:{width:"100%",height:"100%"}},ci={style:{height:"calc(100% - 80px)",display:"flex"}},hi={style:{width:"80%",height:"100%",display:"inline-block"}},fi={style:{height:"50%",width:"100%",display:"block"}},pi={style:{"margin-left":"5px"}},mi={style:{height:"50%"}},vi={style:{width:"20%",height:"100%",display:"inline-block"}},gi={style:{"margin-left":"5px"}},wi=X({__name:"LayoutView",setup(n){return(e,t)=>{const s=te("font-awesome-icon");return v(),g("div",di,[c(Xo,{style:{height:"50px"}}),S("div",ci,[S("div",hi,[S("div",fi,[c(tt,{style:{display:"inline-block",width:"100%"}},{header:_(()=>[c(s,{icon:["fas","mountain-sun"]}),S("span",pi,P(e.$t("windows.thirdPreview")),1)]),default:_(()=>[c(ui)]),_:1})]),S("div",mi,[c(mo)])]),S("div",vi,[c(tt,{"wheel-focus":!1},{header:_(()=>[c(s,{icon:["fas","sliders"]}),S("span",gi,P(e.$t("windows.properties")),1)]),default:_(()=>[c(ti)]),_:1})])]),c(rn,{style:{height:"30px"}})])}}}),Vi=E(wi,[["__scopeId","data-v-7b326d50"]]),yi=ws({history:Vs("/"),routes:[{path:"/",name:"home",component:Vi}]});function Si(){W.register(be),W.register(qt),W.register(Ft),W.register(Ut),W.register(os),W.register(es),W.register(ds),W.register(ts),W.register(ns),W.register(Jt),W.register(Kt),W.register(ss),W.register(zt),W.register(jt),W.register(Zt),W.register(Qt),W.register(is),W.register(as),W.register(rs)}const bi={en:{"":"",logo:"Mashuk",windows:{thirdPreview:"3D Preview",secondPreview:"2D Preview",properties:"Node properties",graph:"Graph",nodesList:"Nodes list"},tt:{undo:"Undo",redo:"Redo",copy:"Copy",paste:"Paste",delete:"Delete node/selected",fullscreen:"Fullscreen",save:"Save",load:"Load",presets:"Presets",resetView:"Reset view",resetParams:"Reset node parameters to default",lockPreview:"Lock Preview",unlockPreview:"Unlock Preview",mesh_resolution:"Mesh resolution",new:"New project"},hints:{graphLmb:"LMB: Select/Drag node",graphWheel:"Wheel: Zoom/Drag work space"},nodes:{constant:"Constant",perlinNoise:"Perlin Noise",mountain:"Mountain",terrace:"Terrace",combine:"Combine",clamp:"Clamp",invert:"Invert",redistribution:"Redistribution",gradientNoise:"Gradient Noise",voronoi:"Voronoi",crater:"Crater",falloff:"Falloff",fastErosion:"Fast Erosion",cracks:"Cracks",transform:"Transform",tile:"Tile",height:"Height"},nodeCategories:{testNodes:"Test nodes"}},ru:{logo:"",windows:{thirdPreview:"3D ",secondPreview:"2D ",properties:" ",graph:"",nodesList:" "},tt:{undo:"",redo:"",copy:"",paste:"",delete:" /",fullscreen:"  ",save:"",load:"",presets:"",resetView:" ",resetParams:"      ",lockPreview:" ",unlockPreview:" ",mesh_resolution:" ",new:" "},hints:{graphLmb:": / ",graphWheel:" : /  "},nodes:{constant:"",perlinNoise:" ",mountain:"",terrace:"",combine:"",clamp:"",invert:"",redistribution:"",gradientNoise:" ",voronoi:" ",crater:"",falloff:"",fastErosion:" ",cracks:"",transform:"",tile:"",height:""},nodeCategories:{testNodes:" "}}};wt.options.themes.tooltip.delay.show=0;wt.options.distance=10;ys.add(Ks,Ss);const _i=bs({legacy:!1,locale:"en",fallbackLocale:"en",messages:bi}),Me=_s(tn);Me.component("font-awesome-icon",Ps);Me.use(Is());Me.use(yi);Me.use(wt);Me.use(_i);Me.use(Ns);Me.mount("#app");Si();
