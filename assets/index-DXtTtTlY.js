var ls=Object.defineProperty;var us=(n,e,t)=>e in n?ls(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>us(n,typeof e!="symbol"?e+"":e,t);import{d as U,g as Mt,c as ve,r as Q,a as j,b as S,u as C,o as p,R as ds,e as y,f as h,_ as Y,v as ht,h as ft,i as G,j as k,t as O,k as ne,l as ge,w as I,m as Lt,n as kt,p as Te,q as se,s as ye,x as be,y as wt,F as ie,z as Ie,A as Ct,T as yt,B as cs,C as Xe,D as hs,E as fs,G as pt,H as ps,I as ms,J as vs,K as gs,L as Vs,M as ws,V as ys}from"./vendor-BFxIWwPW.js";import{u as V,F as N,f as l,w as $t,i as te,v as g,L as xt,a as et,b as Pe,d as xe,m as T,n as Dt,c as Ye,s as De,e as R,g as K,h as ke,j as Ss,k as le,l as J,o as _s,p as Ve,q as Ke,r as bs,t as lt,x as je,y as Tt,z as Ce,A as ce,B as qe,I as He,C as $e,D as St,E as ot,P as Rt,G as ut,H as _t,J as At,K as Is,M as Ue,N as Ps,O as Ns,Q as Xt,R as mt,S as Gt,T as vt,U as Os,V as Ms,W as We,X as Ls,Y as ks,Z as Cs,_ as $s,$ as it,a0 as ze,a1 as at,a2 as xs,a3 as Ds,a4 as Ts,a5 as Rs,a6 as As,a7 as Xs,a8 as Gs,a9 as Ys,aa as bt,ab as Bs,ac as Fe,ad as Es,ae as Hs}from"./three-UTeHTzsP.js";import{i as Us}from"./icons-CNPGi31y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const Ws={key:1,class:"gpu-error-box disable-user-select"},zs={class:"gpu-error-message-box"},Fs={style:{"font-size":"100px","text-align":"center",color:"var(--vt-c-red)"}},Zs=U({__name:"App",setup(n){const e=Mt(),t=localStorage.getItem("userLang");t&&e!=null&&(e.appContext.config.globalProperties.$i18n.locale=t);var s=ve(()=>navigator.gpu);return(i,o)=>{const r=Q("font-awesome-icon");return C(s)?(p(),j(C(ds),{key:0})):(p(),S("div",Ws,[y("div",zs,[y("div",Fs,[h(r,{icon:["fas","circle-xmark"]})]),o[0]||(o[0]=y("h1",null,"WebGPU is not supported on this browser.",-1))])]))}}}),qs=Y(Zs,[["__scopeId","data-v-f1213186"]]);class Yt{constructor(){a(this,"Id",ht());a(this,"In",null);a(this,"Out",null);a(this,"IsSelected",!1)}SetSelected(e){var s,i,o;var t=this.In!=null?(s=this.In.ParentNode)==null?void 0:s.ParentGraph:(o=(i=this.Out)==null?void 0:i.ParentNode)==null?void 0:o.ParentGraph;t!=null&&e==!0&&t.DeselectAll(),this.IsSelected=e}DeleteLinkFromTerminals(){var s,i;var e=(s=this.In)==null?void 0:s.Links.indexOf(this);e!=null&&this.In!=null&&this.In.Links.splice(e,1);var t=(i=this.Out)==null?void 0:i.Links.indexOf(this);t!=null&&this.Out!=null&&this.Out.Links.splice(t,1)}}class b{constructor(e,t){a(this,"X",0);a(this,"Y",0);this.X=e,this.Y=t}get Length(){return Math.sqrt(this.X*this.X+this.Y*this.Y)}get Normalized(){return b.Div(this,this.Length)}Reset(){this.X=0,this.Y=0}static Add(e,t){return t instanceof b?new b(e.X+t.X,e.Y+t.Y):typeof t=="number"?new b(e.X+t,e.Y+t):e}static Sub(e,t){return t instanceof b?new b(e.X-t.X,e.Y-t.Y):typeof t=="number"?new b(e.X-t,e.Y-t):e}static Mul(e,t){return t instanceof b?new b(e.X*t.X,e.Y*t.Y):typeof t=="number"?new b(e.X*t,e.Y*t):e}static Div(e,t){return t instanceof b?new b(e.X/t.X,e.Y/t.Y):typeof t=="number"?new b(e.X/t,e.Y/t):e}}var tt=(n=>(n[n.none=0]="none",n[n.Buffer=1]="Buffer",n[n.Primitives=2]="Primitives",n[n.GeoPrimitives=3]="GeoPrimitives",n[n.Warps=4]="Warps",n[n.Adjastments=5]="Adjastments",n[n.Profile=6]="Profile",n[n.Filters=7]="Filters",n[n.Erosion=8]="Erosion",n[n.Snow=9]="Snow",n[n.Water=10]="Water",n[n.Data=11]="Data",n[n.Color=12]="Color",n[n.Render=13]="Render",n[n.Output=14]="Output",n))(tt||{}),_e=(n=>(n[n.NotCalculated=0]="NotCalculated",n[n.Calculation=1]="Calculation",n[n.Calculated=2]="Calculated",n))(_e||{});class w{constructor(e,t,s,i=0,o=0,r="",d=""){a(this,"Name","");a(this,"Description","");a(this,"Value");a(this,"Min",-10);a(this,"Max",10);a(this,"Suffix");a(this,"Category");a(this,"Step");a(this,"valueList");a(this,"Default");this.Name=e,this.Value=t,this.Default=t,this.Min=typeof s=="number"?s:0,this.Max=i,this.Suffix=d,this.Category=r,this.Step=o,this.valueList=s instanceof Array?s:void 0}Reset(){this.Value=this.Default}}class z{constructor(){a(this,"Id",ht());a(this,"Position",new b(0,0));a(this,"LastPosition",new b(0,0));a(this,"Name","");a(this,"Category",tt.none);a(this,"Properties");a(this,"Inputs",[]);a(this,"Outputs",[]);a(this,"IsSelected",!1);a(this,"Height",0);a(this,"Width",0);a(this,"IsCalculated",!1);a(this,"ParentGraph",null);a(this,"CalculationState",_e.NotCalculated);a(this,"IsRealtimeUpdate",!1);a(this,"DefaultOutput",0)}Move(e,t){this.Position=new b(e,t)}SetSize(e,t){this.Height=e,this.Width=t}SetSelected(e){this.IsSelected=e;const t=he();e?t.SelectedNode=this:t.SelectedNode==this&&(t.SelectedNode=null)}SetLastPosition(e,t){this.LastPosition.X=e,this.LastPosition.Y=t}BaseCalculate(){this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})}),this.Inputs.forEach(e=>{var t,s,i,o;e.IsConnected&&((s=(t=e.Links[0].In)==null?void 0:t.ParentNode)==null||s.Calculate(),(o=(i=e.Links[0].In)==null?void 0:i.ParentNode)==null||o.SetCalculated())})}SetNotCalculated(){this.CalculationState=_e.NotCalculated,this.Outputs.forEach(e=>{e.Links.forEach(t=>{var s,i;(i=(s=t==null?void 0:t.Out)==null?void 0:s.ParentNode)==null||i.SetNotCalculated()})})}SetCalculated(){this.CalculationState=_e.Calculated}Calculate(){}}class ${constructor(e,t,s){a(this,"Guid",ht());a(this,"Links",new Array);a(this,"IsInput",!1);a(this,"ParentNode",null);a(this,"Position",new b(0,0));a(this,"OffsetPosition",new b(0,0));a(this,"Value",null);a(this,"Name","");this.ParentNode=t,this.IsInput=e,this.Name=s}get IsConnected(){return this.Links.length>0}SetOffset(e,t){this.OffsetPosition=new b(e,t)}SetPosition(e,t){this.Position=new b(e,t)}}const Je=ft("drag",()=>{const n=G(!1),e=G(),t=G(),s=G();function i(r){s.value=r}function o(){return s.value}return{setNode:i,getNode:o,SourceTerminal:e,DestinationTerminal:t,IsDragging:n}}),he=ft("nodes",()=>{const n=G(),e=G();return{SelectedNode:n,LockedNode:e}}),fe=ft("renderer",()=>{const n=G(!1),e=G(),t=o=>{e.value=o},s=()=>e.value,i=G();return{ChangeEvent:n,Resolution:i,SetRenderer:t,GetRenderer:s}}),Ks={class:"status-bar-grid disable-user-select"},js={class:"working-status"},Js={class:"memory-usage"},Qs=U({__name:"StatusBar",setup(n){fe();const e=G(0),t=ve(()=>e.value);return(s,i)=>{const o=Q("font-awesome-icon");return p(),S("div",Ks,[y("div",js,[h(o,{icon:["fas","bars-progress"]}),i[0]||(i[0]=k(" Idle "))]),y("div",Js,[h(o,{icon:["fas","memory"]}),k(" "+O(t.value.toFixed(2))+" ",1),i[1]||(i[1]=y("span",null," GB",-1))])])}}}),en=Y(Qs,[["__scopeId","data-v-254f7b1e"]]);class Bt extends z{constructor(){super(...arguments);a(this,"Name","nodes.constant");a(this,"Outputs",[new $(!1,this,"Output")]);a(this,"Properties",[new w("Height",0,0,1)]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=N(([s])=>l(t))}}const tn={class:"collapse"},sn={class:"carete"},nn={key:0,class:"collapse-body"},on=U({__name:"Collapse",setup(n){var e=G(!1);const t=()=>{e.value=!e.value};return(s,i)=>{const o=Q("font-awesome-icon");return p(),S("div",tn,[y("div",{onClick:t,class:"header"},[y("div",sn,[C(e)?(p(),j(o,{key:0,icon:["fas","angle-right"]})):(p(),j(o,{key:1,icon:["fas","angle-down"]}))]),ge(s.$slots,"header",{},void 0,!0)]),C(e)?ne("",!0):(p(),S("div",nn,[ge(s.$slots,"default",{},void 0,!0)]))])}}}),dt=Y(on,[["__scopeId","data-v-ed8ad461"]]),Ze=N(([n])=>{const e=g(n).toVar();e.assign(e.modInt(l(289)));const t=l(l(34).mul(e.x).add(1).mul(e.x).modInt(289).add(e.y)).toVar();return t.assign(l(34).mul(t).add(l(1)).mul(t).modInt(289)),t.assign(Pe(t.div(l(41))).mul(l(2)).sub(1)),Dt(g(t.sub(et(t.add(.5))),Ye(t).sub(.5)))}).setLayout({name:"gradientNoiseDir",type:"vec2",inputs:[{name:"p",type:"vec2"}]}),an=N(([n])=>{const e=g(n).toVar(),t=g(et(e)).toVar(),s=g(Pe(e)).toVar(),i=l(xe(Ze(t),s)).toVar(),o=l(xe(Ze(t.add(g(l(0),l(1)))),s.sub(g(l(0),l(1))))).toVar(),r=l(xe(Ze(t.add(g(l(1),l(0)))),s.sub(g(l(1),l(0))))).toVar(),d=l(xe(Ze(t.add(g(l(1),l(1)))),s.sub(g(l(1),l(1))))).toVar();return s.assign(s.mul(s).mul(s).mul(s.mul(s.mul(l(6)).sub(l(15))).add(l(10)))),T(T(i,o,s.y),T(r,d,s.y),s.x)}).setLayout({name:"gradientNoise",type:"float",inputs:[{name:"p",type:"vec2"}]}),Et=N(([n])=>an(n).add(.5)),gt=N(([n,e,t,s])=>{const i=te(e).toVar(),o=l(s).toVar(),r=g(t.x,t.y).toVar(),d=g(n.x,n.y).sub(l(.5)).mul(o).toVar();d.addAssign(r);const c=l(0).toVar(),u=l(1).div(2).toVar();return xt(i,({i:f})=>{const m=d.mul(l(2).pow(l(f))).toVar(),v=Et(m).mul(u).toVar();u.divAssign(2),c.addAssign(v)}),c}).setLayout({name:"perlinNoise",type:"float",inputs:[{name:"UV",type:"vec2"},{name:"octaves",type:"int"},{name:"offset",type:"vec2"},{name:"scale",type:"float"}]}),rn=$t(`
fn cracks(uv: vec2<f32>, angle: f32, scale: f32, thickness: f32) -> f32  {
	let st: vec2<f32> = (uv - 0.5) * scale;
	let i_st: vec2<f32> = floor(st);
	let f_st: vec2<f32> = fract(st);
	var m1: f32 = 1.;
	var m2: f32 = 1.;

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let neighbor: vec2<f32> = vec2<f32>(x, y);
			var point: vec2<f32> = random2(i_st + neighbor);
			point = 0.5 + 0.5 * sin(angle + 6.2831 * point);
			let diff: vec2<f32> = neighbor + point - f_st;
			let dist: f32 = length(diff);
			let cond: f32 = step(dist, m1);
			m2 = mix(min(max(m1, dist), m2), m1, cond);
			m1 = mix(m1, dist, cond);
		}

	}

	let edge: f32 = smoothstep(0.01, thickness, m2 - m1);
	return edge;
} 

fn random2(p: vec2<f32>) -> vec2<f32> {
	return fract(sin(vec2<f32>(dot(p, vec2<f32>(127.1, 311.7)), dot(p, vec2<f32>(269.5, 183.3)))) * 43758.547);
} 
`),rt=$t(`
fn voronoi(UV: vec2<f32>, angleOffset: f32, cellDensity: f32) -> vec2<f32> {
	let g: vec2<f32> = floor((UV - 0.5) * cellDensity);
	let f: vec2<f32> = fract((UV - 0.5) * cellDensity);
	var res: vec3<f32> = vec3<f32>(8., 0., 0.);

	for (var y: f32 = -1; y <= 1; y = y + 1) {

		for (var x: f32 = -1; x <= 1; x = x + 1) {
			let lattice: vec2<f32> = vec2<f32>(x, y);
			let offset: vec2<f32> = voronoiNoiseRandomVector(lattice + g, angleOffset);
			let d: f32 = distance(lattice + offset, f);
			res = mix(res, vec3<f32>(d, offset.x, offset.y), step(d, res.x));
		}

	}

	return vec2<f32>(res.x, res.y);
} 

fn voronoiNoiseRandomVector(UV: vec2<f32>, offset: f32) -> vec2<f32> {
	var UV_var = UV;
	let m: mat2x2<f32> = mat2x2<f32>(15.27, 47.63, 99.41, 89.98);
	UV_var = fract(sin(UV_var * m) * 46839.32);
	return vec2<f32>(sin(UV_var.y * offset) * 0.5 + 0.5, cos(UV_var.x * offset) * 0.5 + 0.5);
}
`);class Ht extends z{constructor(){super(...arguments);a(this,"Name","nodes.perlinNoise");a(this,"Outputs",[new $(!1,this,"Output")]);a(this,"Properties",[new w("Scale",10,0,100,0,"Transform","%"),new w("Octaves Count",10,1,50,1,"Noise",""),new w("Offset X",0,-100,100,0,"Transform",""),new w("Offset Y",0,-100,100,0,"Transform",""),new w("Warp Scale",0,0,1,.001,"Warp","%"),new w("Seed",0,0,99999,0,"Random",""),new w("Height",.4,0,1,0,"Noise","")]);a(this,"IsRealtimeUpdate",!0);a(this,"DefaultOutput",0);a(this,"Random",N(([t])=>{const s=g(t).toVar();return Pe(De(xe(s,g(12.9898,78.233))).mul(43758.5453))}))}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value);V(this.Properties[4].Value);const r=V(this.Properties[5].Value),d=V(this.Properties[6].Value);this.Outputs[0].Value=N(([c])=>{const u=g(c.x,c.y).toVar();return u.addAssign(this.Random(g(r).mul(r))),gt(u,s,g(i,o),t).mul(d)})}}const ln=U({__name:"DraggableNode",props:{GraphNode:{type:Function,required:!0}},setup(n){const e=Je(),t=n,s=G(),i=u=>{var m;if((m=u.dataTransfer)==null||m.setData("string","1"),t.GraphNode!=null&&t.GraphNode!=null){var f=t.GraphNode;e.setNode(new f)}};var o=void 0;const r=u=>{var v;o=(v=s.value)==null?void 0:v.cloneNode(!0);var f=o.getBoundingClientRect();if(o.style.position="fixed",o.style.left=`${u.touches[0].pageX-f.width/2}px`,o.style.top=`${u.touches[0].pageY-f.height/2}px`,o.style.zIndex="1000",document.body.appendChild(o),t.GraphNode!=null&&t.GraphNode!=null){var m=t.GraphNode;e.setNode(new m)}},d=u=>{if(o!=null){var f=o.getBoundingClientRect();o.style.left=`${u.touches[0].pageX-f.width/2}px`,o.style.top=`${u.touches[0].pageY-f.height/2}px`}},c=u=>{if(o!=null){document.body.removeChild(o),o=void 0,u.preventDefault(),u.stopPropagation();var f=u.changedTouches[0],m=document.elementFromPoint(f.clientX,f.clientY);console.log(m)}};return window.addEventListener("touchmove",d),window.addEventListener("touchend",c),(u,f)=>(p(),S("div",{onTouchstart:r,onDragstart:i,draggable:"true",class:"node",ref_key:"selfEl",ref:s},[ge(u.$slots,"default",{},void 0,!0)],544))}}),q=Y(ln,[["__scopeId","data-v-ee47cd3c"]]);class Ut extends z{constructor(){super(...arguments);a(this,"Name","nodes.combine");a(this,"Inputs",[new $(!0,this,"Source 1"),new $(!0,this,"Source 2")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Mode","Burn",["Burn","Darken","Difference","Dodge","Divide","Exclusion","HardLight","HardMix","Lighten","LinearBurn","LinearDodge","LinearLight","LinearLightAddSub","Multiply","Negation","Overlay","PinLight","Screen","SoftLight","Subtract","VividLight","Overwrite"]),new w("Strength",0,0,1)]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=this.Properties[0].Value,s=V(this.Properties[1].Value);this.Outputs[0].Value=N(([i])=>{var d,c;if(!this.Inputs[0].IsConnected||!this.Inputs[1].IsConnected)return l(0);const o=(d=this.Inputs[0].Links[0].In)==null?void 0:d.Value(i).toVar(),r=(c=this.Inputs[1].Links[0].In)==null?void 0:c.Value(i).toVar();switch(t){case"Burn":{const u=l(1).sub(l(1).sub(r).div(o)).toVar();return T(o,u,s)}case"Darken":{const u=J(o,r).toVar();return T(o,u,s)}case"Difference":{const u=Ye(r.sub(o)).toVar();return T(o,u,s)}case"Dodge":{const u=o.div(r.add(l(1e-12))).toVar();return T(o,u,s)}case"Divide":{const u=o.div(l(1).sub(r)).toVar();return T(o,u,s)}case"Exclusion":{const u=r.add(o).sub(l(2).mul(r).mul(o)).toVar();return T(o,u,s)}case"HardLight":{const u=l(R(1,K(2,R(1,o)).mul(R(1,r)))).toVar(),f=l(K(2,o).mul(r)).toVar(),m=l(ke(r,.5)).toVar(),v=l(f.mul(m).add(l(1).sub(m).mul(u))).toVar();return T(o,v,s)}case"HardMix":{const u=l(ke(l(1).sub(o),r)).toVar();return T(o,u,s)}case"Lighten":{const u=le(r,o).toVar();return T(o,u,s)}case"LinearBurn":{const u=l(o.add(r.sub(1))).toVar();return T(o,u,s)}case"LinearDodge":{const u=o.add(r).toVar();return T(o,u,s)}case"LinearLight":{const u=l(_s(r.lessThan(.5),le(o.add(l(2).mul(r).sub(l(1))),l(0)),J(o.add(l(2).mul(r.sub(.5))),l(1)))).toVar();return T(o,u,s)}case"LinearLightAddSub":{const u=l(r.add(K(2,o).sub(1))).toVar();return T(o,u,s)}case"Multiply":{const u=o.mul(r).toVar();return T(o,u,s)}case"Negation":{const u=l(R(1,Ye(R(1,r).sub(o)))).toVar();return T(o,u,s)}case"Overlay":{const u=l(R(1,K(2,R(1,o)).mul(R(1,r)))).toVar(),f=l(K(2,o).mul(r)).toVar(),m=l(ke(o,.5)).toVar(),v=l(f.mul(m).add(l(1).sub(m).mul(u))).toVar();return T(o,v,s)}case"PinLight":{const u=l(ke(.5,r)).toVar(),f=l(u.mul(le(K(2,o.sub(.5)),r))).toVar(),m=l(f.add(R(1,u).mul(J(K(2,o),r)))).toVar();return T(o,m,s)}case"Screen":{const u=l(R(1,R(1,r).mul(R(1,o)))).toVar();return T(o,u,s)}case"SoftLight":{const u=l(R(1,K(2,R(1,o)).mul(R(1,r)))).toVar(),f=l(Ss(o).mul(K(2,r).sub(1)).add(K(2,o).mul(R(1,r)))).toVar(),m=l(ke(r,.5)).toVar(),v=l(f.mul(m).add(l(1).sub(m).mul(u))).toVar();return T(o,v,s)}case"Subtract":{const u=o.sub(r).toVar();return T(o,u,s)}case"VividLight":{const u=l(R(1,R(1,r).div(K(2,o)))).toVar(),f=l(r.div(K(2,R(1,o)))).toVar(),m=l(ke(.5,o)).toVar(),v=l(f.mul(m).add(l(1).sub(m).mul(u))).toVar();return T(o,v,s)}case"Overwrite":return T(o,r,s)}return l(0)})}}class Wt extends z{constructor(){super(...arguments);a(this,"Name","nodes.terrace");a(this,"Inputs",[new $(!0,this,"Param 1")]);a(this,"Outputs",[new $(!1,this,"Output")]);a(this,"Properties",[new w("Count",3,0,10,1)]);a(this,"IsRealtimeUpdate",!0);a(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=N(([s])=>{var i;if(this.Inputs[0].IsConnected){const r=((i=this.Inputs[0].Links[0].In)==null?void 0:i.Value)(s).toVar();if(this.Properties[0].Value==0)return r;const d=l(1).div(t).toVar(),c=et(r.div(d)).toVar(),u=r.sub(c.mul(d)).div(d).toVar(),f=J(l(2).mul(u),l(1)).toVar();return c.add(f).mul(d).toVar()}else return 0})}}class zt extends z{constructor(){super(...arguments);a(this,"Name","nodes.clamp");a(this,"Inputs",[new $(!0,this,"Source")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Min",0,0,1),new w("Max",1,0,1)]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value);this.Outputs[0].Value=N(([i])=>{var r;if(!this.Inputs[0].IsConnected)return l(0);const o=(r=this.Inputs[0].Links[0].In)==null?void 0:r.Value(i);return Ve(o,t,s)})}}class Ft extends z{constructor(){super(...arguments);a(this,"Name","nodes.invert");a(this,"Inputs",[new $(!0,this,"Source")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate(),this.Outputs[0].Value=N(([t])=>{var i;if(!this.Inputs[0].IsConnected)return l(0);const s=(i=this.Inputs[0].Links[0].In)==null?void 0:i.Value(t);return l(1).sub(s)})}}class Zt extends z{constructor(){super(...arguments);a(this,"Name","nodes.redistribution");a(this,"Inputs",[new $(!0,this,"Source")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Exponent",1,1,10)]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=N(([s])=>{var o;return this.Inputs[0].IsConnected?((o=this.Inputs[0].Links[0].In)==null?void 0:o.Value(s)).pow(t):l(0)})}}class qt extends z{constructor(){super(...arguments);a(this,"Name","nodes.gradientNoise");a(this,"Outputs",[new $(!1,this,"Output")]);a(this,"Properties",[new w("Scale",10,0,100),new w("Offset X",0,0,100),new w("Offset Y",0,0,100)]);a(this,"IsRealtimeUpdate",!0);a(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value);this.Outputs[0].Value=N(([o])=>{const r=g(o.x,o.y).mul(t).toVar(),d=g(s,i).toVar();return r.addAssign(d),Et(r)})}}class Kt extends z{constructor(){super(...arguments);a(this,"Name","nodes.voronoi");a(this,"Outputs",[new $(!1,this,"Output"),new $(!1,this,"Cells"),new $(!1,this,"Bubbles")]);a(this,"Properties",[new w("Scale",10,1,100,0,"Transform","%"),new w("OffsetX",0,0,100,0,"Transform",""),new w("OffsetY",0,0,100,0,"Transform",""),new w("Angle",5,0,100,0,"Noise","")]);a(this,"IsRealtimeUpdate",!0);a(this,"DefaultOutput",0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value);this.Outputs[0].Value=N(([r])=>{const d=g(r.x,r.y).toVar(),c=g(s,i).toVar();d.addAssign(c);const u=rt({UV:d,angleOffset:o,cellDensity:t}).toVar();return Ke(u.x,2)}),this.Outputs[1].Value=N(([r])=>{const d=g(r.x,r.y).toVar(),c=g(s,i).toVar();return d.addAssign(c),rt({UV:d,angleOffset:o,cellDensity:t}).toVar().y}),this.Outputs[2].Value=N(([r])=>{const d=g(r.x,r.y).toVar(),c=g(s,i).toVar();d.addAssign(c);const u=rt({UV:d,angleOffset:o,cellDensity:t}).toVar();return bs(Ke(u.x,2))})}}const un=N(([n,e,t])=>{const s=l(t).toVar(),i=l(e).toVar(),o=l(n).toVar();s.assign(le(0,s));const r=l(le(0,J(1,i.sub(o).add(s).div(l(2).mul(s))))).toVar();return o.mul(r).add(i.mul(l(1).sub(r)).sub(s.mul(r).mul(l(1).sub(r))))}).setLayout({name:"smoothMin",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),dn=N(([n,e,t])=>{const s=l(t).toVar(),i=l(e).toVar(),o=l(n).toVar();s.assign(J(0,s.negate()));const r=l(le(0,J(1,i.sub(o).add(s).div(l(2).mul(s))))).toVar();return o.mul(r).add(i.mul(l(1).sub(r)).sub(s.mul(r).mul(l(1).sub(r))))}).setLayout({name:"smoothMax",type:"float",inputs:[{name:"a",type:"float"},{name:"b",type:"float"},{name:"k",type:"float"}]}),cn=N(([n])=>{const e=g(n).toVar();return Pe(De(xe(e.xy,g(12.9898,78.233))).mul(43758.5453123))}).setLayout({name:"random",type:"float",inputs:[{name:"st",type:"vec2"}]}),hn=N(([n,e,t])=>{const s=l(t).toVar(),i=l(e).toVar(),o=g(n).toVar(),r=g(o.mul(i)).toVar(),d=g(et(r)).toVar(),c=g(Pe(r)).toVar(),u=l(cn(d).mul(2).sub(1).mul(s)).toVar(),f=l(De(u)).toVar(),m=l(lt(u)).toVar(),v=g(c.sub(.5)).toVar(),M=g().toVar();return M.x.assign(v.x.mul(m).sub(v.y.mul(f))),M.y.assign(v.x.mul(f).add(v.y.mul(m))),M.add(.5).add(d).mod(1)}).setLayout({name:"tilingWithLimitedRotation",type:"vec2",inputs:[{name:"uv",type:"vec2"},{name:"tileCount",type:"float"},{name:"maxAngle",type:"float"}]});class jt extends z{constructor(){super(...arguments);a(this,"Name","nodes.crater");a(this,"Outputs",[new $(!1,this,"Output")]);a(this,"Properties",[new w("Smoothness",.5,0,1,0,"Crater params",""),new w("FloorHeight",-1,-5,5,0,"Crater params",""),new w("Radius",.16,0,1,0,"Crater params",""),new w("RimWidth",1.35,0,100,0,"Crater params",""),new w("RimSteepness",4,0,100,0,"Crater params",""),new w("X",.5,0,1,0,"Transform",""),new w("Y",.5,0,1,0,"Transform","")]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),r=V(this.Properties[4].Value),d=V(this.Properties[5].Value),c=V(this.Properties[6].Value);this.Outputs[0].Value=N(([u])=>{const f=g(u.x,u.y).toVar(),m=g(d,c).toVar(),v=l(je(f.sub(m)).div(le(i,1e-4))).toVar(),M=l(v.mul(v).sub(1)).toVar(),_=l(J(v.sub(1).sub(o),0)).toVar(),P=l(r.mul(_).mul(_)).toVar(),B=l(dn(M,s,t)).toVar();return B.assign(un(B,P,t)),B.mul(i).add(.5).toVar()})}}class Jt extends z{constructor(){super(...arguments);a(this,"Name","nodes.falloff");a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Strength",0,0,10)]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value);this.Outputs[0].Value=N(([s])=>{const i=g(s.x,s.y).toVar(),o=l(Tt(g(.5),i.mod(1))).mul(t).toVar(),r=T(l(1),l(0),o).toVar();return Ke(Ve(r,0,1),2)})}}class Qt extends z{constructor(){super(...arguments);a(this,"Name","nodes.mountain");a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Scale",3.55,0,100,0,"Noise Transform","%"),new w("Octaves Count",10,1,50,1,"Noise Params",""),new w("Offset X",-.08,-100,100,0,"Noise Transform",""),new w("Offset Y",-.54,-100,100,0,"Noise Transform",""),new w("Falloff",3,0,20,0,"Mountain",""),new w("Height",1,0,1,0,"Mountain",""),new w("Position X",.5,0,1,0,"Mountain Transform",""),new w("Position Y",.5,0,1,0,"Mountain Transform","")]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),r=V(this.Properties[4].Value),d=V(this.Properties[5].Value),c=V(this.Properties[6].Value),u=V(this.Properties[7].Value);this.Outputs[0].Value=N(([f])=>{const m=g(f.x,f.y).toVar(),v=l(Tt(g(c,u),m)).mul(r).toVar(),M=T(l(1),l(0),v).toVar(),_=Ke(Ve(M,0,1),2),P=m.sub(g(c,u).sub(.5)).toVar(),B=gt(P,s,g(i,o),t).toVar();return Ve(_.mul(B).mul(l(1.45).mul(d)),0,1)})}}class es extends z{constructor(){super(...arguments);a(this,"Name","nodes.fastErosion");a(this,"Inputs",[new $(!0,this,"Inpute Height")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Tiles",4,0,20,0,"Erosion",""),new w("Octaves",5,0,20,1,"Erosion",""),new w("Gain",.5,0,1,0,"Erosion",""),new w("Lacunarity",2,0,10,0,"Erosion",""),new w("Slope strength",3,0,10,0,"Erosion",""),new w("Branch strength",3,0,10,0,"Erosion",""),new w("Erosion Strength",.04,0,1,0,"Erosion","")]);a(this,"IsRealtimeUpdate",!1);a(this,"terrainHeight");a(this,"waterVolume");a(this,"sedimentAmount");a(this,"tempTerrainHeight");a(this,"tempWaterVolume");a(this,"tempSedimentAmount")}Calculate(){this.BaseCalculate();const t=fe(),s=t.GetRenderer(),i=t.Resolution,o=V(.1),r=V(.1),d=V(.1),c=V(1),u=V(.1),f=V(.1),m=V(9.8),v=V(.01),M=V(3),_=V(i),P=V(i);this.terrainHeight=Ce(i*i,"float"),this.waterVolume=Ce(i*i,"float"),this.sedimentAmount=Ce(i*i,"float"),this.tempTerrainHeight=Ce(i*i,"float"),this.tempWaterVolume=Ce(i*i,"float"),this.tempSedimentAmount=Ce(i*i,"float");const B=N(()=>{var D;const W=ce.modInt(i),E=ce.div(i),A=qe(W,E),x=g(A.x,A.y).div(i).toVar();if(this.Inputs[0].IsConnected){const X=((D=this.Inputs[0].Links[0].In)==null?void 0:D.Value)(x).toVar();this.terrainHeight.element(ce).assign(X)}}),L=N(([W,E])=>{const A=l(E).toVar(),x=l(W).toVar();return x.assign(Ve(x,te(0),_.sub(te(1)))),A.assign(Ve(A,te(0),P.sub(te(1)))),A.mul(_).add(x)}),F=N(([W,E])=>{const A=l(E).toVar(),x=g(W).toVar(),D=l(K(.01,Pe(De(l(A).mul(12.9898)).mul(43758.5453)).mul(2).sub(1))).toVar();return Dt(x.add(g(D)))});N(([W,E,A])=>{const x=te(A).toVar(),D=l(E).toVar(),Z=l(W).toVar(),X=l(L(Z,D)).toVar(),ae=l(this.tempWaterVolume.element(X).add(r.mul(o))).toVar(),ee=l(this.tempSedimentAmount.element(X)).toVar(),we=l(this.tempTerrainHeight.element(X)).toVar(),Be=g(g(this.tempTerrainHeight.element(L(Z.add(1),D)).sub(this.tempTerrainHeight.element(L(Z.sub(1),D))),this.tempTerrainHeight.element(L(Z,D.add(1))).sub(this.tempTerrainHeight.element(L(Z,D.sub(1))))).mul(.5)).toVar(),Re=l(je(Be)).toVar();He(ae.greaterThan(0).and(Re.greaterThan(0)),()=>{const Oe=g(F(Be,x)).toVar(),Ee=l(J(ae,Re.mul(m).mul(o))).toVar(),me=l(J(ae,Ee)).toVar(),Me=$e($e(Z,D).add($e(St(Oe)))).toVar(),Le=te(L(Me.x,Me.y)).toVar();this.tempWaterVolume.element(Le).addAssign(me),ae.subAssign(me);const ue=l(le(Re,v).mul(me).mul(c)).toVar();He(ee.lessThan(ue),()=>{const Ae=l(J(ue.sub(ee).mul(u),we.sub(this.tempTerrainHeight.element(Le)))).toVar();ee.addAssign(Ae),this.tempTerrainHeight.element(X).assign(we.sub(Ae))}).Else(()=>{const Ae=l(ee.sub(ue).mul(f)).toVar();ee.subAssign(Ae),this.tempTerrainHeight.element(X).assign(we.add(Ae))});const Vt=l(ee.mul(me).div(ae)).toVar();this.tempSedimentAmount.element(Le).addAssign(Vt),ee.subAssign(Vt)}),ae.mulAssign(R(1,d.mul(o))),ee.assign(le(0,ee)),this.tempWaterVolume.element(X).assign(ae),this.tempSedimentAmount.element(X).assign(ee)});const oe=N(([W,E])=>{const A=te(E).toVar(),x=qe(W.x,W.y).toVar();return x.y.mul(A).add(x.x)});N(()=>{this.tempTerrainHeight.element(ce).addAssign(.5)});const st=N(()=>{const W=te(ce).toVar(),E=te(W.modInt(_)).toVar(),A=te(W.div(_)).toVar(),x=te(L(E,A)).toVar();this.tempTerrainHeight.element(x).assign(this.terrainHeight.element(x)),this.tempWaterVolume.element(x).assign(this.waterVolume.element(x)),this.tempSedimentAmount.element(x).assign(this.sedimentAmount.element(x)),ot(),xt(M,()=>{const D=l(L(E,A)).toVar(),Z=l(this.tempWaterVolume.element(D).add(r.mul(o))).toVar(),X=l(this.tempSedimentAmount.element(D)).toVar(),ae=l(this.tempTerrainHeight.element(D)).toVar(),ee=g(g(this.tempTerrainHeight.element(L(E.add(1),A)).sub(this.tempTerrainHeight.element(L(E.sub(1),A))),this.tempTerrainHeight.element(L(E,A.add(1))).sub(this.tempTerrainHeight.element(L(E,A.sub(1))))).mul(.5)).toVar(),we=l(je(ee)).toVar();He(Z.greaterThan(0).and(we.greaterThan(0)),()=>{const Be=g(F(ee,W)).toVar(),Re=l(J(Z,we.mul(m).mul(o))).toVar(),Oe=l(J(Z,Re)).toVar(),Ee=$e($e(E,A).add($e(St(Be)))).toVar(),me=te(L(Ee.x,Ee.y)).toVar();this.tempWaterVolume.element(me).addAssign(Oe),Z.subAssign(Oe);const Me=l(le(we,v).mul(Oe).mul(c)).toVar();He(X.lessThan(Me),()=>{const ue=l(J(Me.sub(X).mul(u),ae.sub(this.tempTerrainHeight.element(me)))).toVar();X.addAssign(ue),this.tempTerrainHeight.element(D).assign(ae.sub(ue))}).Else(()=>{const ue=l(X.sub(Me).mul(f)).toVar();X.subAssign(ue),this.tempTerrainHeight.element(D).assign(ae.add(ue))});const Le=l(X.mul(Oe).div(Z)).toVar();this.tempSedimentAmount.element(me).addAssign(Le),X.subAssign(Le)}),Z.mulAssign(R(1,d.mul(o))),X.assign(le(0,X)),this.tempWaterVolume.element(D).assign(Z),this.tempSedimentAmount.element(D).assign(X),ot(),this.terrainHeight.element(D).assign(this.tempTerrainHeight.element(D)),this.waterVolume.element(D).assign(this.tempWaterVolume.element(D)),this.sedimentAmount.element(D).assign(this.tempSedimentAmount.element(D)),ot()}),this.terrainHeight.element(x).assign(this.tempTerrainHeight.element(x)),this.waterVolume.element(x).assign(this.tempWaterVolume.element(x)),this.sedimentAmount.element(x).assign(this.tempSedimentAmount.element(x))}),nt=B().compute(i*i),pe=st().compute(i*i);s==null||s.GPURenderer.compute(nt),s==null||s.GPURenderer.computeAsync(pe),this.Outputs[0].Value=N(([W])=>{if(this.Inputs[0].IsConnected){g(W.x,W.y).toVar();const E=ce.modInt(i),A=ce.div(i),x=qe(E,A);return this.terrainHeight.element(oe(x,i)).toVar()}else return 0})}}class ts extends z{constructor(){super(...arguments);a(this,"Name","nodes.cracks");a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Scale",10,0,100,0,"Transform","%"),new w("Angle",0,0,100,0,"Noise",""),new w("Thickness",.03,0,1,0,"Noise",""),new w("Distortion",0,0,100,0,"Distortion",""),new w("Octaves",10,0,100,1,"Distortion",""),new w("Scale",10,0,100,0,"Distortion",""),new w("Offset X",0,-100,100,0,"Distortion",""),new w("Offset Y",0,-100,100,0,"Distortion","")]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),r=V(this.Properties[4].Value),d=V(this.Properties[5].Value),c=V(this.Properties[6].Value),u=V(this.Properties[7].Value);this.Outputs[0].Value=N(([f])=>{const m=g(f.x,f.y).toVar(),v=g(gt(m.mul(2).mul(.5),r,g(c,u),d)).mul(o).mul(.2);return rn({uv:m.add(v),angle:s,scale:t,thickness:i})})}}class ss extends z{constructor(){super(...arguments);a(this,"Name","nodes.transform");a(this,"Inputs",[new $(!0,this,"Input")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Properties",[new w("Scale X",1,0,100,0,"Scale",""),new w("Scale Y",1,0,100,0,"Scale",""),new w("Position X",0,-100,100,0,"Position",""),new w("Position Y",0,-100,100,0,"Position",""),new w("Midpoint X",.5,0,1,0,"Rotation",""),new w("Midpoint Y",.5,0,1,0,"Rotation",""),new w("Angle",0,-360,360,0,"Rotation","")]);a(this,"IsRealtimeUpdate",!0)}Calculate(){this.BaseCalculate();var t=V(this.Properties[0].Value),s=V(this.Properties[1].Value),i=V(this.Properties[2].Value),o=V(this.Properties[3].Value),r=V(this.Properties[4].Value),d=V(this.Properties[5].Value),c=V(this.Properties[6].Value);this.Outputs[0].Value=N(([u])=>{var L;const f=g(u.x,u.y).toVar(),m=g(t,s).toVar(),v=g(i,o).toVar(),M=g(r,d).toVar(),_=c.mul(Rt.div(180)).toVar(),P=g(lt(_).mul(f.x.sub(M.x)).add(De(_).mul(f.y.sub(M.y))).add(M.x),lt(_).mul(f.y.sub(M.y)).sub(De(_).mul(f.x.sub(M.x))).add(M.y));return f.assign(P),f.addAssign(v),f.mulAssign(m),(L=this.Inputs[0].Links[0].In)==null?void 0:L.Value(f).toVar()})}}class ns extends z{constructor(){super(...arguments);a(this,"Inputs",[new $(!0,this,"Input")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Name","nodes.tile");a(this,"Properties",[new w("Tile Count",1,0,100,1),new w("Angle Threshold",0,0,360,0)])}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value),s=V(this.Properties[1].Value);this.Outputs[0].Value=N(([i])=>{var u;var o=g(i).toVar(),r=s.mul(Rt.div(180));const d=hn(o,t,r).toVar();return(u=this.Inputs[0].Links[0].In)==null?void 0:u.Value(d).toVar()})}}class os extends z{constructor(){super(...arguments);a(this,"Inputs",[new $(!0,this,"Input")]);a(this,"Outputs",[new $(!1,this,"Result")]);a(this,"Name","nodes.height");a(this,"Properties",[new w("Height",1,0,1,0)])}Calculate(){this.BaseCalculate();const t=V(this.Properties[0].Value);this.Outputs[0].Value=N(([s])=>{var r;var i=g(s).toVar();return((r=this.Inputs[0].Links[0].In)==null?void 0:r.Value(i).toVar()).mul(t)})}}const fn={class:"node-list"},pn=U({__name:"NodeList",setup(n){return(e,t)=>{const s=Q("font-awesome-icon");return p(),S("div",fn,[h(dt,null,{header:I(()=>[k(O(e.$t("nodeCategories.testNodes")),1)]),default:I(()=>[h(q,{"-graph-node":C(Bt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.constant")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Ht)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.perlinNoise")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Qt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.mountain")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Wt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.terrace")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Ut)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.combine")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(zt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.clamp")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Ft)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.invert")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Zt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.redistribution")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(qt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.gradientNoise")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Kt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.voronoi")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(jt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.crater")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(Jt)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.falloff")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(es)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.fastErosion")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(ts)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.cracks")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(ss)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.transform")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(ns)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.tile")),1)]),_:1},8,["-graph-node"]),h(q,{"-graph-node":C(os)},{default:I(()=>[h(s,{icon:["fas","circle-nodes"]}),k(" "+O(e.$t("nodes.height")),1)]),_:1},8,["-graph-node"])]),_:1}),h(dt,null,{header:I(()=>t[0]||(t[0]=[k("Basic nodes")])),_:1})])}}}),mn=Y(pn,[["__scopeId","data-v-2ba13cd7"]]),vn={class:"padding"},gn={class:"header disable-user-select"},Vn={class:"body disable-user-select"},wn=U({__name:"FrameTab",props:{wheelFocus:{type:Boolean,default:!0}},setup(n){const e=n,t=G(),s=i=>{t.value&&e.wheelFocus&&t.value.focus()};return(i,o)=>(p(),S("div",vn,[y("div",{class:"main",tabindex:"0",ref_key:"selfEl",ref:t,onWheel:s},[y("div",gn,[ge(i.$slots,"header",{},void 0,!0)]),y("div",Vn,[ge(i.$slots,"default",{},void 0,!0)])],544)]))}}),Qe=Y(wn,[["__scopeId","data-v-bce70494"]]);class It{static pathExists(e,t){if(e===t)return!0;const s=new Set;return this.dfs(e,t,s)}static dfs(e,t,s){if(e===t)return!0;if(s.has(e))return!1;s.add(e);for(const i of e.Outputs)for(const o of i.Links)if(o.Out!=null&&o.Out!=null){const r=o.Out.ParentNode;if(this.dfs(r,t,s))return!0}return!1}}const yn=U({__name:"TerminalRenderer",props:{Term:{type:$,required:!0}},setup(n,{expose:e}){const t=Je(),s=n,i=f=>{t.SourceTerminal=s.Term,t.IsDragging=!0,window.addEventListener("mouseup",o)},o=f=>{var _,P,B;window.removeEventListener("mouseup",o),t.IsDragging=!1;var m=t.DestinationTerminal,v=t.SourceTerminal;if(m!=null&&m!=v&&!(v!=null&&v.IsInput&&m.IsInput)&&(v==null?void 0:v.ParentNode)!=m.ParentNode){if(v!=null&&v.IsInput){if(It.pathExists(v==null?void 0:v.ParentNode,m.ParentNode))return;v.Links.forEach(L=>{var F,oe;(oe=(F=v==null?void 0:v.ParentNode)==null?void 0:F.ParentGraph)==null||oe.DeleteLink(L)})}if(m.IsInput){if(It.pathExists(m==null?void 0:m.ParentNode,v==null?void 0:v.ParentNode))return;m.Links.forEach(L=>{var F,oe;(oe=(F=m==null?void 0:m.ParentNode)==null?void 0:F.ParentGraph)==null||oe.DeleteLink(L)})}(P=(_=s.Term.ParentNode)==null?void 0:_.ParentGraph)==null||P.AddLink(m,v);var M=fe();(B=s.Term.ParentNode)!=null&&B.IsRealtimeUpdate&&(M.ChangeEvent=!M.ChangeEvent)}},r=f=>{t.IsDragging&&(t.DestinationTerminal=s.Term)},d=f=>{t.IsDragging&&(t.DestinationTerminal=null)},c=G();Lt(()=>{kt(()=>{u()})});const u=()=>{var v,M,_,P;var f=((v=c.value)==null?void 0:v.offsetLeft)+((M=c.value)==null?void 0:M.offsetWidth)/2+2,m=((_=c.value)==null?void 0:_.offsetTop)+((P=c.value)==null?void 0:P.offsetHeight)/2+2;s.Term.SetOffset(f,m)};return e({SetOffset:u}),(f,m)=>{const v=Te("tooltip");return se((p(),S("div",{class:be(["node-terminal",{connected:s.Term.IsConnected},"disable-user-select"]),onMousedown:ye(i,["left"]),onMouseover:r,onMouseleave:d,ref_key:"selfEl",ref:c},null,34)),[[v,{content:s.Term.Name,placement:s.Term.IsInput?"left":"right"}]])}}}),Pt=Y(yn,[["__scopeId","data-v-9215b385"]]);class Se extends z{constructor(){super(...arguments);a(this,"Inputs",[new $(!0,this,"")]);a(this,"Outputs",[new $(!1,this,"")]);a(this,"Category",tt.Buffer)}Calculate(){this.BaseCalculate();var t=this.Inputs[0].Links[0].In,s=this.Outputs[0];s.Value=t==null?void 0:t.Value}}const Sn={},_n={class:"loader"};function bn(n,e){return p(),S("span",_n)}const is=Y(Sn,[["render",bn],["__scopeId","data-v-8c5c5c6f"]]);class as{constructor(){a(this,"IsSubGraph",!1);a(this,"Nodes",new Array);a(this,"Links",new Array)}get HasSelected(){return this.Nodes.some(e=>e.IsSelected)||this.Links.some(e=>e.IsSelected)}AddNode(e,t=!0){var s=this.Nodes.indexOf(e);s==-1&&(t&&re.PushState(this),e.ParentGraph=this,this.Nodes.push(e))}DeleteLink(e,t=!0){var s=this.Links.indexOf(e);s!=-1&&(t&&re.PushState(this),e.DeleteLinkFromTerminals(),this.Links.splice(s,1))}AddLink(e,t,s=!0){if(!(e.IsInput&&t.IsInput||!e.IsInput&&!t.IsInput)){s&&re.PushState(this);var i=new Yt;e.IsInput?(i.In=t,i.Out=e):(i.In=e,i.Out=t),t.Links.push(i),e.Links.push(i),this.Links.push(i)}}DeleteNode(e,t=!0){if(e!=null){t&&re.PushState(this);var s=he();s.SelectedNode==e&&(s.SelectedNode=null),s.LockedNode==e&&(s.LockedNode=null),e.Inputs.forEach(o=>{var r=o.Links.map(d=>d);r.forEach(d=>{this.DeleteLink(d)})}),e.Outputs.forEach(o=>{var r=o.Links.map(d=>d);r.forEach(d=>{this.DeleteLink(d)})});var i=this.Nodes.indexOf(e);i!=-1&&this.Nodes.splice(i,1)}}DeleteSelected(e=!0){e&&re.PushState(this),this.Nodes.filter(s=>s.IsSelected).forEach(s=>this.DeleteNode(s,!1));var t=he();t.SelectedNode=void 0,this.Links.filter(s=>s.IsSelected).forEach(s=>this.DeleteLink(s,!1))}DeselectAll(){var e=he();e.SelectedNode=void 0,this.Nodes.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1)),this.Links.filter(t=>t.IsSelected).forEach(t=>t.SetSelected(!1))}SelectAll(){this.Nodes.forEach(e=>e.SetSelected(!0))}}class H{static register(e){var t=new e;this.classMap.set(t.constructor.name,e)}static create(e,...t){const s=this.classMap.get(e);if(!s)throw new Error(`Class ${e} not registered`);return new s(...t)}}a(H,"classMap",new Map);class Ge{static Serialize(e){var r,d,c,u,f,m,v,M;var t=new In;if(e.Nodes!=null&&e.Nodes.length>0)for(const _ of e.Nodes){var s=new Pn;if(s.NodeType=_.constructor.name,s.NodeGuid=_.Id,s.NodePostition=_.Position,_.Properties!=null&&_.Properties.length>0)for(const P of _.Properties){var i=new Nn;i.Value=P.Value,s.Properties==null&&(s.Properties=new Array),s.Properties.push(i)}t.Nodes==null&&(t.Nodes=new Array),t.Nodes.push(s)}if(e.Links!=null&&e.Links.length>0)for(const _ of e.Links){var o=new On;o.FromNodeGuid=(d=(r=_.In)==null?void 0:r.ParentNode)==null?void 0:d.Id,o.ToNodeGuid=(u=(c=_.Out)==null?void 0:c.ParentNode)==null?void 0:u.Id,o.FromTerminalIndex=(m=(f=_.In)==null?void 0:f.ParentNode)==null?void 0:m.Outputs.indexOf(_.In),o.ToTerminalIndex=(M=(v=_.Out)==null?void 0:v.ParentNode)==null?void 0:M.Inputs.indexOf(_.Out),t.Links==null&&(t.Links=new Array),t.Links.push(o)}return t}static Deserialize(e){var t=new as;if(e.Nodes!=null&&e.Nodes.length>0)for(var s of e.Nodes){var i=H.create(s.NodeType);if(i.Id=s.NodeGuid,i.Move(s.NodePostition.X,s.NodePostition.Y),s.Properties!=null&&s.Properties.length>0)for(var o=0;o<s.Properties.length;o++)i.Properties[o].Value=s.Properties[o].Value;t.AddNode(i,!1)}if(e.Links!=null&&e.Links.length>0)for(var r of e.Links){var d=wt(t.Nodes).firstOrDefault(u=>u.Id==r.FromNodeGuid),c=wt(t.Nodes).firstOrDefault(u=>u.Id==r.ToNodeGuid);d==null||c==null||t.AddLink(d.Outputs[r.FromTerminalIndex],c.Inputs[r.ToTerminalIndex],!1)}return t}}class In{constructor(){a(this,"Nodes");a(this,"Links")}static ToJson(e){return JSON.stringify(e)}}class Pn{constructor(){a(this,"NodeGuid");a(this,"NodeType");a(this,"NodePostition");a(this,"Properties")}}class Nn{constructor(){a(this,"Value")}}class On{constructor(){a(this,"FromNodeGuid");a(this,"ToNodeGuid");a(this,"FromTerminalIndex");a(this,"ToTerminalIndex")}}class Mn{constructor(e){a(this,"buffer");a(this,"capacity");a(this,"head",0);a(this,"tail",0);a(this,"size",0);a(this,"poppedItems",[]);if(e<=0)throw new Error("Capacity must be greater than 0");this.capacity=e,this.buffer=new Array(e)}get hasValues(){return this.size>0}get hasPoppedItems(){return this.poppedItems.length>0}push(e){this.poppedItems=[],this.size===this.capacity?(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.head=(this.head+1)%this.capacity):(this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++)}pop(){if(!this.hasValues)return;this.tail=(this.tail-1+this.capacity)%this.capacity;const e=this.buffer[this.tail];return this.size--,this.poppedItems.push(e),e}unpop(){if(!this.hasPoppedItems)return;const e=this.poppedItems.pop();return this.size===this.capacity&&(this.head=(this.head+1)%this.capacity),this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++,e}toArray(){const e=[];for(let t=0;t<this.size;t++){const s=(this.head+t)%this.capacity;e.push(this.buffer[s])}return e}peek(){if(this.hasValues)return this.buffer[(this.tail-1+this.capacity)%this.capacity]}get length(){return this.size}}class re{static get HasValues(){return this.ActionHistoryBuffer.hasValues}static get HasPopped(){return this.ActionHistoryBuffer.hasPoppedItems}static PushState(e){this.ActionHistoryBuffer.push(Ge.Serialize(e))}static UnpopState(){if(this.ActionHistoryBuffer.hasPoppedItems){var e=this.ActionHistoryBuffer.unpop();return Ge.Deserialize(e)}return null}static PopState(){if(this.ActionHistoryBuffer.hasValues){var e=this.ActionHistoryBuffer.pop();return Ge.Deserialize(e)}return null}}a(re,"ActionHistoryBuffer",new Mn(25));const Ln={class:"node-container"},kn={class:"node-terminals left"},Cn={class:"node-center"},$n={class:"node-name"},xn={class:"node-terminals right"},Dn=U({props:{Offset:{type:b,required:!0},Zoom:{type:Number,required:!0},Node:{type:z,required:!0},AllNodes:{type:Array,default:new Array}},data(){return{LastMousePosition:new b(0,0),IsDragging:!1}},created:function(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted:function(){this.$nextTick(()=>{var n=this.$el;this.Node.SetSize(n.offsetHeight,n.offsetWidth),this.Node.Move(this.Node.Position.X-this.Node.Width/2,this.Node.Position.Y-this.Node.Height/2);var e=new ResizeObserver(this.OnNodeResize);e.observe(this.$refs.node)})},computed:{PriviewLocked:function(){var n=he();return n.LockedNode==this.Node},Top:function(){var n=this.Node.Position.Y;return n+"px"},Left:function(){var n=this.Node.Position.X;return n+"px"},Cursor:function(){return this.IsDragging?"grabbing":"default"},ZIndex:function(){return this.Node.IsSelected?"1":"0"},Blur:function(){return 4/this.Zoom+"px"},Border:function(){return this.Node.IsCalculated?"solid":"dashed"},IsNodeLocked:function(){var n=he(),e=n.LockedNode;return e!=null&&e==this.Node}},methods:{OnNodeResize:function(){if(this.$refs.terminals!=null){var n=this.$refs.terminals;n.forEach(e=>{e.SetOffset()})}},LockNode:function(){var n=he(),e=fe();n.LockedNode==this.Node?n.LockedNode=null:(n.LockedNode=this.Node,this.Node.SetSelected(!0),e.ChangeEvent=!e.ChangeEvent)},Down:function(n,e,t){var i,o,r,d,c;if(this.IsDragging=!0,this.LastMousePosition.X=n,this.LastMousePosition.Y=e,t)this.Node.SetSelected(!((i=this.Node)!=null&&i.IsSelected));else{var s=(o=this.Node.ParentGraph)==null?void 0:o.Nodes.filter(u=>u.IsSelected);s.length>1?this.Node.IsSelected==!1&&((r=this.Node.ParentGraph)==null||r.DeselectAll(),this.Node.SetSelected(!0)):((d=this.Node.ParentGraph)==null||d.DeselectAll(),this.Node.SetSelected(!0))}(c=this.Node.ParentGraph)==null||c.Nodes.filter(u=>u.IsSelected).forEach(u=>{u.SetLastPosition(u.Position.X,u.Position.Y)}),re.PushState(this.Node.ParentGraph)},OnTouchDown:function(n){if(this.$refs.terminals!=null&&this.$refs.terminals.some(s=>s.$el==n.target||s==n.target))return;let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Down(e,t,!1)},OnMouseDown:function(n){this.$refs.terminals!=null&&this.$refs.terminals.some(e=>e.$el==n.target||e==n.target)||this.Down(n.clientX,n.clientY,n.shiftKey)},OnMouseUp:function(n){this.IsDragging=!1},OnTouchUp:function(n){this.IsDragging=!1},OnTouchMove:function(n){let e=n.touches[0].clientX,t=n.touches[0].clientY;this.Move(e,t)},Move:function(n,e){var i;if(this.IsDragging){var t=(n-this.LastMousePosition.X)/this.Zoom,s=(e-this.LastMousePosition.Y)/this.Zoom;(i=this.Node.ParentGraph)==null||i.Nodes.filter(o=>o.IsSelected).forEach(o=>{o.Move(o.LastPosition.X+t,o.LastPosition.Y+s)})}},OnMouseMove:function(n){this.Move(n.clientX,n.clientY)}}}),Tn=U({...Dn,__name:"NodeRenderer",setup(n){return Ct(e=>({b5f74f28:e.Cursor,"1e9cf802":e.Top,"257b329d":e.Left,"6c548ce4":e.ZIndex})),(e,t)=>{const s=Q("font-awesome-icon"),i=Te("tooltip");return p(),S("div",{class:be([{node:!(e.Node instanceof C(Se))},{"node-buffer":e.Node instanceof C(Se)},"disable-user-select",{"not-calculated":e.Node.CalculationState==C(_e).NotCalculated&&!(e.Node instanceof C(Se))},{selected:e.Node.IsSelected},{lockedPreview:e.PriviewLocked},{"node-without-inputs":e.Node.Inputs.length==0}]),ref:"node",onMousedown:t[1]||(t[1]=ye((...o)=>e.OnMouseDown&&e.OnMouseDown(...o),["left"])),onTouchmove:t[2]||(t[2]=(...o)=>e.OnTouchMove&&e.OnTouchMove(...o)),onTouchstart:t[3]||(t[3]=(...o)=>e.OnTouchDown&&e.OnTouchDown(...o)),onTouchend:t[4]||(t[4]=(...o)=>e.OnTouchUp&&e.OnTouchUp(...o))},[y("div",Ln,[y("div",kn,[(p(!0),S(ie,null,Ie(e.Node.Inputs,o=>(p(),j(Pt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))]),y("div",Cn,[e.Node instanceof C(Se)?ne("",!0):(p(),S(ie,{key:0},[se((p(),S("a",{class:"lock-icon",onClick:t[0]||(t[0]=o=>e.LockNode())},[e.IsNodeLocked?(p(),j(s,{key:0,icon:["fas","lock"]})):(p(),j(s,{key:1,icon:["fas","lock-open"]}))])),[[i,{content:"Lock preview",placement:"bottom"}]]),y("div",$n,O(e.$t(e.Node.Name)),1),e.Node.CalculationState==C(_e).Calculation?(p(),j(is,{key:0})):ne("",!0)],64))]),y("div",xn,[(p(!0),S(ie,null,Ie(e.Node.Outputs,o=>(p(),j(Pt,{ref_for:!0,ref:"terminals",key:o.Guid,Term:o},null,8,["Term"]))),128))])])],34)}}}),Nt=Y(Tn,[["__scopeId","data-v-7e284aba"]]);class Ot{constructor(e,t,s,i){a(this,"X",0);a(this,"Y",0);a(this,"Height",0);a(this,"Width",0);this.X=e,this.Y=t,this.Height=s,this.Width=i}ContainsRect(e){return this.X<=e.X&&e.X+e.Width<=this.X+this.Width&&this.Y<=e.Y&&e.Y+e.Height<=this.Y+this.Height}ContainsPoint(e,t){return this.X<=e&&e<this.X+this.Width&&this.Y<=t&&t<this.Y+this.Height}IntersectsWith(e){return e.X<this.X+this.Width&&this.X<e.X+e.Width&&e.Y<this.Y+this.Height&&this.Y<e.Y+e.Height}static Intersects(e,t){return e.X<t.X+t.Width&&t.X<e.X+e.Width&&e.Y<t.Y+t.Height&&t.Y<e.Y+e.Height}}const Rn={},An={class:"canvas",xmlns:"http://www.w3.org/2000/svg"};function Xn(n,e){return p(),S("svg",An,[ge(n.$slots,"default",{},void 0,!0)])}const Gn=Y(Rn,[["render",Xn],["__scopeId","data-v-81940268"]]),Yn=["points"],Bn=U({computed:{Points(){var t,s,i,o,r,d;var n=b.Add((s=(t=this.Link.In)==null?void 0:t.ParentNode)==null?void 0:s.Position,(i=this.Link.In)==null?void 0:i.OffsetPosition),e=b.Add((r=(o=this.Link.Out)==null?void 0:o.ParentNode)==null?void 0:r.Position,(d=this.Link.Out)==null?void 0:d.OffsetPosition);return`${n.X},${n.Y} ${n.X+20},${n.Y} ${e.X-20},${e.Y} ${e.X},${e.Y}`}}}),En=U({...Bn,__name:"LinkRenderer",props:{Link:{type:Yt,required:!0}},setup(n){const e=n,t=()=>{e.Link.SetSelected(!0)},s=i=>{var u;var o=e.Link.In,r=e.Link.Out;if(!(o==null||r==null)){var d=new Se;d.Move(i.offsetX,i.offsetY);var c=(u=o.ParentNode)==null?void 0:u.ParentGraph;c!=null&&(c.DeleteLink(e.Link),c.AddNode(d),c.AddLink(o,d.Inputs[0]),c.AddLink(d.Outputs[0],r))}};return(i,o)=>(p(),S("polyline",{onClick:t,onDblclick:s,points:i.Points,class:be(["line",{selected:e.Link.IsSelected}])},null,42,Yn))}}),Hn=Y(En,[["__scopeId","data-v-a61d9acd"]]),Un={},Wn={class:"tool-bar-container"};function zn(n,e){return p(),S("div",Wn,[ge(n.$slots,"default",{},void 0,!0)])}const ct=Y(Un,[["render",zn],["__scopeId","data-v-b20ca96b"]]),Fn={},Zn={class:"tool-bar-body"};function qn(n,e){return p(),S("div",Zn,[ge(n.$slots,"default")])}const de=Y(Fn,[["render",qn]]);class rs extends z{constructor(){super(...arguments);a(this,"Category",tt.Buffer);a(this,"Position",new b(1e3,1e3))}}const Kn={key:0,class:"selection-box"},jn={class:"offset-container",ref:"offset_container"},Jn=["points"],Qn={key:1,style:{"pointer-events":"none",height:"100%",width:"100%",padding:"30px"}},eo=U({props:{MinScale:{type:Number,default:.5},MaxScale:{type:Number,default:2}},data(){return{Offset:new b(0,0),SelectionBox:new Ot(0,0,0,0),SelectionBoxVisibility:!1,LastMouse:new b(0,0),LastOffset:new b(0,0),Zoom:1,isDragging:!1,_Graph:new as,dragStore:Je(),points:"",GridSize:20,isDragOver:!1,fakeNode:new rs}},computed:{Nodes:function(){return this._Graph.Nodes},OffsetXStyle:function(){return this.Offset.X+"px"},OffsetYStyle:function(){return this.Offset.Y+"px"},EditorCursor:function(){return this.isDragging?"grabbing":"default"},SelectionBoxX:function(){return this.SelectionBox.X+"px"},SelectionBoxY:function(){return this.SelectionBox.Y+"px"},SelectionBoxHeight:function(){return this.SelectionBox.Height+"px"},SelectionBoxWidth:function(){return this.SelectionBox.Width+"px"},OffsetStyle:function(){var n=this.GridSize/2*this.Zoom;return this.Offset.X-n+"px "+(this.Offset.Y-n)+"px"},ScaleGridStyle:function(){var n=(this.GridSize*this.Zoom).toString();return`${n}px ${n}px`}},created(){window.addEventListener("mousemove",this.OnMouseMove),window.addEventListener("mouseup",this.OnMouseUp)},mounted(){this.$nextTick(()=>{var e;this.$el;var n=((e=this.$parent)==null?void 0:e.$el).parentElement;n!=null&&(n.onkeydown=this.KeysHandler)})},methods:{SaveGraph(){var n=Ge.Serialize(this._Graph),e=JSON.stringify(n);console.log(e);var t=JSON.parse(e);console.log(t);var s=Ge.Deserialize(t);console.log(s)},Undo(){var n=re.PopState();n!=null&&(this._Graph=n)},Redo(){var n=re.UnpopState();n!=null&&(this._Graph=n)},isChild(n,e){for(var t=e.parentNode;t!=null;){if(t==n)return!0;t=t.parentNode}return!1},dragenter(){this.isDragOver=!0},dragleave(n){var e=this.$el,t=n.target;this.isChild(e,t)||(this.isDragOver=!1)},drop(n){this.isDragOver=!1;var e=Je(),t=e.getNode();if(t!=null){var s=this.$refs.editor,i=s.getBoundingClientRect();if(i!=null){re.PushState(this._Graph);var o=b.Div(new b(n.clientX-i.x-this.Offset.X,n.clientY-i.y-this.Offset.Y),this.Zoom);t==null||t.Move(o.X,o.Y),this._Graph.AddNode(t)}}},KeysHandler(n){n.key=="Delete"&&(re.PushState(this._Graph),this._Graph.DeleteSelected())},UpdateOffsetStyle(){var n=this.$refs.offset_container;n.style.left=this.OffsetXStyle,n.style.top=this.OffsetYStyle,n.style.scale=this.Zoom.toString()},OnMouseDownLeft:function(n){this.DrawGhostLine(n),n.target==this.$refs.editor&&(this.LastMouse=new b(n.clientX,n.clientY),this.SelectionBox.X=0,this.SelectionBox.Y=0,this.SelectionBox.Width=0,this.SelectionBox.Height=0,this.SelectionBoxVisibility=!0,this._Graph.DeselectAll())},OnMouseDownMiddle:function(n){this.isDragging=!0,this.LastMouse=new b(n.clientX,n.clientY),this.LastOffset={...this.Offset}},OnMouseMove:function(n){if(this.isDragging){n.preventDefault();var e=n.clientX-this.LastMouse.X,t=n.clientY-this.LastMouse.Y;this.Offset.X=this.LastOffset.X+e,this.Offset.Y=this.LastOffset.Y+t,this.UpdateOffsetStyle()}if(this.SelectionBoxVisibility){n.preventDefault();var s=new b(n.clientX,n.clientY),i=new b(Math.min(this.LastMouse.X,s.X),Math.min(this.LastMouse.Y,s.Y)),o=new b(Math.abs(this.LastMouse.X-s.X),Math.abs(this.LastMouse.Y-s.Y)),r=this.$refs.editor,d=r.getBoundingClientRect();this.SelectionBox.X=i.X-d.left,this.SelectionBox.Y=i.Y-d.top,this.SelectionBox.Width=o.X,this.SelectionBox.Height=o.Y,this._Graph.Nodes.forEach(c=>{var u=new Ot(this.Offset.X+c.Position.X*this.Zoom,this.Offset.Y+c.Position.Y*this.Zoom,c.Height*this.Zoom,c.Width*this.Zoom);this.SelectionBox.IntersectsWith(u)?c.SetSelected(!0):c.SetSelected(!1)})}this.DrawGhostLine(n)},OnMouseUp:function(n){this.isDragging=!1,this.SelectionBoxVisibility=!1},OnWheel:function(n){let t=this.$refs.editor.getBoundingClientRect(),s=n.deltaY*.001,i=this.Zoom;this.Zoom=this.Clamp(this.Zoom-s,this.MinScale,this.MaxScale);let o=new b(n.clientX-t.left,n.clientY-t.top),r=(i-this.Zoom)/i;this.Offset=b.Add(this.Offset,b.Mul(b.Sub(o,this.Offset),r)),this.UpdateOffsetStyle()},DisableContextMenu(n){n.preventDefault()},Clamp:function(n,e,t){return Math.min(Math.max(n,e),t)},DrawGhostLine(n){var c;if(this.dragStore.IsDragging){var e=this.$refs.editor,t=e.getBoundingClientRect();if(n.preventDefault(),t!=null){var s=this.dragStore.SourceTerminal,i=b.Add((c=s.ParentNode)==null?void 0:c.Position,s.OffsetPosition),o=b.Div(new b(n.clientX-t.x-this.Offset.X,n.clientY-t.y-this.Offset.Y),this.Zoom),r=s.IsInput?o:i,d=s.IsInput?i:o;this.points=`${r.X},${r.Y} ${r.X+20},${r.Y} ${d.X-20},${d.Y} ${d.X},${d.Y}`}}}}}),to=U({...eo,__name:"GraphRenderer",setup(n){return Ct(e=>({"3ab26e7d":e.EditorCursor,49061380:e.SelectionBoxY,"4906137f":e.SelectionBoxX,cc0f6b00:e.SelectionBoxHeight,"68e5654d":e.SelectionBoxWidth,"2b71e68a":e.ScaleGridStyle,"3fb20644":e.OffsetStyle})),(e,t)=>{const s=Q("font-awesome-icon"),i=Te("tooltip");return p(),S("div",{class:"graph-renderer dot",ref:"editor",onWheel:t[4]||(t[4]=(...o)=>e.OnWheel&&e.OnWheel(...o)),onMousedown:[t[5]||(t[5]=ye((...o)=>e.OnMouseDownLeft&&e.OnMouseDownLeft(...o),["left"])),t[6]||(t[6]=ye((...o)=>e.OnMouseDownMiddle&&e.OnMouseDownMiddle(...o),["middle"]))],onContextmenu:ye(()=>!1,["prevent","right"]),onDragover:t[7]||(t[7]=ye(()=>{},["prevent"])),onDragenter:t[8]||(t[8]=(...o)=>e.dragenter&&e.dragenter(...o)),onDragleave:t[9]||(t[9]=(...o)=>e.dragleave&&e.dragleave(...o)),onDrop:t[10]||(t[10]=(...o)=>e.drop&&e.drop(...o))},[h(ct,{class:"top-left"},{default:I(()=>[h(de,null,{default:I(()=>[se((p(),S("a",{onClick:t[0]||(t[0]=o=>e.Undo())},[h(s,{icon:["fas","rotate-left"]})])),[[i,e.$t("tt.undo"),void 0,{bottom:!0}]]),se((p(),S("a",{onClick:t[1]||(t[1]=o=>e.Redo())},[h(s,{icon:["fas","rotate-right"]})])),[[i,e.$t("tt.redo"),void 0,{bottom:!0}]])]),_:1}),h(de,null,{default:I(()=>[se((p(),S("a",null,[h(s,{icon:["far","copy"]})])),[[i,e.$t("tt.copy"),void 0,{bottom:!0}]]),se((p(),S("a",null,[h(s,{icon:["far","paste"]})])),[[i,e.$t("tt.paste"),void 0,{bottom:!0}]]),se((p(),S("a",{class:be([{disabled:!e._Graph.HasSelected}]),style:{color:"var(--vt-c-red)"},onClick:t[2]||(t[2]=o=>e._Graph.DeleteSelected())},[h(s,{icon:["far","trash-can"]})],2)),[[i,e.$t("tt.delete"),void 0,{bottom:!0}]])]),_:1}),h(de,null,{default:I(()=>[se((p(),S("a",null,[h(s,{icon:["fas","expand"]})])),[[i,e.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),_:1})]),_:1}),h(ct,{class:"bottom-left"},{default:I(()=>[h(de,null,{default:I(()=>[y("span",null,[e.Zoom<1?(p(),j(s,{key:0,icon:["fas","magnifying-glass-minus"]})):(p(),j(s,{key:1,icon:["fas","magnifying-glass-plus"]})),k(" "+O((e.Zoom*100).toFixed(0))+"%",1)])]),_:1}),h(de,null,{default:I(()=>[y("span",null,[h(s,{icon:["fas","up-down-left-right"]}),k(" X: "+O(e.Offset.X.toFixed())+" Y: "+O(e.Offset.Y.toFixed()),1)])]),_:1}),h(de,null,{default:I(()=>[se((p(),S("a",{onClick:t[3]||(t[3]=o=>{e.Offset.Reset(),e.Zoom=1,e.UpdateOffsetStyle()})},[h(s,{icon:["fas","arrows-rotate"]})])),[[i,e.$t("tt.resetView")]])]),_:1}),h(de,null,{default:I(()=>[y("span",null,[h(s,{icon:["fas","circle-info"]}),k(" "+O(e.$t("hints.graphLmb")),1)])]),_:1}),h(de,null,{default:I(()=>[y("span",null,[h(s,{icon:["fas","circle-info"]}),k(" "+O(e.$t("hints.graphWheel")),1)])]),_:1})]),_:1}),e.SelectionBoxVisibility?(p(),S("div",Kn)):ne("",!0),y("div",jn,[h(Gn,{id:"links-container"},{default:I(()=>[h(yt,{name:"link"},{default:I(()=>[(p(!0),S(ie,null,Ie(e._Graph.Links,o=>(p(),j(Hn,{key:o.Id,Link:o},null,8,["Link"]))),128))]),_:1}),e.dragStore.IsDragging?(p(),S("polyline",{key:0,class:"ghost-line",points:e.points},null,8,Jn)):ne("",!0)]),_:1}),h(yt,{name:"delete",tag:"div"},{default:I(()=>[(p(!0),S(ie,null,Ie(e.Nodes,o=>(p(),j(Nt,{key:o.Id,Offset:e.Offset,Zoom:e.Zoom,Node:o},null,8,["Offset","Zoom","Node"]))),128))]),_:1}),h(Nt,{Offset:e.Offset,Zoom:e.Zoom,Node:e.fakeNode},null,8,["Offset","Zoom","Node"])],512),e.isDragOver?(p(),S("div",Qn,t[11]||(t[11]=[y("div",{style:{height:"100%",width:"100%","border-radius":"50px",border:"4px dashed var(--vt-c-black-mute)"}},null,-1)]))):ne("",!0)],544)}}}),so=Y(to,[["__scopeId","data-v-7b3e1448"]]),no={style:{height:"100%"}},oo={style:{"margin-left":"5px"}},io={style:{"margin-left":"5px"}},ao=U({__name:"EditorView",setup(n){return(e,t)=>{const s=Q("font-awesome-icon");return p(),S("div",no,[h(Qe,{style:{width:"20%",display:"inline-block"}},{header:I(()=>[h(s,{icon:["fas","list"]}),t[0]||(t[0]=k()),y("span",oo,O(e.$t("windows.nodesList")),1)]),default:I(()=>[h(mn)]),_:1}),h(Qe,{style:{width:"80%",display:"inline-block"}},{header:I(()=>[h(s,{icon:["fas","circle-nodes"]}),t[1]||(t[1]=k()),y("span",io,O(e.$t("windows.graph")),1)]),default:I(()=>[h(so)]),_:1})])}}}),ro=U({__name:"ToggleSwitch",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(n){const e=cs(n,"modelValue");return(t,s)=>(p(),S("div",{onClick:s[0]||(s[0]=i=>e.value=!e.value),class:be(["container",{"on-state":e.value}])},[y("div",{class:be(["switch",{right:e.value}])},null,2)],2))}}),lo=Y(ro,[["__scopeId","data-v-7fe4f9ed"]]),uo={style:{display:"flex","flex-direction":"row"}},co={style:{width:"100%","font-weight":"bold","text-align":"left","margin-left":"10px"}},ho={style:{width:"100%","font-weight":"bold","text-align":"right","margin-right":"10px"}},fo={style:{width:"10px","margin-right":"10px"}},po={key:0,class:"dropdown"},mo=["onClick"],vo=U({__name:"SelectDropdown",props:{options:{type:Array,required:!1,default:[]},title:{type:String,required:!1,default:""},default:{type:String,required:!1,default:null},modelValue:{type:String,default:""},RealtimeChange:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(n,{emit:e}){G(!1);const t=n,s=G(t.default?t.default:t.options.length>0?t.options[0]:null),i=G(!1);Xe(()=>t.modelValue,r=>{s.value=r});const o=()=>{var r=fe();t.RealtimeChange&&(r.ChangeEvent=!r.ChangeEvent)};return(r,d)=>{const c=Q("font-awesome-icon");return p(),S("div",{class:"dropdown-head input-element value",tabindex:"0",onBlur:d[1]||(d[1]=u=>i.value=!1),style:{width:"100%",position:"relative"}},[y("div",{onClick:d[0]||(d[0]=u=>i.value=!i.value),style:{height:"100%"}},[y("div",uo,[y("div",co,O(t.title)+O(t.title==""?"":":"),1),y("div",ho,O(s.value),1),y("div",fo,[i.value?(p(),j(c,{key:1,icon:["fas","angle-up"]})):(p(),j(c,{key:0,icon:["fas","angle-down"]}))])])]),i.value?(p(),S("ul",po,[(p(!0),S(ie,null,Ie(n.options,(u,f)=>(p(),S("li",{class:be({selected:u==s.value}),key:f,onClick:m=>{s.value=u,i.value=!1,r.$emit("update:modelValue",s.value),o()}},O(u),11,mo))),128))])):ne("",!0)],32)}}}),go=Y(vo,[["__scopeId","data-v-66e3177b"]]),Vo={},wo={class:"btn"},yo={key:0,class:"dropdown"};function So(n,e){const t=Q("flag");return p(),S(ie,null,[y("button",wo,[h(t,{iso:"ru"}),e[0]||(e[0]=k(" Русский "))]),(p(),S("ul",yo,[y("li",null,[h(t,{iso:"ru"}),e[1]||(e[1]=k(" Русский"))]),y("li",null,[h(t,{iso:"gb"}),e[2]||(e[2]=k(" English"))])]))],64)}const _o=Y(Vo,[["render",So],["__scopeId","data-v-4511bd2c"]]),bo={class:"main"},Io={class:"disable-user-select left-section"},Po={class:"padding"},No={class:"middle-actions"},Oo=U({__name:"MainMenuBar",setup(n){const e=Mt(),t=G(!1);Xe(t,(i,o)=>{i?document.documentElement.requestFullscreen():document.exitFullscreen()});const s=i=>{e!=null&&(e.appContext.config.globalProperties.$i18n.locale=i,localStorage.setItem("userLang",i))};return(i,o)=>{const r=Q("font-awesome-icon"),d=Q("flag"),c=Te("tooltip");return p(),S("div",bo,[y("div",Io,[o[3]||(o[3]=y("div",{class:"logo disable-user-select"},"TerraForge",-1)),se(h(lo,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=u=>t.value=u)},null,8,["modelValue"]),[[c,i.$t("tt.fullscreen"),void 0,{bottom:!0}]])]),y("div",Po,[y("div",No,[y("button",null,[h(r,{icon:["fas","border-all"]}),o[4]||(o[4]=k(" 0.5K ")),h(r,{icon:["fas","angle-down"]})]),y("button",null,[h(r,{icon:["fas","floppy-disk"]})]),y("button",null,[h(r,{icon:["fas","folder-open"]})])])]),y("div",null,[h(_o),y("button",{class:"btn",onClick:o[1]||(o[1]=u=>s("ru"))},[h(d,{iso:"ru"}),o[5]||(o[5]=k(" ru"))]),y("button",{class:"btn",onClick:o[2]||(o[2]=u=>s("en"))},[h(d,{iso:"gb"}),o[6]||(o[6]=k(" en"))])])])}}}),Mo=Y(Oo,[["__scopeId","data-v-64b91772"]]),Lo=U({props:{Min:Number,Max:Number,Suffix:String,Title:String,RealtimeChange:{type:Boolean,default:!0},Step:{type:Number,default:0},modelValue:{type:Number,default:0}},emits:["update:modelValue"],data(){return{IsDragging:!1,Value:0,lastPosition:new b(0,0),lastValue:0,IsInputVisible:!1,moveDistance:0}},created(){document.addEventListener("mousemove",this.OnMouseMove),document.addEventListener("mouseup",this.OnMouseUp),this.Value=this.modelValue},watch:{modelValue(n,e){this.Value=n}},methods:{ClickValue(n){this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n,this.Min,this.Max):this.Value=this.Clamp(this.Value+(n>0?this.Step:-this.Step),this.Min,this.Max):this.Step==0?this.Value+=n:this.Value+=n>0?this.Step:-this.Step,this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnInput(n){this.Value=Number(n.target.value),this.Min!=null&&this.Max!=null&&(this.Value=this.Clamp(this.Value,this.Min,this.Max)),this.$emit("update:modelValue",this.Value),this.UpdateEvent()},OnMouseDown(n){this.IsInputVisible||(this.$el.requestPointerLock(),this.IsDragging=!0,this.lastPosition=new b(n.clientX,n.clientY),this.lastValue=this.Value,this.moveDistance=0)},OnMouseMove(n){this.IsDragging&&(this.moveDistance+=n.movementX,this.Min!=null&&this.Max!=null?this.Step==0?this.Value=this.Clamp(this.Value+n.movementX/(n.shiftKey?25:50),this.Min,this.Max):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value=this.Clamp(this.Value+(n.movementX>0?this.Step:-this.Step),this.Min,this.Max)):this.Step==0?this.Value+=n.movementX/(n.shiftKey?25:50):n.movementX!=0&&Math.abs(this.moveDistance)>=(n.shiftKey?25:50)&&(this.moveDistance=0,this.Value+=n.movementX>0?this.Step:-this.Step),this.$emit("update:modelValue",this.Value),this.UpdateEvent())},OnMouseUp(n){var e=new b(n.clientX,n.clientY);e.X==this.lastPosition.X&&e.Y==this.lastPosition.Y&&this.Value==this.lastValue&&(this.IsInputVisible=!0,this.$nextTick(()=>{var t=this.$refs.input;t.focus(),t.select()})),this.IsDragging=!1,document.exitPointerLock()},UpdateEvent(){var n=fe();this.RealtimeChange&&(n.ChangeEvent=!n.ChangeEvent)},validate(n){n.key=="Enter"&&n.target.blur();var e=/[0-9-]|\./;e.test(n.key)||n.preventDefault()},Clamp(n,e,t){return Math.min(Math.max(n,e),t)}}}),ko={ref:"inputRange",class:"input-range"},Co=["value"],$o={class:"title"},xo={class:"valueText"};function Do(n,e,t,s,i,o){const r=Q("font-awesome-icon");return p(),S("div",ko,[y("div",{class:"button",onClick:e[0]||(e[0]=d=>n.ClickValue(-.1))},[h(r,{icon:["fas","caret-left"]})]),y("div",{class:"value",onMousedown:e[4]||(e[4]=ye((...d)=>n.OnMouseDown&&n.OnMouseDown(...d),["left"]))},[n.IsInputVisible?(p(),S("input",{key:0,onKeypress:e[1]||(e[1]=(...d)=>n.validate&&n.validate(...d)),ref:"input",class:"input-element",value:n.modelValue,onInput:e[2]||(e[2]=(...d)=>n.OnInput&&n.OnInput(...d)),onBlur:e[3]||(e[3]=d=>n.IsInputVisible=!1)},null,40,Co)):(p(),S(ie,{key:1},[y("div",$o,O(n.Title)+": ",1),y("div",xo,O(Number(n.Value.toFixed(4)))+" "+O(n.Suffix),1)],64))],32),y("div",{class:"button",onClick:e[5]||(e[5]=d=>n.ClickValue(.1))},[h(r,{icon:["fas","caret-right"]})])],512)}const To=Y(Lo,[["render",Do],["__scopeId","data-v-85813c7d"]]),Ro={class:"properties"},Ao={key:0,class:"not-selected"},Xo={class:"header"},Go={style:{width:"100%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Yo={class:"buttons",style:{display:"flex","font-weight":"bold"}},Bo={class:"btn"},Eo={key:0,style:{margin:"0px 10px"}},Ho={class:"input-group",style:{width:"100%",padding:"0px"}},Uo=U({__name:"PropertiesView",setup(n){const e=he();var t=ve(()=>e.SelectedNode),s=ve(()=>e.SelectedNode==null||e.SelectedNode instanceof Se),i=ve(()=>{var d;return r((d=t.value)==null?void 0:d.Properties)});const o=()=>{if(e.SelectedNode!=null&&e.SelectedNode!=null&&e.SelectedNode){for(var d of e.SelectedNode.Properties)d.Reset();var c=fe();c.ChangeEvent=!c.ChangeEvent}};var r=d=>{var c=new Map;return d==null||d.length==0||d.forEach(u=>{var f;c.has(u.Category)||c.set(u.Category,new Array),(f=c.get(u.Category))==null||f.push(u)}),c};return(d,c)=>{var m;const u=Q("font-awesome-icon"),f=Te("tooltip");return p(),S("div",Ro,[C(s)?(p(),S("div",Ao,[h(u,{icon:["fas","sliders"]})])):ne("",!0),C(s)?ne("",!0):(p(),S(ie,{key:1},[y("div",Xo,[y("div",Go,O(d.$t((m=C(t))==null?void 0:m.Name)),1),y("div",Yo,[se((p(),S("button",Bo,[h(u,{icon:["fas","sliders"]})])),[[f,d.$t("tt.presets"),void 0,{bottom:!0}]]),se((p(),S("button",{class:"btn",onClick:o},[h(u,{icon:["fas","arrows-rotate"]})])),[[f,d.$t("tt.resetParams"),void 0,{bottom:!0}]])])]),C(t).Name?(p(),S("hr",Eo)):ne("",!0),(p(!0),S(ie,null,Ie(C(i),([v,M])=>(p(),j(dt,{style:{"background-color":"transparent",padding:"0px"}},{header:I(()=>[k(O(v),1)]),default:I(()=>[y("div",Ho,[(p(!0),S(ie,null,Ie(M,_=>(p(),S(ie,null,[typeof _.Value=="number"?(p(),j(To,{key:0,modelValue:_.Value,"onUpdate:modelValue":P=>_.Value=P,Min:_.Min,Max:_.Max,Step:_.Step,Suffix:_.Suffix,Title:_.Name},null,8,["modelValue","onUpdate:modelValue","Min","Max","Step","Suffix","Title"])):ne("",!0),_.valueList!=null?(p(),j(go,{key:1,modelValue:_.Value,"onUpdate:modelValue":P=>_.Value=P,default:_.Value,title:_.Name,options:_.valueList},null,8,["modelValue","onUpdate:modelValue","default","title","options"])):ne("",!0)],64))),256))])]),_:2},1024))),256))],64))])}}}),Wo=Y(Uo,[["__scopeId","data-v-00af43f3"]]);function zo(n){return new Worker("/assets/MeshGenerationWorker-DdK6sfo-.js",{name:n==null?void 0:n.name})}class Fo{constructor(){a(this,"GridMaterial");a(this,"GridMesh");const e=l(.5).toVar(),t=l(5).toVar(),s=l(1*window.devicePixelRatio).toVar(),i=l(500).toVar(),o=l(200).toVar(),r=ut(.2,.2,.2,.2).toVar(),d=ut(.05,.05,.05,.2).toVar(),c=Is,u=Ps,f=N(([A,x])=>{const D=_t(A,x),Z=Ye(R(Pe(R(D,.5)),.5)),X=_t(Z,At(D));return J(X.x,X.y)}),m=f(c.xz,e),v=f(c.xz,t),M=R(1,Ue(0,s,m)),_=R(1,Ue(0,s,v)),P=R(c,u),B=je(P),L=Ue(l(i),l(0),B),F=Ue(l(o),l(0),B),oe=K(r,K(M,F)).toVar(),st=K(d,K(_,L)).toVar(),nt=Ns(st,oe),pe=new Xt;pe.colorNode=nt,pe.transparent=!0,pe.side=mt,pe.lights=!1;const W=new Gt(1e3,1e3,1,1);W.rotateX(-Math.PI/2);const E=new vt(W,pe);this.GridMesh=E,this.GridMaterial=pe}}class Zo{constructor(){a(this,"Mesh");const e=N(([o,r,d])=>{const c=g(o.x,o.y).toVar(),u=g(Ye(c.mul(2).sub(1)).sub(g(r,d))).toVar();return u.assign(l(1).sub(u.div(At(u)))),Os(J(u.x,u.y))});var t=new Ms({color:"#fff",transparent:!0,side:mt});t.colorNode=N(()=>{const o=e(We(),1,1).toVar(),r=e(We(),.9,1).toVar(),d=e(We(),1,.9).toVar(),c=e(We(),.98,.98).toVar(),u=Ve(0,1,o.sub(r).sub(d).sub(c)).toVar();return ut(.8,.8,.8,u)})();var s=new Gt(1,1,1,1);s.rotateX(-Math.PI/2);var i=new vt(s,t);i.castShadow=!1,i.receiveShadow=!1,i.scale.set(10,1,10),i.position.set(0,.005,0),this.Mesh=i}}class qo{constructor(){a(this,"Height",2);a(this,"GPURenderer");a(this,"HeightTexture");a(this,"TerrainMaterial");a(this,"HeightArray");a(this,"IsMeshGenerated");a(this,"Scene");a(this,"Camera");a(this,"Controls");a(this,"TerrainMesh");a(this,"GridMesh");a(this,"GridMaterial");a(this,"DirectionalLight");a(this,"DirectionalLight2");a(this,"_resolution",512);a(this,"_canvas");this.IsMeshGenerated=G(!1),this.CreateRenderer(),this.Scene=new Ls,this.Scene.environmentNode=ks("#ffffff"),this.Scene.environmentIntensity=.05,this.Camera=new Cs(75,1,.1,1e3),this.Camera.position.z=10,this.Camera.position.y=10,this.CreateMaterial(),this.CreateTexture(this._resolution),this.CreateTerrainMesh(this.Resolution),this.CreateLight();const e=new Fo;this.Scene.add(this.DirectionalLight),this.Scene.add(this.DirectionalLight2),this.GridMesh=e.GridMesh,this.Scene.add(this.GridMesh);const t=fe();t.SetRenderer(this),t.Resolution=this.Resolution}get Resolution(){return this._resolution}CreateMaterial(){this.TerrainMaterial=new Xt({color:"#a2a2a2"}),this.TerrainMaterial.side=mt,this.TerrainMaterial.needsUpdate=!0,this.TerrainMaterial.roughness=1;const e=$s(it());this.TerrainMaterial.positionNode=N(()=>{const t=l(1/this.Resolution),s=ze.xyz.add(it(t,0,0)).toVar(),i=ze.xyz.add(it(0,0,t.negate())).toVar(),o=l(1).sub(t).toVar(),r=ze.xyz.toVar(),d=at(this.HeightTexture,ze.xz.add(.5).mul(o)).mul(this.Height);r.y.addAssign(d),s.y.addAssign(at(this.HeightTexture,s.xz.add(.5).mul(o)).mul(this.Height)),i.y.addAssign(at(this.HeightTexture,i.xz.add(.5).mul(o)).mul(this.Height));const c=s.sub(r).normalize(),u=i.sub(r).normalize();return e.assign(xs(c,u)),r})(),this.TerrainMaterial.normalNode=Ds(e)}CreateRenderer(){this.GPURenderer=new Ts({alpha:!0,antialias:!0}),this.GPURenderer.shadowMap.enabled=!0,this.GPURenderer.shadowMap.type=Rs,this.GPURenderer.toneMapping=As,this.GPURenderer.setClearColor(0,0),this.GPURenderer.setPixelRatio(window.devicePixelRatio)}CreateTexture(e){this.HeightTexture=new Xs(Math.floor(this.Resolution),Math.floor(this.Resolution)),this.HeightTexture.format=Gs,this.HeightTexture.type=Ys}CreateLight(){const e=new bt(16777215,2);e.position.set(-10,10,0),e.castShadow=!0,e.shadow.camera.near=.1,e.shadow.camera.far=30,e.shadow.camera.top=8,e.shadow.camera.right=8,e.shadow.camera.bottom=-8,e.shadow.camera.left=-8,e.shadow.mapSize.set(2048,2048),e.shadow.radius=5,e.shadow.blurSamples=25,e.shadow.normalBias=.05,this.DirectionalLight=e;const t=new bt(16777215,.5);t.position.set(10,10,0),this.DirectionalLight2=t}CreateTerrainMesh(e){let t=new zo;t.onmessage=async i=>{var o=new Bs;o.setIndex(new Fe(new Uint32Array(i.data.indices),1)),o.setAttribute("position",new Fe(new Float32Array(i.data.position),3)),o.setAttribute("normal",new Fe(new Float32Array(i.data.normal),3)),o.setAttribute("uv",new Fe(new Float32Array(i.data.uv),2)),this.TerrainMesh=new vt(o,this.TerrainMaterial),this.TerrainMesh.castShadow=!0,this.TerrainMesh.receiveShadow=!0,this.TerrainMesh.scale.set(10,1,10),this.TerrainMesh.position.set(0,.006,0),this.Scene.add(this.TerrainMesh),this.IsMeshGenerated.value=!0},t.postMessage(e);var s=new Zo;this.Scene.add(s.Mesh)}ChangeResolution(e){this.Scene.remove(this.TerrainMesh),this._resolution=e,this.CreateTerrainMesh(this._resolution),this.CreateTexture(this._resolution),this.Scene.add(this.TerrainMesh)}OnWindowResize(){if(this.GPURenderer==null||this.Camera==null||this._canvas==null)return;var e=this._canvas.offsetHeight,t=this._canvas.offsetWidth;this.GPURenderer.setSize(t,e);const s=t/e;this.Camera.aspect=s,this.Camera.updateProjectionMatrix(),requestAnimationFrame(()=>this.Render())}async Render(){await this.GPURenderer.renderAsync(this.Scene,this.Camera)}Mount(e){this._canvas=e;var t=this._canvas.offsetHeight,s=this._canvas.offsetWidth;this._canvas.appendChild(this.GPURenderer.domElement),this.GPURenderer.setSize(s,t),this.Camera.aspect=s/t,this.Controls=new Es(this.Camera,this.GPURenderer.domElement),this.Controls.enablePan=!1,this.Controls.update(),window.addEventListener("resize",()=>this.OnWindowResize()),this.Render(),requestAnimationFrame(()=>this.Render)}RequestRender(){requestAnimationFrame(()=>this.Render)}async Recalculate(e,t=!1){t||e.Calculate();var s=e.Outputs[e.DefaultOutput].Value;const o=N(()=>{const r=ce.modInt(this.Resolution),d=ce.div(this.Resolution),c=qe(r,d),u=g(c.x,c.y).div(this.Resolution).toVar(),f=s(u).toVar();f.assign(Ve(f,0,1)),Hs(this.HeightTexture,c,f).toWriteOnly()})().compute(this.Resolution*this.Resolution);this.GPURenderer.computeAsync(o).then(()=>{e.CalculationState=_e.Calculated,requestAnimationFrame(()=>this.Render())})}SetGridVisible(e){this.GridMesh.visible=e,requestAnimationFrame(()=>this.Render())}}const Ko={class:"container"},jo={key:0,style:{position:"relative",height:"100%",width:"100%"}},Jo=U({__name:"Preview3D",setup(n){const e=G();e.value=new qo,G(e.value.IsMeshGenerated.value);const t=G();var s=fe();const i=ve(()=>s.ChangeEvent);var o=he();const r=ve(()=>o.SelectedNode),d=ve(()=>{var P;return(P=e.value)==null?void 0:P.IsMeshGenerated});Xe(d,async(P,B)=>{requestAnimationFrame(()=>{var L;return(L=e.value)==null?void 0:L.Render()})}),Xe(i,async(P,B)=>{var L,F;o.LockedNode!=null?(L=e.value)==null||L.Recalculate(o.LockedNode,!1):r.value!=null&&((F=e.value)==null||F.Recalculate(r.value,!1))}),Xe(r,async P=>{var L,F;if(o.LockedNode!=null)(L=e.value)==null||L.Recalculate(o.LockedNode);else if(P!=null){var B=P;await((F=e.value)==null?void 0:F.Recalculate(B))}}),Lt(()=>{kt(()=>{var P;(P=e.value)==null||P.Mount(t.value)})});let c=!1;const u=()=>{c=!0},f=()=>{c=!1};window.addEventListener("mouseup",f),window.addEventListener("pointerup",f);const m=()=>{c&&requestAnimationFrame(()=>{var P;return(P=e.value)==null?void 0:P.Render()})},v=()=>{requestAnimationFrame(()=>{var P;return(P=e.value)==null?void 0:P.Render()})},M=G(!0),_=()=>{var P;M.value=!M.value,(P=e.value)==null||P.SetGridVisible(M.value)};return(P,B)=>{var oe;const L=Q("font-awesome-icon"),F=Te("tooltip");return p(),S("div",Ko,[(oe=e.value)!=null&&oe.IsMeshGenerated?ne("",!0):(p(),S("div",jo,[h(is,{style:{scale:"2"}}),B[0]||(B[0]=y("span",{style:{position:"absolute !important",top:"calc(50% + 20px)",width:"100%","text-align":"center"}}," Initializing mesh...",-1))])),y("div",{onMousedown:u,onMousemove:m,onWheel:v,onPointerdown:u,onPointermove:m,ref_key:"canvas",ref:t,style:{height:"100%",width:"100%"}},[h(ct,{class:"top-left"},{default:I(()=>[h(de,null,{default:I(()=>[se((p(),S("a",{onClick:_},[h(L,{icon:["fas","hashtag"]})])),[[F,"Switch Grid visibility",void 0,{bottom:!0}]])]),_:1})]),_:1})],544)])}}}),Qo=Y(Jo,[["__scopeId","data-v-41874a11"]]),ei={style:{width:"100%",height:"100%"}},ti={style:{height:"calc(100% - 80px)",display:"flex"}},si={style:{width:"80%",height:"100%",display:"inline-block"}},ni={style:{height:"50%",width:"100%",display:"block"}},oi={style:{"margin-left":"5px"}},ii={style:{height:"50%"}},ai={style:{width:"20%",height:"100%",display:"inline-block"}},ri={style:{"margin-left":"5px"}},li=U({__name:"LayoutView",setup(n){return(e,t)=>{const s=Q("font-awesome-icon");return p(),S("div",ei,[h(Mo,{style:{height:"50px"}}),y("div",ti,[y("div",si,[y("div",ni,[h(Qe,{style:{display:"inline-block",width:"100%"}},{header:I(()=>[h(s,{icon:["fas","mountain-sun"]}),y("span",oi,O(e.$t("windows.thirdPreview")),1)]),default:I(()=>[h(Qo)]),_:1})]),y("div",ii,[h(ao)])]),y("div",ai,[h(Qe,{"wheel-focus":!1},{header:I(()=>[h(s,{icon:["fas","sliders"]}),y("span",ri,O(e.$t("windows.properties")),1)]),default:I(()=>[h(Wo)]),_:1})])]),h(en,{style:{height:"30px"}})])}}}),ui=Y(li,[["__scopeId","data-v-7b326d50"]]),di=hs({history:fs("/"),routes:[{path:"/",name:"home",component:ui}]});function ci(){H.register(Se),H.register(zt),H.register(Ut),H.register(Bt),H.register(ts),H.register(jt),H.register(rs),H.register(Jt),H.register(es),H.register(qt),H.register(Ft),H.register(Qt),H.register(Ht),H.register(Zt),H.register(Wt),H.register(Kt),H.register(ss),H.register(ns),H.register(os)}const hi={en:{"":"",windows:{thirdPreview:"3D Preview",secondPreview:"2D Preview",properties:"Node properties",graph:"Graph",nodesList:"Nodes list"},tt:{undo:"Undo",redo:"Redo",copy:"Copy",paste:"Paste",delete:"Delete node",fullscreen:"Fullscreen",save:"Save",load:"Load",presets:"Presets",resetView:"Reset view",resetParams:"Reset node parameters to default"},hints:{graphLmb:"LMB: Select/Drag node",graphWheel:"Wheel: Zoom/Drag work space"},nodes:{constant:"Constant",perlinNoise:"Perlin Noise",mountain:"Mountain",terrace:"Terrace",combine:"Combine",clamp:"Clamp",invert:"Invert",redistribution:"Redistribution",gradientNoise:"Gradient Noise",voronoi:"Voronoi",crater:"Crater",falloff:"Falloff",fastErosion:"Fast Erosion",cracks:"Cracks",transform:"Transform",tile:"Tile",height:"Height"},nodeCategories:{testNodes:"Test nodes"}},ru:{windows:{thirdPreview:"3D Просмотр",secondPreview:"2D Просмотр",properties:"Параметры узла",graph:"Граф",nodesList:"Список узлов"},tt:{undo:"Отменить",redo:"Повторить",copy:"Копировать",paste:"Вставить",delete:"Удалить узел",fullscreen:"На весь экран",save:"Сохранить",load:"Загрузить",presets:"Предустановки",resetView:"Сбросить вид",resetParams:"Сбросить параметры узла до значений по умолчанию"},hints:{graphLmb:"ЛКМ: Выделить/Передвинуть узел",graphWheel:"Колесо мыши: Приближение/Перемещение рабочей области"},nodes:{constant:"Константа",perlinNoise:"Шум Перлина",mountain:"Гора",terrace:"Террасы",combine:"Комбинирование",clamp:"Ограничение",invert:"Инверсия",redistribution:"Перераспределение",gradientNoise:"Градиентный Шум",voronoi:"Шум Вороного",crater:"Кратер",falloff:"Спад",fastErosion:"Быстрая Эрозия",cracks:"Трещины",transform:"Преобразование",tile:"Плитка",height:"Высота"},nodeCategories:{testNodes:"Тестовые узлы"}}};pt.options.themes.tooltip.delay.show=0;pt.options.distance=10;ps.add(Us,ms);const fi=vs({legacy:!1,locale:"en",fallbackLocale:"en",messages:hi}),Ne=gs(qs);Ne.component("font-awesome-icon",Vs);Ne.use(ws());Ne.use(di);Ne.use(pt);Ne.use(fi);Ne.use(ys);Ne.mount("#app");ci();
